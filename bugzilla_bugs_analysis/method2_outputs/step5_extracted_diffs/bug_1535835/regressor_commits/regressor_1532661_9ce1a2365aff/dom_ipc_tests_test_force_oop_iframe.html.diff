# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/ipc/tests/test_force_oop_iframe.html
# Commit: 9ce1a2365aff
# Full Hash: 9ce1a2365afff092f9107a5f1ae1eca6a34dfce3
# Author: Nika Layzell <nika@thelayzells.com>
# Date: 2019-03-15 03:42:43
# Regressor Bug: 1532661
# File Overlap Count: 2
# Description:
#   Bug 1532661 - Part 4: Support initializing complete BrowsingContextGroups in a single op with an IPCInitializer struct, r=farre
#   
#   Depends on D22192
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D22193
# ==============================================================================

diff -r 58f77fa35eea -r 9ce1a2365aff dom/ipc/tests/test_force_oop_iframe.html
--- a/dom/ipc/tests/test_force_oop_iframe.html	Thu Mar 14 18:51:07 2019 +0000
+++ b/dom/ipc/tests/test_force_oop_iframe.html	Thu Mar 14 18:51:09 2019 +0000
@@ -13,7 +13,8 @@
 /* eslint-env mozilla/frame-script */
 
 add_task(async function() {
-  await SpecialPowers.pushPrefEnv({"set": [["fission.oopif.attribute", true]]});
+  await SpecialPowers.pushPrefEnv({"set": [["fission.oopif.attribute", true],
+                                           ["dom.ipc.processCount", 10000]]});
 
   // This iframe should be loaded out of process. Unfortunately as of the time
   // of this test's creation, many different events which we could use to detect
@@ -48,6 +49,15 @@
   is(frameLoader.tabParent, null);
 
   await contentCreated;
+
+  ok(frameLoader.browsingContext, "Has BrowsingContext");
+  ok(frameLoader.browsingContext.parent, "BrowsingContext has parent");
+
+  let wgc = SpecialPowers.wrap(window).getWindowGlobalChild();
+  ok(wgc, "we have a WindowGlobalChild");
+  is(SpecialPowers.unwrap(wgc.browsingContext),
+     SpecialPowers.unwrap(frameLoader.browsingContext.parent),
+     "BrowsingContext matches");
 });
 
 </script>
