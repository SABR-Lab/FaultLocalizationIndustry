# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/modules/WebProgressChild.jsm
# Commit: e1fbefe38944
# Full Hash: e1fbefe38944eb82d3c2e87a0307b121daf0e830
# Author: Barret Rennie <barret@brennie.ca>
# Date: 2019-04-04 04:33:36
# Regressor Bug: 1510569
# File Overlap Count: 1
# Description:
#   Bug 1510569 - Port onProgressChange notifications inside WebProgressChild.jsm to C++ r=baku
#   
#   We do not need to handle onProgressChange64 notifications since the TabChild's
#   web progress events are filtered through an nsBrowserStatusFilter, which
#   truncates onProgresChange64 event values to 32-bit integers and then calls
# ==============================================================================

diff -r 102881458323 -r e1fbefe38944 toolkit/modules/WebProgressChild.jsm
--- a/toolkit/modules/WebProgressChild.jsm	Wed Apr 03 17:32:21 2019 +0000
+++ b/toolkit/modules/WebProgressChild.jsm	Wed Apr 03 17:32:41 2019 +0000
@@ -27,10 +27,12 @@
 
     this.inLoadURI = false;
 
-    // NOTIFY_CONTENT_BLOCKING and NOTIFY_STATUS_CHANGE are handled by PBrowser.
+    // NOTIFY_PROGRESS, NOTIFY_STATUS, and NOTIFY_CONTENT_BLOCKING are handled
+    // by PBrowser.
     let notifyCode = Ci.nsIWebProgress.NOTIFY_ALL &
-                        ~Ci.nsIWebProgress.NOTIFY_CONTENT_BLOCKING &
-                        ~Ci.nsIWebProgress.NOTIFY_STATUS;
+                        ~Ci.nsIWebProgress.NOTIFY_PROGRESS &
+                        ~Ci.nsIWebProgress.NOTIFY_STATUS &
+                        ~Ci.nsIWebProgress.NOTIFY_CONTENT_BLOCKING;
 
     this._filter = Cc["@mozilla.org/appshell/component/browser-status-filter;1"]
                      .createInstance(Ci.nsIWebProgress);
@@ -118,24 +120,6 @@
     this._send("Content:StateChange", json);
   }
 
-  // Note: Because the nsBrowserStatusFilter timeout runnable is
-  // SystemGroup-labeled, this method should not modify this.mm.content DOM or
-  // run this.mm.content JS.
-  onProgressChange(aWebProgress, aRequest, aCurSelf, aMaxSelf, aCurTotal, aMaxTotal) {
-    let json = this._setupJSON(aWebProgress, aRequest);
-
-    json.curSelf = aCurSelf;
-    json.maxSelf = aMaxSelf;
-    json.curTotal = aCurTotal;
-    json.maxTotal = aMaxTotal;
-
-    this._send("Content:ProgressChange", json);
-  }
-
-  onProgressChange64(aWebProgress, aRequest, aCurSelf, aMaxSelf, aCurTotal, aMaxTotal) {
-    this.onProgressChange(aWebProgress, aRequest, aCurSelf, aMaxSelf, aCurTotal, aMaxTotal);
-  }
-
   onLocationChange(aWebProgress, aRequest, aLocationURI, aFlags) {
     let json = this._setupJSON(aWebProgress, aRequest);
 
