# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/wr/webrender/src/resource_cache.rs
# Commit: d9a0cc432b2e
# Full Hash: d9a0cc432b2e898d3fc74a2183c931018237c668
# Author: Nicolas Silva <nsilva@mozilla.com>
# Date: 2019-04-27 09:45:52
# Description:
#   Bug 1546126 - Fix the max blob tile limit logic. r=kats
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D28991
# ==============================================================================

diff -r 76dd4019ac47 -r d9a0cc432b2e gfx/wr/webrender/src/resource_cache.rs
--- a/gfx/wr/webrender/src/resource_cache.rs	Fri Apr 26 16:44:53 2019 +0000
+++ b/gfx/wr/webrender/src/resource_cache.rs	Fri Apr 26 15:38:54 2019 +0000
@@ -1216,14 +1216,16 @@
                     && (tiles.size.width > MAX_TILES_PER_REQUEST
                         || tiles.size.height > MAX_TILES_PER_REQUEST
                         || tiles.size.width * tiles.size.height > MAX_TILES_PER_REQUEST) {
-                    let diff = tiles.size.width * tiles.size.height - MAX_TILES_PER_REQUEST;
+                    let w = tiles.size.width;
+                    let h = tiles.size.height;
+                    let diff = w * h - MAX_TILES_PER_REQUEST;
                     // Remove tiles in the largest dimension.
                     if tiles.size.width > tiles.size.height {
-                        tiles.size.width -= diff / tiles.size.height + 1;
-                        tiles.origin.x += diff / (2 * tiles.size.height);
+                        tiles.size.width -= diff / h + 1;
+                        tiles.origin.x += diff / (2 * h);
                     } else {
-                        tiles.size.height -= diff / tiles.size.width + 1;
-                        tiles.origin.y += diff / (2 * tiles.size.height);
+                        tiles.size.height -= diff / w + 1;
+                        tiles.origin.y += diff / (2 * w);
                     }
                 }
 
