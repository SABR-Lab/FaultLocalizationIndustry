# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit-test/tests/debug/onEnterFrame-async-resumption-13.js
# Commit: c3ea428d6b2a
# Full Hash: c3ea428d6b2a4ab026fea0e1dc5c0776720d1b2d
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2019-05-08 03:38:51
# Description:
#   Bug 1547039: Adjust async-generator state when manually closing an async-generator. r=arai
#   
#   Similar to AutoSetGeneratorRunning, AdjustGeneratorResumptionValue also needs to modify the
#   async-generator state in addition to the shared generator state.
#   
# ==============================================================================

diff -r 723587a2ae49 -r c3ea428d6b2a js/src/jit-test/tests/debug/onEnterFrame-async-resumption-13.js
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/js/src/jit-test/tests/debug/onEnterFrame-async-resumption-13.js	Tue May 07 04:11:58 2019 +0000
@@ -0,0 +1,21 @@
+// An onPop handler can return its input argument for async generators. The
+// debugger correctly adjusts the state of the async generator object.
+
+let g = newGlobal({newCompartment: true});
+g.eval(`
+    async function* f() {}
+`);
+
+let hits = 0;
+let dbg = new Debugger(g);
+dbg.onEnterFrame = frame => {
+  frame.onPop = completion => {
+      hits++;
+      return completion;
+  };
+};
+
+let it = g.f();
+let p = it.next();
+
+assertEq(hits, 1);