# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/vm/Debugger.cpp
# Commit: b86f47596771
# Full Hash: b86f47596771c90b024b235a8c29ed16438bf94c
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2019-03-27 04:44:00
# Regressor Bug: 1530754
# File Overlap Count: 1
# Description:
#   Bug 1530754 - Part 3: Don't create unnecessary iterator result objects in async generators. r=arai
#   
#   Per spec, IteratorValue() must be called outside of the implicit try-catch-finally
#   block in yield*. But when IteratorValue is already called in the generated byte
#   code for yield*, we no longer have an iterator result object to pass back to
# ==============================================================================

diff -r 98c9901e6ca6 -r b86f47596771 js/src/vm/Debugger.cpp
--- a/js/src/vm/Debugger.cpp	Tue Mar 26 16:25:37 2019 +0000
+++ b/js/src/vm/Debugger.cpp	Tue Mar 26 16:26:42 2019 +0000
@@ -1609,9 +1609,9 @@
     Rooted<AbstractGeneratorObject*> genObj(
         cx, GetGeneratorObjectForFrame(cx, frame));
     if (genObj) {
-      // 1.  `return <value>` creates and returns a new object,
-      //     `{value: <value>, done: true}`.
-      if (!genObj->isBeforeInitialYield()) {
+      // 1.  `return <value>` creates and returns a new object in non-async
+      //     generators, `{value: <value>, done: true}`.
+      if (!frame.callee()->isAsync() && !genObj->isBeforeInitialYield()) {
         JSObject* pair = CreateIterResultObject(cx, vp, true);
         if (!pair) {
           getAndClearExceptionThenThrow();