# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/base/nsILoadInfo.idl
# Commit: ddf4012a7652
# Full Hash: ddf4012a7652e36d144fc43bc99335276deeafbe
# Author: Christoph Kerschbaumer <ckerschb@christophkerschbaumer.com>
# Date: 2019-05-22 03:40:58
# Regressor Bug: 965637
# File Overlap Count: 1
# Description:
#   Bug 965637: Move CSP from Principal into Client, part 1: backend changes. r=mccr8
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D27654
# ==============================================================================

diff -r 6c2047bc2f3e -r ddf4012a7652 netwerk/base/nsILoadInfo.idl
--- a/netwerk/base/nsILoadInfo.idl	Tue May 21 22:51:54 2019 +0000
+++ b/netwerk/base/nsILoadInfo.idl	Tue May 21 23:14:27 2019 +0000
@@ -8,6 +8,7 @@
 #include "nsIContentPolicy.idl"
 
 interface nsIChannel;
+interface nsIContentSecurityPolicy;
 interface nsICookieSettings;
 interface nsICSPEventListener;
 interface nsINode;
@@ -49,6 +50,7 @@
 [ref] native const_MaybeServiceWorkerDescriptorRef(const mozilla::Maybe<mozilla::dom::ServiceWorkerDescriptor>);
 [ptr] native PerformanceStoragePtr(mozilla::dom::PerformanceStorage);
       native LoadTainting(mozilla::LoadTainting);
+      native CSPRef(already_AddRefed<nsIContentSecurityPolicy>);
 
 typedef unsigned long nsSecurityFlags;
 
@@ -1025,6 +1027,13 @@
   PerformanceStoragePtr GetPerformanceStorage();
 
   /**
+   * Query the CSP (or Preload CSP for preloads) which should be
+   * enforced for the channel this loadinfo belongs to.
+   */
+  [notxpcom,nostdcall] CSPRef GetCsp();
+  [notxpcom,nostdcall] CSPRef GetPreloadCsp();
+
+  /**
     * The service worker and fetch specifications require returning the
     * exact tainting level of the Response passed to FetchEvent.respondWith().
     * This method allows us to override the tainting level in that case.