# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/ipc/ContentChild.cpp
# Commit: 1bcf9f586c55
# Full Hash: 1bcf9f586c5582ddeb822f4c2be3ca314694337e
# Author: Ryan Hunt <rhunt@eqrion.net>
# Date: 2019-05-23 04:41:59
# Regressor Bug: 1525720
# File Overlap Count: 1
# Description:
#   Bug 1525720, part 11 - Use RemoteBrowser interface instead of IPDL actors in nsFrameLoader. r=nika
#   
#   This commit replaces the direct use of the IPDL actors in nsFrameLoader with
#   the RemoteBrowser interface. Some special use cases are adapted to still use
#   the IPDL actors. In the future, we should burn these use cases down.
# ==============================================================================

diff -r d3b2ac8d5ca4 -r 1bcf9f586c55 dom/ipc/ContentChild.cpp
--- a/dom/ipc/ContentChild.cpp	Wed May 15 10:34:03 2019 -0500
+++ b/dom/ipc/ContentChild.cpp	Mon May 06 21:29:48 2019 -0500
@@ -30,6 +30,7 @@
 #include "mozilla/docshell/OfflineCacheUpdateChild.h"
 #include "mozilla/dom/BrowsingContext.h"
 #include "mozilla/dom/BrowsingContextGroup.h"
+#include "mozilla/dom/BrowserBridgeHost.h"
 #include "mozilla/dom/ClientManager.h"
 #include "mozilla/dom/ClientOpenWindowOpActors.h"
 #include "mozilla/dom/ChildProcessMessageManager.h"
@@ -2007,7 +2008,7 @@
   csChild->TrackCookieLoad(aChannel);
 }
 
-already_AddRefed<BrowserBridgeChild> ContentChild::CreateBrowser(
+already_AddRefed<RemoteBrowser> ContentChild::CreateBrowser(
     nsFrameLoader* aFrameLoader, const TabContext& aContext,
     const nsString& aRemoteType, BrowsingContext* aBrowsingContext) {
   MOZ_ASSERT(XRE_IsContentProcess());
@@ -2054,7 +2055,9 @@
       aBrowsingContext, chromeFlags);
   browserBridge->mIPCOpen = true;
 
-  return browserBridge.forget();
+  RefPtr<BrowserBridgeHost> browserBridgeHost =
+      new BrowserBridgeHost(browserBridge);
+  return browserBridgeHost.forget();
 }
 
 PScriptCacheChild* ContentChild::AllocPScriptCacheChild(