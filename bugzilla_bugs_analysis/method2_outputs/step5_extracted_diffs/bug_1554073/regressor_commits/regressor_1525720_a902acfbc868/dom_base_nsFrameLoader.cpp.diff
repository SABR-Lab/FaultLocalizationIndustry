# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/nsFrameLoader.cpp
# Commit: a902acfbc868
# Full Hash: a902acfbc8680811e4538f8d27e78e4fe6ca55f2
# Author: Ryan Hunt <rhunt@eqrion.net>
# Date: 2019-05-23 15:55:11
# Regressor Bug: 1525720
# File Overlap Count: 1
# Description:
#   Bug 1525720, part 13 - Stop inheriting nsIRemoteTab interface in BrowserParent. r=nika
#   
#   This commit removes nsIRemoteTab as a parent class from BrowserParent,
#   so that BrowserHost is the only concrete implementation of nsIRemoteTab.
#   
# ==============================================================================

diff -r 50475885250c -r a902acfbc868 dom/base/nsFrameLoader.cpp
--- a/dom/base/nsFrameLoader.cpp	Wed May 08 11:45:23 2019 -0500
+++ b/dom/base/nsFrameLoader.cpp	Wed May 08 14:34:47 2019 -0500
@@ -2599,13 +2599,10 @@
     return false;
   }
 
-  BrowserParent* openingTab =
-      BrowserParent::GetFrom(parentDocShell->GetOpener());
   RefPtr<ContentParent> openerContentParent;
   RefPtr<BrowserParent> sameTabGroupAs;
-
-  if (openingTab && openingTab->Manager()) {
-    openerContentParent = openingTab->Manager();
+  if (auto* host = BrowserHost::GetFrom(parentDocShell->GetOpener())) {
+    openerContentParent = host->GetActor()->Manager();
   }
 
   // <iframe mozbrowser> gets to skip these checks.
@@ -3367,12 +3364,12 @@
 
 void nsFrameLoader::MaybeUpdatePrimaryBrowserParent(
     BrowserParentChange aChange) {
-  if (!mOwnerContent) {
+  if (!mOwnerContent || !mRemoteBrowser) {
     return;
   }
 
-  RefPtr<BrowserParent> browserParent = GetBrowserParent();
-  if (!browserParent) {
+  RefPtr<BrowserHost> browserHost = mRemoteBrowser->AsBrowserHost();
+  if (!browserHost) {
     return;
   }
 
@@ -3397,11 +3394,11 @@
     mObservingOwnerContent = true;
   }
 
-  parentTreeOwner->RemoteTabRemoved(browserParent);
+  parentTreeOwner->RemoteTabRemoved(browserHost);
   if (aChange == eBrowserParentChanged) {
     bool isPrimary = mOwnerContent->AttrValueIs(
         kNameSpaceID_None, nsGkAtoms::primary, nsGkAtoms::_true, eIgnoreCase);
-    parentTreeOwner->RemoteTabAdded(browserParent, isPrimary);
+    parentTreeOwner->RemoteTabAdded(browserHost, isPrimary);
   }
 }
 