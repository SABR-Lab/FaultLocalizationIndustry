# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/nsFrameLoader.cpp
# Commit: b255e0a84e12
# Full Hash: b255e0a84e12657a62a2cdfd4a4c2ebb893b2a0d
# Author: Ryan Hunt <rhunt@eqrion.net>
# Date: 2019-05-23 04:41:59
# Regressor Bug: 1525720
# File Overlap Count: 1
# Description:
#   Bug 1525720, part 4 - Assert in DrawSnapshot if not the chrome process. r=mattwoodrow
#   
#   This API is only intended to be used in the chrome process and this commit
#   makes this explicit to simplify a later refactoring.
#   
# ==============================================================================

diff -r 9a255864f75d -r b255e0a84e12 dom/base/nsFrameLoader.cpp
--- a/dom/base/nsFrameLoader.cpp	Wed Apr 24 23:25:56 2019 -0500
+++ b/dom/base/nsFrameLoader.cpp	Wed Apr 24 23:28:31 2019 -0500
@@ -3235,6 +3235,12 @@
 already_AddRefed<mozilla::dom::Promise> nsFrameLoader::DrawSnapshot(
     double aX, double aY, double aW, double aH, double aScale,
     const nsAString& aBackgroundColor, mozilla::ErrorResult& aRv) {
+  MOZ_ASSERT(XRE_IsParentProcess());
+  if (!XRE_IsParentProcess()) {
+    aRv = NS_ERROR_FAILURE;
+    return nullptr;
+  }
+
   RefPtr<nsIGlobalObject> global = GetOwnerContent()->GetOwnerGlobal();
   RefPtr<Promise> promise = Promise::Create(global, aRv);
   if (NS_WARN_IF(aRv.Failed())) {
