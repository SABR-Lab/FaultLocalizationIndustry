# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/libeditor/HTMLEditRules.cpp
# Commit: 0475e2855e5c
# Full Hash: 0475e2855e5c4b03dfce9da151fd4ac2bb1367c3
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2019-05-23 15:52:15
# Regressor Bug: 1534394
# File Overlap Count: 1
# Description:
#   Bug 1534394 - Make WSRunObject::InsertText() set aPointAfterInsertedString by itself when HTMLEditor::InsertTextWithTransaction() returns error r=m_kato
#   
#   Oddly, `WSRunObject::InsertText()` returns `NS_OK` even when
#   `HTMLEditor::InsertTextWithTransaction()` returns error.  However,
#   it fails if insertion point is not editable like `<noscript>` element.
# ==============================================================================

diff -r 4cd6d838796a -r 0475e2855e5c editor/libeditor/HTMLEditRules.cpp
--- a/editor/libeditor/HTMLEditRules.cpp	Thu May 23 06:35:52 2019 +0000
+++ b/editor/libeditor/HTMLEditRules.cpp	Thu May 23 06:06:18 2019 +0000
@@ -1541,6 +1541,7 @@
             return rv;
           }
           pos++;
+          MOZ_ASSERT(pointAfterInsertedSpaces.IsSet());
           currentPoint = pointAfterInsertedSpaces;
           pointToInsert = pointAfterInsertedSpaces;
         }
@@ -1581,6 +1582,7 @@
           if (NS_WARN_IF(NS_FAILED(rv))) {
             return rv;
           }
+          MOZ_ASSERT(pointAfterInsertedString.IsSet());
           currentPoint = pointAfterInsertedString;
           pointToInsert = pointAfterInsertedString;
         }