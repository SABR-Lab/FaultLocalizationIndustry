# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/components/style/gecko/conversions.rs
# Commit: 25354cfea038
# Full Hash: 25354cfea03822ff64efeeb420e2fa4a5732eca9
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2019-06-06 09:29:49
# Regressor Bug: 1557110
# File Overlap Count: 2
# Description:
#   Bug 1557110 - Cleanup gradient parsing by removing the simple-moz-gradient parsing pref. r=dholbert
#   
#   It looks like bug 1547939 will stick, given how fast the other regressions came
#   in for bug 1337655.
#   
# ==============================================================================

diff -r c02fd9857532 -r 25354cfea038 servo/components/style/gecko/conversions.rs
--- a/servo/components/style/gecko/conversions.rs	Thu Jun 06 02:56:52 2019 +0000
+++ b/servo/components/style/gecko/conversions.rs	Thu Jun 06 04:08:52 2019 +0000
@@ -65,7 +65,6 @@
 }
 
 fn line_direction(horizontal: LengthPercentage, vertical: LengthPercentage) -> LineDirection {
-    use crate::values::computed::position::Position;
     use crate::values::specified::position::{X, Y};
 
     let horizontal_percentage = horizontal.as_percentage();
@@ -107,13 +106,7 @@
         }
     }
 
-    LineDirection::MozPosition(
-        Some(Position {
-            horizontal,
-            vertical,
-        }),
-        None,
-    )
+    unreachable!("Unexpected line direction");
 }
 
 impl nsStyleImage {
@@ -241,20 +234,10 @@
                                 .set_value(CoordDataValue::Percent(percent_y));
                         }
                     },
-                    #[cfg(feature = "gecko")]
-                    LineDirection::MozPosition(position, angle) => unsafe {
-                        if let Some(position) = position {
-                            (*gecko_gradient).mBgPosX.set(position.horizontal);
-                            (*gecko_gradient).mBgPosY.set(position.vertical);
-                        }
-                        if let Some(angle) = angle {
-                            (*gecko_gradient).mAngle.set(angle);
-                        }
-                    },
                 }
                 gecko_gradient
             },
-            GradientKind::Radial(shape, position, angle) => {
+            GradientKind::Radial(shape, position) => {
                 let keyword_to_gecko_size = |keyword| match keyword {
                     ShapeExtent::ClosestSide => CLOSEST_SIDE,
                     ShapeExtent::FarthestSide => FARTHEST_SIDE,
@@ -294,13 +277,6 @@
                     )
                 };
 
-                // Clear mBgPos field and set mAngle if angle is set. Otherwise clear it.
-                unsafe {
-                    if let Some(angle) = angle {
-                        (*gecko_gradient).mAngle.set(angle);
-                    }
-                }
-
                 // Setting radius values depending shape
                 match shape {
                     EndingShape::Circle(Circle::Radius(length)) => unsafe {
@@ -405,30 +381,19 @@
         let gecko_gradient = bindings::Gecko_GetGradientImageValue(self)
             .as_ref()
             .unwrap();
-        let angle = Angle::from_gecko_style_coord(&gecko_gradient.mAngle);
         let horizontal_style = LengthPercentage::from_gecko_style_coord(&gecko_gradient.mBgPosX);
         let vertical_style = LengthPercentage::from_gecko_style_coord(&gecko_gradient.mBgPosY);
 
         let kind = match gecko_gradient.mShape as u32 {
             structs::NS_STYLE_GRADIENT_SHAPE_LINEAR => {
+                let angle = Angle::from_gecko_style_coord(&gecko_gradient.mAngle);
                 let line_direction = match (angle, horizontal_style, vertical_style) {
                     (Some(a), None, None) => LineDirection::Angle(a),
                     (None, Some(horizontal), Some(vertical)) => {
                         line_direction(horizontal, vertical)
                     },
-                    (Some(_), Some(horizontal), Some(vertical)) => LineDirection::MozPosition(
-                        Some(Position {
-                            horizontal,
-                            vertical,
-                        }),
-                        angle,
-                    ),
                     _ => {
-                        debug_assert!(
-                            horizontal_style.is_none() && vertical_style.is_none(),
-                            "Unexpected linear gradient direction"
-                        );
-                        LineDirection::MozPosition(None, None)
+                        unreachable!("unexpected line direction for linear gradient direction");
                     },
                 };
                 GradientKind::Linear(line_direction)
@@ -507,7 +472,7 @@
                     },
                 };
 
-                GradientKind::Radial(shape, position, angle)
+                GradientKind::Radial(shape, position)
             },
         };
 