# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/base/Document.cpp
# Commit: 2514efbfbb78
# Full Hash: 2514efbfbb783ebbdbf6c84751e2c464a8d65d83
# Author: Olli Pettay <Olli.Pettay@helsinki.fi>
# Date: 2019-07-06 03:37:34
# Description:
#   Bug 1559523 - Fix a crash in Thunderbird, [@ mozilla::dom::Document::EndLoad]. r=kaie
# ==============================================================================

diff -r c7e91f614eb7 -r 2514efbfbb78 dom/base/Document.cpp
--- a/dom/base/Document.cpp	Thu Jul 04 14:50:06 2019 +0200
+++ b/dom/base/Document.cpp	Fri Jul 05 14:54:53 2019 +0200
@@ -11192,7 +11192,7 @@
   // At the time of loading start, we don't have timing object, record time.
 
   if (READYSTATE_INTERACTIVE == rs) {
-    if (nsContentUtils::IsSystemPrincipal(NodePrincipal())) {
+    if (!mXULPersist && nsContentUtils::IsSystemPrincipal(NodePrincipal())) {
       mXULPersist = new XULPersist(this);
       mXULPersist->Init();
     }
