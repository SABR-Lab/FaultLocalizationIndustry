# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/wr/webrender/src/texture_cache.rs
# Commit: 431c5142ff3a
# Full Hash: 431c5142ff3ad102328d90cb29470b20ccd1271e
# Author: Glenn Watson <github@intuitionlibrary.com>
# Date: 2019-06-13 21:50:57
# Regressor Bug: 1558106
# File Overlap Count: 1
# Description:
#   Bug 1558106 - Support picture caching for multiple scroll roots. r=kvark
#   
#   This patch implements the majority of the planned picture caching
#   improvements. It supports most of the functionality required to
#   (as a follow up) support OS compositor integration. It also improves
# ==============================================================================

diff -r 855d557b82a2 -r 431c5142ff3a gfx/wr/webrender/src/texture_cache.rs
--- a/gfx/wr/webrender/src/texture_cache.rs	Wed Jun 12 16:18:22 2019 +0000
+++ b/gfx/wr/webrender/src/texture_cache.rs	Thu Jun 13 04:43:56 2019 +0000
@@ -556,10 +556,10 @@
         }
 
         let mut pending_updates = TextureUpdateList::new();
-        let picture_texture = if let Some(tile_size) = picture_tile_size{
+        let picture_texture = if let Some(tile_size) = picture_tile_size {
             let picture_texture = WholeTextureArray {
                 size: tile_size,
-                filter: TextureFilter::Linear,
+                filter: TextureFilter::Nearest,
                 format: PICTURE_TILE_FORMAT,
                 texture_id: CacheTextureId(1),
                 slices: {
@@ -569,6 +569,7 @@
                     info!("Initializing picture texture with {}x{} slices", num_x, num_y);
                     vec![WholeTextureSlice { uv_rect_handle: None }; count]
                 },
+                has_depth: true,
             };
             pending_updates.push_alloc(picture_texture.texture_id, picture_texture.to_info());
             Some(picture_texture)
@@ -1092,6 +1093,7 @@
                 filter: texture_array.filter,
                 layer_count: 1,
                 is_shared_cache: true,
+                has_depth: false,
             };
             self.pending_updates.push_alloc(texture_id, info);
 
@@ -1155,6 +1157,7 @@
             filter: params.filter,
             layer_count: 1,
             is_shared_cache: false,
+            has_depth: false,
         };
         self.pending_updates.push_alloc(texture_id, info);
 
@@ -1223,6 +1226,7 @@
                     filter: texture_array.filter,
                     layer_count: (num_regions + 1) as i32,
                     is_shared_cache: true,
+                    has_depth: false,
                 };
                 self.pending_updates.push_realloc(texture_array.texture_id.unwrap(), info);
                 texture_array.push_region();
@@ -1608,6 +1612,7 @@
     format: ImageFormat,
     texture_id: CacheTextureId,
     slices: Vec<WholeTextureSlice>,
+    has_depth: bool,
 }
 
 impl WholeTextureArray {
@@ -1619,6 +1624,7 @@
             filter: self.filter,
             layer_count: self.slices.len() as i32,
             is_shared_cache: true, //TODO: reconsider
+            has_depth: self.has_depth,
         }
     }
 