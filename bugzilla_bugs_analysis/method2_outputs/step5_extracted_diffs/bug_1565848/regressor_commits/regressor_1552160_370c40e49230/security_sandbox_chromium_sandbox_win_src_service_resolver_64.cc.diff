# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: security/sandbox/chromium/sandbox/win/src/service_resolver_64.cc
# Commit: 370c40e49230
# Full Hash: 370c40e4923073a87845b57c1f4851bacd9663da
# Author: Bob Owen <bobowencode@gmail.com>
# Date: 2019-06-12 21:42:35
# Regressor Bug: 1552160
# File Overlap Count: 3
# Description:
#   Bug 1552160 Part 1: Roll-up of chromium sandbox update and mozilla patches to get a running browser. r=jld,aklotz,tjr,bobowen
#   
#   This updates security/sandbox/chromium/ files to chromium commit 84108231f6e6e0772fb9a4643679ce76aa771e67.
#   
#   Existing and new patches applied from security/sandbox/chromium-shim/patches/with_update/ to give a compiling and mostly working browser.
# ==============================================================================

diff -r bd5ecd72f76c -r 370c40e49230 security/sandbox/chromium/sandbox/win/src/service_resolver_64.cc
--- a/security/sandbox/chromium/sandbox/win/src/service_resolver_64.cc	Wed Jun 12 21:55:59 2019 +1200
+++ b/security/sandbox/chromium/sandbox/win/src/service_resolver_64.cc	Wed Jun 12 11:10:48 2019 +0100
@@ -105,8 +105,7 @@
 #pragma pack(pop)
 
 bool IsService(const void* source) {
-  const ServiceEntry* service =
-      reinterpret_cast<const ServiceEntry*>(source);
+  const ServiceEntry* service = reinterpret_cast<const ServiceEntry*>(source);
 
   return (kMmovR10EcxMovEax == service->mov_r10_rcx_mov_eax &&
           kSyscall == service->syscall && kRetNp == service->ret);
@@ -169,7 +168,7 @@
 #error "Unsupported Windows 64-bit Arch"
 #endif
 
-};  // namespace
+}  // namespace
 
 namespace sandbox {
 
@@ -189,15 +188,15 @@
 
   size_t thunk_bytes = GetThunkSize();
   std::unique_ptr<char[]> thunk_buffer(new char[thunk_bytes]);
-  ServiceFullThunk* thunk = reinterpret_cast<ServiceFullThunk*>(
-                                thunk_buffer.get());
+  ServiceFullThunk* thunk =
+      reinterpret_cast<ServiceFullThunk*>(thunk_buffer.get());
 
   if (!IsFunctionAService(&thunk->original))
     return STATUS_OBJECT_NAME_COLLISION;
 
   ret = PerformPatch(thunk, thunk_storage);
 
-  if (NULL != storage_used)
+  if (storage_used)
     *storage_used = thunk_bytes;
 
   return ret;
@@ -225,7 +224,7 @@
   if (!IsFunctionAService(&thunk->original))
     return STATUS_OBJECT_NAME_COLLISION;
 
-  if (NULL != storage_used)
+  if (storage_used)
     *storage_used = thunk_bytes;
 
   return ret;
@@ -255,7 +254,7 @@
   // Patch the original code.
   ServiceEntry local_service;
   DCHECK_NT(GetInternalThunkSize() <= sizeof(local_service));
-  if (!SetInternalThunk(&local_service, sizeof(local_service), NULL,
+  if (!SetInternalThunk(&local_service, sizeof(local_service), nullptr,
                         interceptor_))
     return STATUS_UNSUCCESSFUL;
 
@@ -269,7 +268,7 @@
     return STATUS_UNSUCCESSFUL;
 
   // And now change the function to intercept, on the child.
-  if (NULL != ntdll_base_) {
+  if (ntdll_base_) {
     // Running a unit test.
     if (!::WriteProcessMemory(process_, target_, &local_service,
                               sizeof(local_service), &actual))