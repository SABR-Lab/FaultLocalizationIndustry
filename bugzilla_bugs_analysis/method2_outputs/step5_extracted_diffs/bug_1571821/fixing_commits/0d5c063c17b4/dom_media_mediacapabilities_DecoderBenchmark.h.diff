# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/media/mediacapabilities/DecoderBenchmark.h
# Commit: 0d5c063c17b4
# Full Hash: 0d5c063c17b49d4be792578849376d95a7e5e40a
# Author: Alex Chronopoulos <achronop@gmail.com>
# Date: 2019-09-10 15:48:08
# Description:
#   Bug 1571821 - Use total frames instead of parsed frames to calculate benchmark. r=alwu
#   
#   The problem reproduces when the system is loaded and the decoder is dropping most of the frames. When there are two benchmark calculations close to each other, the measured parsed frames of the first calculation can be buffered in the decoder and reported as dropped frames on the second calculation. Then on the second calculation, the number of dropped frames can be greater than the parsed frame which will hit the assert. The number of total frames is a better measure since it counts the frames that appeared in the in VideoSink plus the total dropped frames.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D44478
# ==============================================================================

diff -r 3b9e96b71449 -r 0d5c063c17b4 dom/media/mediacapabilities/DecoderBenchmark.h
--- a/dom/media/mediacapabilities/DecoderBenchmark.h	Tue Sep 10 07:05:14 2019 +0000
+++ b/dom/media/mediacapabilities/DecoderBenchmark.h	Mon Sep 09 20:08:59 2019 +0000
@@ -53,12 +53,12 @@
                                     const nsACString& aKey);
   ~DecoderBenchmark() = default;
 
-  // Keep the last ParsedFrames and DroppedFrames from FrameStatistics.
+  // Keep the last TotalFrames and DroppedFrames from FrameStatistics.
   // FrameStatistics keep an ever-increasing counter across the entire video and
   // even when there are resolution changes. This code is called whenever there
   // is a resolution change and we need to calculate the benchmark since the
   // last call.
-  uint64_t mLastParsedFrames = 0;
+  uint64_t mLastTotalFrames = 0;
   uint64_t mLastDroppedFrames = 0;
 };
 
