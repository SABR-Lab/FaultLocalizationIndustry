# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/gc/GCRuntime.h
# Commit: 7b97deb4ae68
# Full Hash: 7b97deb4ae68a7bc333f17c8f13c533968e2122f
# Author: Jon Coppeard <jcoppeard@mozilla.com>
# Date: 2019-07-25 16:20:39
# Regressor Bug: 1568454
# File Overlap Count: 1
# Description:
#   Bug 1568454 - Set GCRuntime::invocationKind in the first slice of a collection r=sfink
#   
#   This is slightly complicated by the fact that we should only pass an invocation kind for the first slice, so it's passed as Maybe<>.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D39222
# ==============================================================================

diff -r fcd91e8b0180 -r 7b97deb4ae68 js/src/gc/GCRuntime.h
--- a/js/src/gc/GCRuntime.h	Wed Jul 24 16:13:03 2019 +0100
+++ b/js/src/gc/GCRuntime.h	Wed Jul 24 17:48:15 2019 +0100
@@ -593,7 +593,11 @@
   MOZ_MUST_USE bool checkIfGCAllowedInCurrentState(JS::GCReason reason);
 
   gcstats::ZoneGCStats scanZonesBeforeGC();
+
+  using MaybeInvocationKind = mozilla::Maybe<JSGCInvocationKind>;
+
   void collect(bool nonincrementalByAPI, SliceBudget budget,
+               const MaybeInvocationKind& gckind,
                JS::GCReason reason) JS_HAZ_GC_CALL;
 
   /*
@@ -607,10 +611,11 @@
    */
   MOZ_MUST_USE IncrementalResult gcCycle(bool nonincrementalByAPI,
                                          SliceBudget budget,
+                                         const MaybeInvocationKind& gckind,
                                          JS::GCReason reason);
   bool shouldRepeatForDeadZone(JS::GCReason reason);
-  void incrementalSlice(SliceBudget& budget, JS::GCReason reason,
-                        AutoGCSession& session);
+  void incrementalSlice(SliceBudget& budget, const MaybeInvocationKind& gckind,
+                        JS::GCReason reason, AutoGCSession& session);
   MOZ_MUST_USE bool shouldCollectNurseryForSlice(bool nonincrementalByAPI,
                                                  SliceBudget& budget);
 
