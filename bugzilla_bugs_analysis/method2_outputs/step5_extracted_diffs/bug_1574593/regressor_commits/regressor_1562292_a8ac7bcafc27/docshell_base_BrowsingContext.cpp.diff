# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: docshell/base/BrowsingContext.cpp
# Commit: a8ac7bcafc27
# Full Hash: a8ac7bcafc270b5be3eca84efebcde672fe8fba5
# Author: Kris Maglione <maglione.k@gmail.com>
# Date: 2019-08-15 09:46:49
# Regressor Bug: 1562292
# File Overlap Count: 1
# Description:
#   Bug 1562292: Part 1b.2 - Don't fall back to named lookup for inaccessible special name. r=nika
#   
#   Currently, if a window with a special name is inaccessible to the caller, we
#   fall back to ordinary named lookup, which is not desirable.
#   
# ==============================================================================

diff -r f1fc2382346d -r a8ac7bcafc27 docshell/base/BrowsingContext.cpp
--- a/docshell/base/BrowsingContext.cpp	Thu Aug 01 18:45:47 2019 -0700
+++ b/docshell/base/BrowsingContext.cpp	Thu Aug 08 11:43:38 2019 -0700
@@ -468,13 +468,12 @@
   if (aName.IsEmpty()) {
     // You can't find a browsing context with an empty name.
     found = nullptr;
-  } else if (BrowsingContext* special =
-                 FindWithSpecialName(aName, aRequestingContext)) {
-    found = special;
   } else if (aName.LowerCaseEqualsLiteral("_blank")) {
     // Just return null. Caller must handle creating a new window with
     // a blank name.
     found = nullptr;
+  } else if (IsSpecialName(aName)) {
+    found = FindWithSpecialName(aName, aRequestingContext);
   } else if (BrowsingContext* child =
                  FindWithNameInSubtree(aName, aRequestingContext)) {
     found = child;
@@ -540,6 +539,14 @@
   return nullptr;
 }
 
+/* static */
+bool BrowsingContext::IsSpecialName(const nsAString& aName) {
+  return (aName.LowerCaseEqualsLiteral("_self") ||
+          aName.LowerCaseEqualsLiteral("_parent") ||
+          aName.LowerCaseEqualsLiteral("_top") ||
+          aName.LowerCaseEqualsLiteral("_blank"));
+}
+
 BrowsingContext* BrowsingContext::FindWithSpecialName(
     const nsAString& aName, BrowsingContext& aRequestingContext) {
   // TODO(farre): Neither BrowsingContext nor nsDocShell checks if the