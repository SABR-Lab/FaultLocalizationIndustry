# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/gfxPlatformFontList.cpp
# Commit: 3acfcd288f56
# Full Hash: 3acfcd288f567c09ce806ce144f48447bd01b661
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2019-08-30 21:54:33
# Description:
#   Bug 1576846 - Fix the content-process's use of mAliasTable to temporarily record alternate font family names on Windows. r=jwatt
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D43746
# ==============================================================================

diff -r 3e9155a5cd24 -r 3acfcd288f56 gfx/thebes/gfxPlatformFontList.cpp
--- a/gfx/thebes/gfxPlatformFontList.cpp	Fri Aug 30 12:52:42 2019 +0000
+++ b/gfx/thebes/gfxPlatformFontList.cpp	Fri Aug 30 13:14:26 2019 +0000
@@ -400,6 +400,9 @@
 
   gfxPlatform::PurgeSkiaFontCache();
 
+  mAliasTable.Clear();
+  mLocalNameTable.Clear();
+
   CancelInitOtherFamilyNamesTask();
   MutexAutoLock lock(mFontFamiliesMutex);
   mFontFamilies.Clear();
@@ -2117,7 +2120,7 @@
     mPendingOtherFamilyNameTask = nullptr;
   }
   auto list = SharedFontList();
-  if (list) {
+  if (list && XRE_IsParentProcess()) {
     bool forceReflow = false;
     if (!mAliasTable.IsEmpty()) {
       list->SetAliases(mAliasTable);
