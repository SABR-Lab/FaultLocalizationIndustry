# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/SharedFontList-impl.h
# Commit: 6af07e63a001
# Full Hash: 6af07e63a001dfc667a952727551a80b16797339
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2019-08-13 09:54:32
# Regressor Bug: 1565966
# File Overlap Count: 1
# Description:
#   Bug 1565966 - part 2 - Include Family attributes in mAliasTable when collecting font-name aliases, so that fontEntry instantiation on Windows can work correctly for the Aliases eventually stored in the font-list. r=jwatt
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D41243
# ==============================================================================

diff -r 277876c31869 -r 6af07e63a001 gfx/thebes/SharedFontList-impl.h
--- a/gfx/thebes/SharedFontList-impl.h	Mon Aug 12 17:49:09 2019 +0000
+++ b/gfx/thebes/SharedFontList-impl.h	Mon Aug 12 17:49:28 2019 +0000
@@ -25,6 +25,30 @@
 namespace fontlist {
 
 /**
+ * Data used to initialize a font family alias (a "virtual" family that refers
+ * to some or all of the faces of another family, used when alternate family
+ * names are found in the font resource for localization or for styled
+ * subfamilies). AliasData records are collected incrementally while scanning
+ * the fonts, and then used to set up the Aliases list in the shared font list.
+ */
+struct AliasData {
+  nsTArray<Pointer> mFaces;
+  uint32_t mIndex = 0;
+  bool mHidden = false;
+  bool mBundled = false;
+  bool mBadUnderline = false;
+  bool mForceClassic = false;
+
+  void InitFromFamily(const Family* aFamily) {
+    mIndex = aFamily->Index();
+    mHidden = aFamily->IsHidden();
+    mBundled = aFamily->IsBundled();
+    mBadUnderline = aFamily->IsBadUnderlineFamily();
+    mForceClassic = aFamily->IsForceClassic();
+  }
+};
+
+/**
  * The Shared Font List is a collection of data that lives in shared memory
  * so that all processes can use it, rather than maintaining their own copies,
  * and provides the metadata needed for CSS font-matching (a list of all the
@@ -93,8 +117,7 @@
    *
    * Only used in the parent process.
    */
-  void SetAliases(
-      nsClassHashtable<nsCStringHashKey, nsTArray<Pointer>>& aAliasTable);
+  void SetAliases(nsClassHashtable<nsCStringHashKey, AliasData>& aAliasTable);
 
   /**
    * Local names are PostScript or Full font names of individual faces, used