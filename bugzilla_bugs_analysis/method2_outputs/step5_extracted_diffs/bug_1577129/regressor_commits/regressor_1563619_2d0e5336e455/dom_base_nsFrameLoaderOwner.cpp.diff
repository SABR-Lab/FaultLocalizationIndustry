# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/nsFrameLoaderOwner.cpp
# Commit: 2d0e5336e455
# Full Hash: 2d0e5336e455f560cdd345afa57f21b8cdbfc1fb
# Author: Andreas Farre <farre@mozilla.com>
# Date: 2019-08-26 22:30:36
# Regressor Bug: 1563619
# File Overlap Count: 1
# Description:
#   Bug 1563619 - Handle subframe crashes in BrowserParent::ActorDestroy. r=mconley,kmag,peterv
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D40937
# ==============================================================================

diff -r fd3185644de9 -r 2d0e5336e455 dom/base/nsFrameLoaderOwner.cpp
--- a/dom/base/nsFrameLoaderOwner.cpp	Mon Aug 26 13:07:26 2019 +0000
+++ b/dom/base/nsFrameLoaderOwner.cpp	Mon Aug 26 13:08:32 2019 +0000
@@ -12,6 +12,7 @@
 #include "mozilla/AsyncEventDispatcher.h"
 #include "mozilla/dom/BrowsingContext.h"
 #include "mozilla/dom/FrameLoaderBinding.h"
+#include "mozilla/dom/HTMLIFrameElement.h"
 #include "mozilla/dom/MozFrameLoaderOwnerBinding.h"
 #include "mozilla/StaticPrefs_fission.h"
 
@@ -90,7 +91,22 @@
     return;
   }
 
-  if (aOptions.mPendingSwitchID.WasPassed()) {
+  if (aOptions.mError.WasPassed()) {
+    nsCOMPtr<nsIURI> uri;
+    rv = NS_NewURI(getter_AddRefs(uri), "about:blank");
+    if (NS_WARN_IF(rv.Failed())) {
+      return;
+    }
+
+    nsDocShell* docShell = mFrameLoader->GetDocShell(rv);
+    if (NS_WARN_IF(rv.Failed())) {
+      return;
+    }
+    bool displayed = false;
+    docShell->DisplayLoadError(static_cast<nsresult>(aOptions.mError.Value()),
+                               uri, u"about:blank", nullptr, &displayed);
+
+  } else if (aOptions.mPendingSwitchID.WasPassed()) {
     mFrameLoader->ResumeLoad(aOptions.mPendingSwitchID.Value());
   } else {
     mFrameLoader->LoadFrame(false);