# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: tools/profiler/core/ProfileBuffer.cpp
# Commit: 7ea3346267bd
# Full Hash: 7ea3346267bdc7f9e752a1a28c791696b7bdafac
# Author: Gerald Squelart <gsquelart@mozilla.com>
# Date: 2019-09-24 03:42:17
# Description:
#   Bug 1582992 - Removed unneded BlocksRingBuffer's entry destructor, and ProfilerBuffer's JS::AutoSuppressGCAnalysis - r=gregtatum
#   
#   `BlocksRingBuffer` had an "entry destructor" to make it a more generic
#   container, and it was useful during early prototyping of the new profiler
#   storage (so that we could store owning pointers).
# ==============================================================================

diff -r e35199501a97 -r 7ea3346267bd tools/profiler/core/ProfileBuffer.cpp
--- a/tools/profiler/core/ProfileBuffer.cpp	Mon Sep 23 19:47:28 2019 +0000
+++ b/tools/profiler/core/ProfileBuffer.cpp	Mon Sep 23 20:50:20 2019 +0000
@@ -45,13 +45,9 @@
 BlocksRingBuffer::BlockIndex ProfileBuffer::AddEntry(
     BlocksRingBuffer& aBlocksRingBuffer, const ProfileBufferEntry& aEntry) {
   switch (aEntry.GetKind()) {
-#define SWITCH_KIND(KIND, TYPE, SIZE)                                        \
-  case ProfileBufferEntry::Kind::KIND: {                                     \
-    /* Rooting analysis cannot get through `BlocksRingBuffer`'s heavy use of \
-     * lambdas and `std::function`s, which then trips it when used from      \
-     * `MergeStacks()` where unrooted js objects are manipulated. */         \
-    JS::AutoSuppressGCAnalysis nogc;                                         \
-    return aBlocksRingBuffer.PutFrom(&aEntry, 1 + (SIZE));                   \
+#define SWITCH_KIND(KIND, TYPE, SIZE)                      \
+  case ProfileBufferEntry::Kind::KIND: {                   \
+    return aBlocksRingBuffer.PutFrom(&aEntry, 1 + (SIZE)); \
   }
 
     FOR_EACH_PROFILE_BUFFER_ENTRY_KIND(SWITCH_KIND)
