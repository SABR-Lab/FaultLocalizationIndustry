# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: toolkit/components/extensions/webrequest/ChannelWrapper.cpp
# Commit: ab3acf0f24a4
# Full Hash: ab3acf0f24a4c59de4b25d489c4a0aeaf9720448
# Author: Jean-Yves Avenard <jyavenard@mozilla.com>
# Date: 2019-10-23 09:48:16
# Description:
#   Bug 1590214 - Don't assert that ChannelWrapper will always be used with a nsIHttpChannel. r=mixedpuppy
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D50109
# ==============================================================================

diff -r 89b3345153a3 -r ab3acf0f24a4 toolkit/components/extensions/webrequest/ChannelWrapper.cpp
--- a/toolkit/components/extensions/webrequest/ChannelWrapper.cpp	Tue Oct 22 19:02:36 2019 +0000
+++ b/toolkit/components/extensions/webrequest/ChannelWrapper.cpp	Tue Oct 22 19:47:35 2019 +0000
@@ -907,13 +907,12 @@
 void ChannelWrapper::GetUrlClassification(
     dom::Nullable<dom::MozUrlClassification>& aRetVal, ErrorResult& aRv) const {
   MozUrlClassification classification;
-  nsCOMPtr<nsIHttpChannel> chan = MaybeHttpChannel();
-  nsCOMPtr<nsIClassifiedChannel> classified = do_QueryInterface(chan);
-  MOZ_DIAGNOSTIC_ASSERT(
-      classified,
-      "Must be an object inheriting from both nsIHttpChannel and "
-      "nsIClassifiedChannel");
-  if (classified) {
+  if (nsCOMPtr<nsIHttpChannel> chan = MaybeHttpChannel()) {
+    nsCOMPtr<nsIClassifiedChannel> classified = do_QueryInterface(chan);
+    MOZ_DIAGNOSTIC_ASSERT(
+        classified,
+        "Must be an object inheriting from both nsIHttpChannel and "
+        "nsIClassifiedChannel");
     uint32_t classificationFlags;
     classified->GetFirstPartyClassificationFlags(&classificationFlags);
     FillClassification(classification.mFirstParty, classificationFlags, aRv);
