# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/indexedDB/IDBTransaction.cpp
# Commit: 340dfa69aed8
# Full Hash: 340dfa69aed87f29b9fdeef59a650ad5eb8c1b7b
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2019-09-30 16:21:37
# Regressor Bug: 1168606
# File Overlap Count: 1
# Description:
#   Bug 1168606 - Remove duplication in uses of IDB_LOG_MARK. r=ttung,asuth
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D46576
# ==============================================================================

diff -r a864ed2ae59a -r 340dfa69aed8 dom/indexedDB/IDBTransaction.cpp
--- a/dom/indexedDB/IDBTransaction.cpp	Mon Sep 30 08:54:17 2019 +0000
+++ b/dom/indexedDB/IDBTransaction.cpp	Fri Sep 27 10:11:45 2019 +0000
@@ -360,11 +360,9 @@
       MOZ_ASSERT(!mSentCommitOrAbort);
       mSentCommitOrAbort = true;
 #endif
-      IDB_LOG_MARK(
-          "IndexedDB %s: Child  Transaction[%lld]: "
+      IDB_LOG_MARK_CHILD_TRANSACTION(
           "Request actor was killed, transaction will be aborted",
-          "IndexedDB %s: C T[%lld]: IDBTransaction abort", IDB_LOG_ID_STRING(),
-          LoggingSerialNumber());
+          "IDBTransaction abort", LoggingSerialNumber());
     }
   }
 }
@@ -380,11 +378,9 @@
   // number to keep in sync with the parent.
   const uint64_t requestSerialNumber = IDBRequest::NextSerialNumber();
 
-  IDB_LOG_MARK(
-      "IndexedDB %s: Child  Transaction[%lld] Request[%llu]: "
-      "All requests complete, committing transaction",
-      "IndexedDB %s: C T[%lld] R[%llu]: IDBTransaction commit",
-      IDB_LOG_ID_STRING(), LoggingSerialNumber(), requestSerialNumber);
+  IDB_LOG_MARK_CHILD_TRANSACTION_REQUEST(
+      "All requests complete, committing transaction", "IDBTransaction commit",
+      LoggingSerialNumber(), requestSerialNumber);
 
   if (mMode == VERSION_CHANGE) {
     MOZ_ASSERT(mBackgroundActor.mVersionChangeBackgroundActor);
@@ -409,12 +405,9 @@
   // number to keep in sync with the parent.
   const uint64_t requestSerialNumber = IDBRequest::NextSerialNumber();
 
-  IDB_LOG_MARK(
-      "IndexedDB %s: Child  Transaction[%lld] Request[%llu]: "
-      "Aborting transaction with result 0x%x",
-      "IndexedDB %s: C T[%lld] R[%llu]: IDBTransaction abort (0x%x)",
-      IDB_LOG_ID_STRING(), LoggingSerialNumber(), requestSerialNumber,
-      aResultCode);
+  IDB_LOG_MARK_CHILD_TRANSACTION_REQUEST(
+      "Aborting transaction with result 0x%x", "IDBTransaction abort (0x%x)",
+      LoggingSerialNumber(), requestSerialNumber, aResultCode);
 
   if (mMode == VERSION_CHANGE) {
     MOZ_ASSERT(mBackgroundActor.mVersionChangeBackgroundActor);
@@ -764,17 +757,13 @@
   }
 
   if (NS_SUCCEEDED(mAbortCode)) {
-    IDB_LOG_MARK(
-        "IndexedDB %s: Child  Transaction[%lld]: "
-        "Firing 'complete' event",
-        "IndexedDB %s: C T[%lld]: IDBTransaction 'complete' event",
-        IDB_LOG_ID_STRING(), mLoggingSerialNumber);
+    IDB_LOG_MARK_CHILD_TRANSACTION("Firing 'complete' event",
+                                   "IDBTransaction 'complete' event",
+                                   mLoggingSerialNumber);
   } else {
-    IDB_LOG_MARK(
-        "IndexedDB %s: Child  Transaction[%lld]: "
-        "Firing 'abort' event with error 0x%x",
-        "IndexedDB %s: C T[%lld]: IDBTransaction 'abort' event (0x%x)",
-        IDB_LOG_ID_STRING(), mLoggingSerialNumber, mAbortCode);
+    IDB_LOG_MARK_CHILD_TRANSACTION("Firing 'abort' event with error 0x%x",
+                                   "IDBTransaction 'abort' event (0x%x)",
+                                   mLoggingSerialNumber, mAbortCode);
   }
 
   IgnoredErrorResult rv;