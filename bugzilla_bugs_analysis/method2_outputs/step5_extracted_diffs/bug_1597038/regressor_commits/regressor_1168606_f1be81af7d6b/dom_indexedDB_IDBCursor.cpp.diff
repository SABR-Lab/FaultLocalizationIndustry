# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/indexedDB/IDBCursor.cpp
# Commit: f1be81af7d6b
# Full Hash: f1be81af7d6b1dd98040b90ff4e094da950f01f6
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2019-11-05 21:49:23
# Regressor Bug: 1168606
# File Overlap Count: 1
# Description:
#   Bug 1168606 - Support preloading also for index cursors. r=ttung,asuth
#   
#   Depends on D43252
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D43461
# ==============================================================================

diff -r 8dc185488801 -r f1be81af7d6b dom/indexedDB/IDBCursor.cpp
--- a/dom/indexedDB/IDBCursor.cpp	Tue Nov 05 12:48:36 2019 +0000
+++ b/dom/indexedDB/IDBCursor.cpp	Tue Nov 05 12:45:48 2019 +0000
@@ -258,6 +258,8 @@
   }
 }
 
+IDBCursor::Type IDBCursor::GetType() const { return mType; }
+
 void IDBCursor::GetSource(OwningIDBObjectStoreOrIDBIndex& aSource) const {
   AssertIsOnOwningThread();
 
@@ -453,7 +455,8 @@
         IDB_LOG_STRINGIFY(key));
   }
 
-  mBackgroundActor->SendContinueInternal(ContinueParams(key), mKey);
+  mBackgroundActor->SendContinueInternal(ContinueParams(key), mKey,
+                                         mPrimaryKey);
 
   mContinueCalled = true;
 }
@@ -559,7 +562,7 @@
       IDB_LOG_STRINGIFY(key), IDB_LOG_STRINGIFY(primaryKey));
 
   mBackgroundActor->SendContinueInternal(
-      ContinuePrimaryKeyParams(key, primaryKey), mKey);
+      ContinuePrimaryKeyParams(key, primaryKey), mKey, mPrimaryKey);
 
   mContinueCalled = true;
 }
@@ -604,7 +607,8 @@
         IDB_LOG_STRINGIFY(mSourceIndex), IDB_LOG_STRINGIFY(mDirection), aCount);
   }
 
-  mBackgroundActor->SendContinueInternal(AdvanceParams(aCount), mKey);
+  mBackgroundActor->SendContinueInternal(AdvanceParams(aCount), mKey,
+                                         mPrimaryKey);
 
   mContinueCalled = true;
 }