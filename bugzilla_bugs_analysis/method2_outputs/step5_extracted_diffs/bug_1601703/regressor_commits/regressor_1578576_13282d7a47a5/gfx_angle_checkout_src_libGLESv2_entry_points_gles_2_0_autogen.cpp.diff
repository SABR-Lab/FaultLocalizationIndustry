# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/angle/checkout/src/libGLESv2/entry_points_gles_2_0_autogen.cpp
# Commit: 13282d7a47a5
# Full Hash: 13282d7a47a57a73be8d060efd9645b4d642f03e
# Author: Miko Mynttinen <mikokm@gmail.com>
# Date: 2019-09-08 09:46:52
# Regressor Bug: 1578576
# File Overlap Count: 4
# Description:
#   Bug 1578576 - Part 2: Update to ANGLE 3865 r=jgilbert
#   
#   Depends on D44561
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D44579
# ==============================================================================

diff -r 3064469c073d -r 13282d7a47a5 gfx/angle/checkout/src/libGLESv2/entry_points_gles_2_0_autogen.cpp
--- a/gfx/angle/checkout/src/libGLESv2/entry_points_gles_2_0_autogen.cpp	Sat Sep 07 13:36:46 2019 +0000
+++ b/gfx/angle/checkout/src/libGLESv2/entry_points_gles_2_0_autogen.cpp	Sat Sep 07 13:38:36 2019 +0000
@@ -12,20 +12,21 @@
 
 #include "libANGLE/Context.h"
 #include "libANGLE/Context.inl.h"
+#include "libANGLE/capture_gles_2_0_autogen.h"
+#include "libANGLE/entry_points_utils.h"
 #include "libANGLE/validationES2.h"
-#include "libGLESv2/entry_points_utils.h"
 #include "libGLESv2/global_state.h"
 
 namespace gl
 {
 void GL_APIENTRY ActiveTexture(GLenum texture)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum texture = 0x%X)", texture);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ActiveTexture, context, texture);
         if (context->skipValidation() || ValidateActiveTexture(context, texture))
         {
             context->activeTexture(texture);
@@ -35,12 +36,12 @@
 
 void GL_APIENTRY AttachShader(GLuint program, GLuint shader)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLuint shader = %u)", program, shader);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(AttachShader, context, program, shader);
         if (context->skipValidation() || ValidateAttachShader(context, program, shader))
         {
             context->attachShader(program, shader);
@@ -50,13 +51,13 @@
 
 void GL_APIENTRY BindAttribLocation(GLuint program, GLuint index, const GLchar *name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLuint index = %u, const GLchar *name = 0x%016" PRIxPTR ")",
           program, index, (uintptr_t)name);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BindAttribLocation, context, program, index, name);
         if (context->skipValidation() || ValidateBindAttribLocation(context, program, index, name))
         {
             context->bindAttribLocation(program, index, name);
@@ -66,13 +67,13 @@
 
 void GL_APIENTRY BindBuffer(GLenum target, GLuint buffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLuint buffer = %u)", target, buffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         BufferBinding targetPacked = FromGLenum<BufferBinding>(target);
+        ANGLE_CAPTURE(BindBuffer, context, targetPacked, buffer);
         if (context->skipValidation() || ValidateBindBuffer(context, targetPacked, buffer))
         {
             context->bindBuffer(targetPacked, buffer);
@@ -82,12 +83,12 @@
 
 void GL_APIENTRY BindFramebuffer(GLenum target, GLuint framebuffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLuint framebuffer = %u)", target, framebuffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BindFramebuffer, context, target, framebuffer);
         if (context->skipValidation() || ValidateBindFramebuffer(context, target, framebuffer))
         {
             context->bindFramebuffer(target, framebuffer);
@@ -97,12 +98,12 @@
 
 void GL_APIENTRY BindRenderbuffer(GLenum target, GLuint renderbuffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLuint renderbuffer = %u)", target, renderbuffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BindRenderbuffer, context, target, renderbuffer);
         if (context->skipValidation() || ValidateBindRenderbuffer(context, target, renderbuffer))
         {
             context->bindRenderbuffer(target, renderbuffer);
@@ -112,13 +113,13 @@
 
 void GL_APIENTRY BindTexture(GLenum target, GLuint texture)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLuint texture = %u)", target, texture);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(BindTexture, context, targetPacked, texture);
         if (context->skipValidation() || ValidateBindTexture(context, targetPacked, texture))
         {
             context->bindTexture(targetPacked, texture);
@@ -128,13 +129,13 @@
 
 void GL_APIENTRY BlendColor(GLfloat red, GLfloat green, GLfloat blue, GLfloat alpha)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat red = %f, GLfloat green = %f, GLfloat blue = %f, GLfloat alpha = %f)", red,
           green, blue, alpha);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BlendColor, context, red, green, blue, alpha);
         if (context->skipValidation() || ValidateBlendColor(context, red, green, blue, alpha))
         {
             context->blendColor(red, green, blue, alpha);
@@ -144,12 +145,12 @@
 
 void GL_APIENTRY BlendEquation(GLenum mode)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum mode = 0x%X)", mode);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BlendEquation, context, mode);
         if (context->skipValidation() || ValidateBlendEquation(context, mode))
         {
             context->blendEquation(mode);
@@ -159,12 +160,12 @@
 
 void GL_APIENTRY BlendEquationSeparate(GLenum modeRGB, GLenum modeAlpha)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum modeRGB = 0x%X, GLenum modeAlpha = 0x%X)", modeRGB, modeAlpha);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BlendEquationSeparate, context, modeRGB, modeAlpha);
         if (context->skipValidation() || ValidateBlendEquationSeparate(context, modeRGB, modeAlpha))
         {
             context->blendEquationSeparate(modeRGB, modeAlpha);
@@ -174,12 +175,12 @@
 
 void GL_APIENTRY BlendFunc(GLenum sfactor, GLenum dfactor)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum sfactor = 0x%X, GLenum dfactor = 0x%X)", sfactor, dfactor);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BlendFunc, context, sfactor, dfactor);
         if (context->skipValidation() || ValidateBlendFunc(context, sfactor, dfactor))
         {
             context->blendFunc(sfactor, dfactor);
@@ -192,7 +193,6 @@
                                    GLenum sfactorAlpha,
                                    GLenum dfactorAlpha)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum sfactorRGB = 0x%X, GLenum dfactorRGB = 0x%X, GLenum sfactorAlpha = 0x%X, GLenum "
         "dfactorAlpha = 0x%X)",
@@ -201,6 +201,8 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(BlendFuncSeparate, context, sfactorRGB, dfactorRGB, sfactorAlpha,
+                      dfactorAlpha);
         if (context->skipValidation() ||
             ValidateBlendFuncSeparate(context, sfactorRGB, dfactorRGB, sfactorAlpha, dfactorAlpha))
         {
@@ -211,7 +213,6 @@
 
 void GL_APIENTRY BufferData(GLenum target, GLsizeiptr size, const void *data, GLenum usage)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLsizeiptr size = %llu, const void *data = 0x%016" PRIxPTR
           ", GLenum usage = 0x%X)",
           target, static_cast<unsigned long long>(size), (uintptr_t)data, usage);
@@ -221,6 +222,7 @@
     {
         BufferBinding targetPacked = FromGLenum<BufferBinding>(target);
         BufferUsage usagePacked    = FromGLenum<BufferUsage>(usage);
+        ANGLE_CAPTURE(BufferData, context, targetPacked, size, data, usagePacked);
         if (context->skipValidation() ||
             ValidateBufferData(context, targetPacked, size, data, usagePacked))
         {
@@ -231,7 +233,6 @@
 
 void GL_APIENTRY BufferSubData(GLenum target, GLintptr offset, GLsizeiptr size, const void *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLintptr offset = %llu, GLsizeiptr size = %llu, const void *data = "
         "0x%016" PRIxPTR ")",
@@ -242,6 +243,7 @@
     if (context)
     {
         BufferBinding targetPacked = FromGLenum<BufferBinding>(target);
+        ANGLE_CAPTURE(BufferSubData, context, targetPacked, offset, size, data);
         if (context->skipValidation() ||
             ValidateBufferSubData(context, targetPacked, offset, size, data))
         {
@@ -252,12 +254,12 @@
 
 GLenum GL_APIENTRY CheckFramebufferStatus(GLenum target)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X)", target);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(CheckFramebufferStatus, context, target);
         if (context->skipValidation() || ValidateCheckFramebufferStatus(context, target))
         {
             return context->checkFramebufferStatus(target);
@@ -269,12 +271,12 @@
 
 void GL_APIENTRY Clear(GLbitfield mask)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLbitfield mask = 0x%X)", mask);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Clear, context, mask);
         if (context->skipValidation() || ValidateClear(context, mask))
         {
             context->clear(mask);
@@ -284,13 +286,13 @@
 
 void GL_APIENTRY ClearColor(GLfloat red, GLfloat green, GLfloat blue, GLfloat alpha)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat red = %f, GLfloat green = %f, GLfloat blue = %f, GLfloat alpha = %f)", red,
           green, blue, alpha);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ClearColor, context, red, green, blue, alpha);
         if (context->skipValidation() || ValidateClearColor(context, red, green, blue, alpha))
         {
             context->clearColor(red, green, blue, alpha);
@@ -300,12 +302,12 @@
 
 void GL_APIENTRY ClearDepthf(GLfloat d)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat d = %f)", d);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ClearDepthf, context, d);
         if (context->skipValidation() || ValidateClearDepthf(context, d))
         {
             context->clearDepthf(d);
@@ -315,12 +317,12 @@
 
 void GL_APIENTRY ClearStencil(GLint s)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint s = %d)", s);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ClearStencil, context, s);
         if (context->skipValidation() || ValidateClearStencil(context, s))
         {
             context->clearStencil(s);
@@ -330,13 +332,13 @@
 
 void GL_APIENTRY ColorMask(GLboolean red, GLboolean green, GLboolean blue, GLboolean alpha)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLboolean red = %u, GLboolean green = %u, GLboolean blue = %u, GLboolean alpha = %u)",
           red, green, blue, alpha);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ColorMask, context, red, green, blue, alpha);
         if (context->skipValidation() || ValidateColorMask(context, red, green, blue, alpha))
         {
             context->colorMask(red, green, blue, alpha);
@@ -346,12 +348,12 @@
 
 void GL_APIENTRY CompileShader(GLuint shader)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u)", shader);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(CompileShader, context, shader);
         if (context->skipValidation() || ValidateCompileShader(context, shader))
         {
             context->compileShader(shader);
@@ -368,7 +370,6 @@
                                       GLsizei imageSize,
                                       const void *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLenum internalformat = 0x%X, GLsizei width = "
         "%d, GLsizei height = %d, GLint border = %d, GLsizei imageSize = %d, const void *data = "
@@ -379,6 +380,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(CompressedTexImage2D, context, targetPacked, level, internalformat, width,
+                      height, border, imageSize, data);
         if (context->skipValidation() ||
             ValidateCompressedTexImage2D(context, targetPacked, level, internalformat, width,
                                          height, border, imageSize, data))
@@ -399,7 +402,6 @@
                                          GLsizei imageSize,
                                          const void *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLint xoffset = %d, GLint yoffset = %d, GLsizei "
         "width = %d, GLsizei height = %d, GLenum format = 0x%X, GLsizei imageSize = %d, const void "
@@ -410,6 +412,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(CompressedTexSubImage2D, context, targetPacked, level, xoffset, yoffset,
+                      width, height, format, imageSize, data);
         if (context->skipValidation() ||
             ValidateCompressedTexSubImage2D(context, targetPacked, level, xoffset, yoffset, width,
                                             height, format, imageSize, data))
@@ -429,7 +433,6 @@
                                 GLsizei height,
                                 GLint border)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLenum internalformat = 0x%X, GLint x = %d, "
         "GLint y = %d, GLsizei width = %d, GLsizei height = %d, GLint border = %d)",
@@ -439,6 +442,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(CopyTexImage2D, context, targetPacked, level, internalformat, x, y, width,
+                      height, border);
         if (context->skipValidation() ||
             ValidateCopyTexImage2D(context, targetPacked, level, internalformat, x, y, width,
                                    height, border))
@@ -458,7 +463,6 @@
                                    GLsizei width,
                                    GLsizei height)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLint xoffset = %d, GLint yoffset = %d, GLint x "
         "= %d, GLint y = %d, GLsizei width = %d, GLsizei height = %d)",
@@ -468,6 +472,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(CopyTexSubImage2D, context, targetPacked, level, xoffset, yoffset, x, y,
+                      width, height);
         if (context->skipValidation() ||
             ValidateCopyTexSubImage2D(context, targetPacked, level, xoffset, yoffset, x, y, width,
                                       height))
@@ -479,12 +485,12 @@
 
 GLuint GL_APIENTRY CreateProgram()
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("()");
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(CreateProgram, context);
         if (context->skipValidation() || ValidateCreateProgram(context))
         {
             return context->createProgram();
@@ -496,13 +502,13 @@
 
 GLuint GL_APIENTRY CreateShader(GLenum type)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum type = 0x%X)", type);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         ShaderType typePacked = FromGLenum<ShaderType>(type);
+        ANGLE_CAPTURE(CreateShader, context, typePacked);
         if (context->skipValidation() || ValidateCreateShader(context, typePacked))
         {
             return context->createShader(typePacked);
@@ -514,13 +520,13 @@
 
 void GL_APIENTRY CullFace(GLenum mode)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum mode = 0x%X)", mode);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         CullFaceMode modePacked = FromGLenum<CullFaceMode>(mode);
+        ANGLE_CAPTURE(CullFace, context, modePacked);
         if (context->skipValidation() || ValidateCullFace(context, modePacked))
         {
             context->cullFace(modePacked);
@@ -530,12 +536,12 @@
 
 void GL_APIENTRY DeleteBuffers(GLsizei n, const GLuint *buffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, const GLuint *buffers = 0x%016" PRIxPTR ")", n, (uintptr_t)buffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteBuffers, context, n, buffers);
         if (context->skipValidation() || ValidateDeleteBuffers(context, n, buffers))
         {
             context->deleteBuffers(n, buffers);
@@ -545,13 +551,13 @@
 
 void GL_APIENTRY DeleteFramebuffers(GLsizei n, const GLuint *framebuffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, const GLuint *framebuffers = 0x%016" PRIxPTR ")", n,
           (uintptr_t)framebuffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteFramebuffers, context, n, framebuffers);
         if (context->skipValidation() || ValidateDeleteFramebuffers(context, n, framebuffers))
         {
             context->deleteFramebuffers(n, framebuffers);
@@ -561,12 +567,12 @@
 
 void GL_APIENTRY DeleteProgram(GLuint program)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u)", program);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteProgram, context, program);
         if (context->skipValidation() || ValidateDeleteProgram(context, program))
         {
             context->deleteProgram(program);
@@ -576,13 +582,13 @@
 
 void GL_APIENTRY DeleteRenderbuffers(GLsizei n, const GLuint *renderbuffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, const GLuint *renderbuffers = 0x%016" PRIxPTR ")", n,
           (uintptr_t)renderbuffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteRenderbuffers, context, n, renderbuffers);
         if (context->skipValidation() || ValidateDeleteRenderbuffers(context, n, renderbuffers))
         {
             context->deleteRenderbuffers(n, renderbuffers);
@@ -592,12 +598,12 @@
 
 void GL_APIENTRY DeleteShader(GLuint shader)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u)", shader);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteShader, context, shader);
         if (context->skipValidation() || ValidateDeleteShader(context, shader))
         {
             context->deleteShader(shader);
@@ -607,12 +613,12 @@
 
 void GL_APIENTRY DeleteTextures(GLsizei n, const GLuint *textures)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, const GLuint *textures = 0x%016" PRIxPTR ")", n, (uintptr_t)textures);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DeleteTextures, context, n, textures);
         if (context->skipValidation() || ValidateDeleteTextures(context, n, textures))
         {
             context->deleteTextures(n, textures);
@@ -622,12 +628,12 @@
 
 void GL_APIENTRY DepthFunc(GLenum func)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum func = 0x%X)", func);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DepthFunc, context, func);
         if (context->skipValidation() || ValidateDepthFunc(context, func))
         {
             context->depthFunc(func);
@@ -637,12 +643,12 @@
 
 void GL_APIENTRY DepthMask(GLboolean flag)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLboolean flag = %u)", flag);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DepthMask, context, flag);
         if (context->skipValidation() || ValidateDepthMask(context, flag))
         {
             context->depthMask(flag);
@@ -652,12 +658,12 @@
 
 void GL_APIENTRY DepthRangef(GLfloat n, GLfloat f)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat n = %f, GLfloat f = %f)", n, f);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DepthRangef, context, n, f);
         if (context->skipValidation() || ValidateDepthRangef(context, n, f))
         {
             context->depthRangef(n, f);
@@ -667,12 +673,12 @@
 
 void GL_APIENTRY DetachShader(GLuint program, GLuint shader)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLuint shader = %u)", program, shader);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DetachShader, context, program, shader);
         if (context->skipValidation() || ValidateDetachShader(context, program, shader))
         {
             context->detachShader(program, shader);
@@ -682,12 +688,12 @@
 
 void GL_APIENTRY Disable(GLenum cap)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum cap = 0x%X)", cap);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Disable, context, cap);
         if (context->skipValidation() || ValidateDisable(context, cap))
         {
             context->disable(cap);
@@ -697,12 +703,12 @@
 
 void GL_APIENTRY DisableVertexAttribArray(GLuint index)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u)", index);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(DisableVertexAttribArray, context, index);
         if (context->skipValidation() || ValidateDisableVertexAttribArray(context, index))
         {
             context->disableVertexAttribArray(index);
@@ -712,13 +718,13 @@
 
 void GL_APIENTRY DrawArrays(GLenum mode, GLint first, GLsizei count)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum mode = 0x%X, GLint first = %d, GLsizei count = %d)", mode, first, count);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         PrimitiveMode modePacked = FromGLenum<PrimitiveMode>(mode);
+        ANGLE_CAPTURE(DrawArrays, context, modePacked, first, count);
         if (context->skipValidation() || ValidateDrawArrays(context, modePacked, first, count))
         {
             context->drawArrays(modePacked, first, count);
@@ -728,7 +734,6 @@
 
 void GL_APIENTRY DrawElements(GLenum mode, GLsizei count, GLenum type, const void *indices)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum mode = 0x%X, GLsizei count = %d, GLenum type = 0x%X, const void *indices = "
         "0x%016" PRIxPTR ")",
@@ -739,6 +744,7 @@
     {
         PrimitiveMode modePacked    = FromGLenum<PrimitiveMode>(mode);
         DrawElementsType typePacked = FromGLenum<DrawElementsType>(type);
+        ANGLE_CAPTURE(DrawElements, context, modePacked, count, typePacked, indices);
         if (context->skipValidation() ||
             ValidateDrawElements(context, modePacked, count, typePacked, indices))
         {
@@ -749,12 +755,12 @@
 
 void GL_APIENTRY Enable(GLenum cap)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum cap = 0x%X)", cap);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Enable, context, cap);
         if (context->skipValidation() || ValidateEnable(context, cap))
         {
             context->enable(cap);
@@ -764,12 +770,12 @@
 
 void GL_APIENTRY EnableVertexAttribArray(GLuint index)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u)", index);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(EnableVertexAttribArray, context, index);
         if (context->skipValidation() || ValidateEnableVertexAttribArray(context, index))
         {
             context->enableVertexAttribArray(index);
@@ -779,12 +785,12 @@
 
 void GL_APIENTRY Finish()
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("()");
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Finish, context);
         if (context->skipValidation() || ValidateFinish(context))
         {
             context->finish();
@@ -794,12 +800,12 @@
 
 void GL_APIENTRY Flush()
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("()");
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Flush, context);
         if (context->skipValidation() || ValidateFlush(context))
         {
             context->flush();
@@ -812,7 +818,6 @@
                                          GLenum renderbuffertarget,
                                          GLuint renderbuffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLenum attachment = 0x%X, GLenum renderbuffertarget = 0x%X, GLuint "
         "renderbuffer = %u)",
@@ -821,6 +826,8 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(FramebufferRenderbuffer, context, target, attachment, renderbuffertarget,
+                      renderbuffer);
         if (context->skipValidation() ||
             ValidateFramebufferRenderbuffer(context, target, attachment, renderbuffertarget,
                                             renderbuffer))
@@ -836,7 +843,6 @@
                                       GLuint texture,
                                       GLint level)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLenum attachment = 0x%X, GLenum textarget = 0x%X, GLuint texture "
         "= %u, GLint level = %d)",
@@ -846,6 +852,8 @@
     if (context)
     {
         TextureTarget textargetPacked = FromGLenum<TextureTarget>(textarget);
+        ANGLE_CAPTURE(FramebufferTexture2D, context, target, attachment, textargetPacked, texture,
+                      level);
         if (context->skipValidation() ||
             ValidateFramebufferTexture2D(context, target, attachment, textargetPacked, texture,
                                          level))
@@ -857,12 +865,12 @@
 
 void GL_APIENTRY FrontFace(GLenum mode)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum mode = 0x%X)", mode);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(FrontFace, context, mode);
         if (context->skipValidation() || ValidateFrontFace(context, mode))
         {
             context->frontFace(mode);
@@ -872,12 +880,12 @@
 
 void GL_APIENTRY GenBuffers(GLsizei n, GLuint *buffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, GLuint *buffers = 0x%016" PRIxPTR ")", n, (uintptr_t)buffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GenBuffers, context, n, buffers);
         if (context->skipValidation() || ValidateGenBuffers(context, n, buffers))
         {
             context->genBuffers(n, buffers);
@@ -887,12 +895,12 @@
 
 void GL_APIENTRY GenFramebuffers(GLsizei n, GLuint *framebuffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, GLuint *framebuffers = 0x%016" PRIxPTR ")", n, (uintptr_t)framebuffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GenFramebuffers, context, n, framebuffers);
         if (context->skipValidation() || ValidateGenFramebuffers(context, n, framebuffers))
         {
             context->genFramebuffers(n, framebuffers);
@@ -902,13 +910,13 @@
 
 void GL_APIENTRY GenRenderbuffers(GLsizei n, GLuint *renderbuffers)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, GLuint *renderbuffers = 0x%016" PRIxPTR ")", n,
           (uintptr_t)renderbuffers);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GenRenderbuffers, context, n, renderbuffers);
         if (context->skipValidation() || ValidateGenRenderbuffers(context, n, renderbuffers))
         {
             context->genRenderbuffers(n, renderbuffers);
@@ -918,12 +926,12 @@
 
 void GL_APIENTRY GenTextures(GLsizei n, GLuint *textures)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei n = %d, GLuint *textures = 0x%016" PRIxPTR ")", n, (uintptr_t)textures);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GenTextures, context, n, textures);
         if (context->skipValidation() || ValidateGenTextures(context, n, textures))
         {
             context->genTextures(n, textures);
@@ -933,13 +941,13 @@
 
 void GL_APIENTRY GenerateMipmap(GLenum target)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X)", target);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(GenerateMipmap, context, targetPacked);
         if (context->skipValidation() || ValidateGenerateMipmap(context, targetPacked))
         {
             context->generateMipmap(targetPacked);
@@ -955,7 +963,6 @@
                                  GLenum *type,
                                  GLchar *name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLuint program = %u, GLuint index = %u, GLsizei bufSize = %d, GLsizei *length = "
         "0x%016" PRIxPTR ", GLint *size = 0x%016" PRIxPTR ", GLenum *type = 0x%016" PRIxPTR
@@ -966,6 +973,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetActiveAttrib, context, program, index, bufSize, length, size, type, name);
         if (context->skipValidation() ||
             ValidateGetActiveAttrib(context, program, index, bufSize, length, size, type, name))
         {
@@ -982,7 +990,6 @@
                                   GLenum *type,
                                   GLchar *name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLuint program = %u, GLuint index = %u, GLsizei bufSize = %d, GLsizei *length = "
         "0x%016" PRIxPTR ", GLint *size = 0x%016" PRIxPTR ", GLenum *type = 0x%016" PRIxPTR
@@ -993,6 +1000,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetActiveUniform, context, program, index, bufSize, length, size, type, name);
         if (context->skipValidation() ||
             ValidateGetActiveUniform(context, program, index, bufSize, length, size, type, name))
         {
@@ -1006,7 +1014,6 @@
                                     GLsizei *count,
                                     GLuint *shaders)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLsizei maxCount = %d, GLsizei *count = 0x%016" PRIxPTR
           ", GLuint *shaders = 0x%016" PRIxPTR ")",
           program, maxCount, (uintptr_t)count, (uintptr_t)shaders);
@@ -1014,6 +1021,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetAttachedShaders, context, program, maxCount, count, shaders);
         if (context->skipValidation() ||
             ValidateGetAttachedShaders(context, program, maxCount, count, shaders))
         {
@@ -1024,13 +1032,13 @@
 
 GLint GL_APIENTRY GetAttribLocation(GLuint program, const GLchar *name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, const GLchar *name = 0x%016" PRIxPTR ")", program,
           (uintptr_t)name);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetAttribLocation, context, program, name);
         if (context->skipValidation() || ValidateGetAttribLocation(context, program, name))
         {
             return context->getAttribLocation(program, name);
@@ -1042,12 +1050,12 @@
 
 void GL_APIENTRY GetBooleanv(GLenum pname, GLboolean *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum pname = 0x%X, GLboolean *data = 0x%016" PRIxPTR ")", pname, (uintptr_t)data);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetBooleanv, context, pname, data);
         if (context->skipValidation() || ValidateGetBooleanv(context, pname, data))
         {
             context->getBooleanv(pname, data);
@@ -1057,7 +1065,6 @@
 
 void GL_APIENTRY GetBufferParameteriv(GLenum target, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", target,
           pname, (uintptr_t)params);
 
@@ -1065,6 +1072,7 @@
     if (context)
     {
         BufferBinding targetPacked = FromGLenum<BufferBinding>(target);
+        ANGLE_CAPTURE(GetBufferParameteriv, context, targetPacked, pname, params);
         if (context->skipValidation() ||
             ValidateGetBufferParameteriv(context, targetPacked, pname, params))
         {
@@ -1075,12 +1083,12 @@
 
 GLenum GL_APIENTRY GetError()
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("()");
 
     Context *context = GetGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetError, context);
         if (context->skipValidation() || ValidateGetError(context))
         {
             return context->getError();
@@ -1092,12 +1100,12 @@
 
 void GL_APIENTRY GetFloatv(GLenum pname, GLfloat *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum pname = 0x%X, GLfloat *data = 0x%016" PRIxPTR ")", pname, (uintptr_t)data);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetFloatv, context, pname, data);
         if (context->skipValidation() || ValidateGetFloatv(context, pname, data))
         {
             context->getFloatv(pname, data);
@@ -1110,7 +1118,6 @@
                                                      GLenum pname,
                                                      GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLenum attachment = 0x%X, GLenum pname = 0x%X, GLint *params = "
         "0x%016" PRIxPTR ")",
@@ -1119,6 +1126,8 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetFramebufferAttachmentParameteriv, context, target, attachment, pname,
+                      params);
         if (context->skipValidation() ||
             ValidateGetFramebufferAttachmentParameteriv(context, target, attachment, pname, params))
         {
@@ -1129,12 +1138,12 @@
 
 void GL_APIENTRY GetIntegerv(GLenum pname, GLint *data)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum pname = 0x%X, GLint *data = 0x%016" PRIxPTR ")", pname, (uintptr_t)data);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetIntegerv, context, pname, data);
         if (context->skipValidation() || ValidateGetIntegerv(context, pname, data))
         {
             context->getIntegerv(pname, data);
@@ -1147,7 +1156,6 @@
                                    GLsizei *length,
                                    GLchar *infoLog)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLsizei bufSize = %d, GLsizei *length = 0x%016" PRIxPTR
           ", GLchar *infoLog = 0x%016" PRIxPTR ")",
           program, bufSize, (uintptr_t)length, (uintptr_t)infoLog);
@@ -1155,6 +1163,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetProgramInfoLog, context, program, bufSize, length, infoLog);
         if (context->skipValidation() ||
             ValidateGetProgramInfoLog(context, program, bufSize, length, infoLog))
         {
@@ -1165,13 +1174,13 @@
 
 void GL_APIENTRY GetProgramiv(GLuint program, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", program,
           pname, (uintptr_t)params);
 
-    Context *context = GetValidGlobalContext();
+    Context *context = GetGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetProgramiv, context, program, pname, params);
         if (context->skipValidation() || ValidateGetProgramiv(context, program, pname, params))
         {
             context->getProgramiv(program, pname, params);
@@ -1181,13 +1190,13 @@
 
 void GL_APIENTRY GetRenderbufferParameteriv(GLenum target, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", target,
           pname, (uintptr_t)params);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetRenderbufferParameteriv, context, target, pname, params);
         if (context->skipValidation() ||
             ValidateGetRenderbufferParameteriv(context, target, pname, params))
         {
@@ -1198,7 +1207,6 @@
 
 void GL_APIENTRY GetShaderInfoLog(GLuint shader, GLsizei bufSize, GLsizei *length, GLchar *infoLog)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u, GLsizei bufSize = %d, GLsizei *length = 0x%016" PRIxPTR
           ", GLchar *infoLog = 0x%016" PRIxPTR ")",
           shader, bufSize, (uintptr_t)length, (uintptr_t)infoLog);
@@ -1206,6 +1214,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetShaderInfoLog, context, shader, bufSize, length, infoLog);
         if (context->skipValidation() ||
             ValidateGetShaderInfoLog(context, shader, bufSize, length, infoLog))
         {
@@ -1219,7 +1228,6 @@
                                           GLint *range,
                                           GLint *precision)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum shadertype = 0x%X, GLenum precisiontype = 0x%X, GLint *range = 0x%016" PRIxPTR
           ", GLint *precision = 0x%016" PRIxPTR ")",
           shadertype, precisiontype, (uintptr_t)range, (uintptr_t)precision);
@@ -1227,6 +1235,8 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetShaderPrecisionFormat, context, shadertype, precisiontype, range,
+                      precision);
         if (context->skipValidation() ||
             ValidateGetShaderPrecisionFormat(context, shadertype, precisiontype, range, precision))
         {
@@ -1237,7 +1247,6 @@
 
 void GL_APIENTRY GetShaderSource(GLuint shader, GLsizei bufSize, GLsizei *length, GLchar *source)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u, GLsizei bufSize = %d, GLsizei *length = 0x%016" PRIxPTR
           ", GLchar *source = 0x%016" PRIxPTR ")",
           shader, bufSize, (uintptr_t)length, (uintptr_t)source);
@@ -1245,6 +1254,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetShaderSource, context, shader, bufSize, length, source);
         if (context->skipValidation() ||
             ValidateGetShaderSource(context, shader, bufSize, length, source))
         {
@@ -1255,13 +1265,13 @@
 
 void GL_APIENTRY GetShaderiv(GLuint shader, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", shader,
           pname, (uintptr_t)params);
 
-    Context *context = GetValidGlobalContext();
+    Context *context = GetGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetShaderiv, context, shader, pname, params);
         if (context->skipValidation() || ValidateGetShaderiv(context, shader, pname, params))
         {
             context->getShaderiv(shader, pname, params);
@@ -1271,12 +1281,12 @@
 
 const GLubyte *GL_APIENTRY GetString(GLenum name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum name = 0x%X)", name);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetString, context, name);
         if (context->skipValidation() || ValidateGetString(context, name))
         {
             return context->getString(name);
@@ -1288,7 +1298,6 @@
 
 void GL_APIENTRY GetTexParameterfv(GLenum target, GLenum pname, GLfloat *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLfloat *params = 0x%016" PRIxPTR ")",
           target, pname, (uintptr_t)params);
 
@@ -1296,6 +1305,7 @@
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(GetTexParameterfv, context, targetPacked, pname, params);
         if (context->skipValidation() ||
             ValidateGetTexParameterfv(context, targetPacked, pname, params))
         {
@@ -1306,7 +1316,6 @@
 
 void GL_APIENTRY GetTexParameteriv(GLenum target, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", target,
           pname, (uintptr_t)params);
 
@@ -1314,6 +1323,7 @@
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(GetTexParameteriv, context, targetPacked, pname, params);
         if (context->skipValidation() ||
             ValidateGetTexParameteriv(context, targetPacked, pname, params))
         {
@@ -1324,13 +1334,13 @@
 
 GLint GL_APIENTRY GetUniformLocation(GLuint program, const GLchar *name)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, const GLchar *name = 0x%016" PRIxPTR ")", program,
           (uintptr_t)name);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetUniformLocation, context, program, name);
         if (context->skipValidation() || ValidateGetUniformLocation(context, program, name))
         {
             return context->getUniformLocation(program, name);
@@ -1342,13 +1352,13 @@
 
 void GL_APIENTRY GetUniformfv(GLuint program, GLint location, GLfloat *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLint location = %d, GLfloat *params = 0x%016" PRIxPTR ")",
           program, location, (uintptr_t)params);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetUniformfv, context, program, location, params);
         if (context->skipValidation() || ValidateGetUniformfv(context, program, location, params))
         {
             context->getUniformfv(program, location, params);
@@ -1358,13 +1368,13 @@
 
 void GL_APIENTRY GetUniformiv(GLuint program, GLint location, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u, GLint location = %d, GLint *params = 0x%016" PRIxPTR ")", program,
           location, (uintptr_t)params);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetUniformiv, context, program, location, params);
         if (context->skipValidation() || ValidateGetUniformiv(context, program, location, params))
         {
             context->getUniformiv(program, location, params);
@@ -1374,13 +1384,13 @@
 
 void GL_APIENTRY GetVertexAttribPointerv(GLuint index, GLenum pname, void **pointer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLenum pname = 0x%X, void **pointer = 0x%016" PRIxPTR ")", index,
           pname, (uintptr_t)pointer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetVertexAttribPointerv, context, index, pname, pointer);
         if (context->skipValidation() ||
             ValidateGetVertexAttribPointerv(context, index, pname, pointer))
         {
@@ -1391,13 +1401,13 @@
 
 void GL_APIENTRY GetVertexAttribfv(GLuint index, GLenum pname, GLfloat *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLenum pname = 0x%X, GLfloat *params = 0x%016" PRIxPTR ")", index,
           pname, (uintptr_t)params);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetVertexAttribfv, context, index, pname, params);
         if (context->skipValidation() || ValidateGetVertexAttribfv(context, index, pname, params))
         {
             context->getVertexAttribfv(index, pname, params);
@@ -1407,13 +1417,13 @@
 
 void GL_APIENTRY GetVertexAttribiv(GLuint index, GLenum pname, GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLenum pname = 0x%X, GLint *params = 0x%016" PRIxPTR ")", index,
           pname, (uintptr_t)params);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(GetVertexAttribiv, context, index, pname, params);
         if (context->skipValidation() || ValidateGetVertexAttribiv(context, index, pname, params))
         {
             context->getVertexAttribiv(index, pname, params);
@@ -1423,12 +1433,12 @@
 
 void GL_APIENTRY Hint(GLenum target, GLenum mode)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum mode = 0x%X)", target, mode);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Hint, context, target, mode);
         if (context->skipValidation() || ValidateHint(context, target, mode))
         {
             context->hint(target, mode);
@@ -1438,12 +1448,12 @@
 
 GLboolean GL_APIENTRY IsBuffer(GLuint buffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint buffer = %u)", buffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsBuffer, context, buffer);
         if (context->skipValidation() || ValidateIsBuffer(context, buffer))
         {
             return context->isBuffer(buffer);
@@ -1455,12 +1465,12 @@
 
 GLboolean GL_APIENTRY IsEnabled(GLenum cap)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum cap = 0x%X)", cap);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsEnabled, context, cap);
         if (context->skipValidation() || ValidateIsEnabled(context, cap))
         {
             return context->isEnabled(cap);
@@ -1472,12 +1482,12 @@
 
 GLboolean GL_APIENTRY IsFramebuffer(GLuint framebuffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint framebuffer = %u)", framebuffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsFramebuffer, context, framebuffer);
         if (context->skipValidation() || ValidateIsFramebuffer(context, framebuffer))
         {
             return context->isFramebuffer(framebuffer);
@@ -1489,12 +1499,12 @@
 
 GLboolean GL_APIENTRY IsProgram(GLuint program)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u)", program);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsProgram, context, program);
         if (context->skipValidation() || ValidateIsProgram(context, program))
         {
             return context->isProgram(program);
@@ -1506,12 +1516,12 @@
 
 GLboolean GL_APIENTRY IsRenderbuffer(GLuint renderbuffer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint renderbuffer = %u)", renderbuffer);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsRenderbuffer, context, renderbuffer);
         if (context->skipValidation() || ValidateIsRenderbuffer(context, renderbuffer))
         {
             return context->isRenderbuffer(renderbuffer);
@@ -1523,12 +1533,12 @@
 
 GLboolean GL_APIENTRY IsShader(GLuint shader)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u)", shader);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsShader, context, shader);
         if (context->skipValidation() || ValidateIsShader(context, shader))
         {
             return context->isShader(shader);
@@ -1540,12 +1550,12 @@
 
 GLboolean GL_APIENTRY IsTexture(GLuint texture)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint texture = %u)", texture);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(IsTexture, context, texture);
         if (context->skipValidation() || ValidateIsTexture(context, texture))
         {
             return context->isTexture(texture);
@@ -1557,12 +1567,12 @@
 
 void GL_APIENTRY LineWidth(GLfloat width)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat width = %f)", width);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(LineWidth, context, width);
         if (context->skipValidation() || ValidateLineWidth(context, width))
         {
             context->lineWidth(width);
@@ -1572,12 +1582,12 @@
 
 void GL_APIENTRY LinkProgram(GLuint program)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u)", program);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(LinkProgram, context, program);
         if (context->skipValidation() || ValidateLinkProgram(context, program))
         {
             context->linkProgram(program);
@@ -1587,12 +1597,12 @@
 
 void GL_APIENTRY PixelStorei(GLenum pname, GLint param)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum pname = 0x%X, GLint param = %d)", pname, param);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(PixelStorei, context, pname, param);
         if (context->skipValidation() || ValidatePixelStorei(context, pname, param))
         {
             context->pixelStorei(pname, param);
@@ -1602,12 +1612,12 @@
 
 void GL_APIENTRY PolygonOffset(GLfloat factor, GLfloat units)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat factor = %f, GLfloat units = %f)", factor, units);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(PolygonOffset, context, factor, units);
         if (context->skipValidation() || ValidatePolygonOffset(context, factor, units))
         {
             context->polygonOffset(factor, units);
@@ -1623,7 +1633,6 @@
                             GLenum type,
                             void *pixels)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLint x = %d, GLint y = %d, GLsizei width = %d, GLsizei height = %d, GLenum format = "
         "0x%X, GLenum type = 0x%X, void *pixels = 0x%016" PRIxPTR ")",
@@ -1632,6 +1641,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ReadPixels, context, x, y, width, height, format, type, pixels);
         if (context->skipValidation() ||
             ValidateReadPixels(context, x, y, width, height, format, type, pixels))
         {
@@ -1642,12 +1652,12 @@
 
 void GL_APIENTRY ReleaseShaderCompiler()
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("()");
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ReleaseShaderCompiler, context);
         if (context->skipValidation() || ValidateReleaseShaderCompiler(context))
         {
             context->releaseShaderCompiler();
@@ -1660,7 +1670,6 @@
                                      GLsizei width,
                                      GLsizei height)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLenum internalformat = 0x%X, GLsizei width = %d, GLsizei height = "
         "%d)",
@@ -1669,6 +1678,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(RenderbufferStorage, context, target, internalformat, width, height);
         if (context->skipValidation() ||
             ValidateRenderbufferStorage(context, target, internalformat, width, height))
         {
@@ -1679,12 +1689,12 @@
 
 void GL_APIENTRY SampleCoverage(GLfloat value, GLboolean invert)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLfloat value = %f, GLboolean invert = %u)", value, invert);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(SampleCoverage, context, value, invert);
         if (context->skipValidation() || ValidateSampleCoverage(context, value, invert))
         {
             context->sampleCoverage(value, invert);
@@ -1694,13 +1704,13 @@
 
 void GL_APIENTRY Scissor(GLint x, GLint y, GLsizei width, GLsizei height)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint x = %d, GLint y = %d, GLsizei width = %d, GLsizei height = %d)", x, y, width,
           height);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Scissor, context, x, y, width, height);
         if (context->skipValidation() || ValidateScissor(context, x, y, width, height))
         {
             context->scissor(x, y, width, height);
@@ -1714,7 +1724,6 @@
                               const void *binary,
                               GLsizei length)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLsizei count = %d, const GLuint *shaders = 0x%016" PRIxPTR
           ", GLenum binaryformat = 0x%X, const void *binary = 0x%016" PRIxPTR
           ", GLsizei length = %d)",
@@ -1723,6 +1732,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ShaderBinary, context, count, shaders, binaryformat, binary, length);
         if (context->skipValidation() ||
             ValidateShaderBinary(context, count, shaders, binaryformat, binary, length))
         {
@@ -1736,7 +1746,6 @@
                               const GLchar *const *string,
                               const GLint *length)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint shader = %u, GLsizei count = %d, const GLchar *const*string = 0x%016" PRIxPTR
           ", const GLint *length = 0x%016" PRIxPTR ")",
           shader, count, (uintptr_t)string, (uintptr_t)length);
@@ -1744,6 +1753,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ShaderSource, context, shader, count, string, length);
         if (context->skipValidation() ||
             ValidateShaderSource(context, shader, count, string, length))
         {
@@ -1754,12 +1764,12 @@
 
 void GL_APIENTRY StencilFunc(GLenum func, GLint ref, GLuint mask)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum func = 0x%X, GLint ref = %d, GLuint mask = %u)", func, ref, mask);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilFunc, context, func, ref, mask);
         if (context->skipValidation() || ValidateStencilFunc(context, func, ref, mask))
         {
             context->stencilFunc(func, ref, mask);
@@ -1769,13 +1779,13 @@
 
 void GL_APIENTRY StencilFuncSeparate(GLenum face, GLenum func, GLint ref, GLuint mask)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum face = 0x%X, GLenum func = 0x%X, GLint ref = %d, GLuint mask = %u)", face, func,
           ref, mask);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilFuncSeparate, context, face, func, ref, mask);
         if (context->skipValidation() ||
             ValidateStencilFuncSeparate(context, face, func, ref, mask))
         {
@@ -1786,12 +1796,12 @@
 
 void GL_APIENTRY StencilMask(GLuint mask)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint mask = %u)", mask);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilMask, context, mask);
         if (context->skipValidation() || ValidateStencilMask(context, mask))
         {
             context->stencilMask(mask);
@@ -1801,12 +1811,12 @@
 
 void GL_APIENTRY StencilMaskSeparate(GLenum face, GLuint mask)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum face = 0x%X, GLuint mask = %u)", face, mask);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilMaskSeparate, context, face, mask);
         if (context->skipValidation() || ValidateStencilMaskSeparate(context, face, mask))
         {
             context->stencilMaskSeparate(face, mask);
@@ -1816,12 +1826,12 @@
 
 void GL_APIENTRY StencilOp(GLenum fail, GLenum zfail, GLenum zpass)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum fail = 0x%X, GLenum zfail = 0x%X, GLenum zpass = 0x%X)", fail, zfail, zpass);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilOp, context, fail, zfail, zpass);
         if (context->skipValidation() || ValidateStencilOp(context, fail, zfail, zpass))
         {
             context->stencilOp(fail, zfail, zpass);
@@ -1831,13 +1841,13 @@
 
 void GL_APIENTRY StencilOpSeparate(GLenum face, GLenum sfail, GLenum dpfail, GLenum dppass)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum face = 0x%X, GLenum sfail = 0x%X, GLenum dpfail = 0x%X, GLenum dppass = 0x%X)",
           face, sfail, dpfail, dppass);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(StencilOpSeparate, context, face, sfail, dpfail, dppass);
         if (context->skipValidation() ||
             ValidateStencilOpSeparate(context, face, sfail, dpfail, dppass))
         {
@@ -1856,7 +1866,6 @@
                             GLenum type,
                             const void *pixels)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLint internalformat = %d, GLsizei width = %d, "
         "GLsizei height = %d, GLint border = %d, GLenum format = 0x%X, GLenum type = 0x%X, const "
@@ -1867,6 +1876,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(TexImage2D, context, targetPacked, level, internalformat, width, height,
+                      border, format, type, pixels);
         if (context->skipValidation() ||
             ValidateTexImage2D(context, targetPacked, level, internalformat, width, height, border,
                                format, type, pixels))
@@ -1879,13 +1890,13 @@
 
 void GL_APIENTRY TexParameterf(GLenum target, GLenum pname, GLfloat param)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLfloat param = %f)", target, pname, param);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(TexParameterf, context, targetPacked, pname, param);
         if (context->skipValidation() || ValidateTexParameterf(context, targetPacked, pname, param))
         {
             context->texParameterf(targetPacked, pname, param);
@@ -1895,7 +1906,6 @@
 
 void GL_APIENTRY TexParameterfv(GLenum target, GLenum pname, const GLfloat *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, const GLfloat *params = 0x%016" PRIxPTR ")",
           target, pname, (uintptr_t)params);
 
@@ -1903,6 +1913,7 @@
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(TexParameterfv, context, targetPacked, pname, params);
         if (context->skipValidation() ||
             ValidateTexParameterfv(context, targetPacked, pname, params))
         {
@@ -1913,13 +1924,13 @@
 
 void GL_APIENTRY TexParameteri(GLenum target, GLenum pname, GLint param)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, GLint param = %d)", target, pname, param);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(TexParameteri, context, targetPacked, pname, param);
         if (context->skipValidation() || ValidateTexParameteri(context, targetPacked, pname, param))
         {
             context->texParameteri(targetPacked, pname, param);
@@ -1929,7 +1940,6 @@
 
 void GL_APIENTRY TexParameteriv(GLenum target, GLenum pname, const GLint *params)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLenum target = 0x%X, GLenum pname = 0x%X, const GLint *params = 0x%016" PRIxPTR ")",
           target, pname, (uintptr_t)params);
 
@@ -1937,6 +1947,7 @@
     if (context)
     {
         TextureType targetPacked = FromGLenum<TextureType>(target);
+        ANGLE_CAPTURE(TexParameteriv, context, targetPacked, pname, params);
         if (context->skipValidation() ||
             ValidateTexParameteriv(context, targetPacked, pname, params))
         {
@@ -1955,7 +1966,6 @@
                                GLenum type,
                                const void *pixels)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLenum target = 0x%X, GLint level = %d, GLint xoffset = %d, GLint yoffset = %d, GLsizei "
         "width = %d, GLsizei height = %d, GLenum format = 0x%X, GLenum type = 0x%X, const void "
@@ -1966,6 +1976,8 @@
     if (context)
     {
         TextureTarget targetPacked = FromGLenum<TextureTarget>(target);
+        ANGLE_CAPTURE(TexSubImage2D, context, targetPacked, level, xoffset, yoffset, width, height,
+                      format, type, pixels);
         if (context->skipValidation() ||
             ValidateTexSubImage2D(context, targetPacked, level, xoffset, yoffset, width, height,
                                   format, type, pixels))
@@ -1978,12 +1990,12 @@
 
 void GL_APIENTRY Uniform1f(GLint location, GLfloat v0)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLfloat v0 = %f)", location, v0);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform1f, context, location, v0);
         if (context->skipValidation() || ValidateUniform1f(context, location, v0))
         {
             context->uniform1f(location, v0);
@@ -1993,13 +2005,13 @@
 
 void GL_APIENTRY Uniform1fv(GLint location, GLsizei count, const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLfloat *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform1fv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform1fv(context, location, count, value))
         {
             context->uniform1fv(location, count, value);
@@ -2009,12 +2021,12 @@
 
 void GL_APIENTRY Uniform1i(GLint location, GLint v0)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLint v0 = %d)", location, v0);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform1i, context, location, v0);
         if (context->skipValidation() || ValidateUniform1i(context, location, v0))
         {
             context->uniform1i(location, v0);
@@ -2024,13 +2036,13 @@
 
 void GL_APIENTRY Uniform1iv(GLint location, GLsizei count, const GLint *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLint *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform1iv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform1iv(context, location, count, value))
         {
             context->uniform1iv(location, count, value);
@@ -2040,12 +2052,12 @@
 
 void GL_APIENTRY Uniform2f(GLint location, GLfloat v0, GLfloat v1)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLfloat v0 = %f, GLfloat v1 = %f)", location, v0, v1);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform2f, context, location, v0, v1);
         if (context->skipValidation() || ValidateUniform2f(context, location, v0, v1))
         {
             context->uniform2f(location, v0, v1);
@@ -2055,13 +2067,13 @@
 
 void GL_APIENTRY Uniform2fv(GLint location, GLsizei count, const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLfloat *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform2fv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform2fv(context, location, count, value))
         {
             context->uniform2fv(location, count, value);
@@ -2071,12 +2083,12 @@
 
 void GL_APIENTRY Uniform2i(GLint location, GLint v0, GLint v1)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLint v0 = %d, GLint v1 = %d)", location, v0, v1);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform2i, context, location, v0, v1);
         if (context->skipValidation() || ValidateUniform2i(context, location, v0, v1))
         {
             context->uniform2i(location, v0, v1);
@@ -2086,13 +2098,13 @@
 
 void GL_APIENTRY Uniform2iv(GLint location, GLsizei count, const GLint *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLint *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform2iv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform2iv(context, location, count, value))
         {
             context->uniform2iv(location, count, value);
@@ -2102,13 +2114,13 @@
 
 void GL_APIENTRY Uniform3f(GLint location, GLfloat v0, GLfloat v1, GLfloat v2)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLfloat v0 = %f, GLfloat v1 = %f, GLfloat v2 = %f)", location, v0,
           v1, v2);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform3f, context, location, v0, v1, v2);
         if (context->skipValidation() || ValidateUniform3f(context, location, v0, v1, v2))
         {
             context->uniform3f(location, v0, v1, v2);
@@ -2118,13 +2130,13 @@
 
 void GL_APIENTRY Uniform3fv(GLint location, GLsizei count, const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLfloat *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform3fv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform3fv(context, location, count, value))
         {
             context->uniform3fv(location, count, value);
@@ -2134,13 +2146,13 @@
 
 void GL_APIENTRY Uniform3i(GLint location, GLint v0, GLint v1, GLint v2)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLint v0 = %d, GLint v1 = %d, GLint v2 = %d)", location, v0, v1,
           v2);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform3i, context, location, v0, v1, v2);
         if (context->skipValidation() || ValidateUniform3i(context, location, v0, v1, v2))
         {
             context->uniform3i(location, v0, v1, v2);
@@ -2150,13 +2162,13 @@
 
 void GL_APIENTRY Uniform3iv(GLint location, GLsizei count, const GLint *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLint *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform3iv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform3iv(context, location, count, value))
         {
             context->uniform3iv(location, count, value);
@@ -2166,7 +2178,6 @@
 
 void GL_APIENTRY Uniform4f(GLint location, GLfloat v0, GLfloat v1, GLfloat v2, GLfloat v3)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLint location = %d, GLfloat v0 = %f, GLfloat v1 = %f, GLfloat v2 = %f, GLfloat v3 = %f)",
         location, v0, v1, v2, v3);
@@ -2174,6 +2185,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform4f, context, location, v0, v1, v2, v3);
         if (context->skipValidation() || ValidateUniform4f(context, location, v0, v1, v2, v3))
         {
             context->uniform4f(location, v0, v1, v2, v3);
@@ -2183,13 +2195,13 @@
 
 void GL_APIENTRY Uniform4fv(GLint location, GLsizei count, const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLfloat *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform4fv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform4fv(context, location, count, value))
         {
             context->uniform4fv(location, count, value);
@@ -2199,13 +2211,13 @@
 
 void GL_APIENTRY Uniform4i(GLint location, GLint v0, GLint v1, GLint v2, GLint v3)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLint v0 = %d, GLint v1 = %d, GLint v2 = %d, GLint v3 = %d)",
           location, v0, v1, v2, v3);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform4i, context, location, v0, v1, v2, v3);
         if (context->skipValidation() || ValidateUniform4i(context, location, v0, v1, v2, v3))
         {
             context->uniform4i(location, v0, v1, v2, v3);
@@ -2215,13 +2227,13 @@
 
 void GL_APIENTRY Uniform4iv(GLint location, GLsizei count, const GLint *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint location = %d, GLsizei count = %d, const GLint *value = 0x%016" PRIxPTR ")",
           location, count, (uintptr_t)value);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Uniform4iv, context, location, count, value);
         if (context->skipValidation() || ValidateUniform4iv(context, location, count, value))
         {
             context->uniform4iv(location, count, value);
@@ -2234,7 +2246,6 @@
                                   GLboolean transpose,
                                   const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLint location = %d, GLsizei count = %d, GLboolean transpose = %u, const GLfloat *value "
         "= 0x%016" PRIxPTR ")",
@@ -2243,6 +2254,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(UniformMatrix2fv, context, location, count, transpose, value);
         if (context->skipValidation() ||
             ValidateUniformMatrix2fv(context, location, count, transpose, value))
         {
@@ -2256,7 +2268,6 @@
                                   GLboolean transpose,
                                   const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLint location = %d, GLsizei count = %d, GLboolean transpose = %u, const GLfloat *value "
         "= 0x%016" PRIxPTR ")",
@@ -2265,6 +2276,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(UniformMatrix3fv, context, location, count, transpose, value);
         if (context->skipValidation() ||
             ValidateUniformMatrix3fv(context, location, count, transpose, value))
         {
@@ -2278,7 +2290,6 @@
                                   GLboolean transpose,
                                   const GLfloat *value)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLint location = %d, GLsizei count = %d, GLboolean transpose = %u, const GLfloat *value "
         "= 0x%016" PRIxPTR ")",
@@ -2287,6 +2298,7 @@
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(UniformMatrix4fv, context, location, count, transpose, value);
         if (context->skipValidation() ||
             ValidateUniformMatrix4fv(context, location, count, transpose, value))
         {
@@ -2297,12 +2309,12 @@
 
 void GL_APIENTRY UseProgram(GLuint program)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u)", program);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(UseProgram, context, program);
         if (context->skipValidation() || ValidateUseProgram(context, program))
         {
             context->useProgram(program);
@@ -2312,12 +2324,12 @@
 
 void GL_APIENTRY ValidateProgram(GLuint program)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint program = %u)", program);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(ValidateProgram, context, program);
         if (context->skipValidation() || ValidateValidateProgram(context, program))
         {
             context->validateProgram(program);
@@ -2327,12 +2339,12 @@
 
 void GL_APIENTRY VertexAttrib1f(GLuint index, GLfloat x)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLfloat x = %f)", index, x);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib1f, context, index, x);
         if (context->skipValidation() || ValidateVertexAttrib1f(context, index, x))
         {
             context->vertexAttrib1f(index, x);
@@ -2342,12 +2354,12 @@
 
 void GL_APIENTRY VertexAttrib1fv(GLuint index, const GLfloat *v)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, const GLfloat *v = 0x%016" PRIxPTR ")", index, (uintptr_t)v);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib1fv, context, index, v);
         if (context->skipValidation() || ValidateVertexAttrib1fv(context, index, v))
         {
             context->vertexAttrib1fv(index, v);
@@ -2357,12 +2369,12 @@
 
 void GL_APIENTRY VertexAttrib2f(GLuint index, GLfloat x, GLfloat y)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLfloat x = %f, GLfloat y = %f)", index, x, y);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib2f, context, index, x, y);
         if (context->skipValidation() || ValidateVertexAttrib2f(context, index, x, y))
         {
             context->vertexAttrib2f(index, x, y);
@@ -2372,12 +2384,12 @@
 
 void GL_APIENTRY VertexAttrib2fv(GLuint index, const GLfloat *v)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, const GLfloat *v = 0x%016" PRIxPTR ")", index, (uintptr_t)v);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib2fv, context, index, v);
         if (context->skipValidation() || ValidateVertexAttrib2fv(context, index, v))
         {
             context->vertexAttrib2fv(index, v);
@@ -2387,12 +2399,12 @@
 
 void GL_APIENTRY VertexAttrib3f(GLuint index, GLfloat x, GLfloat y, GLfloat z)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLfloat x = %f, GLfloat y = %f, GLfloat z = %f)", index, x, y, z);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib3f, context, index, x, y, z);
         if (context->skipValidation() || ValidateVertexAttrib3f(context, index, x, y, z))
         {
             context->vertexAttrib3f(index, x, y, z);
@@ -2402,12 +2414,12 @@
 
 void GL_APIENTRY VertexAttrib3fv(GLuint index, const GLfloat *v)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, const GLfloat *v = 0x%016" PRIxPTR ")", index, (uintptr_t)v);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib3fv, context, index, v);
         if (context->skipValidation() || ValidateVertexAttrib3fv(context, index, v))
         {
             context->vertexAttrib3fv(index, v);
@@ -2417,13 +2429,13 @@
 
 void GL_APIENTRY VertexAttrib4f(GLuint index, GLfloat x, GLfloat y, GLfloat z, GLfloat w)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, GLfloat x = %f, GLfloat y = %f, GLfloat z = %f, GLfloat w = %f)",
           index, x, y, z, w);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib4f, context, index, x, y, z, w);
         if (context->skipValidation() || ValidateVertexAttrib4f(context, index, x, y, z, w))
         {
             context->vertexAttrib4f(index, x, y, z, w);
@@ -2433,12 +2445,12 @@
 
 void GL_APIENTRY VertexAttrib4fv(GLuint index, const GLfloat *v)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLuint index = %u, const GLfloat *v = 0x%016" PRIxPTR ")", index, (uintptr_t)v);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(VertexAttrib4fv, context, index, v);
         if (context->skipValidation() || ValidateVertexAttrib4fv(context, index, v))
         {
             context->vertexAttrib4fv(index, v);
@@ -2453,7 +2465,6 @@
                                      GLsizei stride,
                                      const void *pointer)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT(
         "(GLuint index = %u, GLint size = %d, GLenum type = 0x%X, GLboolean normalized = %u, "
         "GLsizei stride = %d, const void *pointer = 0x%016" PRIxPTR ")",
@@ -2463,6 +2474,8 @@
     if (context)
     {
         VertexAttribType typePacked = FromGLenum<VertexAttribType>(type);
+        ANGLE_CAPTURE(VertexAttribPointer, context, index, size, typePacked, normalized, stride,
+                      pointer);
         if (context->skipValidation() ||
             ValidateVertexAttribPointer(context, index, size, typePacked, normalized, stride,
                                         pointer))
@@ -2474,13 +2487,13 @@
 
 void GL_APIENTRY Viewport(GLint x, GLint y, GLsizei width, GLsizei height)
 {
-    ANGLE_SCOPED_GLOBAL_LOCK();
     EVENT("(GLint x = %d, GLint y = %d, GLsizei width = %d, GLsizei height = %d)", x, y, width,
           height);
 
     Context *context = GetValidGlobalContext();
     if (context)
     {
+        ANGLE_CAPTURE(Viewport, context, x, y, width, height);
         if (context->skipValidation() || ValidateViewport(context, x, y, width, height))
         {
             context->viewport(x, y, width, height);