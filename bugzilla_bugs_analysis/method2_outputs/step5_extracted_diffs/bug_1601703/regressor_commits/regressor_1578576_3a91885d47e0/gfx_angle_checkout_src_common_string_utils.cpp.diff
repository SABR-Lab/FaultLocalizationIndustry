# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/angle/checkout/src/common/string_utils.cpp
# Commit: 3a91885d47e0
# Full Hash: 3a91885d47e0ef7fba9749562d52300eea67c651
# Author: Miko Mynttinen <mikokm@gmail.com>
# Date: 2019-11-11 21:52:52
# Regressor Bug: 1578576
# File Overlap Count: 4
# Description:
#   Bug 1578576 - Part 2: Update to ANGLE 3865 r=jgilbert
#   
#   Depends on D44561
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D44579
# ==============================================================================

diff -r 77cee77c0307 -r 3a91885d47e0 gfx/angle/checkout/src/common/string_utils.cpp
--- a/gfx/angle/checkout/src/common/string_utils.cpp	Fri Nov 08 16:41:42 2019 +0000
+++ b/gfx/angle/checkout/src/common/string_utils.cpp	Fri Nov 08 17:06:00 2019 +0000
@@ -57,7 +57,7 @@
 
         if (resultType == SPLIT_WANT_ALL || !piece.empty())
         {
-            result.push_back(piece);
+            result.push_back(std::move(piece));
         }
     }
 
@@ -101,6 +101,26 @@
     return input.substr(begin, end - begin + 1);
 }
 
+std::string GetPrefix(const std::string &input, size_t offset, const char *delimiter)
+{
+    size_t match = input.find(delimiter, offset);
+    if (match == std::string::npos)
+    {
+        return input.substr(offset);
+    }
+    return input.substr(offset, match - offset);
+}
+
+std::string GetPrefix(const std::string &input, size_t offset, char delimiter)
+{
+    size_t match = input.find(delimiter, offset);
+    if (match == std::string::npos)
+    {
+        return input.substr(offset);
+    }
+    return input.substr(offset, match - offset);
+}
+
 bool HexStringToUInt(const std::string &input, unsigned int *uintOut)
 {
     unsigned int offset = 0;
@@ -137,27 +157,6 @@
     return !inFile.fail();
 }
 
-Optional<std::vector<wchar_t>> WidenString(size_t length, const char *cString)
-{
-    std::vector<wchar_t> wcstring(length + 1);
-#if !defined(ANGLE_PLATFORM_WINDOWS)
-    mbstate_t mbstate = {};
-    size_t written    = mbsrtowcs(wcstring.data(), &cString, length + 1, &mbstate);
-    if (written == 0)
-    {
-        return Optional<std::vector<wchar_t>>::Invalid();
-    }
-#else
-    size_t convertedChars = 0;
-    errno_t err = mbstowcs_s(&convertedChars, wcstring.data(), length + 1, cString, _TRUNCATE);
-    if (err != 0)
-    {
-        return Optional<std::vector<wchar_t>>::Invalid();
-    }
-#endif
-    return Optional<std::vector<wchar_t>>(wcstring);
-}
-
 bool BeginsWith(const std::string &str, const std::string &prefix)
 {
     return strncmp(str.c_str(), prefix.c_str(), prefix.length()) == 0;