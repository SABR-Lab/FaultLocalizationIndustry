# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/angle/checkout/src/libANGLE/validationES31.cpp
# Commit: 3a91885d47e0
# Full Hash: 3a91885d47e0ef7fba9749562d52300eea67c651
# Author: Miko Mynttinen <mikokm@gmail.com>
# Date: 2019-11-11 21:52:52
# Regressor Bug: 1578576
# File Overlap Count: 4
# Description:
#   Bug 1578576 - Part 2: Update to ANGLE 3865 r=jgilbert
#   
#   Depends on D44561
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D44579
# ==============================================================================

diff -r 77cee77c0307 -r 3a91885d47e0 gfx/angle/checkout/src/libANGLE/validationES31.cpp
--- a/gfx/angle/checkout/src/libANGLE/validationES31.cpp	Fri Nov 08 16:41:42 2019 +0000
+++ b/gfx/angle/checkout/src/libANGLE/validationES31.cpp	Fri Nov 08 17:06:00 2019 +0000
@@ -938,6 +938,26 @@
                                                height);
 }
 
+bool ValidateTexStorageMem2DMultisampleEXT(Context *context,
+                                           TextureType target,
+                                           GLsizei samples,
+                                           GLenum internalFormat,
+                                           GLsizei width,
+                                           GLsizei height,
+                                           GLboolean fixedSampleLocations,
+                                           GLuint memory,
+                                           GLuint64 offset)
+{
+    if (!context->getExtensions().memoryObject)
+    {
+        context->validationError(GL_INVALID_OPERATION, kExtensionNotEnabled);
+        return false;
+    }
+
+    UNIMPLEMENTED();
+    return false;
+}
+
 bool ValidateGetMultisamplefv(Context *context, GLenum pname, GLuint index, GLfloat *val)
 {
     if (context->getClientVersion() < ES_3_1)
@@ -1733,7 +1753,7 @@
         GL_PIXEL_BUFFER_BARRIER_BIT | GL_TEXTURE_UPDATE_BARRIER_BIT | GL_BUFFER_UPDATE_BARRIER_BIT |
         GL_FRAMEBUFFER_BARRIER_BIT | GL_TRANSFORM_FEEDBACK_BARRIER_BIT |
         GL_ATOMIC_COUNTER_BARRIER_BIT | GL_SHADER_STORAGE_BARRIER_BIT;
-    if ((barriers & ~supported_barrier_bits) != 0)
+    if (barriers == 0 || (barriers & ~supported_barrier_bits) != 0)
     {
         context->validationError(GL_INVALID_VALUE, kInvalidMemoryBarrierBit);
         return false;
@@ -1759,7 +1779,7 @@
                                         GL_SHADER_IMAGE_ACCESS_BARRIER_BIT |
                                         GL_SHADER_STORAGE_BARRIER_BIT |
                                         GL_TEXTURE_FETCH_BARRIER_BIT | GL_UNIFORM_BARRIER_BIT;
-    if ((barriers & ~supported_barrier_bits) != 0)
+    if (barriers == 0 || (barriers & ~supported_barrier_bits) != 0)
     {
         context->validationError(GL_INVALID_VALUE, kInvalidMemoryBarrierBit);
         return false;
@@ -1858,6 +1878,27 @@
                                          height);
 }
 
+bool ValidateTexStorageMem3DMultisampleEXT(Context *context,
+                                           TextureType target,
+                                           GLsizei samples,
+                                           GLenum internalFormat,
+                                           GLsizei width,
+                                           GLsizei height,
+                                           GLsizei depth,
+                                           GLboolean fixedSampleLocations,
+                                           GLuint memory,
+                                           GLuint64 offset)
+{
+    if (!context->getExtensions().memoryObject)
+    {
+        context->validationError(GL_INVALID_OPERATION, kExtensionNotEnabled);
+        return false;
+    }
+
+    UNIMPLEMENTED();
+    return false;
+}
+
 bool ValidateGetProgramResourceLocationIndexEXT(Context *context,
                                                 GLuint program,
                                                 GLenum programInterface,