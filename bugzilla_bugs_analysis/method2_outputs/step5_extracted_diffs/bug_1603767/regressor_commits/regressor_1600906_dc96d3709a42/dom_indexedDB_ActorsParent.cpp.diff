# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/indexedDB/ActorsParent.cpp
# Commit: dc96d3709a42
# Full Hash: dc96d3709a42beabb15aa2cbbf1894984a5e40d9
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2019-12-05 04:11:08
# Regressor Bug: 1600906
# File Overlap Count: 1
# Description:
#   Bug 1600906 - Make use of FlippedOnce in QuotaClient. r=dom-workers-and-storage-reviewers,ytausky
#   
#   Depends on D55678
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D55679
# ==============================================================================

diff -r 7c4e2c13f1c3 -r dc96d3709a42 dom/indexedDB/ActorsParent.cpp
--- a/dom/indexedDB/ActorsParent.cpp	Wed Dec 04 14:24:59 2019 +0000
+++ b/dom/indexedDB/ActorsParent.cpp	Wed Dec 04 14:22:33 2019 +0000
@@ -7956,7 +7956,7 @@
   RefPtr<nsThreadPool> mMaintenanceThreadPool;
   nsClassHashtable<nsRefPtrHashKey<FileManager>, nsTArray<int64_t>>
       mPendingDeleteInfos;
-  bool mShutdownRequested;
+  FlippedOnce<false> mShutdownRequested;
 
  public:
   QuotaClient();
@@ -16145,8 +16145,7 @@
 
 QuotaClient* QuotaClient::sInstance = nullptr;
 
-QuotaClient::QuotaClient()
-    : mDeleteTimer(NS_NewTimer()), mShutdownRequested(false) {
+QuotaClient::QuotaClient() : mDeleteTimer(NS_NewTimer()) {
   AssertIsOnBackgroundThread();
   MOZ_ASSERT(!sInstance, "We expect this to be a singleton!");
   MOZ_ASSERT(!gTelemetryIdMutex);
@@ -16667,9 +16666,8 @@
 
 void QuotaClient::ShutdownWorkThreads() {
   AssertIsOnBackgroundThread();
-  MOZ_ASSERT(!mShutdownRequested);
-
-  mShutdownRequested = true;
+
+  mShutdownRequested.Flip();
 
   AbortOperations(VoidCString());
 
