# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/indexedDB/IDBTransaction.h
# Commit: e65d7e9dea10
# Full Hash: e65d7e9dea10c417588224abb452aa2d181e8e0c
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2020-01-13 15:45:24
# Regressor Bug: 1600906
# File Overlap Count: 1
# Description:
#   Bug 1600906 - Convert IDBCursor and BackgroundCursorChild to templates to increase type safety and reduce state. r=dom-workers-and-storage-reviewers,ytausky
#   
#   This also simplifies delegating calls that are dependent on the cursor type.
#   
#   Also reduce dependency on IDBCursor.h by moving enums and type traits to IDBCursorType.h
# ==============================================================================

diff -r 422de232c5ce -r e65d7e9dea10 dom/indexedDB/IDBTransaction.h
--- a/dom/indexedDB/IDBTransaction.h	Fri Jan 10 15:59:51 2020 +0000
+++ b/dom/indexedDB/IDBTransaction.h	Fri Jan 10 15:23:52 2020 +0000
@@ -34,7 +34,7 @@
 class StrongWorkerRef;
 
 namespace indexedDB {
-class BackgroundCursorChild;
+class PBackgroundIDBCursorChild;
 class BackgroundRequestChild;
 class BackgroundTransactionChild;
 class BackgroundVersionChangeTransactionChild;
@@ -48,7 +48,6 @@
     : public DOMEventTargetHelper,
       public nsIRunnable,
       public SupportsCheckedUnsafePtr<CheckIf<DiagnosticAssertEnabled>> {
-  friend class indexedDB::BackgroundCursorChild;
   friend class indexedDB::BackgroundRequestChild;
 
  public:
@@ -163,7 +162,7 @@
   indexedDB::BackgroundRequestChild* StartRequest(
       IDBRequest* aRequest, const indexedDB::RequestParams& aParams);
 
-  void OpenCursor(indexedDB::BackgroundCursorChild* aBackgroundActor,
+  void OpenCursor(indexedDB::PBackgroundIDBCursorChild* aBackgroundActor,
                   const indexedDB::OpenCursorParams& aParams);
 
   void RefreshSpec(bool aMayDelete);
@@ -366,10 +365,13 @@
 
   void MaybeNoteInactiveTransaction();
 
+  // TODO consider making private again, or move to the right place
+ public:
   void OnNewRequest();
 
   void OnRequestFinished(bool aRequestCompletedSuccessfully);
 
+ private:
   template <typename Func>
   auto DoWithTransactionChild(const Func& aFunc) const;
 