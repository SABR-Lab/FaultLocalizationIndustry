# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/storage/SessionStorageService.h
# Commit: aea23435804b
# Full Hash: aea23435804b56798dbae8fa46dfccb8cbdca131
# Author: Yaron Tausky <ytausky@mozilla.com>
# Date: 2019-12-13 16:53:24
# Regressor Bug: 1593246
# File Overlap Count: 6
# Description:
#   Bug 1593246 - Part 5: Replicate session storage data r=janv,asuth
#   
#   This commit implements a simple data replication scheme, where
#   each content process receives a copy of the relevant session
#   storage data when navigating, and sending all its session storage
# ==============================================================================

diff -r da1672f831d1 -r aea23435804b dom/storage/SessionStorageService.h
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/dom/storage/SessionStorageService.h	Fri Dec 13 09:45:55 2019 +0000
@@ -0,0 +1,47 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+#ifndef mozilla_dom_SessionStorageService_h
+#define mozilla_dom_SessionStorageService_h
+
+#include "mozilla/UniquePtr.h"
+#include "nsIObserver.h"
+#include "nsISupportsImpl.h"
+#include "nsPointerHashKeys.h"
+#include "nsTHashtable.h"
+
+namespace mozilla {
+namespace dom {
+
+class SessionStorageManager;
+
+class SessionStorageService final : public nsIObserver {
+ public:
+  SessionStorageService();
+
+  static SessionStorageService* Get();
+
+  NS_DECL_ISUPPORTS
+  NS_DECL_NSIOBSERVER
+
+  void RegisterSessionStorageManager(SessionStorageManager* aManager);
+  void UnregisterSessionStorageManager(SessionStorageManager* aManager);
+
+ private:
+  ~SessionStorageService();
+
+  static void ShutDown();
+
+  void SendSessionStorageDataToParentProcess();
+
+  static RefPtr<SessionStorageService> sService;
+  static bool sShutdown;
+
+  nsTHashtable<nsPtrHashKey<SessionStorageManager>> mManagers;
+};
+
+}  // namespace dom
+}  // namespace mozilla
+
+#endif  // mozilla_dom_SessionStorageService_h