# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/builtin/ModuleObject.h
# Commit: 2a0aacbd11de
# Full Hash: 2a0aacbd11dee6907445c902aa088ab4b9492d6b
# Author: caroline <cullen.caroline@gmail.com>
# Date: 2019-12-10 21:29:05
# Regressor Bug: 1588861
# File Overlap Count: 1
# Description:
#   Bug 1588861 - Part 3: Add support for xdr encoding modules into xdr cache. r=iain,tcampbell
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D54158
# ==============================================================================

diff -r 639290e9ff22 -r 2a0aacbd11de js/src/builtin/ModuleObject.h
--- a/js/src/builtin/ModuleObject.h	Tue Dec 10 02:52:30 2019 +0000
+++ b/js/src/builtin/ModuleObject.h	Tue Dec 10 02:52:37 2019 +0000
@@ -55,6 +55,12 @@
 
 typedef Rooted<ImportEntryObject*> RootedImportEntryObject;
 typedef Handle<ImportEntryObject*> HandleImportEntryObject;
+typedef Rooted<GCVector<ImportEntryObject*>> RootedImportEntryVector;
+typedef MutableHandle<ImportEntryObject*> MutableHandleImportEntryObject;
+
+template <XDRMode mode>
+XDRResult XDRImportEntryObject(XDRState<mode>* xdr,
+                               MutableHandleImportEntryObject impObj);
 
 class ExportEntryObject : public NativeObject {
  public:
@@ -83,6 +89,9 @@
   uint32_t columnNumber() const;
 };
 
+template <XDRMode mode>
+XDRResult XDRExportEntries(XDRState<mode>* xdr, MutableHandleArrayObject vec);
+
 typedef Rooted<ExportEntryObject*> RootedExportEntryObject;
 typedef Handle<ExportEntryObject*> HandleExportEntryObject;
 
@@ -103,6 +112,13 @@
 
 typedef Rooted<RequestedModuleObject*> RootedRequestedModuleObject;
 typedef Handle<RequestedModuleObject*> HandleRequestedModuleObject;
+typedef Rooted<GCVector<RequestedModuleObject*>> RootedRequestedModuleVector;
+typedef MutableHandle<RequestedModuleObject*>
+    MutableHandleRequestedModuleObject;
+
+template <XDRMode mode>
+XDRResult XDRRequestedModuleObject(XDRState<mode>* xdr,
+                                   MutableHandleRequestedModuleObject reqObj);
 
 class IndirectBindingMap {
  public:
@@ -319,6 +335,10 @@
                                                 HandleModuleObject self,
                                                 HandleObject exports);
 
+  static bool createEnvironment(JSContext* cx, HandleModuleObject self);
+
+  FunctionDeclarationVector* functionDeclarations();
+
  private:
   static const JSClassOps classOps_;
 
@@ -326,7 +346,6 @@
   static void finalize(JSFreeOp* fop, JSObject* obj);
 
   bool hasImportBindings() const;
-  FunctionDeclarationVector* functionDeclarations();
 };
 
 JSObject* GetOrCreateModuleMetaObject(JSContext* cx, HandleObject module);
@@ -340,6 +359,9 @@
 bool FinishDynamicModuleImport(JSContext* cx, HandleValue referencingPrivate,
                                HandleString specifier, HandleObject promise);
 
+template <XDRMode mode>
+XDRResult XDRModuleObject(XDRState<mode>* xdr, MutableHandleModuleObject modp);
+
 }  // namespace js
 
 template <>