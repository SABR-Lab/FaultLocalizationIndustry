# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/rust/src/rust.rs
# Commit: a0d1fb0a86b0
# Full Hash: a0d1fb0a86b04c74a8809c35230382f90cdfe779
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2020-01-07 21:57:58
# Regressor Bug: 1530372
# File Overlap Count: 1
# Description:
#   Bug 1530372 - Part 4: Support nursery allocation for BigInt. r=sfink,jandem
#   
#   Most of the code was copied from the String nursery allocation code paths and
#   then adjusted to work with BigInts. Where applicable, the newly added BigInt
#   functions were placed right next to the String functions, so it's easier to
# ==============================================================================

diff -r 9ae1e055de13 -r a0d1fb0a86b0 js/rust/src/rust.rs
--- a/js/rust/src/rust.rs	Thu Jan 02 13:04:45 2020 +0000
+++ b/js/rust/src/rust.rs	Mon Jan 06 12:49:45 2020 +0000
@@ -568,6 +568,15 @@
     unsafe fn write_barriers(_: *mut jsid, _: jsid, _: jsid) {}
 }
 
+#[cfg(feature = "bigint")]
+impl GCMethods for *mut JS::BigInt {
+    unsafe fn initial() -> *mut JS::BigInt { ptr::null_mut() }
+    unsafe fn write_barriers(v: *mut *mut JS::BigInt, prev: *mut JS::BigInt,
+                             next: *mut JS::BigInt) {
+        JS::HeapBigIntWriteBarriers(v, prev, next);
+    }
+}
+
 impl GCMethods for *mut JSObject {
     unsafe fn initial() -> *mut JSObject { ptr::null_mut() }
     unsafe fn write_barriers(v: *mut *mut JSObject,