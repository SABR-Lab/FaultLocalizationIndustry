# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/gc/Barrier.h
# Commit: a0d1fb0a86b0
# Full Hash: a0d1fb0a86b04c74a8809c35230382f90cdfe779
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2020-01-07 21:57:58
# Regressor Bug: 1530372
# File Overlap Count: 1
# Description:
#   Bug 1530372 - Part 4: Support nursery allocation for BigInt. r=sfink,jandem
#   
#   Most of the code was copied from the String nursery allocation code paths and
#   then adjusted to work with BigInts. Where applicable, the newly added BigInt
#   functions were placed right next to the String functions, so it's easier to
# ==============================================================================

diff -r 9ae1e055de13 -r a0d1fb0a86b0 js/src/gc/Barrier.h
--- a/js/src/gc/Barrier.h	Thu Jan 02 13:04:45 2020 +0000
+++ b/js/src/gc/Barrier.h	Mon Jan 06 12:49:45 2020 +0000
@@ -347,13 +347,13 @@
 
     // If the target needs an entry, add it.
     js::gc::StoreBuffer* sb;
-    if ((next.isObject() || next.isString()) &&
+    if ((next.isObject() || next.isString() || next.isBigInt()) &&
         (sb = next.toGCThing()->storeBuffer())) {
       // If we know that the prev has already inserted an entry, we can
       // skip doing the lookup to add the new entry. Note that we cannot
       // safely assert the presence of the entry because it may have been
       // added via a different store buffer.
-      if ((prev.isObject() || prev.isString()) &&
+      if ((prev.isObject() || prev.isString() || prev.isBigInt()) &&
           prev.toGCThing()->storeBuffer()) {
         return;
       }
@@ -361,7 +361,7 @@
       return;
     }
     // Remove the prev entry if the new value does not need it.
-    if ((prev.isObject() || prev.isString()) &&
+    if ((prev.isObject() || prev.isString() || prev.isBigInt()) &&
         (sb = prev.toGCThing()->storeBuffer())) {
       sb->unputValue(vp);
     }
@@ -802,7 +802,8 @@
 #ifdef DEBUG
     assertPreconditionForWriteBarrierPost(owner, kind, slot, target);
 #endif
-    if (this->value.isObject() || this->value.isString()) {
+    if (this->value.isObject() || this->value.isString() ||
+        this->value.isBigInt()) {
       gc::Cell* cell = this->value.toGCThing();
       if (cell->storeBuffer()) {
         cell->storeBuffer()->putSlot(owner, kind, slot, 1);