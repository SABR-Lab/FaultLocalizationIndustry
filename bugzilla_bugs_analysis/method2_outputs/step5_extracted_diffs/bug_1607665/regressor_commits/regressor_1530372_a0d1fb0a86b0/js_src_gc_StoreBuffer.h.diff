# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/gc/StoreBuffer.h
# Commit: a0d1fb0a86b0
# Full Hash: a0d1fb0a86b04c74a8809c35230382f90cdfe779
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2020-01-07 21:57:58
# Regressor Bug: 1530372
# File Overlap Count: 1
# Description:
#   Bug 1530372 - Part 4: Support nursery allocation for BigInt. r=sfink,jandem
#   
#   Most of the code was copied from the String nursery allocation code paths and
#   then adjusted to work with BigInts. Where applicable, the newly added BigInt
#   functions were placed right next to the String functions, so it's easier to
# ==============================================================================

diff -r 9ae1e055de13 -r a0d1fb0a86b0 js/src/gc/StoreBuffer.h
--- a/js/src/gc/StoreBuffer.h	Thu Jan 02 13:04:45 2020 +0000
+++ b/js/src/gc/StoreBuffer.h	Mon Jan 06 12:49:45 2020 +0000
@@ -270,6 +270,7 @@
 
   using ObjectPtrEdge = CellPtrEdge<JSObject>;
   using StringPtrEdge = CellPtrEdge<JSString>;
+  using BigIntPtrEdge = CellPtrEdge<JS::BigInt>;
 
   struct ValueEdge {
     JS::Value* edge;
@@ -403,6 +404,7 @@
 
   MonoTypeBuffer<ValueEdge> bufferVal;
   MonoTypeBuffer<StringPtrEdge> bufStrCell;
+  MonoTypeBuffer<BigIntPtrEdge> bufBigIntCell;
   MonoTypeBuffer<ObjectPtrEdge> bufObjCell;
   MonoTypeBuffer<SlotsEdge> bufferSlot;
   WholeCellBuffer bufferWholeCell;
@@ -441,6 +443,9 @@
   void putCell(JSString** strp) { put(bufStrCell, StringPtrEdge(strp)); }
   void unputCell(JSString** strp) { unput(bufStrCell, StringPtrEdge(strp)); }
 
+  void putCell(JS::BigInt** bip) { put(bufBigIntCell, BigIntPtrEdge(bip)); }
+  void unputCell(JS::BigInt** bip) { unput(bufBigIntCell, BigIntPtrEdge(bip)); }
+
   void putCell(JSObject** strp) { put(bufObjCell, ObjectPtrEdge(strp)); }
   void unputCell(JSObject** strp) { unput(bufObjCell, ObjectPtrEdge(strp)); }
 
@@ -467,6 +472,7 @@
   void traceValues(TenuringTracer& mover) { bufferVal.trace(mover); }
   void traceCells(TenuringTracer& mover) {
     bufStrCell.trace(mover);
+    bufBigIntCell.trace(mover);
     bufObjCell.trace(mover);
   }
   void traceSlots(TenuringTracer& mover) { bufferSlot.trace(mover); }