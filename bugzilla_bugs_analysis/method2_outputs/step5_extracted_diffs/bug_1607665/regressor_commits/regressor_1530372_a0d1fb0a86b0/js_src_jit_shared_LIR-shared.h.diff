# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/jit/shared/LIR-shared.h
# Commit: a0d1fb0a86b0
# Full Hash: a0d1fb0a86b04c74a8809c35230382f90cdfe779
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2020-01-07 21:57:58
# Regressor Bug: 1530372
# File Overlap Count: 1
# Description:
#   Bug 1530372 - Part 4: Support nursery allocation for BigInt. r=sfink,jandem
#   
#   Most of the code was copied from the String nursery allocation code paths and
#   then adjusted to work with BigInts. Where applicable, the newly added BigInt
#   functions were placed right next to the String functions, so it's easier to
# ==============================================================================

diff -r 9ae1e055de13 -r a0d1fb0a86b0 js/src/jit/shared/LIR-shared.h
--- a/js/src/jit/shared/LIR-shared.h	Thu Jan 02 13:04:45 2020 +0000
+++ b/js/src/jit/shared/LIR-shared.h	Mon Jan 06 12:49:45 2020 +0000
@@ -5708,6 +5708,25 @@
   const LDefinition* temp() { return getTemp(0); }
 };
 
+// Generational write barrier used when writing a BigInt to an object.
+class LPostWriteBarrierBI : public LInstructionHelper<0, 2, 1> {
+ public:
+  LIR_HEADER(PostWriteBarrierBI)
+
+  LPostWriteBarrierBI(const LAllocation& obj, const LAllocation& value,
+                      const LDefinition& temp)
+      : LInstructionHelper(classOpcode) {
+    setOperand(0, obj);
+    setOperand(1, value);
+    setTemp(0, temp);
+  }
+
+  const MPostWriteBarrier* mir() const { return mir_->toPostWriteBarrier(); }
+  const LAllocation* object() { return getOperand(0); }
+  const LAllocation* value() { return getOperand(1); }
+  const LDefinition* temp() { return getTemp(0); }
+};
+
 // Generational write barrier used when writing a value to another object.
 class LPostWriteBarrierV : public LInstructionHelper<0, 1 + BOX_PIECES, 1> {
  public:
@@ -5784,6 +5803,34 @@
   const LDefinition* temp() { return getTemp(0); }
 };
 
+// Generational write barrier used when writing a BigInt to an object's
+// elements.
+class LPostWriteElementBarrierBI : public LInstructionHelper<0, 3, 1> {
+ public:
+  LIR_HEADER(PostWriteElementBarrierBI)
+
+  LPostWriteElementBarrierBI(const LAllocation& obj, const LAllocation& value,
+                             const LAllocation& index, const LDefinition& temp)
+      : LInstructionHelper(classOpcode) {
+    setOperand(0, obj);
+    setOperand(1, value);
+    setOperand(2, index);
+    setTemp(0, temp);
+  }
+
+  const MPostWriteElementBarrier* mir() const {
+    return mir_->toPostWriteElementBarrier();
+  }
+
+  const LAllocation* object() { return getOperand(0); }
+
+  const LAllocation* value() { return getOperand(1); }
+
+  const LAllocation* index() { return getOperand(2); }
+
+  const LDefinition* temp() { return getTemp(0); }
+};
+
 // Generational write barrier used when writing a value to another object's
 // elements.
 class LPostWriteElementBarrierV