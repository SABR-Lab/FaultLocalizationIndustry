# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/wasm/WasmBuiltins.cpp
# Commit: a0d1fb0a86b0
# Full Hash: a0d1fb0a86b04c74a8809c35230382f90cdfe779
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2020-01-07 21:57:58
# Regressor Bug: 1530372
# File Overlap Count: 1
# Description:
#   Bug 1530372 - Part 4: Support nursery allocation for BigInt. r=sfink,jandem
#   
#   Most of the code was copied from the String nursery allocation code paths and
#   then adjusted to work with BigInts. Where applicable, the newly added BigInt
#   functions were placed right next to the String functions, so it's easier to
# ==============================================================================

diff -r 9ae1e055de13 -r a0d1fb0a86b0 js/src/wasm/WasmBuiltins.cpp
--- a/js/src/wasm/WasmBuiltins.cpp	Thu Jan 02 13:04:45 2020 +0000
+++ b/js/src/wasm/WasmBuiltins.cpp	Mon Jan 06 12:49:45 2020 +0000
@@ -23,6 +23,7 @@
 #include "fdlibm.h"
 #include "jslibmath.h"
 
+#include "gc/Allocator.h"
 #include "jit/AtomicOperations.h"
 #include "jit/InlinableNatives.h"
 #include "jit/MacroAssembler.h"
@@ -648,10 +649,10 @@
 
 #ifdef ENABLE_WASM_BIGINT
 // Allocate a BigInt without GC, corresponds to the similar VMFunction.
-static BigInt* AllocateBigInt() {
+static BigInt* AllocateBigIntTenuredNoGC() {
   JSContext* cx = TlsContext.get();
 
-  return js::Allocate<BigInt, NoGC>(cx);
+  return js::AllocateBigInt<NoGC>(cx, gc::TenuredHeap);
 }
 #endif
 
@@ -850,7 +851,7 @@
 #ifdef ENABLE_WASM_BIGINT
     case SymbolicAddress::AllocateBigInt:
       *abiType = Args_General0;
-      return FuncCast(AllocateBigInt, *abiType);
+      return FuncCast(AllocateBigIntTenuredNoGC, *abiType);
 #endif
     case SymbolicAddress::DivI64:
       *abiType = Args_General4;
