# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/canvas/WebGL2Context.cpp
# Commit: ccfa767dba64
# Full Hash: ccfa767dba644dc193e0246eb8e8ff3377e8b8a5
# Author: Jeff Gilbert <jgilbert@mozilla.com>
# Date: 2020-01-09 03:40:18
# Regressor Bug: 1477756
# File Overlap Count: 1
# Description:
#   Bug 1477756 - Client-side bindings mirror for precise CC, and merge similar codepaths. r=handyman
#   
#   * Context loss using RAII
#   * Move Program reflection Client-side
#   
# ==============================================================================

diff -r 71c122ac0ca7 -r ccfa767dba64 dom/canvas/WebGL2Context.cpp
--- a/dom/canvas/WebGL2Context.cpp	Wed Jan 08 22:19:14 2020 +0000
+++ b/dom/canvas/WebGL2Context.cpp	Wed Jan 08 22:19:16 2020 +0000
@@ -22,9 +22,6 @@
   return webgl::FormatUsageAuthority::CreateForWebGL2(gl);
 }
 
-/*static*/
-bool WebGL2Context::IsSupported() { return StaticPrefs::webgl_enable_webgl2(); }
-
 ////////////////////////////////////////////////////////////////////////////////
 // WebGL 2 initialisation
 
@@ -120,18 +117,12 @@
     return false;
   }
 
-  // we initialise WebGL 2 related stuff.
-  gl->GetUIntegerv(LOCAL_GL_MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,
-                   &mGLMaxTransformFeedbackSeparateAttribs);
-  gl->GetUIntegerv(LOCAL_GL_MAX_UNIFORM_BUFFER_BINDINGS,
-                   &mGLMaxUniformBufferBindings);
-
   mGLMinProgramTexelOffset =
       gl->GetIntAs<uint32_t>(LOCAL_GL_MIN_PROGRAM_TEXEL_OFFSET);
   mGLMaxProgramTexelOffset =
       gl->GetIntAs<uint32_t>(LOCAL_GL_MAX_PROGRAM_TEXEL_OFFSET);
 
-  mIndexedUniformBufferBindings.resize(mGLMaxUniformBufferBindings);
+  mIndexedUniformBufferBindings.resize(mLimits->maxUniformBufferBindings);
 
   mDefaultTransformFeedback = new WebGLTransformFeedback(this, 0);
   mBoundTransformFeedback = mDefaultTransformFeedback;
@@ -157,4 +148,25 @@
   return true;
 }
 
+// -
+
+/*virtual*/
+bool WebGL2Context::IsTexParamValid(GLenum pname) const {
+  switch (pname) {
+    case LOCAL_GL_TEXTURE_BASE_LEVEL:
+    case LOCAL_GL_TEXTURE_COMPARE_FUNC:
+    case LOCAL_GL_TEXTURE_COMPARE_MODE:
+    case LOCAL_GL_TEXTURE_IMMUTABLE_FORMAT:
+    case LOCAL_GL_TEXTURE_IMMUTABLE_LEVELS:
+    case LOCAL_GL_TEXTURE_MAX_LEVEL:
+    case LOCAL_GL_TEXTURE_WRAP_R:
+    case LOCAL_GL_TEXTURE_MAX_LOD:
+    case LOCAL_GL_TEXTURE_MIN_LOD:
+      return true;
+
+    default:
+      return WebGLContext::IsTexParamValid(pname);
+  }
+}
+
 }  // namespace mozilla