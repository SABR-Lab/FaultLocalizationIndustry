# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/canvas/WebGL2ContextRenderbuffers.cpp
# Commit: ccfa767dba64
# Full Hash: ccfa767dba644dc193e0246eb8e8ff3377e8b8a5
# Author: Jeff Gilbert <jgilbert@mozilla.com>
# Date: 2020-01-09 03:40:18
# Regressor Bug: 1477756
# File Overlap Count: 1
# Description:
#   Bug 1477756 - Client-side bindings mirror for precise CC, and merge similar codepaths. r=handyman
#   
#   * Context loss using RAII
#   * Move Program reflection Client-side
#   
# ==============================================================================

diff -r 71c122ac0ca7 -r ccfa767dba64 dom/canvas/WebGL2ContextRenderbuffers.cpp
--- a/dom/canvas/WebGL2ContextRenderbuffers.cpp	Wed Jan 08 22:19:14 2020 +0000
+++ b/dom/canvas/WebGL2ContextRenderbuffers.cpp	Wed Jan 08 22:19:16 2020 +0000
@@ -12,8 +12,8 @@
 
 namespace mozilla {
 
-Maybe<nsTArray<int32_t>> WebGL2Context::GetInternalformatParameter(
-    GLenum target, GLenum internalformat, GLenum pname) {
+Maybe<std::vector<int32_t>> WebGL2Context::GetInternalformatParameter(
+    GLenum target, GLenum internalformat, GLenum pname) const {
   const FuncScope funcScope(*this, "getInternalfomratParameter");
   if (IsContextLost()) return Nothing();
 
@@ -58,23 +58,17 @@
     return Nothing();
   }
 
-  nsTArray<int32_t> obj;
+  std::vector<int32_t> ret;
   GLint sampleCount = 0;
   gl->fGetInternalformativ(LOCAL_GL_RENDERBUFFER, internalformat,
                            LOCAL_GL_NUM_SAMPLE_COUNTS, 1, &sampleCount);
-  if (sampleCount > 0) {
-    GLint* samples =
-        static_cast<GLint*>(obj.AppendElements(sampleCount, fallible));
-    // If we don't have 'samples' then we will return a zero-length array, which
-    // will be interpreted by the ClientWebGLContext as an out-of-memory
-    // condition.
-    if (samples) {
-      gl->fGetInternalformativ(LOCAL_GL_RENDERBUFFER, internalformat,
-                               LOCAL_GL_SAMPLES, sampleCount, samples);
-    }
+  if (sampleCount) {
+    ret.resize(sampleCount);
+    gl->fGetInternalformativ(LOCAL_GL_RENDERBUFFER, internalformat,
+                             LOCAL_GL_SAMPLES, ret.size(), ret.data());
   }
 
-  return Some(obj);
+  return Some(ret);
 }
 
 }  // namespace mozilla