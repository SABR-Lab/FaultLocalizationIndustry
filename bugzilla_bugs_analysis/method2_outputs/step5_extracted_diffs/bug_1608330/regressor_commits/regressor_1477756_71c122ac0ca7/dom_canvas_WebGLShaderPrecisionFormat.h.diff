# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/canvas/WebGLShaderPrecisionFormat.h
# Commit: 71c122ac0ca7
# Full Hash: 71c122ac0ca73391866b1ef19f4f82bc2d28568b
# Author: David Parks <davidp99@gmail.com>
# Date: 2020-01-09 03:40:18
# Regressor Bug: 1477756
# File Overlap Count: 1
# Description:
#   Bug 1477756 - Initial out-of-process WebGL implementation. r=mccr8,handyman
#   
#   Splits WebGLContext into ClientWebGLContext and HostWebGLContext.  The Client enables the JS-control of a WebGL context in a content procecss while the Host executes the WebGL graphics operations (via a WebGLContext that maintains much of the existing code) in the compositor process.  At this point, the cross-process behavior is disabled -- this series of patches is an incremental step toward that final goal.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D54018
# ==============================================================================

diff -r 5cbf5bb11c58 -r 71c122ac0ca7 dom/canvas/WebGLShaderPrecisionFormat.h
--- a/dom/canvas/WebGLShaderPrecisionFormat.h	Wed Jan 08 21:52:03 2020 +0000
+++ b/dom/canvas/WebGLShaderPrecisionFormat.h	Wed Jan 08 22:19:14 2020 +0000
@@ -6,40 +6,56 @@
 #ifndef WEBGL_SHADER_PRECISION_FORMAT_H_
 #define WEBGL_SHADER_PRECISION_FORMAT_H_
 
-#include "WebGLObjectModel.h"
+#include "GLTypes.h"
+#include "nsISupports.h"
 
 namespace mozilla {
 
-class WebGLShaderPrecisionFormat final : public WebGLContextBoundObject {
- public:
-  WebGLShaderPrecisionFormat(WebGLContext* context, GLint rangeMin,
-                             GLint rangeMax, GLint precision)
-      : WebGLContextBoundObject(context),
-        mRangeMin(rangeMin),
-        mRangeMax(rangeMax),
-        mPrecision(precision) {}
+namespace ipc {
+template <typename T>
+struct PcqParamTraits;
+};
 
-  bool WrapObject(JSContext* cx, JS::Handle<JSObject*> givenProto,
-                  JS::MutableHandle<JSObject*> reflector);
+class WebGLShaderPrecisionFormat final {
+ public:
+  WebGLShaderPrecisionFormat(GLint rangeMin, GLint rangeMax, GLint precision)
+      : mRangeMin(rangeMin), mRangeMax(rangeMax), mPrecision(precision) {}
 
-  // WebIDL WebGLShaderPrecisionFormat API
   GLint RangeMin() const { return mRangeMin; }
-
   GLint RangeMax() const { return mRangeMax; }
-
   GLint Precision() const { return mPrecision; }
 
-  NS_INLINE_DECL_REFCOUNTING(WebGLShaderPrecisionFormat)
-
- private:
-  // Private destructor, to discourage deletion outside of Release():
-  ~WebGLShaderPrecisionFormat() {}
+ protected:
+  friend struct mozilla::ipc::PcqParamTraits<WebGLShaderPrecisionFormat>;
 
   GLint mRangeMin;
   GLint mRangeMax;
   GLint mPrecision;
 };
 
+class ClientWebGLShaderPrecisionFormat final {
+ public:
+  NS_INLINE_DECL_REFCOUNTING(ClientWebGLShaderPrecisionFormat)
+  bool WrapObject(JSContext* cx, JS::Handle<JSObject*> givenProto,
+                  JS::MutableHandle<JSObject*> reflector);
+  ClientWebGLShaderPrecisionFormat(GLint rangeMin, GLint rangeMax,
+                                   GLint precision)
+      : mSPF(rangeMin, rangeMax, precision) {}
+
+  ClientWebGLShaderPrecisionFormat(const WebGLShaderPrecisionFormat& aOther)
+      : mSPF(aOther.RangeMin(), aOther.RangeMax(), aOther.Precision()) {}
+
+  // WebIDL WebGLShaderPrecisionFormat API
+  GLint RangeMin() const { return mSPF.RangeMin(); }
+  GLint RangeMax() const { return mSPF.RangeMax(); }
+  GLint Precision() const { return mSPF.Precision(); }
+  WebGLShaderPrecisionFormat& GetObject() { return mSPF; }
+
+ protected:
+  ~ClientWebGLShaderPrecisionFormat() {}
+  WebGLShaderPrecisionFormat mSPF;
+};
+
 }  // namespace mozilla
 
 #endif  // WEBGL_SHADER_PRECISION_FORMAT_H_