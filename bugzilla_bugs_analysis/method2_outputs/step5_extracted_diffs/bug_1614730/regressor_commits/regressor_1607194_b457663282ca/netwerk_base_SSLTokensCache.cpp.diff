# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/base/SSLTokensCache.cpp
# Commit: b457663282ca
# Full Hash: b457663282ca584b00302e8898eedee3e5b54a0b
# Author: Kershaw Chang <kershaw@mozilla.com>
# Date: 2020-02-10 21:33:47
# Regressor Bug: 1607194
# File Overlap Count: 1
# Description:
#   Bug 1607194 - P2: Make SSLTokensCache available on socket process r=dragana
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D58775
# ==============================================================================

diff -r 20f3d7a5481d -r b457663282ca netwerk/base/SSLTokensCache.cpp
--- a/netwerk/base/SSLTokensCache.cpp	Mon Feb 10 17:07:26 2020 +0000
+++ b/netwerk/base/SSLTokensCache.cpp	Mon Feb 10 17:08:57 2020 +0000
@@ -5,6 +5,7 @@
 #include "SSLTokensCache.h"
 #include "mozilla/Preferences.h"
 #include "mozilla/Logging.h"
+#include "nsIOService.h"
 #include "nsNSSIOLayer.h"
 #include "TransportSecurityInfo.h"
 #include "ssl.h"
@@ -66,7 +67,11 @@
 nsresult SSLTokensCache::Init() {
   StaticMutexAutoLock lock(sLock);
 
-  if (XRE_GetProcessType() != GeckoProcessType_Default) {
+  if (gIOService->UseSocketProcess()) {
+    if (!XRE_IsSocketProcess()) {
+      return NS_OK;
+    }
+  } else if (!XRE_IsParentProcess()) {
     return NS_OK;
   }
 