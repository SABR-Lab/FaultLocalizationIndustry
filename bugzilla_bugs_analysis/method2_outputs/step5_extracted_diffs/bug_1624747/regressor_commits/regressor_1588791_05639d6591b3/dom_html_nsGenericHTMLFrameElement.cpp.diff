# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/html/nsGenericHTMLFrameElement.cpp
# Commit: 05639d6591b3
# Full Hash: 05639d6591b3251c31fdaf5fe5d37dd162009a8b
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-01-13 15:45:24
# Regressor Bug: 1588791
# File Overlap Count: 1
# Description:
#   Bug 1588791 - Make fission iframes honor and deal with the scrolling attribute. r=mattwoodrow
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D59630
# ==============================================================================

diff -r e4eb188ccbe0 -r 05639d6591b3 dom/html/nsGenericHTMLFrameElement.cpp
--- a/dom/html/nsGenericHTMLFrameElement.cpp	Mon Jan 13 11:30:36 2020 +0000
+++ b/dom/html/nsGenericHTMLFrameElement.cpp	Mon Jan 13 11:30:44 2020 +0000
@@ -8,6 +8,7 @@
 
 #include "mozilla/dom/HTMLIFrameElement.h"
 #include "mozilla/dom/XULFrameElement.h"
+#include "mozilla/dom/BrowserBridgeChild.h"
 #include "mozilla/dom/WindowProxyHolder.h"
 #include "mozilla/Preferences.h"
 #include "mozilla/PresShell.h"
@@ -291,10 +292,16 @@
   if (aNameSpaceID == kNameSpaceID_None) {
     if (aName == nsGkAtoms::scrolling) {
       if (mFrameLoader) {
-        // FIXME(bug 1588791): This should work for fission iframes.
+        ScrollbarPreference pref = MapScrollingAttribute(aValue);
         if (nsIDocShell* docshell = mFrameLoader->GetExistingDocShell()) {
-          nsDocShell::Cast(docshell)->SetScrollbarPreference(
-              MapScrollingAttribute(aValue));
+          nsDocShell::Cast(docshell)->SetScrollbarPreference(pref);
+        } else if (auto* child = mFrameLoader->GetBrowserBridgeChild()) {
+          // NOTE(emilio): We intentionally don't deal with the
+          // GetBrowserParent() case, and only deal with the fission iframe
+          // case. We could make it work, but it's a bit of boilerplate for
+          // something that we don't use, and we'd need to think how it
+          // interacts with the scrollbar window flags...
+          child->SendScrollbarPreferenceChanged(pref);
         }
       }
     } else if (aName == nsGkAtoms::mozbrowser) {