# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/wr/webrender/src/picture.rs
# Commit: 95ddb3213aec
# Full Hash: 95ddb3213aecaf87c0a4f2d3559bd17e0194148c
# Author: sotaro <sotaro.ikeda.g@gmail.com>
# Date: 2020-04-02 09:51:45
# Description:
#   Bug 1624817 - Fix Tile invalidation during disabling WR native compositor r=gw
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D69168
# ==============================================================================

diff -r e377a27d74ae -r 95ddb3213aec gfx/wr/webrender/src/picture.rs
--- a/gfx/wr/webrender/src/picture.rs	Thu Apr 02 03:55:57 2020 +0000
+++ b/gfx/wr/webrender/src/picture.rs	Thu Apr 02 06:27:25 2020 +0000
@@ -2787,10 +2787,10 @@
                     if let Some(TileSurface::Texture { descriptor: SurfaceTextureDescriptor::Native { ref mut id, .. }, .. }) = tile.surface {
                         if let Some(id) = id.take() {
                             frame_state.resource_cache.destroy_compositor_tile(id);
-                            tile.surface = None;
-                            // Invalidate the entire tile to force a redraw.
-                            tile.invalidate(None, InvalidationReason::CompositorKindChanged);
                         }
+                        tile.surface = None;
+                        // Invalidate the entire tile to force a redraw.
+                        tile.invalidate(None, InvalidationReason::CompositorKindChanged);
                     }
                 }
 
