# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/webrender_bindings/DCLayerTree.h
# Commit: 971767c6ed2b
# Full Hash: 971767c6ed2b2201e172105046ecc61942e03a7e
# Author: sotaro <sotaro.ikeda.g@gmail.com>
# Date: 2020-01-24 21:46:30
# Regressor Bug: 1602643
# File Overlap Count: 1
# Description:
#   Bug 1602643 - Disable WebRender compositor dinamically for async screenshot r=gw
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D59658
# ==============================================================================

diff -r 436df7dc06c6 -r 971767c6ed2b gfx/webrender_bindings/DCLayerTree.h
--- a/gfx/webrender_bindings/DCLayerTree.h	Fri Jan 24 01:04:09 2020 +0000
+++ b/gfx/webrender_bindings/DCLayerTree.h	Thu Jan 23 23:52:05 2020 +0000
@@ -60,7 +60,9 @@
 
   void SetDefaultSwapChain(IDXGISwapChain1* aSwapChain);
   void MaybeUpdateDebug();
+  void MaybeCommit();
   void WaitForCommitCompletion();
+  void DisableNativeCompositor();
 
   // Interface for wr::Compositor
   void CompositorBeginFrame();
@@ -96,6 +98,7 @@
       wr::DeviceIntRect aDirtyRect, wr::DeviceIntPoint* aOffset,
       RefPtr<IDCompositionSurface> aCompositionSurface,
       wr::DeviceIntPoint aSurfaceOffset);
+  void ReleaseNativeCompositorResources();
 
   RefPtr<gl::GLContext> mGL;
   EGLConfig mEGLConfig;
@@ -147,6 +150,8 @@
   // TODO(gw): Might be faster as a hashmap? The length is typically much less
   // than 10.
   std::vector<CachedFrameBuffer> mFrameBuffers;
+
+  bool mPendingCommit;
 };
 
 /**