# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/wasm/WasmValidate.cpp
# Commit: e71e54d93af8
# Full Hash: e71e54d93af8baa6ef915c81dc04ac3400f825cd
# Author: Andy Wingo <wingo@igalia.com>
# Date: 2020-03-06 20:10:41
# Regressor Bug: 1620197
# File Overlap Count: 1
# Description:
#   Bug 1620197 - Enable multiple results from WebAssembly functions r=lth
#   
#   This patch enables multi-value calls and returns, adding some tests, and
#   conditionally disabling a couple expect-fail reftests that now pass.
#   
# ==============================================================================

diff -r afbf73fb4073 -r e71e54d93af8 js/src/wasm/WasmValidate.cpp
--- a/js/src/wasm/WasmValidate.cpp	Fri Mar 06 09:57:45 2020 +0000
+++ b/js/src/wasm/WasmValidate.cpp	Fri Mar 06 13:53:07 2020 +0000
@@ -1214,8 +1214,6 @@
 bool wasm::ValidateFunctionBody(const ModuleEnvironment& env,
                                 uint32_t funcIndex, uint32_t bodySize,
                                 Decoder& d) {
-  MOZ_ASSERT(env.funcTypes[funcIndex]->results().length() <= MaxFuncResults);
-
   ValTypeVector locals;
   if (!locals.appendAll(env.funcTypes[funcIndex]->args())) {
     return false;
@@ -1590,12 +1588,6 @@
     return d.fail("signature index references non-signature");
   }
 
-  // FIXME: Remove this check when full multi-value function returns land.
-  // Bug 1585909.
-  if (def.funcType().results().length() > MaxFuncResults) {
-    return d.fail("too many returns in signature");
-  }
-
   return true;
 }
 
