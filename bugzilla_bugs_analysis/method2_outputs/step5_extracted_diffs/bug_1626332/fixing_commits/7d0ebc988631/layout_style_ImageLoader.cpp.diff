# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/style/ImageLoader.cpp
# Commit: 7d0ebc988631
# Full Hash: 7d0ebc9886317baffec1e6caab7b1dbd0cb1b009
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-04-04 09:29:13
# Description:
#   Bug 1626332 - null-check the canvas frame as it can be null in some documents.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D69541
# ==============================================================================

diff -r 2ff264d68b14 -r 7d0ebc988631 layout/style/ImageLoader.cpp
--- a/layout/style/ImageLoader.cpp	Fri Apr 03 11:36:35 2020 +0000
+++ b/layout/style/ImageLoader.cpp	Fri Apr 03 11:54:07 2020 +0000
@@ -510,10 +510,11 @@
   }
 
   if (aFrame->IsPrimaryFrameOfRootOrBodyElement()) {
-    // Try to invalidate the canvas too, in the probable case the background
-    // was propagated to it.
-    InvalidateImages(aFrame->PresShell()->GetCanvasFrame(), aRequest,
-                     aForcePaint);
+    if (auto* canvas = aFrame->PresShell()->GetCanvasFrame()) {
+      // Try to invalidate the canvas too, in the probable case the background
+      // was propagated to it.
+      InvalidateImages(canvas, aRequest, aForcePaint);
+    }
   }
 
   bool invalidateFrame = aForcePaint;
