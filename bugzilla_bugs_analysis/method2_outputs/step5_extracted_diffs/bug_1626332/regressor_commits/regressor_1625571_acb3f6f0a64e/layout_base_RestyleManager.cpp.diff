# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/RestyleManager.cpp
# Commit: acb3f6f0a64e
# Full Hash: acb3f6f0a64e5e31daee85c5e991b4ed2a69d721
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-03-30 15:54:08
# Regressor Bug: 1625571
# File Overlap Count: 1
# Description:
#   Bug 1625571 - Invalidate canvas background in ImageLoader rather than nsDisplayBackgroundImage. r=tnikkel
#   
#   This is less error prone and also less code.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D68732
# ==============================================================================

diff -r 059be1f4b4ed -r acb3f6f0a64e layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp	Mon Mar 30 11:35:20 2020 +0300
+++ b/layout/base/RestyleManager.cpp	Mon Mar 30 08:35:34 2020 +0000
@@ -1122,40 +1122,6 @@
   }
 }
 
-static bool IsPrimaryFrameOfRootOrBodyElement(nsIFrame* aFrame) {
-  nsIContent* content = aFrame->GetContent();
-  if (!content) {
-    return false;
-  }
-
-  Document* document = content->OwnerDoc();
-  Element* root = document->GetRootElement();
-  if (!root) {
-    return false;
-  }
-  nsIFrame* rootFrame = root->GetPrimaryFrame();
-  if (!rootFrame) {
-    return false;
-  }
-  if (aFrame == rootFrame) {
-    return true;
-  }
-
-  Element* body = document->GetBodyElement();
-  if (!body) {
-    return false;
-  }
-  nsIFrame* bodyFrame = body->GetPrimaryFrame();
-  if (!bodyFrame) {
-    return false;
-  }
-  if (aFrame == bodyFrame) {
-    return true;
-  }
-
-  return false;
-}
-
 static void ApplyRenderingChangeToTree(PresShell* aPresShell, nsIFrame* aFrame,
                                        nsChangeHint aChange) {
   // We check StyleDisplay()->HasTransformStyle() in addition to checking
@@ -1185,7 +1151,7 @@
     // the html element, we propagate the repaint change hint to the
     // viewport. This is necessary for background and scrollbar colors
     // propagation.
-    if (IsPrimaryFrameOfRootOrBodyElement(aFrame)) {
+    if (aFrame->IsPrimaryFrameOfRootOrBodyElement()) {
       nsIFrame* rootFrame = aPresShell->GetRootFrame();
       MOZ_ASSERT(rootFrame, "No root frame?");
       DoApplyRenderingChangeToTree(rootFrame, nsChangeHint_RepaintFrame);