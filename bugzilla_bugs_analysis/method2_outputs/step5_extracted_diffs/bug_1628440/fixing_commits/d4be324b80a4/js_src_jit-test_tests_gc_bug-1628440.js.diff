# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit-test/tests/gc/bug-1628440.js
# Commit: d4be324b80a4
# Full Hash: d4be324b80a403215e60c3462272fbc46241d3cd
# Author: Jon Coppeard <jcoppeard@mozilla.com>
# Date: 2020-04-10 02:59:09
# Description:
#   Bug 1628440 - Use WeakHeapPtr for weakly-held vector elements in finalization registry registrations weakmap r=sfink
#   
#   The problem is that HeapPtr<> has a prebarrier in its destructor.  This isn't necessary for weakly held values, and cause problems if the values have already been finalized.  The patch also renames FinalizationRecordVectorObject to FinalizationRegistrationsObject to better describe its purpose.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D70346
# ==============================================================================

diff -r ce494e20e11c -r d4be324b80a4 js/src/jit-test/tests/gc/bug-1628440.js
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/js/src/jit-test/tests/gc/bug-1628440.js	Thu Apr 09 16:23:12 2020 +0000
@@ -0,0 +1,9 @@
+// |jit-test| error: ReferenceError
+gczeal(10, 2);
+let cleanup = function(iter) {}
+let key = {"k": "this is my key"};
+let fg = new FinalizationRegistry(cleanup);
+let object = {};
+fg.register(object, {}, key);
+let success = fg.unregister(key);
+throw "x";
