# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: widget/gtk/nsWaylandDisplay.cpp
# Commit: 2e638f8a11df
# Full Hash: 2e638f8a11df2d0d7424059abc8ae65db580cf87
# Author: Martin Stransky <stransky@redhat.com>
# Date: 2020-04-24 03:06:24
# Description:
#   Bug 1632059 [Wayland] Use wayland display directly for va-api, r=jhorak
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D72122
# ==============================================================================

diff -r ddbd6938e3f3 -r 2e638f8a11df widget/gtk/nsWaylandDisplay.cpp
--- a/widget/gtk/nsWaylandDisplay.cpp	Thu Apr 23 18:34:21 2020 +0000
+++ b/widget/gtk/nsWaylandDisplay.cpp	Thu Apr 23 16:06:54 2020 +0000
@@ -35,6 +35,9 @@
 wl_display* WaylandDisplayGetWLDisplay(GdkDisplay* aGdkDisplay) {
   if (!aGdkDisplay) {
     aGdkDisplay = gdk_display_get_default();
+    if (!aGdkDisplay || GDK_IS_X11_DISPLAY(aGdkDisplay)) {
+      return nullptr;
+    }
   }
 
   // Available as of GTK 3.8+
@@ -537,8 +540,7 @@
          StaticPrefs::widget_wayland_dmabuf_webgl_enabled();
 }
 bool nsWaylandDisplay::IsDMABufVAAPIEnabled() {
-  return IsDMABufEnabled() &&
-         StaticPrefs::widget_wayland_dmabuf_vaapi_enabled();
+  return StaticPrefs::widget_wayland_dmabuf_vaapi_enabled();
 }
 
 void* nsGbmLib::sGbmLibHandle = nullptr;
