# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: docshell/base/BrowsingContextGroup.h
# Commit: 80fed0cf581c
# Full Hash: 80fed0cf581ca575f6dc90714834650f156bf1e5
# Author: Nika Layzell <nika@thelayzells.com>
# Date: 2020-04-30 03:51:35
# Description:
#   Bug 1633204 - Live WindowContexts should keep BrowsingContextGroup alive, r=farre
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D72893
# ==============================================================================

diff -r 8c1e8723a695 -r 80fed0cf581c docshell/base/BrowsingContextGroup.h
--- a/docshell/base/BrowsingContextGroup.h	Wed Apr 29 18:37:37 2020 +0000
+++ b/docshell/base/BrowsingContextGroup.h	Wed Apr 29 18:49:10 2020 +0000
@@ -36,10 +36,10 @@
 
   typedef nsTHashtable<nsRefPtrHashKey<ContentParent>> ContentParents;
 
-  // Interact with the list of BrowsingContexts.
-  bool Contains(BrowsingContext* aContext);
-  void Register(BrowsingContext* aContext);
-  void Unregister(BrowsingContext* aContext);
+  // Interact with the list of synced contexts. This controls the lifecycle of
+  // the BrowsingContextGroup and contexts loaded within them.
+  void Register(nsISupports* aContext);
+  void Unregister(nsISupports* aContext);
 
   // Interact with the list of ContentParents
   void Subscribe(ContentParent* aOriginProcess);
@@ -126,10 +126,15 @@
 
   uint64_t mId;
 
-  // A BrowsingContextGroup contains a series of BrowsingContext objects. They
-  // are addressed using a hashtable to avoid linear lookup when adding or
-  // removing elements from the set.
-  nsTHashtable<nsRefPtrHashKey<BrowsingContext>> mContexts;
+  // A BrowsingContextGroup contains a series of {Browsing,Window}Context
+  // objects. They are addressed using a hashtable to avoid linear lookup when
+  // adding or removing elements from the set.
+  //
+  // FIXME: This list is only required over a counter to keep nested
+  // non-discarded contexts within discarded contexts alive. It should be
+  // removed in the future.
+  // FIXME: Consider introducing a better common base than `nsISupports`?
+  nsTHashtable<nsRefPtrHashKey<nsISupports>> mContexts;
 
   // The set of toplevel browsing contexts in the current BrowsingContextGroup.
   nsTArray<RefPtr<BrowsingContext>> mToplevels;