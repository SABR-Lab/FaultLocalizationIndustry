# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/ipc/PContent.ipdl
# Commit: a30f158eba45
# Full Hash: a30f158eba4511313be684c4b5f3d5f278f34103
# Author: Nika Layzell <nika@thelayzells.com>
# Date: 2020-04-22 21:48:48
# Regressor Bug: 1580565
# File Overlap Count: 3
# Description:
#   Bug 1580565 - Part 4: Use WindowContext to manage BrowsingContext cached status, r=farre
#   
#   The existing infrastructure which stored cached BrowsingContexts on the
#   BrowsingContextGroup was added before WindowContexts were added, and can cause
#   racing issues with partially discarded trees during process switches.
# ==============================================================================

diff -r 276b131190a8 -r a30f158eba45 dom/ipc/PContent.ipdl
--- a/dom/ipc/PContent.ipdl	Wed Apr 22 03:21:55 2020 +0000
+++ b/dom/ipc/PContent.ipdl	Wed Apr 22 06:05:41 2020 +0000
@@ -342,6 +342,12 @@
     nsString value;
 };
 
+union SyncedContextInitializer
+{
+    BrowsingContextInitializer;
+    WindowContextInitializer;
+};
+
 /**
  * The PContent protocol is a top-level protocol between the UI process
  * and a content process. There is exactly one PContentParent/PContentChild pair
@@ -826,8 +832,7 @@
 
     // Begin subscribing to a new BrowsingContextGroup, sending down the current
     // value for every individual BrowsingContext.
-    async RegisterBrowsingContextGroup(BrowsingContextInitializer[] aInits,
-                                       WindowContextInitializer[] aWindowInits);
+    async RegisterBrowsingContextGroup(SyncedContextInitializer[] aInits);
 
 #if defined(MOZ_SANDBOX) && defined(MOZ_DEBUG) && defined(ENABLE_TESTS)
     // Initialize top-level actor for testing content process sandbox.
@@ -1591,18 +1596,6 @@
      */
     async DetachBrowsingContext(uint64_t aContextId) returns (bool unused);
 
-    /**
-     * Removes all of 'aContext'\'s children, and caches them in the
-     * BrowsingContextGroup.
-     */
-    async CacheBrowsingContextChildren(MaybeDiscardedBrowsingContext aContext);
-
-    /**
-     * Re-attach all BrowsingContexts in a 'aContext'.
-     */
-    async RestoreBrowsingContextChildren(MaybeDiscardedBrowsingContext aContext,
-                                         MaybeDiscardedBrowsingContext[] aChildren);
-
     async WindowClose(MaybeDiscardedBrowsingContext aContext,
                       bool aTrustedCaller);
     async WindowFocus(MaybeDiscardedBrowsingContext aContext,