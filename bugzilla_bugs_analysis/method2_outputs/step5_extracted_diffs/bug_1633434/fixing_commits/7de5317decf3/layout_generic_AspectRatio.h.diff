# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/generic/AspectRatio.h
# Commit: 7de5317decf3
# Full Hash: 7de5317decf341d1fd59467cf56a38210aba8e77
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-05-01 09:42:47
# Description:
#   Bug 1633434 - Ensure inverting a valid aspect ratio generates a valid aspect ratio. r=dholbert
#   
#   It seems like a reasonable expectation, but it may not hold with massive
#   ratios. Make it hold by returning the floating point epsilon in that
#   case.
# ==============================================================================

diff -r a00787062bfd -r 7de5317decf3 layout/generic/AspectRatio.h
--- a/layout/generic/AspectRatio.h	Thu Apr 30 14:02:58 2020 +0000
+++ b/layout/generic/AspectRatio.h	Thu Apr 30 14:04:24 2020 +0000
@@ -10,8 +10,9 @@
 /* The aspect ratio of a box, in a "width / height" format. */
 
 #include "mozilla/Attributes.h"
-#include "mozilla/Maybe.h"
 #include "nsCoord.h"
+#include <algorithm>
+#include <limits>
 
 namespace mozilla {
 
@@ -40,7 +41,14 @@
 
   // Inverts the ratio, in order to get the height / width ratio.
   [[nodiscard]] AspectRatio Inverted() const {
-    return *this ? AspectRatio(1.0f / mRatio) : *this;
+    if (!*this) {
+      return AspectRatio();
+    }
+    // Clamp to a small epsilon, in case mRatio is absurdly large & produces
+    // 0.0f in the division here (so that valid ratios always generate other
+    // valid ratios when inverted).
+    return AspectRatio(
+        std::max(std::numeric_limits<float>::epsilon(), 1.0f / mRatio));
   }
 
   bool operator==(const AspectRatio& aOther) const {