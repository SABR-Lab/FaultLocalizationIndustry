# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/ViewportUtils.cpp
# Commit: 7782bd4b305a
# Full Hash: 7782bd4b305a61c5945ef715e482973f64339780
# Author: Botond Ballo <botond@mozilla.com>
# Date: 2020-05-06 09:37:16
# Regressor Bug: 1556556
# File Overlap Count: 1
# Description:
#   Bug 1556556 - Add ViewportUtils::IsZoomedContentRoot(). r=kats,mattwoodrow
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D68727
# ==============================================================================

diff -r 25d6c0b90ad2 -r 7782bd4b305a layout/base/ViewportUtils.cpp
--- a/layout/base/ViewportUtils.cpp	Tue May 05 19:22:42 2020 +0000
+++ b/layout/base/ViewportUtils.cpp	Tue May 05 19:22:49 2020 +0000
@@ -3,12 +3,17 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 #include "mozilla/PresShell.h"
+#include "mozilla/ViewportFrame.h"
 #include "mozilla/ViewportUtils.h"
 #include "mozilla/layers/APZCCallbackHelper.h"
 #include "mozilla/layers/InputAPZContext.h"
 #include "mozilla/layers/ScrollableLayerGuid.h"
 #include "nsIContent.h"
+#include "nsIFrame.h"
+#include "nsIScrollableFrame.h"
 #include "nsLayoutUtils.h"
+#include "nsQueryFrame.h"
+#include "nsStyleStruct.h"
 
 namespace mozilla {
 
@@ -117,4 +122,25 @@
     ViewportUtils::GetVisualToLayoutTransform<LayoutDevicePixel>(
         ScrollableLayerGuid::ViewID);
 
+const nsIFrame* ViewportUtils::IsZoomedContentRoot(const nsIFrame* aFrame) {
+  if (!aFrame) {
+    return nullptr;
+  }
+  if (aFrame->Type() == LayoutFrameType::Canvas) {
+    nsIScrollableFrame* sf = do_QueryFrame(aFrame->GetParent());
+    if (sf && sf->IsRootScrollFrameOfDocument() &&
+        aFrame->PresContext()->IsRootContentDocumentCrossProcess()) {
+      return aFrame->GetParent();
+    }
+  } else if (aFrame->StyleDisplay()->mPosition ==
+             StylePositionProperty::Fixed) {
+    if (ViewportFrame* viewportFrame = do_QueryFrame(aFrame->GetParent())) {
+      if (viewportFrame->PresContext()->IsRootContentDocumentCrossProcess()) {
+        return viewportFrame->PresShell()->GetRootScrollFrame();
+      }
+    }
+  }
+  return nullptr;
+}
+
 }  // namespace mozilla
\ No newline at end of file