# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/ViewportUtils.h
# Commit: b76b8d0b94ca
# Full Hash: b76b8d0b94cab1edac764542d3d36604d629746c
# Author: Botond Ballo <botond@mozilla.com>
# Date: 2020-05-06 09:37:16
# Regressor Bug: 1556556
# File Overlap Count: 1
# Description:
#   Bug 1556556 - Add some VisualToLayout() and LayoutToVisual() wrappers to ViewportUtils. r=kats
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D68724
# ==============================================================================

diff -r ff865d99f67e -r b76b8d0b94ca layout/base/ViewportUtils.h
--- a/layout/base/ViewportUtils.h	Tue May 05 19:37:26 2020 +0000
+++ b/layout/base/ViewportUtils.h	Tue May 05 19:37:26 2020 +0000
@@ -8,8 +8,12 @@
 #include "Units.h"
 #include "mozilla/layers/ScrollableLayerGuid.h"
 
+class nsIFrame;
+
 namespace mozilla {
 
+class PresShell;
+
 class ViewportUtils {
  public:
   /* Return a transform to be applied to the coordinates of input events
@@ -32,6 +36,19 @@
        documentation for additional details. */
   static CSSToCSSMatrix4x4 GetVisualToLayoutTransform(
       layers::ScrollableLayerGuid::ViewID aScrollId);
+
+  /* The functions below apply GetVisualToLayoutTransform() or its inverse
+   * to various quantities.
+   *
+   * To determine the appropriate scroll id to pass into
+   * GetVisualToLayoutTransform(), these functions prefer to use the one
+   * from InputAPZContext::GetTargetLayerGuid() if one is available.
+   * If one is not available, they use the scroll id of the root scroll
+   * frame of the pres shell passed in as |aContext| as a fallback.
+   */
+  static nsPoint VisualToLayout(const nsPoint& aPt, PresShell* aContext);
+  static nsRect VisualToLayout(const nsRect& aRect, PresShell* aContext);
+  static nsPoint LayoutToVisual(const nsPoint& aPt, PresShell* aContext);
 };
 
 }  // namespace mozilla
