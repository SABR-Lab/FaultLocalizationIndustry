# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/new-regexp/RegExpAPI.cpp
# Commit: 5c0565636d06
# Full Hash: 5c0565636d06c53ae0d4455158164da0f3d9cb6a
# Author: Iain Ireland <iireland@mozilla.com>
# Date: 2020-05-13 21:46:27
# Regressor Bug: 1634135
# File Overlap Count: 2
# Description:
#   Bug 1634135: Don't leak Isolate r=mgaudet
#   
#   ASAN found a leak.
#   
#   We destroy the isolate with a level of indirection through RegexpAPI so that JSContext doesn't have to be able to see the full definition of Isolate.
# ==============================================================================

diff -r 16a1d1bbdd3e -r 5c0565636d06 js/src/new-regexp/RegExpAPI.cpp
--- a/js/src/new-regexp/RegExpAPI.cpp	Wed May 13 16:22:55 2020 +0000
+++ b/js/src/new-regexp/RegExpAPI.cpp	Wed May 13 16:23:20 2020 +0000
@@ -136,6 +136,10 @@
   return isolate.release();
 }
 
+void DestroyIsolate(Isolate* isolate) {
+  js_delete(isolate);
+}
+
 static size_t ComputeColumn(const Latin1Char* begin, const Latin1Char* end) {
   return PointerRangeSize(begin, end);
 }