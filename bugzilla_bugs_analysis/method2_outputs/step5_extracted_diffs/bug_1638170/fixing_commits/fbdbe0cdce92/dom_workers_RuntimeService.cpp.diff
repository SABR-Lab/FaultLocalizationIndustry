# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/workers/RuntimeService.cpp
# Commit: fbdbe0cdce92
# Full Hash: fbdbe0cdce92c5856678a1f3afd09dfa995c4488
# Author: Yaron Tausky <ytausky@mozilla.com>
# Date: 2020-05-26 21:37:52
# Description:
#   Bug 1638170 - Don't dispatch buggy WorkerRunnables r=asuth,dom-workers-and-storage-reviewers,sg
#   
#   This patch removes the dispatch of ReportGenericErrorRunnables when
#   a worker fails to start, since they were causing crashes and
#   weren't getting run anyway. It also adds an assertion that prevents
# ==============================================================================

diff -r 2bccc3e80006 -r fbdbe0cdce92 dom/workers/RuntimeService.cpp
--- a/dom/workers/RuntimeService.cpp	Mon May 25 20:31:28 2020 +0000
+++ b/dom/workers/RuntimeService.cpp	Tue May 26 11:38:58 2020 +0000
@@ -2232,8 +2232,6 @@
   mWorkerPrivate->EnsurePerformanceCounter();
 
   if (NS_WARN_IF(!BackgroundChild::GetOrCreateForCurrentThread())) {
-    WorkerErrorReport::CreateAndDispatchGenericErrorRunnableToParent(
-        mWorkerPrivate);
     return NS_ERROR_FAILURE;
   }
 
@@ -2249,8 +2247,6 @@
     JSContext* cx = context->Context();
 
     if (!InitJSContextForWorker(mWorkerPrivate, cx)) {
-      WorkerErrorReport::CreateAndDispatchGenericErrorRunnableToParent(
-          mWorkerPrivate);
       return NS_ERROR_FAILURE;
     }
 