# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/generic/Accessible.cpp
# Commit: 987e73f47fda
# Full Hash: 987e73f47fda36f43597b6943f4c9d3509094561
# Author: James Teh <jteh@mozilla.com>
# Date: 2020-05-11 21:47:06
# Regressor Bug: 1572860
# File Overlap Count: 1
# Description:
#   Bug 1572860: Remove the ability for an outer document to override live region markup in an inner iframe document. r=MarcoZ
#   
#   This is something that was implemented a long time ago, but it isn't covered in any spec, other browsers don't implement it and I don't know of any usage in the wild.
#   This doesn't work with OOP iframes, since what we're doing here requires the documents to be in the same process.
#   Given it isn't used or specified, the simplest solution is to just remove the behaviour altogether.
# ==============================================================================

diff -r fabe539cdc5e -r 987e73f47fda accessible/generic/Accessible.cpp
--- a/accessible/generic/Accessible.cpp	Mon May 11 10:33:28 2020 +0000
+++ b/accessible/generic/Accessible.cpp	Mon May 11 11:13:43 2020 +0000
@@ -1005,31 +1005,8 @@
   // Get container-foo computed live region properties based on the closest
   // container with the live region attribute. Inner nodes override outer nodes
   // within the same document. The inner nodes can be used to override live
-  // region behavior on more general outer nodes. However, nodes in outer
-  // documents override nodes in inner documents: outer doc author may want to
-  // override properties on a widget they used in an iframe.
-  nsIContent* startContent = mContent;
-  while (startContent) {
-    dom::Document* doc = startContent->GetComposedDoc();
-    if (!doc) break;
-
-    nsAccUtils::SetLiveContainerAttributes(attributes, startContent,
-                                           doc->GetRootElement());
-
-    // Allow ARIA live region markup from outer documents to override
-    nsCOMPtr<nsIDocShellTreeItem> docShellTreeItem = doc->GetDocShell();
-    if (!docShellTreeItem) break;
-
-    nsCOMPtr<nsIDocShellTreeItem> sameTypeParent;
-    docShellTreeItem->GetInProcessSameTypeParent(
-        getter_AddRefs(sameTypeParent));
-    if (!sameTypeParent || sameTypeParent == docShellTreeItem) break;
-
-    dom::Document* parentDoc = doc->GetInProcessParentDocument();
-    if (!parentDoc) break;
-
-    startContent = parentDoc->FindContentForSubDocument(doc);
-  }
+  // region behavior on more general outer nodes.
+  nsAccUtils::SetLiveContainerAttributes(attributes, mContent);
 
   if (!mContent->IsElement()) return attributes.forget();
 
