# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: toolkit/components/antitracking/ContentBlocking.cpp
# Commit: d69131a21fee
# Full Hash: d69131a21feedc02c202912955ae015c74c4c8ec
# Author: Dimi Lee <dlee@mozilla.com>
# Date: 2020-07-03 09:44:20
# Description:
#   Bug 1645777 - Add nullptr check after calling AntiTrackingUtils::GetPrincipal r=timhuang
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D82076
# ==============================================================================

diff -r 71ad2012ce3d -r d69131a21fee toolkit/components/antitracking/ContentBlocking.cpp
--- a/toolkit/components/antitracking/ContentBlocking.cpp	Thu Jul 02 23:05:52 2020 +0000
+++ b/toolkit/components/antitracking/ContentBlocking.cpp	Fri Jul 03 01:30:12 2020 +0000
@@ -802,6 +802,10 @@
     } else {
       nsCOMPtr<nsIPrincipal> principal =
           AntiTrackingUtils::GetPrincipal(topContext);
+      if (!principal) {
+        continue;
+      }
+
       nsAutoCString key;
       PermissionManager::GetKeyForPrincipal(principal, false, key);
       // Make sure we only apply to frames that have the same top-level.
