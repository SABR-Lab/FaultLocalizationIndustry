# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/vm/HelperThreads.cpp
# Commit: f2c470e06d30
# Full Hash: f2c470e06d308602428ea31875812ea321a14906
# Author: Yoshi Cheng-Hao Huang <allstars.chh@gmail.com>
# Date: 2020-06-28 09:28:14
# Description:
#   Bug 1647115 - Add a runTaskLocked method in SourceCompressionTask. r=jonco
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D80893
# ==============================================================================

diff -r df0a1af35e23 -r f2c470e06d30 js/src/vm/HelperThreads.cpp
--- a/js/src/vm/HelperThreads.cpp	Sat Jun 27 19:15:17 2020 +0000
+++ b/js/src/vm/HelperThreads.cpp	Sat Jun 27 18:25:51 2020 +0000
@@ -2217,13 +2217,9 @@
     currentTask.emplace(task.get());
   }
 
-  {
-    AutoUnlockHelperThreadState unlock(locked);
-
-    // release the pointer, inside runTask the SourceCompressTask pointer will
-    // be stored in compressionFinishedList.
-    task.release()->runTask();
-  }
+  // Release the pointer, inside runTaskLocked the SourceCompressTask pointer
+  // will be stored in compressionFinishedList.
+  task.release()->runTaskLocked(locked);
 
   currentTask.reset();
 