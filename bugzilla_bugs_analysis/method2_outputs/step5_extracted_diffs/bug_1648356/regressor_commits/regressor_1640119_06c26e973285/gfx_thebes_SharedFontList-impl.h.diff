# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/SharedFontList-impl.h
# Commit: 06c26e973285
# Full Hash: 06c26e97328589418681f58d637df751451f04ca
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2020-05-26 21:37:52
# Regressor Bug: 1640119
# File Overlap Count: 1
# Description:
#   Bug 1640119 - Pass shared-memory blocks for the font list as part of SetXPCOMProcessAttributes. r=jwatt
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D76507
# ==============================================================================

diff -r fbdbe0cdce92 -r 06c26e973285 gfx/thebes/SharedFontList-impl.h
--- a/gfx/thebes/SharedFontList-impl.h	Tue May 26 11:38:58 2020 +0000
+++ b/gfx/thebes/SharedFontList-impl.h	Tue May 26 09:30:17 2020 +0000
@@ -220,7 +220,9 @@
 
   /**
    * Used by the parent process to pass a handle to a shared block to a
-   * specific child process.
+   * specific child process. This is used when a child process requests
+   * an additional block that was not already passed to it (because the
+   * list has changed/grown since the child was first initialized).
    */
   void ShareShmBlockToProcess(uint32_t aIndex, base::ProcessId aPid,
                               base::SharedMemoryHandle* aOut) {
@@ -235,6 +237,14 @@
   }
 
   /**
+   * Collect an array of handles to all the shmem blocks, ready to be
+   * shared to the given process. This is used at child process startup
+   * to pass the complete list at once.
+   */
+  void ShareBlocksToProcess(nsTArray<base::SharedMemoryHandle>* aBlocks,
+                            base::ProcessId aPid);
+
+  /**
    * Support for memory reporter.
    */
   size_t SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf) const {