# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: netwerk/test/unit/test_standardurl.js
# Commit: d9e19325c7c7
# Full Hash: d9e19325c7c7065822a0bed016d05c556f93fbb3
# Author: Valentin Gosu <valentin.gosu@gmail.com>
# Date: 2020-11-18 16:05:35
# Description:
#   Bug 1648493 - tests r=necko-reviewers,kershaw
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D88299
# ==============================================================================

diff -r aa0b71302d8a -r d9e19325c7c7 netwerk/test/unit/test_standardurl.js
--- a/netwerk/test/unit/test_standardurl.js	Wed Nov 18 09:20:56 2020 +0000
+++ b/netwerk/test/unit/test_standardurl.js	Wed Nov 18 09:29:56 2020 +0000
@@ -1271,3 +1271,29 @@
     "A pseudo-empty host is not allowed for URLTYPE_AUTHORITY"
   );
 });
+
+add_task(async function test_bug1648493() {
+  let url = stringToURL("https://example.com/");
+  url = url
+    .mutate()
+    .setScheme("file")
+    .finalize();
+  url = url
+    .mutate()
+    .setScheme("resource")
+    .finalize();
+  url = url
+    .mutate()
+    .setPassword("Ãª")
+    .finalize();
+  url = url
+    .mutate()
+    .setUsername("Ã§")
+    .finalize();
+  url = url
+    .mutate()
+    .setScheme("t")
+    .finalize();
+  equal(url.spec, "t://%C3%83%C2%A7:%C3%83%C2%AA@example.com/");
+  equal(url.username, "%C3%83%C2%A7");
+});
