# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/style/SheetLoadData.h
# Commit: 10064e664a57
# Full Hash: 10064e664a57f5a297dd25ae8c6ba07c03398b2a
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-07-17 03:27:56
# Description:
#   Bug 1649728 - Use WeakPtr in SharedStyleSheetCache::mLoadingDatas. r=firefox-style-system-reviewers,jwatt
#   
#   This is safer in case Necko fails to notify us. The only repro we have
#   is fixed by bug 1651661, but this should hopefully be uncontroversial as
#   well and prevents crashing in release builds.
# ==============================================================================

diff -r dce645f310a5 -r 10064e664a57 layout/style/SheetLoadData.h
--- a/layout/style/SheetLoadData.h	Thu Jul 16 17:31:10 2020 +0000
+++ b/layout/style/SheetLoadData.h	Thu Jul 16 16:31:52 2020 +0000
@@ -39,6 +39,8 @@
               "in SheetLoadData::mParsingMode");
 
 class SheetLoadData final : public PreloaderBase,
+                            // FIXME(bug 1653011): This is a bit unfortunate.
+                            public SupportsWeakPtr<SheetLoadData>,
                             public nsIRunnable,
                             public nsIThreadObserver {
   using MediaMatched = dom::LinkStyle::MediaMatched;
