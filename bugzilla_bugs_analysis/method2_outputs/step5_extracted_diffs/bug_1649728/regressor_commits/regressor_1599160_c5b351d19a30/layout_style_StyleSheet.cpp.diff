# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/style/StyleSheet.cpp
# Commit: c5b351d19a30
# Full Hash: c5b351d19a3076dd2b782fdbc6fa0d5c07267adb
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-06-15 21:48:38
# Regressor Bug: 1599160
# File Overlap Count: 3
# Description:
#   Bug 1599160 - Allow caching stylesheets across documents. r=heycam
#   
#   This patch implements a per-process cache of parsed stylesheets for
#   non-inline sheets. The entries are evicted when the document gets
#   destroyed and there's no other document with the same principal around.
# ==============================================================================

diff -r 3ce9af6580b2 -r c5b351d19a30 layout/style/StyleSheet.cpp
--- a/layout/style/StyleSheet.cpp	Mon Jun 15 13:53:18 2020 +0000
+++ b/layout/style/StyleSheet.cpp	Fri Jun 12 19:31:32 2020 +0000
@@ -1193,7 +1193,7 @@
     RefPtr<RawServoStyleSheetContents> contents =
         Servo_StyleSheet_FromUTF8Bytes(
             &aLoader, this, &aLoadData, &aBytes, mParsingMode, Inner().mURLData,
-            aLoadData.mLineNumber, aLoader.GetCompatibilityMode(),
+            aLoadData.mLineNumber, aLoadData.mCompatMode,
             /* reusable_sheets = */ nullptr, useCounters, allowImportRules,
             StyleSanitizationKind::None,
             /* sanitized_output = */ nullptr)
@@ -1203,7 +1203,7 @@
     auto holder = MakeRefPtr<css::SheetLoadDataHolder>(__func__, &aLoadData);
     Servo_StyleSheet_FromUTF8BytesAsync(
         holder, Inner().mURLData, &aBytes, mParsingMode, aLoadData.mLineNumber,
-        aLoader.GetCompatibilityMode(),
+        aLoadData.mCompatMode,
         /* should_record_use_counters = */ !!useCounters, allowImportRules);
   }
 