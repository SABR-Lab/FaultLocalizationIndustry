# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/MediaManager.cpp
# Commit: 8c949ad30253
# Full Hash: 8c949ad302533dbb1d7651bf4ceda039c490f124
# Author: Paul Adenot <paul@paul.cx>
# Date: 2020-11-19 21:44:32
# Regressor Bug: 1624322
# File Overlap Count: 1
# Description:
#   Bug 1674283 - Backout part of bug 1624322. r=jib
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D97202
# ==============================================================================

diff -r ba1285f0cd47 -r 8c949ad30253 dom/media/MediaManager.cpp
--- a/dom/media/MediaManager.cpp	Tue Nov 17 16:28:48 2020 +0000
+++ b/dom/media/MediaManager.cpp	Wed Nov 18 15:04:13 2020 +0000
@@ -4248,42 +4248,18 @@
   }
 }
 
-static bool SameGroupAsCurrentAudioOutput(const nsString& aGroupId) {
-  CubebDeviceEnumerator* enumerator = CubebDeviceEnumerator::GetInstance();
-  // Get the current graph's device info. This is always the
-  // default audio output device for now.
-  RefPtr<AudioDeviceInfo> outputDevice =
-      enumerator->DefaultDevice(CubebDeviceEnumerator::Side::OUTPUT);
-  return outputDevice && outputDevice->GroupID().Equals(aGroupId);
-}
-
 auto SourceListener::UpdateDevice(MediaTrack* aTrack, bool aOn)
     -> RefPtr<DeviceOperationPromise> {
   MOZ_ASSERT(NS_IsMainThread());
   RefPtr<SourceListener> self = this;
   DeviceState& state = GetDeviceStateFor(aTrack);
-  nsString groupId;
-  state.mDevice->GetRawGroupId(groupId);
 
   return MediaManager::Dispatch<DeviceOperationPromise>(
              __func__,
-             [self, device = state.mDevice, aOn,
-              groupId](MozPromiseHolder<DeviceOperationPromise>& h) {
-               if (device->mKind == dom::MediaDeviceKind::Audioinput && !aOn &&
-                   SameGroupAsCurrentAudioOutput(groupId)) {
-                 // Don't turn off the microphone of a device that is on the
-                 // same physical device as the output.
-                 //
-                 // Also don't take this branch when turning on, in case the
-                 // default audio output device has changed. The AudioInput
-                 // source start/stop are idempotent, so this works.
-                 LOG("Not turning device off, as it matches audio output (%s)",
-                     NS_ConvertUTF16toUTF8(groupId).get());
-                 h.Resolve(NS_OK, __func__);
-                 return;
-               }
+             [self, device = state.mDevice,
+              aOn](MozPromiseHolder<DeviceOperationPromise>& h) {
                LOG("Turning %s device (%s)", aOn ? "on" : "off",
-                   NS_ConvertUTF16toUTF8(groupId).get());
+                   NS_ConvertUTF16toUTF8(device->mName).get());
                h.Resolve(aOn ? device->Start() : device->Stop(), __func__);
              })
       ->Then(
