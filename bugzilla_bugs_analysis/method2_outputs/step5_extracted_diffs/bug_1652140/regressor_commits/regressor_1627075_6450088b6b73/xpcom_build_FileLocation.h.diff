# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: xpcom/build/FileLocation.h
# Commit: 6450088b6b73
# Full Hash: 6450088b6b73ffc17c79cd7097b1bfe30d00e207
# Author: Doug Thayer <dothayer@mozilla.com>
# Date: 2020-09-14 21:29:41
# Regressor Bug: 1627075
# File Overlap Count: 1
# Description:
#   Bug 1656261 - Back out all recent StartupCache work r=RyanVM
#   
#   This backs out all work from bug 1627075 as well as all of its
#   descendents. There were a few conflicts when backing this out but
#   overall it was pretty clean, so I would say it's a fairly mild
# ==============================================================================

diff -r b0fabcd60430 -r 6450088b6b73 xpcom/build/FileLocation.h
--- a/xpcom/build/FileLocation.h	Mon Sep 14 17:32:40 2020 +0000
+++ b/xpcom/build/FileLocation.h	Mon Sep 14 17:00:53 2020 +0000
@@ -17,8 +17,6 @@
 
 namespace mozilla {
 
-class CacheAwareZipReader;
-
 class FileLocation {
  public:
   /**
@@ -29,7 +27,7 @@
    * - in archives within archives
    * As such, it stores a path within an archive, as well as the archive
    * path itself, or the complete file path alone when on a filesystem.
-   * When the archive is in an archive, an CacheAwareZipReader is stored instead
+   * When the archive is in an archive, an nsZipArchive is stored instead
    * of a file path.
    */
   FileLocation();
@@ -47,14 +45,9 @@
 
   /**
    * Constructors for path within an archive. The archive can be given either
-   * as nsIFile or CacheAwareZipReader.
+   * as nsIFile or nsZipArchive.
    */
-  FileLocation(nsIFile* aFile, const char* aPath);
-
-  /**
-   * Constructors for path within a zip archive.
-   */
-  FileLocation(CacheAwareZipReader* aZip, const char* aPath);
+  FileLocation(nsIFile* aZip, const char* aPath);
 
   FileLocation(nsZipArchive* aZip, const char* aPath);
 
@@ -68,12 +61,10 @@
    */
   void Init(nsIFile* aFile);
 
-  void Init(nsIFile* aFile, const char* aPath);
+  void Init(nsIFile* aZip, const char* aPath);
 
   void Init(nsZipArchive* aZip, const char* aPath);
 
-  void Init(CacheAwareZipReader* aZip, const char* aPath);
-
   /**
    * Returns an URI string corresponding to the file location
    */
@@ -87,7 +78,7 @@
    */
   already_AddRefed<nsIFile> GetBaseFile();
 
-  CacheAwareZipReader* GetBaseZip() { return mBaseZip; }
+  nsZipArchive* GetBaseZip() { return mBaseZip; }
 
   /**
    * Returns whether the "base file" (see GetBaseFile) is an archive
@@ -128,7 +119,7 @@
    protected:
     friend class FileLocation;
     nsZipItem* mItem;
-    RefPtr<CacheAwareZipReader> mZip;
+    RefPtr<nsZipArchive> mZip;
     mozilla::AutoFDClose mFd;
   };
 
@@ -140,7 +131,7 @@
 
  private:
   nsCOMPtr<nsIFile> mBaseFile;
-  RefPtr<CacheAwareZipReader> mBaseZip;
+  RefPtr<nsZipArchive> mBaseZip;
   nsCString mPath;
 }; /* class FileLocation */
 