# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/indexedDB/FileManagerBase.h
# Commit: 7e9d56eb485e
# Full Hash: 7e9d56eb485e06cca2a82fe88e2ae36c2ccd2095
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2020-04-01 21:26:59
# Regressor Bug: 1623278
# File Overlap Count: 1
# Description:
#   Bug 1623278 - Use SafeRefPtr for FileManager. r=dom-workers-and-storage-reviewers,asuth
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D65549
# ==============================================================================

diff -r a753c018a4a8 -r 7e9d56eb485e dom/indexedDB/FileManagerBase.h
--- a/dom/indexedDB/FileManagerBase.h	Wed Apr 01 09:54:24 2020 +0000
+++ b/dom/indexedDB/FileManagerBase.h	Wed Apr 01 09:52:54 2020 +0000
@@ -60,8 +60,10 @@
 
       const int64_t id = ++mLastFileId;
 
-      fileInfo =
-          new FileInfo(FileManagerGuard{}, static_cast<FileManager*>(this), id);
+      fileInfo = new FileInfo(FileManagerGuard{},
+                              SafeRefPtr{static_cast<FileManager*>(this),
+                                         AcquireStrongRefFromRawPtr{}},
+                              id);
 
       mFileInfos.Put(id, fileInfo);
     }