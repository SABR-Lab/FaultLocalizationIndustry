# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/html/HTMLMediaElement.cpp
# Commit: 448c6633265d
# Full Hash: 448c6633265df68e72f25e8170b97522ed4796e0
# Author: alwu <alwu@mozilla.com>
# Date: 2020-07-24 09:32:06
# Regressor Bug: 1653390
# File Overlap Count: 1
# Description:
#   Bug 1653390 - part3 : wrap the detail of updating playback state into Start(). r=bryce
#   
#   `NotifyMediaControlPlaybackStateChanged()` would be called when `mPaused` changes, but it would only take effect after the listener starts. If the media changes its `mPaused` before we starts listener, then we have to manully update `NotifyMediaControlPlaybackStateChanged()`.
#   
#   However, I think wrapping this detail into `Start()` itself would be clearer.
# ==============================================================================

diff -r f42e3e5a600d -r 448c6633265d dom/html/HTMLMediaElement.cpp
--- a/dom/html/HTMLMediaElement.cpp	Thu Jul 23 21:32:51 2020 +0000
+++ b/dom/html/HTMLMediaElement.cpp	Thu Jul 23 21:32:58 2020 +0000
@@ -417,6 +417,12 @@
     }
 
     NotifyPlaybackStateChanged(MediaPlaybackState::eStarted);
+    // If owner has started playing before the listener starts, we should update
+    // the playing state as well. Eg. media starts inaudily and becomes audible
+    // later.
+    if (!Owner()->Paused()) {
+      NotifyMediaStartedPlaying();
+    }
     return true;
   }
 
@@ -7876,12 +7882,6 @@
       !mMediaControlKeyListener->Start()) {
     return;
   }
-
-  // If `mPaused` was being changed at the time the listener didn't start, then
-  // this method won't be called. Eg. if the media becomes audible after it has
-  // been playing for a while. Therefore, we have to manually update playback
-  // state after starting listener.
-  NotifyMediaControlPlaybackStateChanged();
 }
 
 void HTMLMediaElement::StopListeningMediaControlKeyIfNeeded() {
