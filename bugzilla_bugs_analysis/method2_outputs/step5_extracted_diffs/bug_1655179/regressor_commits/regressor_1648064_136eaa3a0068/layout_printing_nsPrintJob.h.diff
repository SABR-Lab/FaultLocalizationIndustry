# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/printing/nsPrintJob.h
# Commit: 136eaa3a0068
# Full Hash: 136eaa3a0068bedf81db704fa077a9fc65f46279
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-07-23 03:20:25
# Regressor Bug: 1648064
# File Overlap Count: 1
# Description:
#   Bug 1648064 - Make print preview documents wait properly for the document to be loaded. r=smaug
#   
#   Otherwise my test fails intermittently on CI. We need to block on all
#   the load blockers because stuff like responsive images doesn't fire the
#   load directly but they do that as a micro task (blocking the load
# ==============================================================================

diff -r b38b31524349 -r 136eaa3a0068 layout/printing/nsPrintJob.h
--- a/layout/printing/nsPrintJob.h	Wed Jul 22 20:29:08 2020 +0000
+++ b/layout/printing/nsPrintJob.h	Wed Jul 22 20:29:16 2020 +0000
@@ -243,7 +243,9 @@
    * (if it has a 'print' style sheet, for example).
    */
   MOZ_CAN_RUN_SCRIPT nsresult
-  ResumePrintAfterResourcesLoaded(bool aCleanupOnError);
+  MaybeResumePrintAfterResourcesLoaded(bool aCleanupOnError);
+
+  bool ShouldResumePrint() const;
 
   nsresult SetRootView(nsPrintObject* aPO, bool& aDoReturn,
                        bool& aDocumentIsTopLevel, nsSize& aAdjSize);
@@ -287,7 +289,6 @@
   nsPagePrintTimer* mPagePrintTimer = nullptr;
 
   float mScreenDPI = 115.0f;
-  int32_t mLoadCounter = 0;
 
   bool mIsCreatingPrintPreview = false;
   bool mIsDoingPrinting = false;
