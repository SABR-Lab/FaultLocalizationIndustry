# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/printing/nsPrintJob.h
# Commit: 4ec12eb9788c
# Full Hash: 4ec12eb9788caed38ad9d5e8dd6490102defd767
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-07-22 21:55:45
# Regressor Bug: 1648064
# File Overlap Count: 1
# Description:
#   Bug 1648064 - Make print preview documents wait properly for the document to be loaded. r=smaug
#   
#   Otherwise my test fails intermittently on CI. We need to block on all
#   the load blockers because stuff like responsive images doesn't fire the
#   load directly but they do that as a micro task (blocking the load
# ==============================================================================

diff -r f735d4f6b21f -r 4ec12eb9788c layout/printing/nsPrintJob.h
--- a/layout/printing/nsPrintJob.h	Wed Jul 22 14:39:45 2020 +0000
+++ b/layout/printing/nsPrintJob.h	Wed Jul 22 14:39:47 2020 +0000
@@ -243,7 +243,9 @@
    * (if it has a 'print' style sheet, for example).
    */
   MOZ_CAN_RUN_SCRIPT nsresult
-  ResumePrintAfterResourcesLoaded(bool aCleanupOnError);
+  MaybeResumePrintAfterResourcesLoaded(bool aCleanupOnError);
+
+  bool ShouldResumePrint() const;
 
   nsresult SetRootView(nsPrintObject* aPO, bool& aDoReturn,
                        bool& aDocumentIsTopLevel, nsSize& aAdjSize);
@@ -287,7 +289,6 @@
   nsPagePrintTimer* mPagePrintTimer = nullptr;
 
   float mScreenDPI = 115.0f;
-  int32_t mLoadCounter = 0;
 
   bool mIsCreatingPrintPreview = false;
   bool mIsDoingPrinting = false;
