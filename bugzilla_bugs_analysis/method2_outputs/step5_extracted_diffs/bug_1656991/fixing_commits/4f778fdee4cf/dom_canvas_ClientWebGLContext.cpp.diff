# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/canvas/ClientWebGLContext.cpp
# Commit: 4f778fdee4cf
# Full Hash: 4f778fdee4cfa6f92f5d86b234d66f4ddd710532
# Author: Jeff Gilbert <jgilbert@mozilla.com>
# Date: 2020-09-02 09:53:59
# Description:
#   Bug 1656991 - Handle surf alloc failure gracefully. r=lsalzman
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D89061
# ==============================================================================

diff -r aa4266b83461 -r 4f778fdee4cf dom/canvas/ClientWebGLContext.cpp
--- a/dom/canvas/ClientWebGLContext.cpp	Tue Sep 01 23:03:36 2020 +0000
+++ b/dom/canvas/ClientWebGLContext.cpp	Tue Sep 01 23:29:44 2020 +0000
@@ -921,6 +921,9 @@
     const auto format = nonPremultSurf->GetFormat();
     snapshot =
         gfx::Factory::CreateDataSourceSurface(size, format, /*zero=*/false);
+    if (!snapshot) {
+      gfxCriticalNote << "CreateDataSourceSurface failed for size " << size;
+    }
     gfxUtils::PremultiplyDataSurface(nonPremultSurf, snapshot);
   }
 
