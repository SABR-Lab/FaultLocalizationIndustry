# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: toolkit/xre/nsAppRunner.cpp
# Commit: e4bcc1ce643e
# Full Hash: e4bcc1ce643e2e8f9f956779fd95c22a3a66fccf
# Author: Andrew McCreight <continuation@gmail.com>
# Date: 2020-08-15 09:31:17
# Description:
#   Bug 1659013 - Fix some issues with running BrowserTabsRemoteAutostart() in non-parent processes. r=froydnj
#   
#   We should do an early return in every kind of non-parent process,
#   not just content processes.
#   
# ==============================================================================

diff -r 2559ac5883da -r e4bcc1ce643e toolkit/xre/nsAppRunner.cpp
--- a/toolkit/xre/nsAppRunner.cpp	Fri Aug 14 14:53:41 2020 +0000
+++ b/toolkit/xre/nsAppRunner.cpp	Fri Aug 14 14:21:31 2020 +0000
@@ -5126,8 +5126,8 @@
   }
   gBrowserTabsRemoteAutostartInitialized = true;
 
-  // If we're in the content process, we are running E10S.
-  if (XRE_IsContentProcess()) {
+  // If we're not in the parent process, we are running E10s.
+  if (!XRE_IsParentProcess()) {
     gBrowserTabsRemoteAutostart = true;
     return gBrowserTabsRemoteAutostart;
   }
@@ -5163,7 +5163,7 @@
   if (gBrowserTabsRemoteAutostart) {
     const char* forceDisable = PR_GetEnv("MOZ_FORCE_DISABLE_E10S");
     // The environment variable must match the application version to apply.
-    if (forceDisable && !strcmp(forceDisable, gAppData->version)) {
+    if (forceDisable && gAppData && !strcmp(forceDisable, gAppData->version)) {
       gBrowserTabsRemoteAutostart = false;
       status = kE10sForceDisabled;
     }
