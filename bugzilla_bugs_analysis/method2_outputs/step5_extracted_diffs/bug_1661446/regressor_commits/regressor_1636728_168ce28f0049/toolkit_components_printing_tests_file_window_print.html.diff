# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/components/printing/tests/file_window_print.html
# Commit: 168ce28f0049
# Full Hash: 168ce28f004948c7b2646d5f613c1bda7af62de6
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-09-17 10:09:40
# Regressor Bug: 1636728
# File Overlap Count: 1
# Description:
#   Bug 1663826 - Keep freezing navigation during window.print() for compat. r=smaug
#   
#   This broke in bug 1636728 because we started setting the bit in the
#   cloned docshell rather than the original one.
#   
# ==============================================================================

diff -r 092dc1009fdf -r 168ce28f0049 toolkit/components/printing/tests/file_window_print.html
--- a/toolkit/components/printing/tests/file_window_print.html	Wed Sep 16 22:49:44 2020 +0000
+++ b/toolkit/components/printing/tests/file_window_print.html	Wed Sep 16 22:55:19 2020 +0000
@@ -5,8 +5,16 @@
   onload = function() {
     // window.print() is special until after the load event is finished firing.
     setTimeout(function() {
-      // This one should block until we're done printing.
+      // This fires a timer which would trigger a navigation and prevent the
+      // test from completing if it happens during window.print().
+      let meta = document.createElement("meta");
+      meta.setAttribute("http-equiv", "refresh");
+      meta.setAttribute("content", "0; url=/unlikely-to-be-found");
+      document.head.appendChild(meta);
+      // This one should block until we're done printing, and block the
+      // navigation too.
       window.print();
+      meta.remove();
       document.body.insertAdjacentHTML('beforeend', `<div id="after-first-print">After first print</div>`);
 
       let canvas = document.getElementById("canvas");
