# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: browser/components/ssb/content/ssb.js
# Commit: 93e3344dd1f7
# Full Hash: 93e3344dd1f7454dc46c1553dd05e5e3bc78c349
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-08-26 03:24:37
# Regressor Bug: 1636728
# File Overlap Count: 1
# Description:
#   Bug 1636728 - Centralize printing entry points in nsGlobalWindowOuter, and move cloning out of nsPrintJob. r=jwatt,geckoview-reviewers,smaug,agi
#   
#   This centralizes our print and preview setup in nsGlobalWindowOuter so
#   that we never re-clone a clone, and so that we reuse the window.open()
#   codepath to create the browsing context to clone into.
# ==============================================================================

diff -r 2969f3de028f -r 93e3344dd1f7 browser/components/ssb/content/ssb.js
--- a/browser/components/ssb/content/ssb.js	Tue Aug 25 02:58:57 2020 +0000
+++ b/browser/components/ssb/content/ssb.js	Tue Aug 25 17:45:12 2020 +0000
@@ -144,10 +144,6 @@
     throw Components.Exception("", Cr.NS_ERROR_FAILURE);
   }
 
-  print(aBrowsingContext) {
-    PrintUtils.startPrintWindow(aBrowsingContext);
-  }
-
   /**
    * Finds a new frame to load some content in.
    *
@@ -170,6 +166,12 @@
     // It's been determined that this load needs to happen in a new frame.
     // Either onBeforeLinkTraversal set this correctly or this is the result
     // of a window.open call.
+    if (where == Ci.nsIBrowserDOMWindow.OPEN_PRINT_BROWSER) {
+      return PrintUtils.startPrintWindow(
+        params.openWindowInfo.parent,
+        params.openWindowInfo
+      );
+    }
 
     // If this ssb can load the url then just load it internally.
     if (gSSB.canLoad(uri)) {