# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/nsGlobalWindowOuter.h
# Commit: d73fe72c4b20
# Full Hash: d73fe72c4b20a408d4c0559b7b1dd5d945f3d3b9
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2020-09-25 21:47:43
# Regressor Bug: 1636728
# File Overlap Count: 1
# Description:
#   Bug 1667342 - Make the "deferred window close" keep making sense after bug 1636728. r=smaug
#   
#   This was only being checked on OnDonePrinting() which isn't called in
#   the original docshell. Move it to the window because we don't need to
#   care about document viewers getting closed during print operations,
# ==============================================================================

diff -r 0bd98379fad4 -r d73fe72c4b20 dom/base/nsGlobalWindowOuter.h
--- a/dom/base/nsGlobalWindowOuter.h	Thu Sep 24 23:51:42 2020 +0000
+++ b/dom/base/nsGlobalWindowOuter.h	Fri Sep 25 13:39:01 2020 +0000
@@ -1053,6 +1053,10 @@
     return mDelayedPrintUntilAfterLoad;
   }
 
+  bool DelayedCloseForPrinting() const {
+    return mDelayedCloseForPrinting;
+  }
+
   void StopDelayingPrintingUntilAfterLoad() {
     mShouldDelayPrintUntilAfterLoad = false;
   }
@@ -1106,6 +1110,9 @@
 
   // Whether we've delayed a print until after load.
   bool mDelayedPrintUntilAfterLoad : 1;
+  // Whether we've delayed a close() operation because there was a pending
+  // print() operation.
+  bool mDelayedCloseForPrinting : 1;
   // Whether we should delay printing until after load.
   bool mShouldDelayPrintUntilAfterLoad : 1;
 