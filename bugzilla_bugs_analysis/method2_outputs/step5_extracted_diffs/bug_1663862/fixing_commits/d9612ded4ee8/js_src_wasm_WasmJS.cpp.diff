# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/wasm/WasmJS.cpp
# Commit: d9612ded4ee8
# Full Hash: d9612ded4ee87528a9519a7e6c60480fcc7acf15
# Author: Ryan Hunt <rhunt@eqrion.net>
# Date: 2020-09-10 15:21:10
# Description:
#   Bug 1663862 - Check OOM from wasm::ToString(). r=lth
#   
#   wasm::ToCString() couldn't OOM, but wasm::ToString() can, so the
#   all the use cases need to check for OOM and propagate it.
#   
# ==============================================================================

diff -r f0551b411d48 -r d9612ded4ee8 js/src/wasm/WasmJS.cpp
--- a/js/src/wasm/WasmJS.cpp	Thu Sep 10 09:14:01 2020 +0300
+++ b/js/src/wasm/WasmJS.cpp	Thu Sep 10 06:08:45 2020 +0000
@@ -1151,6 +1151,10 @@
     }
 
     UniqueChars argStr = ToString(arg);
+    if (!argStr) {
+      return nullptr;
+    }
+
     if (!buf.append(argStr.get(), strlen(argStr.get()))) {
       return nullptr;
     }
@@ -1169,6 +1173,10 @@
     }
 
     UniqueChars resultStr = ToString(result);
+    if (!resultStr) {
+      return nullptr;
+    }
+
     if (!buf.append(resultStr.get(), strlen(resultStr.get()))) {
       return nullptr;
     }