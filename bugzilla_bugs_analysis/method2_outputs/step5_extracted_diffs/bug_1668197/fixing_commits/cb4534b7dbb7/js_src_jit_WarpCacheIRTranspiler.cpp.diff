# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit/WarpCacheIRTranspiler.cpp
# Commit: cb4534b7dbb7
# Full Hash: cb4534b7dbb746d083bdbf8fb74b3036c63f897b
# Author: Iain Ireland <iireland@mozilla.com>
# Date: 2020-10-02 04:10:47
# Description:
#   Bug 1668197: Handle OOM in MHypot::New r=jandem
#   
#   In addition to the calls in the transpiler, MHypot::New is also called in the MHypot `clone` implementation.
#   
#   I checked the other fallible `New` methods, and it looks like we are handling everything else correctly.
# ==============================================================================

diff -r 66666ee5b0a9 -r cb4534b7dbb7 js/src/jit/WarpCacheIRTranspiler.cpp
--- a/js/src/jit/WarpCacheIRTranspiler.cpp	Thu Oct 01 07:19:04 2020 +0000
+++ b/js/src/jit/WarpCacheIRTranspiler.cpp	Thu Oct 01 16:32:15 2020 +0000
@@ -2292,6 +2292,9 @@
   vector.infallibleAppend(getOperand(secondId));
 
   auto* ins = MHypot::New(alloc(), vector);
+  if (!ins) {
+    return false;
+  }
   add(ins);
 
   pushResult(ins);
@@ -2311,6 +2314,9 @@
   vector.infallibleAppend(getOperand(thirdId));
 
   auto* ins = MHypot::New(alloc(), vector);
+  if (!ins) {
+    return false;
+  }
   add(ins);
 
   pushResult(ins);
@@ -2331,6 +2337,9 @@
   vector.infallibleAppend(getOperand(fourthId));
 
   auto* ins = MHypot::New(alloc(), vector);
+  if (!ins) {
+    return false;
+  }
   add(ins);
 
   pushResult(ins);
