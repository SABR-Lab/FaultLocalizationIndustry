# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/platforms/PDMFactory.cpp
# Commit: d82b6476a18d
# Full Hash: d82b6476a18d1dedfe0cb5be42ee9c7040fcf4da
# Author: Dan Glastonbury <dan.glastonbury@gmail.com>
# Date: 2020-10-21 09:51:28
# Regressor Bug: 1595994
# File Overlap Count: 1
# Description:
#   Bug 1595994 - P10: Allow FFMPEG decoding in RDD process. r=mattwoodrow
#   
#   Disabled by default.
#   
#   Depends on D54884
# ==============================================================================

diff -r 9914d2e0f6ca -r d82b6476a18d dom/media/platforms/PDMFactory.cpp
--- a/dom/media/platforms/PDMFactory.cpp	Tue Oct 20 23:27:13 2020 +0000
+++ b/dom/media/platforms/PDMFactory.cpp	Tue Oct 20 23:27:21 2020 +0000
@@ -368,6 +368,15 @@
     CreateAndStartupPDM<FFVPXRuntimeLinker>();
   }
 #endif
+#ifdef MOZ_FFMPEG
+  if (StaticPrefs::media_ffmpeg_enabled() &&
+      StaticPrefs::media_rdd_ffmpeg_enabled() &&
+      !CreateAndStartupPDM<FFmpegRuntimeLinker>()) {
+    mFailureFlags += DecoderDoctorDiagnostics::Flags::FFmpegFailedToLoad;
+  } else {
+    mFailureFlags -= DecoderDoctorDiagnostics::Flags::FFmpegFailedToLoad;
+  }
+#endif
   CreateAndStartupPDM<AgnosticDecoderModule>();
 }
 