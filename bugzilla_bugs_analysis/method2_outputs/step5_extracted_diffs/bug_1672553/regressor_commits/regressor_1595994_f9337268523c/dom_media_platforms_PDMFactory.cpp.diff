# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/platforms/PDMFactory.cpp
# Commit: f9337268523c
# Full Hash: f9337268523c6607228fda7fa659fd5a3d939dad
# Author: Jean-Yves Avenard <jyavenard@mozilla.com>
# Date: 2020-10-21 09:51:28
# Regressor Bug: 1595994
# File Overlap Count: 1
# Description:
#   Bug 1595994 - P1E. Don't use libvpx in the RDD process if video contains an alpha plane. r=mattwoodrow
#   
#   Until bug 1668840 is fixed, we can't allocate a SharedRGBImage without a PImageBridge
#   
#   Depends on D92233
# ==============================================================================

diff -r 7a990fa02246 -r f9337268523c dom/media/platforms/PDMFactory.cpp
--- a/dom/media/platforms/PDMFactory.cpp	Tue Oct 20 23:30:04 2020 +0000
+++ b/dom/media/platforms/PDMFactory.cpp	Tue Oct 20 23:30:18 2020 +0000
@@ -317,7 +317,8 @@
     return mEMEPDM->Supports(aParams, aDiagnostics);
   }
   if (VPXDecoder::IsVPX(aParams.MimeType(),
-                        VPXDecoder::VP8 | VPXDecoder::VP9)) {
+                        VPXDecoder::VP8 | VPXDecoder::VP9) &&
+      !aParams.mConfig.GetAsVideoInfo()->HasAlpha()) {
     // Work around bug 1521370, where trying to instantiate an external decoder
     // could cause a crash.
     // We always ship a VP8/VP9 decoder (libvpx) and optionally we have ffvpx.