# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/ipc/RemoteVideoDecoder.cpp
# Commit: 57607f8b6d8e
# Full Hash: 57607f8b6d8e1619b5c488494fd57547944c47b1
# Author: Dan Glastonbury <dan.glastonbury@gmail.com>
# Date: 2020-10-21 09:51:28
# Regressor Bug: 1595994
# File Overlap Count: 1
# Description:
#   Bug 1595994 - P7: Add Supports messages to PRemoteDecoderManager. r=kamidphish,nika,ipc-reviewers
#   
#   Add a synchronous Supports message to the IPDL PRemoteDecoderManager protocol so
#   decoder modules can query for playback support in the actual process that will
#   attempt to do the decoding.
# ==============================================================================

diff -r 1932f2f34993 -r 57607f8b6d8e dom/media/ipc/RemoteVideoDecoder.cpp
--- a/dom/media/ipc/RemoteVideoDecoder.cpp	Tue Oct 20 23:26:25 2020 +0000
+++ b/dom/media/ipc/RemoteVideoDecoder.cpp	Tue Oct 20 23:26:27 2020 +0000
@@ -33,41 +33,33 @@
 using namespace ipc;
 using namespace gfx;
 
-class KnowsCompositorVideo : public layers::KnowsCompositor {
- public:
-  NS_INLINE_DECL_THREADSAFE_REFCOUNTING(KnowsCompositorVideo, override)
+layers::TextureForwarder* KnowsCompositorVideo::GetTextureForwarder() {
+  auto* vbc = VideoBridgeChild::GetSingleton();
+  return (vbc && vbc->CanSend()) ? vbc : nullptr;
+}
+layers::LayersIPCActor* KnowsCompositorVideo::GetLayersIPCActor() {
+  return GetTextureForwarder();
+}
 
-  layers::TextureForwarder* GetTextureForwarder() override {
-    auto* vbc = VideoBridgeChild::GetSingleton();
-    return (vbc && vbc->CanSend()) ? vbc : nullptr;
-  }
-  layers::LayersIPCActor* GetLayersIPCActor() override {
-    return GetTextureForwarder();
+/* static */ already_AddRefed<KnowsCompositorVideo>
+KnowsCompositorVideo::TryCreateForIdentifier(
+    const layers::TextureFactoryIdentifier& aIdentifier) {
+  VideoBridgeChild* child = VideoBridgeChild::GetSingleton();
+  if (!child) {
+    return nullptr;
   }
 
-  static already_AddRefed<KnowsCompositorVideo> TryCreateForIdentifier(
-      const layers::TextureFactoryIdentifier& aIdentifier) {
-    VideoBridgeChild* child = VideoBridgeChild::GetSingleton();
-    if (!child) {
-      return nullptr;
-    }
-
-    // The RDD process will never use hardware decoding since it's
-    // sandboxed, so don't bother trying to create a sync object.
-    TextureFactoryIdentifier ident = aIdentifier;
-    if (XRE_IsRDDProcess()) {
-      ident.mSyncHandle = 0;
-    }
-
-    RefPtr<KnowsCompositorVideo> knowsCompositor = new KnowsCompositorVideo();
-    knowsCompositor->IdentifyTextureHost(ident);
-    return knowsCompositor.forget();
+  // The RDD process will never use hardware decoding since it's
+  // sandboxed, so don't bother trying to create a sync object.
+  TextureFactoryIdentifier ident = aIdentifier;
+  if (XRE_IsRDDProcess()) {
+    ident.mSyncHandle = 0;
   }
 
- private:
-  KnowsCompositorVideo() = default;
-  virtual ~KnowsCompositorVideo() = default;
-};
+  RefPtr<KnowsCompositorVideo> knowsCompositor = new KnowsCompositorVideo();
+  knowsCompositor->IdentifyTextureHost(ident);
+  return knowsCompositor.forget();
+}
 
 RemoteVideoDecoderChild::RemoteVideoDecoderChild(RemoteDecodeIn aLocation)
     : RemoteDecoderChild(aLocation == RemoteDecodeIn::GpuProcess),