# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/ipc/RemoteDecoderManagerParent.h
# Commit: 9e0809ed54cd
# Full Hash: 9e0809ed54cd2da0e3ebbb0bb143f85bb6ad6b14
# Author: Dan Glastonbury <dan.glastonbury@gmail.com>
# Date: 2020-10-21 09:51:28
# Regressor Bug: 1595994
# File Overlap Count: 1
# Description:
#   Bug 1595994 - P4: Use PDMFactory to create decoders in RDD & GPU process. r=kamidphish
#   
#   Depends on D54876
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D54875
# ==============================================================================

diff -r e3f920da2232 -r 9e0809ed54cd dom/media/ipc/RemoteDecoderManagerParent.h
--- a/dom/media/ipc/RemoteDecoderManagerParent.h	Tue Oct 20 23:24:27 2020 +0000
+++ b/dom/media/ipc/RemoteDecoderManagerParent.h	Tue Oct 20 23:24:40 2020 +0000
@@ -12,7 +12,7 @@
 
 namespace mozilla {
 
-class RemoteDecoderManagerThreadHolder;
+class PDMFactory;
 
 class RemoteDecoderManagerParent final
     : public PRemoteDecoderManagerParent,
@@ -50,6 +50,9 @@
 
   bool OnManagerThread();
 
+  // Can be called from manager thread only
+  PDMFactory& EnsurePDMFactory();
+
  protected:
   PRemoteDecoderParent* AllocPRemoteDecoderParent(
       const RemoteDecoderInfoIPDL& aRemoteDecoderInfo,
@@ -76,6 +79,7 @@
   std::map<uint64_t, RefPtr<layers::TextureClient>> mTextureMap;
 
   nsCOMPtr<nsISerialEventTarget> mThread;
+  RefPtr<PDMFactory> mPDMFactory;
 };
 
 }  // namespace mozilla