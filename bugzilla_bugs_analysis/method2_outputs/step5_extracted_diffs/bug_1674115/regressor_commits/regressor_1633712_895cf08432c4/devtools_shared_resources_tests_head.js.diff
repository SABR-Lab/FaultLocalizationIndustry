# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: devtools/shared/resources/tests/head.js
# Commit: 895cf08432c4
# Full Hash: 895cf08432c40fe371ff83e846cb161430c6be4b
# Author: Nicolas Chevobbe <nchevobbe@mozilla.com>
# Date: 2020-10-27 04:41:26
# Regressor Bug: 1633712
# File Overlap Count: 1
# Description:
#   Bug 1633712 - [devtools] Create WorkerTargets as soon as possible. r=ochameau,devtools-backward-compat-reviewers.
#   
#   This patch adds support for dedicated worker targets in the Watcher actor.
#   Shared and Service workers are not handled yet.
#   
# ==============================================================================

diff -r 2ce79a9ed2d5 -r 895cf08432c4 devtools/shared/resources/tests/head.js
--- a/devtools/shared/resources/tests/head.js	Mon Oct 26 12:52:26 2020 +0000
+++ b/devtools/shared/resources/tests/head.js	Mon Oct 26 12:53:43 2020 +0000
@@ -28,7 +28,11 @@
   return client;
 }
 
-async function _initResourceWatcherFromDescriptor(client, descriptor) {
+async function _initResourceWatcherFromDescriptor(
+  client,
+  descriptor,
+  { listenForWorkers = false } = {}
+) {
   const { TargetList } = require("devtools/shared/resources/target-list");
   const {
     ResourceWatcher,
@@ -36,6 +40,9 @@
 
   const target = await descriptor.getTarget();
   const targetList = new TargetList(client.mainRoot, target);
+  if (listenForWorkers) {
+    targetList.listenForWorkers = true;
+  }
   await targetList.startListening();
 
   // Now create a ResourceWatcher
@@ -49,6 +56,8 @@
  *
  * @param {Tab} tab
  *        The browser frontend's tab to connect to.
+ * @param {Object} options
+ * @param {Boolean} options.listenForWorkers
  * @return {Object} object
  * @return {ResourceWatcher} object.client
  *         The underlying client instance.
@@ -57,10 +66,10 @@
  * @return {DevToolsClient} object.targetList
  *         The underlying target list instance.
  */
-async function initResourceWatcher(tab) {
+async function initResourceWatcher(tab, options) {
   const client = await createLocalClient();
   const descriptor = await client.mainRoot.getTab({ tab });
-  return _initResourceWatcherFromDescriptor(client, descriptor);
+  return _initResourceWatcherFromDescriptor(client, descriptor, options);
 }
 
 /**