# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/layers/apz/src/APZCTreeManager.cpp
# Commit: 5e275c31e9f4
# Full Hash: 5e275c31e9f42def8437d7c8a87cf4cf7aabf0c6
# Author: Hiroyuki Ikezoe <hikezoe.birchill@mozilla.com>
# Date: 2020-11-11 09:55:06
# Regressor Bug: 1674694
# File Overlap Count: 1
# Description:
#   Bug 1674694 - Change APZEventResult::mHandledByRootApzc to Maybe<APZHandledResult>. r=botond
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D96331
# ==============================================================================

diff -r 279eb8cf0dcd -r 5e275c31e9f4 gfx/layers/apz/src/APZCTreeManager.cpp
--- a/gfx/layers/apz/src/APZCTreeManager.cpp	Sat Nov 07 03:43:53 2020 +0000
+++ b/gfx/layers/apz/src/APZCTreeManager.cpp	Wed Nov 11 00:33:20 2020 +0000
@@ -1549,7 +1549,7 @@
 
         // Update the out-parameters so they are what the caller expects.
         hit.mTargetApzc->GetGuid(&result.mTargetGuid);
-        result.mHandledByRootApzc = hit.HandledByRoot();
+        result.mHandledResult = hit.HandledByRoot();
 
         if (!hitScrollbar) {
           // The input was not targeted at a scrollbar, so we untransform it
@@ -1636,7 +1636,7 @@
 
         // Update the out-parameters so they are what the caller expects.
         hit.mTargetApzc->GetGuid(&result.mTargetGuid);
-        result.mHandledByRootApzc = hit.HandledByRoot();
+        result.mHandledResult = hit.HandledByRoot();
         wheelInput.mOrigin = *untransformedOrigin;
       }
       break;
@@ -1695,7 +1695,7 @@
 
         // Update the out-parameters so they are what the caller expects.
         hit.mTargetApzc->GetGuid(&result.mTargetGuid);
-        result.mHandledByRootApzc = hit.HandledByRoot();
+        result.mHandledResult = hit.HandledByRoot();
         panInput.mPanStartPoint = *untransformedStartPoint;
         panInput.mPanDisplacement = *untransformedDisplacement;
 
@@ -1744,7 +1744,7 @@
 
         // Update the out-parameters so they are what the caller expects.
         hit.mTargetApzc->GetGuid(&result.mTargetGuid);
-        result.mHandledByRootApzc = hit.HandledByRoot();
+        result.mHandledResult = hit.HandledByRoot();
         pinchInput.mFocusPoint = *untransformedFocusPoint;
       }
       break;
@@ -1774,7 +1774,7 @@
 
         // Update the out-parameters so they are what the caller expects.
         hit.mTargetApzc->GetGuid(&result.mTargetGuid);
-        result.mHandledByRootApzc = hit.HandledByRoot();
+        result.mHandledResult = hit.HandledByRoot();
         tapInput.mPoint = *untransformedPoint;
       }
       break;
@@ -2045,11 +2045,11 @@
                  CompositorHitTestInvisibleToHit);
 
       mTouchBlockHitResult.mTargetApzc->GetGuid(&result.mTargetGuid);
-      result.mHandledByRootApzc = mTouchBlockHitResult.HandledByRoot();
+      result.mHandledResult = mTouchBlockHitResult.HandledByRoot();
       result.mStatus = mInputQueue->ReceiveInputEvent(
           mTouchBlockHitResult.mTargetApzc,
           TargetConfirmationFlags{mTouchBlockHitResult.mHitResult}, aInput,
-          &result.mInputBlockId, &result.mHandledByRootApzc,
+          &result.mInputBlockId, &result.mHandledResult,
           touchBehaviors.IsEmpty() ? Nothing()
                                    : Some(std::move(touchBehaviors)));
 
@@ -2146,7 +2146,7 @@
   }
 
   mTouchBlockHitResult.mTargetApzc->GetGuid(&result.mTargetGuid);
-  result.mHandledByRootApzc = mTouchBlockHitResult.HandledByRoot();
+  result.mHandledResult = mTouchBlockHitResult.HandledByRoot();
 
   // Since the input was targeted at a scrollbar:
   //    - The original touch event (which will be sent on to content) will
@@ -3961,16 +3961,16 @@
   mStickyScrollRangeOuter = aNode->GetStickyScrollRangeOuter();
 }
 
-Maybe<bool> APZCTreeManager::HitTestResult::HandledByRoot() const {
+Maybe<APZHandledResult> APZCTreeManager::HitTestResult::HandledByRoot() const {
   if (!mTargetApzc->IsRootContent()) {
     // If the initial target is not the root, this will definitely not be
     // handled by the root. (The confirmed target is either the initial
     // target, or a descendant.)
-    return Some(false);
+    return Some(APZHandledResult::HandledByContent);
   } else if ((mHitResult & CompositorHitTestDispatchToContent).isEmpty()) {
     // If the initial target is the root and we don't need to dispatch to
     // content, the event will definitely be handled by the root.
-    return Some(true);
+    return Some(APZHandledResult::HandledByRoot);
   }
   // Otherwise, we're not sure.
   return Nothing();