# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/gamepad/Gamepad.h
# Commit: ec6a64b639a8
# Full Hash: ec6a64b639a82e957376c09a71aef7ce62b3a5aa
# Author: Chris Martin <cmartin@mozilla.com>
# Date: 2020-12-03 09:47:26
# Regressor Bug: 1657404
# File Overlap Count: 1
# Description:
#   Bug 1657404 - Implement a strongly-typed, service-dependent gamepad handle r=handyman,aklotz
#   
#   Currently, the gamepad code uses a uint32_t as a handle and does some trickery
#   with it by trying to create a unique ID and adding an offset to it for VR code.
#   
# ==============================================================================

diff -r 6792f28b99bd -r ec6a64b639a8 dom/gamepad/Gamepad.h
--- a/dom/gamepad/Gamepad.h	Wed Dec 02 22:36:35 2020 +0000
+++ b/dom/gamepad/Gamepad.h	Wed Dec 02 23:06:05 2020 +0000
@@ -9,6 +9,7 @@
 
 #include "mozilla/dom/GamepadBinding.h"
 #include "mozilla/dom/GamepadButton.h"
+#include "mozilla/dom/GamepadHandle.h"
 #include "mozilla/dom/GamepadPose.h"
 #include "mozilla/dom/GamepadHapticActuator.h"
 #include "mozilla/dom/GamepadLightIndicator.h"
@@ -40,7 +41,7 @@
 class Gamepad final : public nsISupports, public nsWrapperCache {
  public:
   Gamepad(nsISupports* aParent, const nsAString& aID, int32_t aIndex,
-          uint32_t aHashKey, GamepadMappingType aMapping, GamepadHand aHand,
+          GamepadHandle aHandle, GamepadMappingType aMapping, GamepadHand aHand,
           uint32_t aDisplayID, uint32_t aNumButtons, uint32_t aNumAxes,
           uint32_t aNumHaptics, uint32_t aNumLightIndicator,
           uint32_t aNumTouchEvents);
@@ -84,8 +85,6 @@
 
   int32_t Index() const { return mIndex; }
 
-  uint32_t HashKey() const { return mHashKey; }
-
   void GetButtons(nsTArray<RefPtr<GamepadButton>>& aButtons) const {
     aButtons = mButtons.Clone();
   }
@@ -108,6 +107,8 @@
     aTouchEvents = mTouchEvents.Clone();
   }
 
+  GamepadHandle GetHandle() const { return mHandle; }
+
  private:
   virtual ~Gamepad() = default;
   void UpdateTimestamp();
@@ -117,7 +118,7 @@
   nsString mID;
   int32_t mIndex;
   // the gamepad hash key in GamepadManager
-  uint32_t mHashKey;
+  GamepadHandle mHandle;
   uint32_t mDisplayId;
   uint32_t mTouchIdHashValue;
   // The mapping in use.