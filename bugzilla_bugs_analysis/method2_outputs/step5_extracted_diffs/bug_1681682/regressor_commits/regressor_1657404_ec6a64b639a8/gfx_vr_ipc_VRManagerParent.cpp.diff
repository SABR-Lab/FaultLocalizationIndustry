# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/vr/ipc/VRManagerParent.cpp
# Commit: ec6a64b639a8
# Full Hash: ec6a64b639a82e957376c09a71aef7ce62b3a5aa
# Author: Chris Martin <cmartin@mozilla.com>
# Date: 2020-12-03 09:47:26
# Regressor Bug: 1657404
# File Overlap Count: 1
# Description:
#   Bug 1657404 - Implement a strongly-typed, service-dependent gamepad handle r=handyman,aklotz
#   
#   Currently, the gamepad code uses a uint32_t as a handle and does some trickery
#   with it by trying to create a unique ID and adding an offset to it for VR code.
#   
# ==============================================================================

diff -r 6792f28b99bd -r ec6a64b639a8 gfx/vr/ipc/VRManagerParent.cpp
--- a/gfx/vr/ipc/VRManagerParent.cpp	Wed Dec 02 22:36:35 2020 +0000
+++ b/gfx/vr/ipc/VRManagerParent.cpp	Wed Dec 02 23:06:05 2020 +0000
@@ -16,6 +16,8 @@
 #include "VRManager.h"
 #include "VRThread.h"
 
+using mozilla::dom::GamepadHandle;
+
 namespace mozilla {
 using namespace layers;
 namespace gfx {
@@ -240,21 +242,21 @@
 }
 
 mozilla::ipc::IPCResult VRManagerParent::RecvVibrateHaptic(
-    const uint32_t& aControllerIdx, const uint32_t& aHapticIndex,
-    const double& aIntensity, const double& aDuration,
-    const uint32_t& aPromiseID) {
+    const mozilla::dom::GamepadHandle& aGamepadHandle,
+    const uint32_t& aHapticIndex, const double& aIntensity,
+    const double& aDuration, const uint32_t& aPromiseID) {
   VRManager* vm = VRManager::Get();
   VRManagerPromise promise(this, aPromiseID);
 
-  vm->VibrateHaptic(aControllerIdx, aHapticIndex, aIntensity, aDuration,
+  vm->VibrateHaptic(aGamepadHandle, aHapticIndex, aIntensity, aDuration,
                     promise);
   return IPC_OK();
 }
 
 mozilla::ipc::IPCResult VRManagerParent::RecvStopVibrateHaptic(
-    const uint32_t& aControllerIdx) {
+    const mozilla::dom::GamepadHandle& aGamepadHandle) {
   VRManager* vm = VRManager::Get();
-  vm->StopVibrateHaptic(aControllerIdx);
+  vm->StopVibrateHaptic(aGamepadHandle);
   return IPC_OK();
 }
 