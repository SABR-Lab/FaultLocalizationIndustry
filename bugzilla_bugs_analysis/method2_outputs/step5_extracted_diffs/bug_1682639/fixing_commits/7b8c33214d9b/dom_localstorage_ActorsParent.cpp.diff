# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/localstorage/ActorsParent.cpp
# Commit: 7b8c33214d9b
# Full Hash: 7b8c33214d9bd49162cb72536b57e7501433e015
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2020-12-17 21:49:27
# Description:
#   Bug 1682639 - Fix diagnostic assertion failure in PrepareDatastoreOp::DatabaseWork. r=janv,dom-workers-and-storage-reviewers
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D100002
# ==============================================================================

diff -r fe225435be7c -r 7b8c33214d9b dom/localstorage/ActorsParent.cpp
--- a/dom/localstorage/ActorsParent.cpp	Thu Dec 17 12:38:04 2020 +0200
+++ b/dom/localstorage/ActorsParent.cpp	Thu Dec 17 10:44:29 2020 +0000
@@ -7369,7 +7369,7 @@
     MOZ_ASSERT(hasUsage);
 
     // XXX Change type of mUsage to UsageInfo or DatabaseUsageType.
-    mUsage = usageInfo.DatabaseUsage().value();
+    mUsage = usageInfo.DatabaseUsage().valueOr(0);
   } else {
     // The database doesn't exist.
     MOZ_ASSERT(!hasUsage);
