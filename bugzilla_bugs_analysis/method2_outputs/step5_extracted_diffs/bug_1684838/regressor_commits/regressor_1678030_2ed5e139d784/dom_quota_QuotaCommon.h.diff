# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/quota/QuotaCommon.h
# Commit: 2ed5e139d784
# Full Hash: 2ed5e139d7840692dad5bcf39348e92bf3b05fdb
# Author: Simon Giesecke <sgiesecke@mozilla.com>
# Date: 2020-12-05 09:38:58
# Regressor Bug: 1678030
# File Overlap Count: 1
# Description:
#   Bug 1678030 - Move CreateAndExecuteSingleStepStatement to QuotaCommon and use in all quota clients. r=dom-workers-and-storage-reviewers,janv
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D97460
# ==============================================================================

diff -r 80442bbcf255 -r 2ed5e139d784 dom/quota/QuotaCommon.h
--- a/dom/quota/QuotaCommon.h	Fri Dec 04 15:08:17 2020 +0000
+++ b/dom/quota/QuotaCommon.h	Fri Dec 04 14:56:18 2020 +0000
@@ -738,6 +738,8 @@
 #  define RETURN_STATUS_OR_RESULT(_status, _rv) return _rv
 #endif
 
+class mozIStorageConnection;
+class mozIStorageStatement;
 class nsIFile;
 
 namespace mozilla {
@@ -977,6 +979,13 @@
 Result<nsCOMPtr<nsIFile>, nsresult> CloneFileAndAppend(
     nsIFile& aDirectory, const nsAString& aPathElement);
 
+// Creates a statement with the specified aStatementString, executes a single
+// step, and asserts that it has a result, and returns the statement. Any other
+// errors are propagated.
+Result<nsCOMPtr<mozIStorageStatement>, nsresult>
+CreateAndExecuteSingleStepStatement(mozIStorageConnection& aConnection,
+                                    const nsACString& aStatementString);
+
 void LogError(const nsLiteralCString& aModule, const nsACString& aExpr,
               const nsACString& aSourceFile, int32_t aSourceLine);
 
