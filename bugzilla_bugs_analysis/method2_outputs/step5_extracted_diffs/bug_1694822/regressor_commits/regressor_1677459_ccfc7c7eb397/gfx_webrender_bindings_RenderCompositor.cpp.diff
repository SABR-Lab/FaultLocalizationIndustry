# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/webrender_bindings/RenderCompositor.cpp
# Commit: ccfc7c7eb397
# Full Hash: ccfc7c7eb3973902e2781ca9bbd5cfeaf2d1e264
# Author: sotaro <sotaro.ikeda.g@gmail.com>
# Date: 2021-02-23 23:03:32
# Regressor Bug: 1677459
# File Overlap Count: 1
# Description:
#   Bug 1677459 - Split platform independent part to RenderCompositorCompositorSWGL r=mattwoodrow
#   
#   The change is a preparation of Bug 1673342
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D99046
# ==============================================================================

diff -r 7a2e24377ae3 -r ccfc7c7eb397 gfx/webrender_bindings/RenderCompositor.cpp
--- a/gfx/webrender_bindings/RenderCompositor.cpp	Tue Feb 23 08:46:42 2021 +0000
+++ b/gfx/webrender_bindings/RenderCompositor.cpp	Tue Feb 23 08:57:27 2021 +0000
@@ -13,13 +13,13 @@
 #include "mozilla/gfx/Logging.h"
 #include "mozilla/gfx/gfxVars.h"
 #include "mozilla/layers/SyncObject.h"
+#include "mozilla/webrender/RenderCompositorLayersSWGL.h"
 #include "mozilla/webrender/RenderCompositorOGL.h"
 #include "mozilla/webrender/RenderCompositorSWGL.h"
 #include "mozilla/widget/CompositorWidget.h"
 
 #ifdef XP_WIN
 #  include "mozilla/webrender/RenderCompositorANGLE.h"
-#  include "mozilla/webrender/RenderCompositorD3D11SWGL.h"
 #endif
 
 #if defined(MOZ_WAYLAND) || defined(MOZ_WIDGET_ANDROID)
@@ -155,16 +155,12 @@
     if (!gfxPlatform::IsHeadless()) {
       return RenderCompositorNativeSWGL::Create(std::move(aWidget), aError);
     }
-#elif defined(XP_WIN)
-    if (StaticPrefs::gfx_webrender_software_d3d11_AtStartup() &&
-        gfx::gfxConfig::IsEnabled(gfx::Feature::D3D11_COMPOSITING)) {
-      UniquePtr<RenderCompositor> comp =
-          RenderCompositorD3D11SWGL::Create(std::move(aWidget), aError);
-      if (comp) {
-        return comp;
-      }
+#endif
+    UniquePtr<RenderCompositor> comp =
+        RenderCompositorLayersSWGL::Create(std::move(aWidget), aError);
+    if (comp) {
+      return comp;
     }
-#endif
     return RenderCompositorSWGL::Create(std::move(aWidget), aError);
   }
 