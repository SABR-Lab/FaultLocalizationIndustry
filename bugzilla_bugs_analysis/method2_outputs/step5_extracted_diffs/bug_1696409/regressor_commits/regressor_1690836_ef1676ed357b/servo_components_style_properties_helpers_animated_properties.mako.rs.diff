# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/components/style/properties/helpers/animated_properties.mako.rs
# Commit: ef1676ed357b
# Full Hash: ef1676ed357b4434d17a71e40e0b04753bdbff0b
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2021-02-17 09:45:59
# Regressor Bug: 1690836
# File Overlap Count: 1
# Description:
#   Bug 1690836 - Cache substituted values from shorthand properties during the cascade. r=xidorn
#   
#   This brings the time down to 1.6ms from 4.8ms on the test-case in the
#   bug. This should be improvable too, but I think this is a nice
#   improvement for regular styling as well.
# ==============================================================================

diff -r be5f469a4424 -r ef1676ed357b servo/components/style/properties/helpers/animated_properties.mako.rs
--- a/servo/components/style/properties/helpers/animated_properties.mako.rs	Wed Feb 17 00:21:35 2021 +0000
+++ b/servo/components/style/properties/helpers/animated_properties.mako.rs	Wed Feb 17 00:21:36 2021 +0000
@@ -367,6 +367,7 @@
                 }
             },
             PropertyDeclaration::WithVariables(ref declaration) => {
+                let mut cache = Default::default();
                 let substituted = {
                     let custom_properties =
                         extra_custom_properties.or_else(|| context.style().custom_properties());
@@ -376,6 +377,7 @@
                         custom_properties,
                         context.quirks_mode,
                         context.device(),
+                        &mut cache,
                     )
                 };
                 return AnimationValue::from_declaration(