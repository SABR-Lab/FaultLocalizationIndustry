# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/layers/NativeLayerCA.mm
# Commit: 79a02e8fc876
# Full Hash: 79a02e8fc876666721aa7d31c889385ff16cf349
# Author: Brad Werth <bwerth@mozilla.com>
# Date: 2021-05-13 09:33:03
# Description:
#   Bug 1707832: Ensure that SurfacePoolCA doesn't store or give out null recycled surfaces. r=mstange
#   
#   The general contract of a SurfacePoolEntry is that mIOSurface should be
#   non-null, but this isn't asserted. This patch adds release asserts to ensure
#   that these surfaces are non-null at the time they are stored and released. It
# ==============================================================================

diff -r a411cd917786 -r 79a02e8fc876 gfx/layers/NativeLayerCA.mm
--- a/gfx/layers/NativeLayerCA.mm	Wed May 12 21:45:18 2021 +0000
+++ b/gfx/layers/NativeLayerCA.mm	Wed May 12 22:38:52 2021 +0000
@@ -644,7 +644,6 @@
     surf = Some(SurfaceWithInvalidRegion{newSurf, IntRect({}, mSize)});
   }
 
-  MOZ_RELEASE_ASSERT(surf);
   mInProgressSurface = std::move(surf);
   IOSurfaceIncrementUseCount(mInProgressSurface->mSurface.get());
   return true;