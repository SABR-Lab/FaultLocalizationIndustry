# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: docshell/shistory/ChildSHistory.cpp
# Commit: ab54092b8afc
# Full Hash: ab54092b8afc8e56dd3f8162344a4ce38ec45999
# Author: Niklas Goegge <ngogge@mozilla.com>
# Date: 2021-04-29 09:26:05
# Regressor Bug: 1708150
# File Overlap Count: 1
# Description:
#   Bug 1708150 - Add user activation flag to reload, goBack and goForward r=ckerschb,Gijs,smaug
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D110245
# ==============================================================================

diff -r a9a52f01de13 -r ab54092b8afc docshell/shistory/ChildSHistory.cpp
--- a/docshell/shistory/ChildSHistory.cpp	Wed Apr 28 11:09:38 2021 +0000
+++ b/docshell/shistory/ChildSHistory.cpp	Wed Apr 28 11:26:49 2021 +0000
@@ -125,7 +125,7 @@
 }
 
 void ChildSHistory::Go(int32_t aOffset, bool aRequireUserInteraction,
-                       ErrorResult& aRv) {
+                       bool aUserActivation, ErrorResult& aRv) {
   CheckedInt<int32_t> index = Index();
   MOZ_LOG(
       gSHLog, LogLevel::Debug,
@@ -156,11 +156,13 @@
     }
   }
 
-  GotoIndex(index.value(), aOffset, aRequireUserInteraction, aRv);
+  GotoIndex(index.value(), aOffset, aRequireUserInteraction, aUserActivation,
+            aRv);
 }
 
 void ChildSHistory::AsyncGo(int32_t aOffset, bool aRequireUserInteraction,
-                            CallerType aCallerType, ErrorResult& aRv) {
+                            bool aUserActivation, CallerType aCallerType,
+                            ErrorResult& aRv) {
   CheckedInt<int32_t> index = Index();
   MOZ_LOG(gSHLog, LogLevel::Debug,
           ("ChildSHistory::AsyncGo(%d), current index = %d", aOffset,
@@ -173,13 +175,15 @@
   }
 
   RefPtr<PendingAsyncHistoryNavigation> asyncNav =
-      new PendingAsyncHistoryNavigation(this, aOffset, aRequireUserInteraction);
+      new PendingAsyncHistoryNavigation(this, aOffset, aRequireUserInteraction,
+                                        aUserActivation);
   mPendingNavigations.insertBack(asyncNav);
   NS_DispatchToCurrentThread(asyncNav.forget());
 }
 
 void ChildSHistory::GotoIndex(int32_t aIndex, int32_t aOffset,
-                              bool aRequireUserInteraction, ErrorResult& aRv) {
+                              bool aRequireUserInteraction,
+                              bool aUserActivation, ErrorResult& aRv) {
   MOZ_LOG(gSHLog, LogLevel::Debug,
           ("ChildSHistory::GotoIndex(%d, %d), epoch %" PRIu64, aIndex, aOffset,
            mHistoryEpoch));
@@ -196,7 +200,7 @@
 
     nsCOMPtr<nsISHistory> shistory = mHistory;
     mBrowsingContext->HistoryGo(
-        aOffset, mHistoryEpoch, aRequireUserInteraction,
+        aOffset, mHistoryEpoch, aRequireUserInteraction, aUserActivation,
         [shistory](int32_t&& aRequestedIndex) {
           // FIXME Should probably only do this for non-fission.
           if (shistory) {
@@ -204,7 +208,7 @@
           }
         });
   } else {
-    aRv = mHistory->GotoIndex(aIndex);
+    aRv = mHistory->GotoIndex(aIndex, aUserActivation);
   }
 }
 