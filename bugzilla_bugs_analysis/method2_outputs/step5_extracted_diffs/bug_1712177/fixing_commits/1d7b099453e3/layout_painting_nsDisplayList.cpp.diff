# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/painting/nsDisplayList.cpp
# Commit: 1d7b099453e3
# Full Hash: 1d7b099453e3b7863650db0d28065571fe320775
# Author: Matt Woodrow <mwoodrow@mozilla.com>
# Date: 2021-05-31 09:54:24
# Description:
#   Bug 1712177 - Handle allocation failure of temporary DrawTarget used for painting blend mode. r=jrmuizel
#   
#   Depends on D116053
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D116054
# ==============================================================================

diff -r fce39bf3b222 -r 1d7b099453e3 layout/painting/nsDisplayList.cpp
--- a/layout/painting/nsDisplayList.cpp	Sun May 30 22:48:07 2021 +0000
+++ b/layout/painting/nsDisplayList.cpp	Mon May 31 02:07:03 2021 +0000
@@ -6222,6 +6222,10 @@
 
   RefPtr<DrawTarget> dt = aCtx->GetDrawTarget()->CreateSimilarDrawTarget(
       rect.Size(), SurfaceFormat::B8G8R8A8);
+  if (!dt) {
+    return;
+  }
+
   dt->SetTransform(Matrix::Translation(-rect.x, -rect.y));
   RefPtr<gfxContext> ctx = gfxContext::CreatePreservingTransformOrNull(dt);
 
