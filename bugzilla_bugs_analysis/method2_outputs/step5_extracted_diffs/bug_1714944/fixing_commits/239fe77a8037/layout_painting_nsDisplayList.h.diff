# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/painting/nsDisplayList.h
# Commit: 239fe77a8037
# Full Hash: 239fe77a80378f1d6c6fd933ba3fed07acba29c9
# Author: Matt Woodrow <mwoodrow@mozilla.com>
# Date: 2021-06-23 09:53:24
# Description:
#   Bug 1714944 - Flatten away wrapper items while collecting 3D transform leaves. r=miko
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D117491
# ==============================================================================

diff -r 9fcef28e4d90 -r 239fe77a8037 layout/painting/nsDisplayList.h
--- a/layout/painting/nsDisplayList.h	Tue Jun 22 21:19:43 2021 +0000
+++ b/layout/painting/nsDisplayList.h	Tue Jun 22 21:20:15 2021 +0000
@@ -7086,7 +7086,8 @@
       TransformReferenceBox& aRefBox, const nsPoint& aOrigin,
       float aAppUnitsPerPixel, uint32_t aFlags);
 
-  void Collect3DTransformLeaves(nsTArray<nsDisplayTransform*>& aLeaves);
+  void Collect3DTransformLeaves(nsDisplayListBuilder* aBuilder,
+                                nsTArray<nsDisplayTransform*>& aLeaves);
   using TransformPolygon = mozilla::layers::BSPPolygon<nsDisplayTransform>;
   void CollectSorted3DTransformLeaves(nsDisplayListBuilder* aBuilder,
                                       nsTArray<TransformPolygon>& aLeaves);
@@ -7418,7 +7419,9 @@
   virtual bool HasNext() const { return mNext || !mStack.IsEmpty(); }
 
   nsDisplayItem* GetNextItem() {
-    MOZ_ASSERT(mNext);
+    if (!mNext) {
+      return nullptr;
+    }
 
     nsDisplayItem* next = mNext;
     mNext = next->GetAbove();
