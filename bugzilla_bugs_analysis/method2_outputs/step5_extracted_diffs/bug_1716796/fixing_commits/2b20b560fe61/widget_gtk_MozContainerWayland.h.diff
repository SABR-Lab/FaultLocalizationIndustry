# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: widget/gtk/MozContainerWayland.h
# Commit: 2b20b560fe61
# Full Hash: 2b20b560fe614c26fe779367c3323addaa55122a
# Author: stransky <stransky@redhat.com>
# Date: 2021-06-20 09:32:48
# Description:
#   Bug 1716796 [Wayland] Poll mozcontainer remap state, r=rmader
#   
#   - Poll mozcontainer remap state by moz_container_wayland_remapped()
#   - Remove WindowSurface::Reset()
#   - Remove moz_container_wayland_set_window_surface() as it adds extra ref at WindowSurface() and causes cyclic dependency.
# ==============================================================================

diff -r 668013f3e201 -r 2b20b560fe61 widget/gtk/MozContainerWayland.h
--- a/widget/gtk/MozContainerWayland.h	Sat Jun 19 07:06:41 2021 +0300
+++ b/widget/gtk/MozContainerWayland.h	Sat Jun 19 09:33:19 2021 +0000
@@ -45,8 +45,8 @@
   gboolean surface_needs_clear;
   gboolean ready_to_draw;
   gboolean before_first_size_alloc;
+  gboolean container_remapped;
   int buffer_scale;
-  RefPtr<mozilla::widget::WindowSurface> window_surface;
   std::vector<std::function<void(void)>> initial_draw_cbs;
   // mozcontainer is used from Compositor and Rendering threads
   // so we need to control access to mozcontainer where wayland internals
@@ -82,7 +82,6 @@
 gboolean moz_container_wayland_can_draw(MozContainer* container);
 double moz_container_wayland_get_scale(MozContainer* container);
 struct wp_viewport* moz_container_wayland_get_viewport(MozContainer* container);
-void moz_container_wayland_set_window_surface(
-    MozContainer* container,
-    RefPtr<mozilla::widget::WindowSurface> window_surface);
+gboolean moz_container_wayland_get_and_reset_remapped(MozContainer* container);
+
 #endif /* __MOZ_CONTAINER_WAYLAND_H__ */