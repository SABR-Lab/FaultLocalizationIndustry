# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/webrender_bindings/RenderCompositorNative.cpp
# Commit: 283bfe656d3a
# Full Hash: 283bfe656d3aaae4f5e1af23bcbf5b41d41fdb6f
# Author: Markus Stange <mstange.moz@gmail.com>
# Date: 2021-07-16 21:43:02
# Description:
#   Bug 1717889 - Make sure we don't call NextSurfaceAsFramebuffer on zero-sized native layers. r=mkaply
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D119676
# ==============================================================================

diff -r 1901ae10c819 -r 283bfe656d3a gfx/webrender_bindings/RenderCompositorNative.cpp
--- a/gfx/webrender_bindings/RenderCompositorNative.cpp	Fri Jul 16 15:04:58 2021 +0000
+++ b/gfx/webrender_bindings/RenderCompositorNative.cpp	Fri Jul 16 15:20:17 2021 +0000
@@ -52,6 +52,9 @@
 
   gfx::IntSize bufferSize = GetBufferSize().ToUnknownSize();
   if (!ShouldUseNativeCompositor()) {
+    if (bufferSize.IsEmpty()) {
+      return false;
+    }
     if (mNativeLayerForEntireWindow &&
         mNativeLayerForEntireWindow->GetSize() != bufferSize) {
       mNativeLayerRoot->RemoveLayer(mNativeLayerForEntireWindow);
