# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: ipc/chromium/src/chrome/common/ipc_channel.h
# Commit: 115187a5f512
# Full Hash: 115187a5f5120c5fda63685fd8a1471339852735
# Author: Nika Layzell <nika@thelayzells.com>
# Date: 2021-06-26 09:46:54
# Description:
#   Bug 1717993 - Hold a WeakPtr to mExistingListener in NodeChannel, r=handyman
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D118868
# ==============================================================================

diff -r d0b8984194c6 -r 115187a5f512 ipc/chromium/src/chrome/common/ipc_channel.h
--- a/ipc/chromium/src/chrome/common/ipc_channel.h	Fri Jun 25 21:10:50 2021 +0000
+++ b/ipc/chromium/src/chrome/common/ipc_channel.h	Fri Jun 25 21:30:49 2021 +0000
@@ -12,6 +12,7 @@
 #include "base/basictypes.h"
 #include "build/build_config.h"
 #include "mozilla/UniquePtr.h"
+#include "mozilla/WeakPtr.h"
 #include "chrome/common/ipc_message.h"
 
 #ifdef OS_WIN
@@ -40,9 +41,12 @@
 #endif
 
   // Implemented by consumers of a Channel to receive messages.
-  class Listener {
+  //
+  // All listeners will only be called on the IO thread, and must be destroyed
+  // on the IO thread.
+  class Listener : public mozilla::SupportsWeakPtr {
    public:
-    virtual ~Listener() {}
+    virtual ~Listener() = default;
 
     // Called when a message is received.
     virtual void OnMessageReceived(Message&& message) = 0;