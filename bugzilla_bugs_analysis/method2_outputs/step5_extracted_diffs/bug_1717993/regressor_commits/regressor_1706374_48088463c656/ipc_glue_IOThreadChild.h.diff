# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: ipc/glue/IOThreadChild.h
# Commit: 48088463c656
# Full Hash: 48088463c6568b03a3e6a4ca6417dd9b650ced2a
# Author: Nika Layzell <nika@thelayzells.com>
# Date: 2021-06-22 21:29:07
# Regressor Bug: 1706374
# File Overlap Count: 2
# Description:
#   Bug 1706374 - Part 12a: Initialize NodeController when creating IO thread, r=handyman
#   
#   This also consumes the existing channel created when launching a process to
#   create the the conneciton required by NodeController for communicating between
#   processes. In part 12b, consumers of the broken APIs will be adjusted to use
# ==============================================================================

diff -r b09ae4c3a94b -r 48088463c656 ipc/glue/IOThreadChild.h
--- a/ipc/glue/IOThreadChild.h	Mon Jun 21 21:53:10 2021 +0000
+++ b/ipc/glue/IOThreadChild.h	Mon Jun 21 21:53:10 2021 +0000
@@ -8,6 +8,7 @@
 #define dom_plugins_IOThreadChild_h 1
 
 #include "chrome/common/child_thread.h"
+#include "mozilla/ipc/NodeController.h"
 
 namespace mozilla {
 namespace ipc {
@@ -28,8 +29,8 @@
     return IOThreadChild::current()->Thread::message_loop();
   }
 
-  static UniquePtr<IPC::Channel> TakeChannel() {
-    return IOThreadChild::current()->ChildThread::TakeChannel();
+  static ScopedPort TakeInitialPort() {
+    return IOThreadChild::current()->ChildThread::TakeInitialPort();
   }
 
  protected:
