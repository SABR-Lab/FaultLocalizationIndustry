# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/xre/nsAppRunner.cpp
# Commit: 19805fbf94a3
# Full Hash: 19805fbf94a3f5876d7eb8c088f64f1dbf487a2f
# Author: Mike Hommey <mh+mozilla@glandium.org>
# Date: 2021-06-25 21:51:52
# Regressor Bug: 1718131
# File Overlap Count: 1
# Description:
#   Bug 1718131 - Close GdkDisplay in XREMain destructor. r=stransky
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D118753
# ==============================================================================

diff -r dd947fcc5fa8 -r 19805fbf94a3 toolkit/xre/nsAppRunner.cpp
--- a/toolkit/xre/nsAppRunner.cpp	Fri Jun 25 09:25:10 2021 +0000
+++ b/toolkit/xre/nsAppRunner.cpp	Fri Jun 25 09:29:33 2021 +0000
@@ -3383,6 +3383,12 @@
   ~XREMain() {
     mScopedXPCOM = nullptr;
     mAppData = nullptr;
+#if defined(MOZ_WIDGET_GTK)
+    if (mGdkDisplay) {
+      gdk_display_close(mGdkDisplay);
+      mGdkDisplay = nullptr;
+    }
+#endif
   }
 
   int XRE_main(int argc, char* argv[], const BootstrapConfig& aConfig);
