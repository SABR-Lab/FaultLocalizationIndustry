# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/libeditor/HTMLEditorEventListener.cpp
# Commit: 71670cedaf26
# Full Hash: 71670cedaf26214f3bcb8562a445cf1ef24f4db6
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2021-06-30 09:36:48
# Regressor Bug: 1714914
# File Overlap Count: 1
# Description:
#   Bug 1714914 - Make editor classes treat offset in parent node as uint32_t r=m_kato
#   
#   It should be treated as `uint32_t` since DOM API does so.  However, there are
#   some exceptions:
#   
# ==============================================================================

diff -r f5dcc2d793d6 -r 71670cedaf26 editor/libeditor/HTMLEditorEventListener.cpp
--- a/editor/libeditor/HTMLEditorEventListener.cpp	Tue Jun 29 22:00:09 2021 +0000
+++ b/editor/libeditor/HTMLEditorEventListener.cpp	Wed Jun 30 07:07:28 2021 +0000
@@ -326,11 +326,12 @@
   int32_t offset = -1;
   nsCOMPtr<nsIContent> parentContent =
       aMouseEvent.GetRangeParentContentAndOffset(&offset);
-  if (NS_WARN_IF(!parentContent)) {
+  if (NS_WARN_IF(!parentContent) || NS_WARN_IF(offset < 0)) {
     return NS_ERROR_FAILURE;
   }
 
-  if (EditorUtils::IsPointInSelection(*selection, *parentContent, offset)) {
+  if (EditorUtils::IsPointInSelection(*selection, *parentContent,
+                                      AssertedCast<uint32_t>(offset))) {
     return NS_OK;
   }
 
@@ -349,8 +350,8 @@
     NS_WARNING_ASSERTION(NS_SUCCEEDED(rvIgnored),
                          "HTMLEditor::SelectElement() failed, but ignored");
   } else {
-    DebugOnly<nsresult> rvIgnored =
-        selection->CollapseInLimiter(parentContent, offset);
+    DebugOnly<nsresult> rvIgnored = selection->CollapseInLimiter(
+        parentContent, AssertedCast<uint32_t>(offset));
     NS_WARNING_ASSERTION(NS_SUCCEEDED(rvIgnored),
                          "Selection::CollapseInLimiter() failed, but ignored");
   }