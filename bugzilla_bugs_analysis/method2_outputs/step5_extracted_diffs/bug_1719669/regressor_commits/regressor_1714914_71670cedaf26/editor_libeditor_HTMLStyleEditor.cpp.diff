# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/libeditor/HTMLStyleEditor.cpp
# Commit: 71670cedaf26
# Full Hash: 71670cedaf26214f3bcb8562a445cf1ef24f4db6
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2021-06-30 09:36:48
# Regressor Bug: 1714914
# File Overlap Count: 1
# Description:
#   Bug 1714914 - Make editor classes treat offset in parent node as uint32_t r=m_kato
#   
#   It should be treated as `uint32_t` since DOM API does so.  However, there are
#   some exceptions:
#   
# ==============================================================================

diff -r f5dcc2d793d6 -r 71670cedaf26 editor/libeditor/HTMLStyleEditor.cpp
--- a/editor/libeditor/HTMLStyleEditor.cpp	Tue Jun 29 22:00:09 2021 +0000
+++ b/editor/libeditor/HTMLStyleEditor.cpp	Wed Jun 30 07:07:28 2021 +0000
@@ -1536,7 +1536,7 @@
     nsAutoString firstValue, theValue;
 
     nsCOMPtr<nsINode> endNode = range->GetEndContainer();
-    int32_t endOffset = range->EndOffset();
+    uint32_t endOffset = range->EndOffset();
 
     PostContentIterator postOrderIter;
     DebugOnly<nsresult> rvIgnored = postOrderIter.Init(range);
@@ -2365,8 +2365,8 @@
 
 nsresult HTMLEditor::RelativeFontChangeOnTextNode(FontSize aDir,
                                                   Text& aTextNode,
-                                                  int32_t aStartOffset,
-                                                  int32_t aEndOffset) {
+                                                  uint32_t aStartOffset,
+                                                  uint32_t aEndOffset) {
   // Don't need to do anything if no characters actually selected
   if (aStartOffset == aEndOffset) {
     return NS_OK;
@@ -2378,10 +2378,7 @@
     return NS_OK;
   }
 
-  // -1 is a magic value meaning to the end of node
-  if (aEndOffset == -1) {
-    aEndOffset = aTextNode.Length();
-  }
+  aEndOffset = std::min(aTextNode.Length(), aEndOffset);
 
   // Make the range an independent node.
   nsCOMPtr<nsIContent> textNodeForTheRange = &aTextNode;