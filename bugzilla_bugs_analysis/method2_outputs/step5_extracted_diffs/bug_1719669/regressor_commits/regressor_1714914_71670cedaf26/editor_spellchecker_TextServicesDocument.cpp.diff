# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/spellchecker/TextServicesDocument.cpp
# Commit: 71670cedaf26
# Full Hash: 71670cedaf26214f3bcb8562a445cf1ef24f4db6
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2021-06-30 09:36:48
# Regressor Bug: 1714914
# File Overlap Count: 1
# Description:
#   Bug 1714914 - Make editor classes treat offset in parent node as uint32_t r=m_kato
#   
#   It should be treated as `uint32_t` since DOM API does so.  However, there are
#   some exceptions:
#   
# ==============================================================================

diff -r f5dcc2d793d6 -r 71670cedaf26 editor/spellchecker/TextServicesDocument.cpp
--- a/editor/spellchecker/TextServicesDocument.cpp	Tue Jun 29 22:00:09 2021 +0000
+++ b/editor/spellchecker/TextServicesDocument.cpp	Wed Jun 30 07:07:28 2021 +0000
@@ -1189,8 +1189,8 @@
     }
 
     RefPtr<nsINode> node = itEntry->mNode;
-    rv = selection->CollapseInLimiter(node,
-                                      itEntry->mNodeOffset + itEntry->mLength);
+    rv = selection->CollapseInLimiter(
+        node, AssertedCast<uint32_t>(itEntry->mNodeOffset + itEntry->mLength));
 
     if (NS_FAILED(rv)) {
       return rv;
@@ -1758,7 +1758,8 @@
 
   if (!aLength) {
     if (aDoUpdate) {
-      nsresult rv = selection->CollapseInLimiter(startNode, startNodeOffset);
+      nsresult rv = selection->CollapseInLimiter(
+          startNode, AssertedCast<uint32_t>(startNodeOffset));
       if (NS_WARN_IF(NS_FAILED(rv))) {
         return rv;
       }
@@ -1802,7 +1803,8 @@
   }
 
   if (!endNode) {
-    nsresult rv = selection->CollapseInLimiter(startNode, startNodeOffset);
+    nsresult rv = selection->CollapseInLimiter(
+        startNode, AssertedCast<uint32_t>(startNodeOffset));
     NS_WARNING_ASSERTION(NS_SUCCEEDED(rv), "Failed to collapse selection");
     return rv;
   }