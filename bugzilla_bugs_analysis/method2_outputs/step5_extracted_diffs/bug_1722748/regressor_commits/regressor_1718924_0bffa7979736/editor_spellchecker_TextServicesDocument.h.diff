# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/spellchecker/TextServicesDocument.h
# Commit: 0bffa7979736
# Full Hash: 0bffa7979736865a3e660f6d676ac829881d7b01
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2021-07-13 21:42:32
# Regressor Bug: 1718924
# File Overlap Count: 2
# Description:
#   Bug 1718924 - part 13: Move `TextServicesDocument::NodeHasOffsetEntry()` into `OffsetEntryArray` r=m_kato
#   
#   Depends on D119159
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D119160
# ==============================================================================

diff -r 622d9feefc23 -r 0bffa7979736 editor/spellchecker/TextServicesDocument.h
--- a/editor/spellchecker/TextServicesDocument.h	Tue Jul 13 10:19:40 2021 +0000
+++ b/editor/spellchecker/TextServicesDocument.h	Tue Jul 13 10:46:40 2021 +0000
@@ -67,6 +67,11 @@
         nsRange* aIterRange, nsAString* aAllTextInBlock = nullptr);
 
     /**
+     * Returns index of first `OffsetEntry` which manages aTextNode.
+     */
+    Maybe<size_t> FirstIndexOf(const dom::Text& aTextNode) const;
+
+    /**
      * FindWordRange() returns a word range starting from aStartPointToScan
      * in aAllTextInBlock.
      */
@@ -254,8 +259,9 @@
    * spell checker of the editor, edit actions will be notified via
    * nsIEditActionListener (slow path, though).
    */
-  void DidDeleteNode(nsINode* aChild);
-  void DidJoinNodes(nsINode& aLeftNode, nsINode& aRightNode);
+  void DidDeleteContent(const nsIContent& aChildContent);
+  void DidJoinNodes(const nsIContent& aLeftContent,
+                    const nsIContent& aRightContent);
 
  private:
   // TODO: We should get rid of this method since `aAbstractRange` has
@@ -317,10 +323,6 @@
   bool SelectionIsCollapsed() const;
   bool SelectionIsValid() const;
 
-  static nsresult NodeHasOffsetEntry(
-      nsTArray<UniquePtr<OffsetEntry>>* aOffsetTable, nsINode* aNode,
-      bool* aHasEntry, size_t* aEntryIndex);
-
   nsresult RemoveInvalidOffsetEntries();
   nsresult SplitOffsetEntry(size_t aTableIndex, uint32_t aOffsetIntoEntry);
 };
