# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/l10n/tests/mochitest/dom_localization/test_domloc.xhtml
# Commit: 85194e5b7a9e
# Full Hash: 85194e5b7a9e6ed9114ee46aef0b5efb819cca9b
# Author: Zibi Braniecki <zbraniecki@mozilla.com>
# Date: 2021-08-04 03:56:33
# Regressor Bug: 1613705
# File Overlap Count: 1
# Description:
#   Bug 1613705 - [localization] part9: Update DOMLocalization to match Localization constructor. r=nika,emilio
#   
#   Depends on D113691
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D113692
# ==============================================================================

diff -r 181487bdf6c0 -r 85194e5b7a9e dom/l10n/tests/mochitest/dom_localization/test_domloc.xhtml
--- a/dom/l10n/tests/mochitest/dom_localization/test_domloc.xhtml	Tue Aug 03 16:25:13 2021 +0000
+++ b/dom/l10n/tests/mochitest/dom_localization/test_domloc.xhtml	Tue Aug 03 16:25:13 2021 +0000
@@ -10,9 +10,9 @@
   <script src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js" />
   <script type="application/javascript">
   <![CDATA[
-  async function* generateBundles(resourceIds) {
-    const bundle = new FluentBundle("en-US");
-    bundle.addResource(new FluentResource(`
+  const l10nReg = new L10nRegistry();
+  const fs = [
+    { path: "/localization/en-US/mock.ftl", source: `
 file-menu =
     .label = File
     .accesskey = F
@@ -20,9 +20,10 @@
     .label = New Tab
     .accesskey = N
 container = Some text with an <image data-l10n-name="foo"> inside it.
-`));
-    yield bundle;
-  }
+` },
+  ];
+  const source = L10nFileSource.createMock("test", ["en-US"], "/localization/{locale}", fs);
+  l10nReg.registerSources([source]);
 
   SimpleTest.waitForExplicitFinish();
 
@@ -30,11 +31,12 @@
   const domLoc = new DOMLocalization(
     [],
     false,
-    { generateBundles },
+    l10nReg,
+    ["en-US"],
   );
 
   async function foo() {
-    domLoc.addResourceIds(["dummy.ftl"]);
+    domLoc.addResourceIds(["/mock.ftl"]);
     domLoc.connectRoot(document.documentElement);
     await domLoc.translateRoots();
 