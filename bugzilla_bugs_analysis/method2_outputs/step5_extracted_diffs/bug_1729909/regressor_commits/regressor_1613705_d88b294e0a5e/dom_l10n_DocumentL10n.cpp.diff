# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/l10n/DocumentL10n.cpp
# Commit: d88b294e0a5e
# Full Hash: d88b294e0a5e00a0ca739037ffa1452e39879382
# Author: Zibi Braniecki <zbraniecki@mozilla.com>
# Date: 2021-08-03 22:01:19
# Regressor Bug: 1613705
# File Overlap Count: 1
# Description:
#   Bug 1613705 - [localization] part2: Switch Localization class to use localization-ffi. r=emilio,nika
#   
#   Depends on D104788
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D104789
# ==============================================================================

diff -r e6bebff87544 -r d88b294e0a5e dom/l10n/DocumentL10n.cpp
--- a/dom/l10n/DocumentL10n.cpp	Tue Aug 03 05:52:00 2021 +0000
+++ b/dom/l10n/DocumentL10n.cpp	Tue Aug 03 05:52:00 2021 +0000
@@ -35,33 +35,25 @@
 bool DocumentL10n::mIsFirstBrowserWindow = true;
 
 /* static */
-RefPtr<DocumentL10n> DocumentL10n::Create(Document* aDocument,
-                                          const bool aSync) {
+RefPtr<DocumentL10n> DocumentL10n::Create(Document* aDocument, bool aSync) {
   RefPtr<DocumentL10n> l10n = new DocumentL10n(aDocument, aSync);
 
-  if (!l10n->Init()) {
+  IgnoredErrorResult rv;
+  l10n->mReady = Promise::Create(l10n->mGlobal, rv);
+  if (NS_WARN_IF(rv.Failed())) {
     return nullptr;
   }
+
   return l10n.forget();
 }
 
-DocumentL10n::DocumentL10n(Document* aDocument, const bool aSync)
+DocumentL10n::DocumentL10n(Document* aDocument, bool aSync)
     : DOMLocalization(aDocument->GetScopeObject(), aSync, {}),
       mDocument(aDocument),
       mState(DocumentL10nState::Constructed) {
   mContentSink = do_QueryInterface(aDocument->GetCurrentContentSink());
 }
 
-bool DocumentL10n::Init() {
-  DOMLocalization::Init();
-  ErrorResult rv;
-  mReady = Promise::Create(mGlobal, rv);
-  if (NS_WARN_IF(rv.Failed())) {
-    return false;
-  }
-  return true;
-}
-
 JSObject* DocumentL10n::WrapObject(JSContext* aCx,
                                    JS::Handle<JSObject*> aGivenProto) {
   return DocumentL10n_Binding::Wrap(aCx, this, aGivenProto);