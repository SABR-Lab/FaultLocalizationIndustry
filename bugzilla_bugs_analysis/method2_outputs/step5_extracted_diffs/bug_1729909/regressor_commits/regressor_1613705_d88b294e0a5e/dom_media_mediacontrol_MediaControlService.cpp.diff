# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/mediacontrol/MediaControlService.cpp
# Commit: d88b294e0a5e
# Full Hash: d88b294e0a5e00a0ca739037ffa1452e39879382
# Author: Zibi Braniecki <zbraniecki@mozilla.com>
# Date: 2021-08-03 22:01:19
# Regressor Bug: 1613705
# File Overlap Count: 1
# Description:
#   Bug 1613705 - [localization] part2: Switch Localization class to use localization-ffi. r=emilio,nika
#   
#   Depends on D104788
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D104789
# ==============================================================================

diff -r e6bebff87544 -r d88b294e0a5e dom/media/mediacontrol/MediaControlService.cpp
--- a/dom/media/mediacontrol/MediaControlService.cpp	Tue Aug 03 05:52:00 2021 +0000
+++ b/dom/media/mediacontrol/MediaControlService.cpp	Tue Aug 03 05:52:00 2021 +0000
@@ -114,18 +114,15 @@
   mControllerManager = MakeUnique<ControllerManager>(this);
 
   // Initialize the fallback title
-  nsCOMPtr<nsIGlobalObject> global =
-      xpc::NativeGlobal(xpc::PrivilegedJunkScope());
-  RefPtr<Localization> l10n = Localization::Create(global, true, {});
-  l10n->AddResourceId(u"branding/brand.ftl"_ns);
-  l10n->AddResourceId(u"dom/media.ftl"_ns);
+  nsTArray<nsCString> resIds{
+      "branding/brand.ftl"_ns,
+      "dom/media.ftl"_ns,
+  };
+  RefPtr<Localization> l10n = Localization::Create(resIds, true);
   {
-    AutoSafeJSContext cx;
-
     nsAutoCString translation;
-    ErrorResult rv;
-    l10n->FormatValueSync(cx, "mediastatus-fallback-title"_ns, {}, translation,
-                          rv);
+    IgnoredErrorResult rv;
+    l10n->FormatValueSync("mediastatus-fallback-title"_ns, {}, translation, rv);
     if (!rv.Failed()) {
       mFallbackTitle = NS_ConvertUTF8toUTF16(translation);
     }