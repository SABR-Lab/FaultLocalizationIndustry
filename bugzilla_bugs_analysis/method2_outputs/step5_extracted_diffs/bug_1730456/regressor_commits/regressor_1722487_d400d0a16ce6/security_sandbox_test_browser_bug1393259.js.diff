# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: security/sandbox/test/browser_bug1393259.js
# Commit: d400d0a16ce6
# Full Hash: d400d0a16ce6c20bfe5addb995f610f4881b31e6
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2021-08-27 09:43:40
# Regressor Bug: 1722487
# File Overlap Count: 3
# Description:
#   Bug 1722487 - Avoid some work for font list updates. r=jfkthame
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D123363
# ==============================================================================

diff -r ab80197101b9 -r d400d0a16ce6 security/sandbox/test/browser_bug1393259.js
--- a/security/sandbox/test/browser_bug1393259.js	Thu Aug 26 23:10:30 2021 +0000
+++ b/security/sandbox/test/browser_bug1393259.js	Thu Aug 26 23:17:54 2021 +0000
@@ -97,22 +97,16 @@
         }
       }
 
-      // Pref "font.internaluseonly.changed" is updated when system
-      // fonts change. We use it to wait for changes to be detected
-      // in the browser.
-      let prefBranch = Services.prefs.getBranch("font.internaluseonly.");
-
-      // Returns a promise that resolves when the pref is changed
+      // Returns a promise that resolves when font info is changed.
       let getFontNotificationPromise = () =>
         new Promise(resolve => {
-          let prefObserver = {
-            QueryInterface: ChromeUtils.generateQI(["nsIObserver"]),
-            observe() {
-              prefBranch.removeObserver("changed", prefObserver);
-              resolve();
-            },
-          };
-          prefBranch.addObserver("changed", prefObserver);
+          const kTopic = "font-info-updated";
+          function observe() {
+            Services.obs.removeObserver(observe, kTopic);
+            resolve();
+          }
+
+          Services.obs.addObserver(observe, kTopic);
         });
 
       let homeDir = Services.dirsvc.get("Home", Ci.nsIFile);