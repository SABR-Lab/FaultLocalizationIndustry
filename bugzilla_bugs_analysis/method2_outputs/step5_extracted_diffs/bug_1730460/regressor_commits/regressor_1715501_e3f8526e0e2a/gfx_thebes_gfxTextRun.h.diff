# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/gfxTextRun.h
# Commit: e3f8526e0e2a
# Full Hash: e3f8526e0e2a08a4a8342dccedf05bebb3de1baf
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2021-09-08 21:39:05
# Regressor Bug: 1715501
# File Overlap Count: 1
# Description:
#   Bug 1715501 - patch 2 - Pass the presContext to platform font lookup methods so they can query it for font visibility. r=emilio
#   
#   This does not in itself change user-visible behavior, but is a foundation for bug
#   1715507 where we will make the behavior per-context instead of global. This is basically
#   just plumbing, passing a pointer to the presContext that's asking for fonts to be
# ==============================================================================

diff -r cfdd1c5d8d3f -r e3f8526e0e2a gfx/thebes/gfxTextRun.h
--- a/gfx/thebes/gfxTextRun.h	Wed Sep 08 09:35:16 2021 +0000
+++ b/gfx/thebes/gfxTextRun.h	Wed Sep 08 09:35:17 2021 +0000
@@ -902,7 +902,8 @@
   static void
   Shutdown();  // platform must call this to release the languageAtomService
 
-  gfxFontGroup(const mozilla::StyleFontFamilyList& aFontFamilyList,
+  gfxFontGroup(nsPresContext* aPresContext,
+               const mozilla::StyleFontFamilyList& aFontFamilyList,
                const gfxFontStyle* aStyle, nsAtom* aLanguage,
                bool aExplicitLanguage, gfxTextPerfMetrics* aTextPerf,
                gfxUserFontSet* aUserFontSet, gfxFloat aDevToCssSize);
@@ -1339,6 +1340,8 @@
     bool mHasFontEntry : 1;
   };
 
+  nsPresContext* mPresContext = nullptr;
+
   // List of font families, either named or generic.
   // Generic names map to system pref fonts based on language.
   mozilla::StyleFontFamilyList mFamilyList;