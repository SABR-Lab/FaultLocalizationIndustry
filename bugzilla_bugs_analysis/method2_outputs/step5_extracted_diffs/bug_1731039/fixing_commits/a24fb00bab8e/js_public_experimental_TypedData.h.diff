# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/public/experimental/TypedData.h
# Commit: a24fb00bab8e
# Full Hash: a24fb00bab8ea918e6751ddde6d7b71c12563d29
# Author: Steve Fink <sfink@mozilla.com>
# Date: 2021-10-22 03:08:27
# Description:
#   Bug 1731039 - ArrayBufferOrView subclasses should null-check in unwrap() r=jonco
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D129092
# ==============================================================================

diff -r d6f67ce93bf2 -r a24fb00bab8e js/public/experimental/TypedData.h
--- a/js/public/experimental/TypedData.h	Thu Oct 21 17:45:50 2021 +0000
+++ b/js/public/experimental/TypedData.h	Thu Oct 21 17:55:30 2021 +0000
@@ -379,6 +379,9 @@
  public:
   static inline ArrayBufferView fromObject(JSObject* unwrapped);
   static ArrayBufferView unwrap(JSObject* maybeWrapped) {
+    if (!maybeWrapped) {
+      return ArrayBufferView(nullptr);
+    }
     ArrayBufferView view = fromObject(maybeWrapped);
     if (view) {
       return view;
@@ -415,6 +418,9 @@
   }
 
   static DataView unwrap(JSObject* maybeWrapped) {
+    if (!maybeWrapped) {
+      return DataView(nullptr);
+    }
     DataView view = fromObject(maybeWrapped);
     if (view) {
       return view;
@@ -434,6 +440,9 @@
   static TypedArray_base fromObject(JSObject* unwrapped);
 
   static TypedArray_base unwrap(JSObject* maybeWrapped) {
+    if (!maybeWrapped) {
+      return TypedArray_base(nullptr);
+    }
     TypedArray_base view = fromObject(maybeWrapped);
     if (view) {
       return view;
@@ -478,8 +487,14 @@
   }
 
   static TypedArray unwrap(JSObject* maybeWrapped) {
+    if (!maybeWrapped) {
+      return TypedArray(nullptr);
+    }
     TypedArray view = fromObject(maybeWrapped);
-    return view ? view : fromObject(js::CheckedUnwrapStatic(maybeWrapped));
+    if (view) {
+      return view;
+    }
+    return fromObject(js::CheckedUnwrapStatic(maybeWrapped));
   }
 
   // Return a pointer to the start of the data referenced by a typed array. The