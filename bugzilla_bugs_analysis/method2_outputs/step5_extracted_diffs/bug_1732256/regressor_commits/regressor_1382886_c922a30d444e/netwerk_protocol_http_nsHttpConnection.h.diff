# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/protocol/http/nsHttpConnection.h
# Commit: c922a30d444e
# Full Hash: c922a30d444e359e6fa572089eb29b85e09a1168
# Author: Dragana Damjanovic <dd.mozilla@gmail.com>
# Date: 2021-09-17 21:50:08
# Regressor Bug: 1382886
# File Overlap Count: 1
# Description:
#   Bug 1382886 - Make sure that nsHttpConnection immediately knows that the handshake is done. r=necko-reviewers,kershaw
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D123919
# ==============================================================================

diff -r 7f2260b49e60 -r c922a30d444e netwerk/protocol/http/nsHttpConnection.h
--- a/netwerk/protocol/http/nsHttpConnection.h	Fri Sep 17 13:19:01 2021 +0000
+++ b/netwerk/protocol/http/nsHttpConnection.h	Fri Sep 17 13:19:01 2021 +0000
@@ -249,6 +249,7 @@
   void EarlyDataTelemetry(int16_t tlsVersion, bool earlyDataAccepted);
   void FinishNPNSetup(bool handshakeSucceeded, bool hasSecurityInfo);
   void Reset0RttForSpdy();
+  void HandshakeDoneInternal();
 
  private:
   // mTransaction only points to the HTTP Transaction callbacks if the
@@ -358,6 +359,7 @@
   bool mEarlyDataNegotiated{false};  // Only used for telemetry
   nsCString mEarlyNegotiatedALPN;
   bool mDid0RTTSpdy{false};
+  bool mTlsHandshakeComplitionPending{false};
 
   nsresult mErrorBeforeConnect = NS_OK;
 