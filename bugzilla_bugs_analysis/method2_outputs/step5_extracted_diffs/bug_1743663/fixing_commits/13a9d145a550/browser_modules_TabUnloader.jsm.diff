# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: browser/modules/TabUnloader.jsm
# Commit: 13a9d145a550
# Full Hash: 13a9d145a55053585dd7477bdc8b7842606784a6
# Author: Toshihito Kikuchi <tkikuchi@mozilla.com>
# Date: 2021-12-17 03:51:53
# Description:
#   Bug 1743663 - Remove windowContext.hasActivePeerConnections.  r=peterv
#   
#   TabUnloader.jsm can directly call windowGlobal.hasActivePeerConnections(),
#   so windowContext.hasActivePeerConnections is not needed.
#   
# ==============================================================================

diff -r 630013ad7f37 -r 13a9d145a550 browser/modules/TabUnloader.jsm
--- a/browser/modules/TabUnloader.jsm	Thu Dec 16 15:44:15 2021 +0000
+++ b/browser/modules/TabUnloader.jsm	Thu Dec 16 16:14:13 2021 +0000
@@ -89,7 +89,7 @@
     // No need to iterate browser contexts for hasActivePeerConnection
     // because hasActivePeerConnection is set only in the top window.
     return webrtcUI.browserHasStreams(browser) ||
-      browser.browsingContext?.topWindowContext?.hasActivePeerConnections
+      browser.browsingContext?.currentWindowGlobal?.hasActivePeerConnections()
       ? weight
       : 0;
   },