# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/webrtc/libwebrtcglue/VideoConduit.cpp
# Commit: 65c1552a1b96
# Full Hash: 65c1552a1b961e75dc3918fdee81de5ef4cad406
# Author: Andreas Pehrson <apehrson@mozilla.com>
# Date: 2021-11-01 18:17:33
# Regressor Bug: 1654112
# File Overlap Count: 1
# Description:
#   Bug 1654112 - Set REMB switch in VideoConduit, based on negotiation. r=ng
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D105776
# ==============================================================================

diff -r e44f2257d1ad -r 65c1552a1b96 dom/media/webrtc/libwebrtcglue/VideoConduit.cpp
--- a/dom/media/webrtc/libwebrtcglue/VideoConduit.cpp	Fri Feb 19 13:47:26 2021 +0100
+++ b/dom/media/webrtc/libwebrtcglue/VideoConduit.cpp	Fri Feb 19 13:48:09 2021 +0100
@@ -1103,6 +1103,7 @@
       webrtc::KeyFrameReqMethod::kNone;
   bool use_nack_basic = false;
   bool use_tmmbr = false;
+  bool use_remb = false;
   bool use_fec = false;
   bool use_transport_cc = false;
   int ulpfec_payload_type = kNullPayloadType;
@@ -1153,6 +1154,7 @@
     // (boolean) settings
     use_nack_basic |= codec_config->RtcpFbNackIsSet("");
     use_tmmbr |= codec_config->RtcpFbCcmIsSet("tmmbr");
+    use_remb |= codec_config->RtcpFbRembIsSet();
     use_fec |= codec_config->RtcpFbFECIsSet();
     use_transport_cc |= codec_config->RtcpFbTransportCCIsSet();
 
@@ -1168,6 +1170,7 @@
   if (!mRecvStream || CodecsDifferent(recv_codecs, mRecvCodecList) ||
       mRecvStreamConfig.rtp.nack.rtp_history_ms !=
           (use_nack_basic ? 1000 : 0) ||
+      mRecvStreamConfig.rtp.remb != use_remb ||
       mRecvStreamConfig.rtp.transport_cc != use_transport_cc ||
       mRecvStreamConfig.rtp.tmmbr != use_tmmbr ||
       mRecvStreamConfig.rtp.keyframe_method != kf_request_method ||
@@ -1185,6 +1188,7 @@
     // If we fail after here things get ugly
     mRecvStreamConfig.rtp.rtcp_mode = aRtpRtcpConfig.GetRtcpMode();
     mRecvStreamConfig.rtp.nack.rtp_history_ms = use_nack_basic ? 1000 : 0;
+    mRecvStreamConfig.rtp.remb = use_remb;
     mRecvStreamConfig.rtp.transport_cc = use_transport_cc;
     mRecvStreamConfig.rtp.tmmbr = use_tmmbr;
     mRecvStreamConfig.rtp.keyframe_method = kf_request_method;
