# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/webrtc/jsapi/RTCRtpReceiver.h
# Commit: 970ed33359b5
# Full Hash: 970ed33359b5223277984f77c521faaa0079aa88
# Author: Andreas Pehrson <apehrson@mozilla.com>
# Date: 2021-11-01 18:17:33
# Regressor Bug: 1654112
# File Overlap Count: 2
# Description:
#   Bug 1654112 - Implement MediaConduitControl for controlling conduits async through state mirroring. r=ng,bwc
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D112868
# ==============================================================================

diff -r ed2e505b5873 -r 970ed33359b5 dom/media/webrtc/jsapi/RTCRtpReceiver.h
--- a/dom/media/webrtc/jsapi/RTCRtpReceiver.h	Wed Apr 21 01:13:43 2021 +0200
+++ b/dom/media/webrtc/jsapi/RTCRtpReceiver.h	Tue Aug 10 14:13:49 2021 +0200
@@ -8,8 +8,11 @@
 #include "nsISupports.h"
 #include "nsWrapperCache.h"
 #include "mozilla/RefPtr.h"
+#include "mozilla/StateMirroring.h"
 #include "mozilla/Maybe.h"
 #include "js/RootingAPI.h"
+#include "libwebrtcglue/MediaConduitInterface.h"
+#include "libwebrtcglue/RtpRtcpConfig.h"
 #include "nsTArray.h"
 #include "mozilla/dom/RTCStatsReportBinding.h"
 #include "RTCStatsReport.h"
@@ -36,14 +39,14 @@
                        public nsWrapperCache,
                        public RtcpEventObserver {
  public:
-  explicit RTCRtpReceiver(nsPIDOMWindowInner* aWindow, bool aPrivacyNeeded,
-                          const std::string& aPCHandle,
-                          MediaTransportHandler* aTransportHandler,
-                          JsepTransceiver* aJsepTransceiver,
-                          nsISerialEventTarget* aMainThread,
-                          nsISerialEventTarget* aStsThread,
-                          MediaSessionConduit* aConduit,
-                          TransceiverImpl* aTransceiverImpl);
+  RTCRtpReceiver(nsPIDOMWindowInner* aWindow, bool aPrivacyNeeded,
+                 const std::string& aPCHandle,
+                 MediaTransportHandler* aTransportHandler,
+                 JsepTransceiver* aJsepTransceiver,
+                 nsISerialEventTarget* aMainThread, AbstractThread* aCallThread,
+                 nsISerialEventTarget* aStsThread,
+                 MediaSessionConduit* aConduit,
+                 TransceiverImpl* aTransceiverImpl);
 
   // nsISupports
   NS_DECL_CYCLE_COLLECTING_ISUPPORTS
@@ -103,6 +106,23 @@
 
   void SetReceiveTrackMuted(bool aMuted);
 
+  AbstractCanonical<Ssrc>* CanonicalSsrc() { return &mSsrc; }
+  AbstractCanonical<Ssrc>* CanonicalVideoRtxSsrc() { return &mVideoRtxSsrc; }
+  AbstractCanonical<RtpExtList>* CanonicalLocalRtpExtensions() {
+    return &mLocalRtpExtensions;
+  }
+
+  AbstractCanonical<std::vector<AudioCodecConfig>>* CanonicalAudioCodecs() {
+    return &mAudioCodecs;
+  }
+
+  AbstractCanonical<std::vector<VideoCodecConfig>>* CanonicalVideoCodecs() {
+    return &mVideoCodecs;
+  }
+  AbstractCanonical<Maybe<RtpRtcpConfig>>* CanonicalVideoRtpRtcpConfig() {
+    return &mVideoRtpRtcpConfig;
+  }
+
  private:
   virtual ~RTCRtpReceiver();
 
@@ -117,6 +137,7 @@
   bool mHaveStartedReceiving = false;
   bool mHaveSetupTransport = false;
   nsCOMPtr<nsISerialEventTarget> mMainThread;
+  RefPtr<AbstractThread> mCallThread;
   nsCOMPtr<nsISerialEventTarget> mStsThread;
   RefPtr<dom::MediaStreamTrack> mTrack;
   RefPtr<MediaPipelineReceive> mPipeline;
@@ -127,6 +148,15 @@
   // where the stream list for the whole RTCPeerConnection lives..
   std::vector<std::string> mStreamIds;
   bool mRemoteSetSendBit = false;
+
+  Canonical<Ssrc> mSsrc;
+  Canonical<Ssrc> mVideoRtxSsrc;
+  Canonical<RtpExtList> mLocalRtpExtensions;
+
+  Canonical<std::vector<AudioCodecConfig>> mAudioCodecs;
+
+  Canonical<std::vector<VideoCodecConfig>> mVideoCodecs;
+  Canonical<Maybe<RtpRtcpConfig>> mVideoRtpRtcpConfig;
 };
 
 }  // namespace dom