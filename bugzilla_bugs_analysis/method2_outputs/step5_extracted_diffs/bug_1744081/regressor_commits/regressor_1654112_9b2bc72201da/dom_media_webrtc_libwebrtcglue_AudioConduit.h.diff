# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/webrtc/libwebrtcglue/AudioConduit.h
# Commit: 9b2bc72201da
# Full Hash: 9b2bc72201dacf69588720bff85bd839310ab54d
# Author: Andreas Pehrson <apehrson@mozilla.com>
# Date: 2021-11-01 18:17:33
# Regressor Bug: 1654112
# File Overlap Count: 3
# Description:
#   Bug 1654112 - Remove obsolete ChannelProxy and VoiceEngine API integrations. r=ng
#   
#   This switches those integrations to the new Call API, with AudioSendStream and
#   AudioReceiveStream as main API surface.
#   
# ==============================================================================

diff -r 8d60ee1f7cd7 -r 9b2bc72201da dom/media/webrtc/libwebrtcglue/AudioConduit.h
--- a/dom/media/webrtc/libwebrtcglue/AudioConduit.h	Fri Jan 29 17:03:42 2021 +0100
+++ b/dom/media/webrtc/libwebrtcglue/AudioConduit.h	Fri Jan 29 15:37:11 2021 +0100
@@ -184,18 +184,12 @@
         mRecvSSRC(0),
         mEngineTransmitting(false),
         mEngineReceiving(false),
-        mRecvChannel(-1),
-        mSendChannel(-1),
         mDtmfEnabled(false),
         mMutex("WebrtcAudioConduit::mMutex"),
         mStsThread(aStsThread) {}
 
   virtual ~WebrtcAudioConduit();
 
-  virtual MediaConduitErrorCode Init();
-
-  int GetRecvChannel() { return mRecvChannel; }
-
   /* Set Local SSRC list.
    * Note: Until the refactor of the VoE into the call API is complete
    *   this list should contain only a single ssrc.
@@ -244,20 +238,6 @@
 
   bool IsSamplingFreqSupported(int freq) const override;
 
- protected:
-  /*
-    // These are protected so they can be accessed by unit tests
-    // Written only on main thread. Accessed from audio thread.
-    // Accessed from mStsThread during stats calls.
-    // This is safe, provided audio and stats calls stop before we
-    // destroy the AudioConduit.
-    std::unique_ptr<webrtc::voe::ChannelProxy> mRecvChannelProxy = nullptr;
-
-    // Written only on main thread. Accessed from mStsThread during stats calls.
-    // This is safe, provided stats calls stop before we destroy the
-    // AudioConduit.
-    std::unique_ptr<webrtc::voe::ChannelProxy> mSendChannelProxy = nullptr;
-  */
  private:
   WebrtcAudioConduit(const WebrtcAudioConduit& other) = delete;
   void operator=(const WebrtcAudioConduit& other) = delete;
@@ -281,9 +261,6 @@
   bool RecreateSendStreamIfExists();
   bool RecreateRecvStreamIfExists();
 
-  MediaConduitErrorCode CreateChannels();
-  virtual void DeleteChannels();
-
   mozilla::ReentrantMonitor mTransportMonitor;
 
   // Accessed on any thread under mTransportMonitor.
@@ -291,12 +268,7 @@
 
   // Accessed on any thread under mTransportMonitor.
   RefPtr<TransportInterface> mReceiverTransport;
-  /*
-    // Accessed from main thread and audio threads. Used to create and destroy
-    // channels and to send audio data. Access to channels is protected by
-    // locking in channel.cc.
-    ScopedCustomReleasePtr<webrtc::VoEBase> mPtrVoEBase;
-  */
+
   // Const so can be accessed on any thread. Most methods are called on
   // main thread.
   const RefPtr<WebRtcCallWrapper> mCall;
@@ -327,13 +299,9 @@
                          // and playout is enabled
 
   // Accessed only on main thread.
-  int mRecvChannel;
-
-  // Accessed on main thread and from audio thread.
-  int mSendChannel;
-
-  // Accessed only on main thread.
   bool mDtmfEnabled;
+  int mDtmfPayloadType = -1;
+  int mDtmfPayloadFrequency = -1;
 
   Mutex mMutex;
 