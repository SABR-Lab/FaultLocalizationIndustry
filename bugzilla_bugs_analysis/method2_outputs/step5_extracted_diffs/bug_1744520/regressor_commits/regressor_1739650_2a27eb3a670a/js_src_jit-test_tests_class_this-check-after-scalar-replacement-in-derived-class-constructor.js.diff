# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/jit-test/tests/class/this-check-after-scalar-replacement-in-derived-class-constructor.js
# Commit: 2a27eb3a670a
# Full Hash: 2a27eb3a670a7778460c2acdf218c000d6a6f91a
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2021-11-10 09:24:53
# Regressor Bug: 1739650
# File Overlap Count: 1
# Description:
#   Bug 1739650 - Part 2: Support array scalar replacement for MConstructArray. r=iain
#   
#   And also support array scalar replacement for `MConstructArray`.
#   
#   Depends on D130480
# ==============================================================================

diff -r 5806df2b62db -r 2a27eb3a670a js/src/jit-test/tests/class/this-check-after-scalar-replacement-in-derived-class-constructor.js
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/js/src/jit-test/tests/class/this-check-after-scalar-replacement-in-derived-class-constructor.js	Tue Nov 09 16:30:03 2021 +0000
@@ -0,0 +1,29 @@
+// Create a derived class with a default class constructor.
+class C extends class {} {}
+
+// The default constructor of a derived class is small enough to be inlinable.
+assertEq(isSmallFunction(C), true);
+
+// Bound functions have a configurable "prototype" property.
+const BF = function(){}.bind();
+
+function testBoundFunction() {
+  for (let i = 0; i <= 1000; ++i) {
+    let newTarget = i < 1000 ? C : BF;
+    Reflect.construct(C, [], newTarget);
+  }
+}
+
+for (let i = 0; i < 2; ++i) testBoundFunction();
+
+// Proxy have a configurable "prototype" property.
+const P = new Proxy(function(){}, {});
+
+function testProxy() {
+  for (let i = 0; i <= 1000; ++i) {
+    let newTarget = i < 1000 ? C : P;
+    Reflect.construct(C, [], newTarget);
+  }
+}
+
+for (let i = 0; i < 2; ++i) testProxy();