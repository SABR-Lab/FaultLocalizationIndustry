# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/jit-test/tests/warp/scalar-replace-array-apply-array-02.js
# Commit: 5806df2b62db
# Full Hash: 5806df2b62db0f8f918bab1df43595b3d3b31885
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2021-11-10 09:24:53
# Regressor Bug: 1739650
# File Overlap Count: 1
# Description:
#   Bug 1739650 - Part 1: Support array scalar replacement for MApplyArray. r=iain
#   
#   This follows the approach we use when performing scalar replacement for `arguments`
#   in `MApplyArgsObj`. Scalar replacement is currently restricted to `MNewArrayObject`,
#   because only this instruction is guaranteed to be packed.
# ==============================================================================

diff -r ee898d5997e1 -r 5806df2b62db js/src/jit-test/tests/warp/scalar-replace-array-apply-array-02.js
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/js/src/jit-test/tests/warp/scalar-replace-array-apply-array-02.js	Tue Nov 09 16:30:03 2021 +0000
@@ -0,0 +1,19 @@
+function foo(...args) {
+  args[0] = 3;
+  return bar.apply({}, args);
+}
+
+// |foo| must be small enough to be inlinable.
+assertEq(isSmallFunction(foo), true);
+
+function bar(x, y) {
+  return x + y;
+}
+
+with ({}) {}
+
+var sum = 0;
+for (var i = 0; i < 100; i++) {
+  sum += foo(1, 2);
+}
+assertEq(sum, 500);