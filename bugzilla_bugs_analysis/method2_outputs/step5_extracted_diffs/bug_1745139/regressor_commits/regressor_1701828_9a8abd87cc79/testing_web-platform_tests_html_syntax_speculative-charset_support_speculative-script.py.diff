# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: testing/web-platform/tests/html/syntax/speculative-charset/support/speculative-script.py
# Commit: 9a8abd87cc79
# Full Hash: 9a8abd87cc7935f29b94248c1a6f8203faa14403
# Author: Henri Sivonen <hsivonen@hsivonen.fi>
# Date: 2021-12-08 21:43:06
# Regressor Bug: 1701828
# File Overlap Count: 1
# Description:
#   Bug 1701828 - meta charset rewrite. r=smaug
#   
#   Implements https://github.com/whatwg/html/issues/6962 . Improves performance
#   when <meta charset> occurs in head but after the first kilobyte and aligns
#   behavior better with WebKit and Blink.
# ==============================================================================

diff --git a/testing/web-platform/tests/html/syntax/speculative-charset/support/speculative-script.py b/testing/web-platform/tests/html/syntax/speculative-charset/support/speculative-script.py
new file mode 100644
--- /dev/null
+++ b/testing/web-platform/tests/html/syntax/speculative-charset/support/speculative-script.py
@@ -0,0 +1,11 @@
+import time
+
+def main(request, response):
+    response.add_required_headers = False # Don't implicitly add HTTP headers
+    response.writer.write_status(200)
+    response.writer.write_header("Content-Type", "text/html")
+    response.writer.end_headers()
+
+    response.writer.write(b'<!DOCTYPE html><script src="script.py?uuid=%s&character=&#x03B6;"></script>' % request.GET[b"uuid"]);
+    time.sleep(0.2)
+    response.writer.write(b'<meta charset="windows-1251"><p>Test: \xE6</p>');