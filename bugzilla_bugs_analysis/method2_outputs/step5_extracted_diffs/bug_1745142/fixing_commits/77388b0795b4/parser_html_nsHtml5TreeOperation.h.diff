# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: parser/html/nsHtml5TreeOperation.h
# Commit: 77388b0795b4
# Full Hash: 77388b0795b4f9a30171c922d6b649c52e5f6c87
# Author: Henri Sivonen <hsivonen@hsivonen.fi>
# Date: 2021-12-23 09:34:36
# Description:
#   Bug 1745142 - Communicate encoding commitment via speculative load queue. r=smaug
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D133996
# ==============================================================================

diff -r a388127095db -r 77388b0795b4 parser/html/nsHtml5TreeOperation.h
--- a/parser/html/nsHtml5TreeOperation.h	Wed Dec 22 15:47:08 2021 +0000
+++ b/parser/html/nsHtml5TreeOperation.h	Wed Dec 22 15:54:49 2021 +0000
@@ -10,6 +10,7 @@
 #include "mozilla/dom/FromParser.h"
 #include "mozilla/NotNull.h"
 #include "mozilla/Variant.h"
+#include "nsCharsetSource.h"
 
 class nsIContent;
 class nsHtml5TreeOpExecutor;
@@ -328,13 +329,11 @@
   };
 };
 
-struct opSetDocumentCharset {
-  const mozilla::Encoding* mEncoding;
-  int32_t mCharsetSource;
+struct opUpdateCharsetSource {
+  nsCharsetSource mCharsetSource;
 
-  explicit opSetDocumentCharset(const mozilla::Encoding* aEncoding,
-                                int32_t aCharsetSource)
-      : mEncoding(aEncoding), mCharsetSource(aCharsetSource){};
+  explicit opUpdateCharsetSource(nsCharsetSource aCharsetSource)
+      : mCharsetSource(aCharsetSource){};
 };
 
 struct opCharsetSwitchTo {
@@ -494,7 +493,7 @@
     // Gecko-specific on-pop ops
     opMarkAsBroken, opRunScript, opRunScriptAsyncDefer,
     opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement,
-    opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet,
+    opUpdateCharsetSource, opCharsetSwitchTo, opUpdateStyleSheet,
     opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded,
     opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad,
     opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass,
