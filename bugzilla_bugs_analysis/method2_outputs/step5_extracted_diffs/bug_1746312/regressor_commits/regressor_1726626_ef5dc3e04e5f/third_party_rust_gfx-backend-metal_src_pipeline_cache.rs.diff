# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: third_party/rust/gfx-backend-metal/src/pipeline_cache.rs
# Commit: ef5dc3e04e5f
# Full Hash: ef5dc3e04e5f271eea0636ab3a495e95cc912f1d
# Author: Dzmitry Malyshau <dmalyshau@mozilla.com>
# Date: 2021-09-04 09:40:24
# Regressor Bug: 1726626
# File Overlap Count: 3
# Description:
#   Bug 1726626 - Move gfx/wgpu into a 3rd party dependency r=jgilbert,bholley
#   
#   This update makes wgpu a vendored dependency instead of having it in gfx/wgpu.
#   
#   ## Notes
# ==============================================================================

diff --git a/third_party/rust/gfx-backend-metal/src/pipeline_cache.rs b/third_party/rust/gfx-backend-metal/src/pipeline_cache.rs
deleted file mode 100644
--- a/third_party/rust/gfx-backend-metal/src/pipeline_cache.rs
+++ /dev/null
@@ -1,64 +0,0 @@
-use crate::internal::FastStorageMap;
-use crate::native::SerializableModuleInfo;
-use std::fmt;
-use std::sync::atomic::AtomicBool;
-
-pub(crate) struct BinaryArchive {
-    pub(crate) inner: metal::BinaryArchive,
-    pub(crate) is_empty: AtomicBool,
-}
-
-unsafe impl Send for BinaryArchive {}
-
-unsafe impl Sync for BinaryArchive {}
-
-#[derive(serde::Serialize, serde::Deserialize, Clone, PartialEq, Eq, Hash)]
-pub(crate) struct SpvToMslKey {
-    pub(crate) options: naga::back::msl::Options,
-    pub(crate) pipeline_options: naga::back::msl::PipelineOptions,
-    pub(crate) spv_hash: u64,
-}
-
-pub(crate) type SpvToMsl = FastStorageMap<SpvToMslKey, SerializableModuleInfo>;
-
-pub(crate) type SerializableSpvToMsl = Vec<(SpvToMslKey, SerializableModuleInfo)>;
-
-pub(crate) fn load_spv_to_msl_cache(serializable: SerializableSpvToMsl) -> SpvToMsl {
-    let cache = FastStorageMap::default();
-    for (options, values) in serializable.into_iter() {
-        cache.get_or_create_with(&options, || values);
-    }
-
-    cache
-}
-
-pub(crate) fn serialize_spv_to_msl_cache(cache: &SpvToMsl) -> SerializableSpvToMsl {
-    cache
-        .whole_write()
-        .iter()
-        .map(|(options, values)| (options.clone(), values.clone()))
-        .collect()
-}
-
-#[derive(serde::Serialize, serde::Deserialize)]
-pub(crate) struct SerializablePipelineCache<'a> {
-    pub(crate) binary_archive: &'a [u8],
-    pub(crate) spv_to_msl: SerializableSpvToMsl,
-}
-
-pub struct PipelineCache {
-    pub(crate) binary_archive: Option<BinaryArchive>,
-    pub(crate) spv_to_msl: SpvToMsl,
-}
-
-impl fmt::Debug for PipelineCache {
-    fn fmt(&self, formatter: &mut fmt::Formatter) -> fmt::Result {
-        write!(formatter, "PipelineCache")
-    }
-}
-
-pub(crate) fn pipeline_cache_to_binary_archive(
-    pipeline_cache: Option<&PipelineCache>,
-) -> Option<&BinaryArchive> {
-    pipeline_cache.and_then(|cache| cache.binary_archive.as_ref())
-}