# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/base/AccGroupInfo.cpp
# Commit: c0a7fdc4bfca
# Full Hash: c0a7fdc4bfca0596ffecd347f0e248440e371989
# Author: Eitan Isaacson <eitan@monotonous.org>
# Date: 2022-01-05 09:33:53
# Regressor Bug: 1737944
# File Overlap Count: 2
# Description:
#   Bug 1737944 - P5: Unify GetLevelInternal and GetDefaultLevel as Accessible::GetLevel. r=Jamie
#   
#   The nsAccUtils method was a "fast" one for calculating set sizes and
#   conceptual parents. Unified it with
#   LocalAccessible::GetLevelInternal in Accessible::GetLevel with an
# ==============================================================================

diff -r f6ce0e05c92e -r c0a7fdc4bfca accessible/base/AccGroupInfo.cpp
--- a/accessible/base/AccGroupInfo.cpp	Tue Jan 04 21:01:35 2022 +0000
+++ b/accessible/base/AccGroupInfo.cpp	Tue Jan 04 21:01:36 2022 +0000
@@ -31,7 +31,7 @@
     return;
   }
 
-  int32_t level = nsAccUtils::GetARIAOrDefaultLevel(mItem);
+  int32_t level = GetARIAOrDefaultLevel(mItem);
 
   // Compute position in set.
   mPosInSet = 1;
@@ -57,7 +57,7 @@
     // level is lesser than this one then group is ended, if the sibling level
     // is greater than this one then the group is split by some child elements
     // (group will be continued).
-    int32_t siblingLevel = nsAccUtils::GetARIAOrDefaultLevel(sibling);
+    int32_t siblingLevel = GetARIAOrDefaultLevel(sibling);
     if (siblingLevel < level) {
       mParent = sibling;
       break;
@@ -101,7 +101,7 @@
     }
 
     // and check if it's hierarchical flatten structure.
-    int32_t siblingLevel = nsAccUtils::GetARIAOrDefaultLevel(sibling);
+    int32_t siblingLevel = GetARIAOrDefaultLevel(sibling);
     if (siblingLevel < level) break;
 
     // Skip subset.
@@ -314,3 +314,13 @@
 
   return false;
 }
+
+int32_t AccGroupInfo::GetARIAOrDefaultLevel(
+    const LocalAccessible* aAccessible) {
+  int32_t level = 0;
+  aAccessible->ARIAGroupPosition(&level, nullptr, nullptr);
+
+  if (level != 0) return level;
+
+  return aAccessible->GetLevel(true);
+}