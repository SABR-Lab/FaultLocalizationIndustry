# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/ContentCache.h
# Commit: 4fe6068164c1
# Full Hash: 4fe6068164c1d3ceee832a161056e870d5417d2a
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2022-02-08 17:32:27
# Regressor Bug: 1746104
# File Overlap Count: 1
# Description:
#   Bug 1746104 - part 6-3: Wrap `ContentCache::mText` with `Maybe` r=m_kato
#   
#   For managing the state of text content cache independent from selection, it
#   should be wrapped with `Maybe`.
#   
# ==============================================================================

diff -r 88cd68e70502 -r 4fe6068164c1 widget/ContentCache.h
--- a/widget/ContentCache.h	Mon Feb 07 22:33:40 2022 +0000
+++ b/widget/ContentCache.h	Mon Feb 07 22:33:40 2022 +0000
@@ -46,7 +46,7 @@
 
  protected:
   // Whole text in the target
-  nsString mText;
+  Maybe<nsString> mText;
 
   // Start offset of the composition string.
   Maybe<uint32_t> mCompositionStart;
@@ -168,8 +168,8 @@
   Maybe<Selection> mSelection;
 
   bool IsSelectionValid() const {
-    return mSelection.isSome() && mSelection->mHasRange &&
-           mSelection->EndOffset() <= mText.Length();
+    return mSelection.isSome() && mSelection->mHasRange && mText.isSome() &&
+           mSelection->EndOffset() <= mText->Length();
   }
 
   // Stores first char rect because Yosemite's Japanese IME sometimes tries