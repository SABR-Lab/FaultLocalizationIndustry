# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/loader/ScriptLoadRequest.h
# Commit: b8ecf23519c9
# Full Hash: b8ecf23519c9ab5180d08f00c712674bfe968dac
# Author: Yulia Startsev <ystartsev@mozilla.com>
# Date: 2022-02-21 21:39:46
# Regressor Bug: 1742437
# File Overlap Count: 5
# Description:
#   Bug 1742437 - re-scope all generic module/script loader files under js/loader; r=jonco
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D138133
# ==============================================================================

diff -r 85fd9fc9cffa -r b8ecf23519c9 js/loader/ScriptLoadRequest.h
--- a/js/loader/ScriptLoadRequest.h	Mon Feb 21 15:39:08 2022 +0000
+++ b/js/loader/ScriptLoadRequest.h	Mon Feb 21 15:39:09 2022 +0000
@@ -4,8 +4,8 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-#ifndef mozilla_dom_ScriptLoadRequest_h
-#define mozilla_dom_ScriptLoadRequest_h
+#ifndef js_loader_ScriptLoadRequest_h
+#define js_loader_ScriptLoadRequest_h
 
 #include "js/AllocPolicy.h"
 #include "js/RootingAPI.h"
@@ -27,22 +27,25 @@
 #include "nsCOMPtr.h"
 #include "nsCycleCollectionParticipant.h"
 #include "nsIGlobalObject.h"
-#include "nsIScriptElement.h"
 #include "ScriptKind.h"
 
 class nsICacheInfoChannel;
 
+namespace mozilla::dom {
+
+class ScriptLoadContext;
+
+}  // namespace mozilla::dom
+
 namespace JS {
 class OffThreadToken;
-}
+
+namespace loader {
 
-namespace mozilla {
-namespace dom {
+using Utf8Unit = mozilla::Utf8Unit;
 
-class Element;
 class ModuleLoadRequest;
 class ScriptLoadRequestList;
-class ScriptLoadContext;
 
 /*
  * ScriptFetchOptions loosely corresponds to HTML's "script fetch options",
@@ -73,7 +76,7 @@
   NS_DECL_CYCLE_COLLECTION_NATIVE_CLASS(ScriptFetchOptions)
 
   ScriptFetchOptions(mozilla::CORSMode aCORSMode,
-                     enum ReferrerPolicy aReferrerPolicy,
+                     enum mozilla::dom::ReferrerPolicy aReferrerPolicy,
                      nsIPrincipal* aTriggeringPrincipal);
 
   /*
@@ -87,7 +90,7 @@
    *  The referrer policy used for the initial fetch and for fetching any
    *  imported modules
    */
-  const enum ReferrerPolicy mReferrerPolicy;
+  const enum mozilla::dom::ReferrerPolicy mReferrerPolicy;
 
   /*
    * related to cryptographic nonce, used to determine CSP
@@ -137,16 +140,27 @@
   virtual ~ScriptLoadRequest();
 
  public:
+  using SRIMetadata = mozilla::dom::SRIMetadata;
   ScriptLoadRequest(ScriptKind aKind, nsIURI* aURI,
                     ScriptFetchOptions* aFetchOptions,
                     const SRIMetadata& aIntegrity, nsIURI* aReferrer,
-                    ScriptLoadContext* aContext);
+                    mozilla::dom::ScriptLoadContext* aContext);
 
   NS_DECL_CYCLE_COLLECTING_ISUPPORTS
   NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS(ScriptLoadRequest)
 
   using super::getNext;
   using super::isInList;
+
+  template <typename T>
+  using VariantType = mozilla::VariantType<T>;
+
+  template <typename... Ts>
+  using Variant = mozilla::Variant<Ts...>;
+
+  template <typename T, typename D = JS::DeletePolicy<T>>
+  using UniquePtr = mozilla::UniquePtr<T, D>;
+
   using MaybeSourceText =
       mozilla::MaybeOneOf<JS::SourceText<char16_t>, JS::SourceText<Utf8Unit>>;
 
@@ -196,7 +210,7 @@
   void SetTextSource() {
     MOZ_ASSERT(IsUnknownDataType());
     mDataType = DataType::eTextSource;
-    if (StaticPrefs::
+    if (mozilla::StaticPrefs::
             dom_script_loader_external_scripts_utf8_parsing_enabled()) {
       mScriptData.emplace(VariantType<ScriptTextBuffer<Utf8Unit>>());
     } else {
@@ -208,7 +222,7 @@
   // can be transferred in constant time to the JS engine, not copied in linear
   // time.
   template <typename Unit>
-  using ScriptTextBuffer = Vector<Unit, 0, js::MallocAllocPolicy>;
+  using ScriptTextBuffer = mozilla::Vector<Unit, 0, js::MallocAllocPolicy>;
 
   bool IsUTF16Text() const {
     return mScriptData->is<ScriptTextBuffer<char16_t>>();
@@ -244,7 +258,7 @@
                          : ScriptText<Utf8Unit>().clearAndFree();
   }
 
-  enum ReferrerPolicy ReferrerPolicy() const {
+  enum mozilla::dom::ReferrerPolicy ReferrerPolicy() const {
     return mFetchOptions->mReferrerPolicy;
   }
 
@@ -266,7 +280,7 @@
 
   bool HasLoadContext() { return mLoadContext; }
 
-  ScriptLoadContext* GetLoadContext() {
+  mozilla::dom::ScriptLoadContext* GetLoadContext() {
     MOZ_ASSERT(mLoadContext);
     return mLoadContext;
   }
@@ -280,10 +294,12 @@
   RefPtr<ScriptFetchOptions> mFetchOptions;
   const SRIMetadata mIntegrity;
   const nsCOMPtr<nsIURI> mReferrer;
-  Maybe<nsString> mSourceMapURL;  // Holds source map url for loaded scripts
+  mozilla::Maybe<nsString>
+      mSourceMapURL;  // Holds source map url for loaded scripts
 
   // Holds script source data for non-inline scripts.
-  Maybe<Variant<ScriptTextBuffer<char16_t>, ScriptTextBuffer<Utf8Unit>>>
+  mozilla::Maybe<
+      Variant<ScriptTextBuffer<char16_t>, ScriptTextBuffer<Utf8Unit>>>
       mScriptData;
 
   // The length of script source text, set when reading completes. This is used
@@ -313,7 +329,7 @@
 
   // ScriptLoadContext for augmenting the load depending on the loading
   // context (DOM, Worker, etc.)
-  RefPtr<ScriptLoadContext> mLoadContext;
+  RefPtr<mozilla::dom::ScriptLoadContext> mLoadContext;
 };
 
 class ScriptLoadRequestList : private mozilla::LinkedList<ScriptLoadRequest> {
@@ -368,7 +384,7 @@
   }
 }
 
-}  // namespace dom
-}  // namespace mozilla
+}  // namespace loader
+}  // namespace JS
 
-#endif  // mozilla_dom_ScriptLoadRequest_h
+#endif  // js_loader_ScriptLoadRequest_h