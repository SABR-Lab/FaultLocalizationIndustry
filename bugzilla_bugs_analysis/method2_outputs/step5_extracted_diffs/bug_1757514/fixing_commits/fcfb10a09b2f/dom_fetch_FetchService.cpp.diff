# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/fetch/FetchService.cpp
# Commit: fcfb10a09b2f
# Full Hash: fcfb10a09b2f0bd15055be5506fc25acee0bb6a5
# Author: Jens Stutte <jstutte@mozilla.com>
# Date: 2022-03-02 04:31:47
# Description:
#   Bug 1757514: Ignore missing PerformanceTimingData in OnResponseEnd. r=dom-worker-reviewers,edenchuang
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D139918
# ==============================================================================

diff -r b42b18204f20 -r fcfb10a09b2f dom/fetch/FetchService.cpp
--- a/dom/fetch/FetchService.cpp	Tue Mar 01 12:39:16 2022 +0000
+++ b/dom/fetch/FetchService.cpp	Tue Mar 01 12:44:49 2022 +0000
@@ -179,17 +179,19 @@
   }
 
   // Get PerformanceTimingData from FetchDriver.
+  IPCPerformanceTimingData ipcPerformanceTiming;
   nsString initiatorType;
   nsString entryName;
   UniquePtr<PerformanceTimingData> performanceTiming(
       mFetchDriver->GetPerformanceTimingData(initiatorType, entryName));
-  MOZ_ASSERT(performanceTiming);
+  if (performanceTiming != nullptr) {
+    ipcPerformanceTiming = performanceTiming->ToIPC();
+  }
 
   initiatorType = u"navigation"_ns;
 
-  FetchServiceResponse response =
-      MakeTuple(std::move(mResponse), performanceTiming->ToIPC(), initiatorType,
-                entryName);
+  FetchServiceResponse response = MakeTuple(
+      std::move(mResponse), ipcPerformanceTiming, initiatorType, entryName);
 
   // Resolve the FetchServiceResponsePromise
   mResponsePromiseHolder.ResolveIfExists(std::move(response), __func__);
