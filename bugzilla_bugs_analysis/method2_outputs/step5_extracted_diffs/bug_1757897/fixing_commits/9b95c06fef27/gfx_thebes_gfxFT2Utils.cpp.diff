# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/gfxFT2Utils.cpp
# Commit: 9b95c06fef27
# Full Hash: 9b95c06fef27b239fb64c329caeca71e63ca4e03
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2022-03-04 04:18:28
# Description:
#   Bug 1757897 - Add null-check for charmap in FT_Face, before trying to check for symbol encoding. r=lsalzman
#   
#   We need a null-check here in case FT_Select_Charmap failed to find any usable charmap in the font
#   (e.g. maybe an old font with only a MacRoman charmap, but no Unicode or Symbol table).
#   
# ==============================================================================

diff -r ec2a4f706f35 -r 9b95c06fef27 gfx/thebes/gfxFT2Utils.cpp
--- a/gfx/thebes/gfxFT2Utils.cpp	Thu Mar 03 19:58:21 2022 +0000
+++ b/gfx/thebes/gfxFT2Utils.cpp	Thu Mar 03 20:14:25 2022 +0000
@@ -40,7 +40,8 @@
 #else
   uint32_t gid = FT_Get_Char_Index(mFace, aCharCode);
 #endif
-  if (!gid && mFace->charmap->encoding == FT_ENCODING_MS_SYMBOL) {
+  if (!gid && mFace->charmap &&
+      mFace->charmap->encoding == FT_ENCODING_MS_SYMBOL) {
     if (auto pua = gfxFontUtils::MapLegacySymbolFontCharToPUA(aCharCode)) {
       gid = FT_Get_Char_Index(mFace, pua);
     }
