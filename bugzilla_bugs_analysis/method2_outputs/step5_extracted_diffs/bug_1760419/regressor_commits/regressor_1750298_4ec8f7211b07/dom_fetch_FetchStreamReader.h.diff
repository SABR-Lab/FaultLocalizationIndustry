# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/fetch/FetchStreamReader.h
# Commit: 4ec8f7211b07
# Full Hash: 4ec8f7211b0705481e717e365724a2e16d8601bb
# Author: Tom Schuster <evilpies@gmail.com>
# Date: 2022-03-19 09:41:58
# Regressor Bug: 1750298
# File Overlap Count: 1
# Description:
#   Bug 1750298 - Use custom ReadRequest for FetchStreamReader. r=smaug
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D137681
# ==============================================================================

diff -r 1820f90df625 -r 4ec8f7211b07 dom/fetch/FetchStreamReader.h
--- a/dom/fetch/FetchStreamReader.h	Fri Mar 18 17:23:13 2022 +0000
+++ b/dom/fetch/FetchStreamReader.h	Fri Mar 18 17:46:32 2022 +0000
@@ -22,8 +22,12 @@
 class ReadableStreamDefaultReader;
 class WeakWorkerRef;
 
-class FetchStreamReader final : public nsIOutputStreamCallback,
-                                public PromiseNativeHandler {
+class FetchStreamReader final : public nsIOutputStreamCallback
+#ifndef MOZ_DOM_STREAMS
+    ,
+                                public PromiseNativeHandler
+#endif
+{
  public:
   NS_DECL_CYCLE_COLLECTING_ISUPPORTS
   NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_AMBIGUOUS(
@@ -36,11 +40,18 @@
                          FetchStreamReader** aStreamReader,
                          nsIInputStream** aInputStream);
 
+#ifdef MOZ_DOM_STREAMS
+  void ChunkSteps(JSContext* aCx, JS::Handle<JS::Value> aChunk,
+                  ErrorResult& aRv);
+  void ErrorSteps(JSContext* aCx, JS::Handle<JS::Value> aError,
+                  ErrorResult& aRv);
+#else
   void ResolvedCallback(JSContext* aCx, JS::Handle<JS::Value> aValue,
                         ErrorResult& aRv) override;
 
   void RejectedCallback(JSContext* aCx, JS::Handle<JS::Value> aValue,
                         ErrorResult& aRv) override;
+#endif
 
   // Idempotently close the output stream and null out all state. If aCx is
   // provided, the reader will also be canceled.  aStatus must be a DOM error