# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit/BytecodeAnalysis.cpp
# Commit: 0ba054ab3339
# Full Hash: 0ba054ab33393a437711d2746a2111206b08e0db
# Author: Iain Ireland <iireland@mozilla.com>
# Date: 2022-04-12 03:57:01
# Description:
#   Bug 1762769: Don't mark ops only reachable via retsub as normally reachable r=jandem
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D143095
# ==============================================================================

diff -r 5ba291945296 -r 0ba054ab3339 js/src/jit/BytecodeAnalysis.cpp
--- a/js/src/jit/BytecodeAnalysis.cpp	Mon Apr 11 19:22:27 2022 +0000
+++ b/js/src/jit/BytecodeAnalysis.cpp	Mon Apr 11 19:28:30 2022 +0000
@@ -146,10 +146,13 @@
       case JSOp::ResumeIndex: {
         // ResumeIndex is used to push a return address for a finally block. If
         // this op is reachable, then so is that return address (with a smaller
-        // stack depth because the resume index will have been popped.
+        // stack depth because the resume index will have been popped).
+        // We conservatively mark the return address as not normally reachable,
+        // to avoid mismatches between this code and WarpBuilder in the case
+        // where the finally block unconditionally throws an exception.
         uint32_t resumeOffset = script_->resumeOffsets()[(it.getResumeIndex())];
         infos_[resumeOffset].init(stackDepth - 1);
-        infos_[resumeOffset].setJumpTarget(normallyReachable);
+        infos_[resumeOffset].setJumpTarget(false /*normallyReachable*/);
         break;
       }
 
