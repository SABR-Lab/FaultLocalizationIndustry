# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/media/webrtc/MediaEngineWebRTCAudio.h
# Commit: 094c8649451f
# Full Hash: 094c8649451f4b3dd81e30c6546425579d96d432
# Author: Chun-Min Chang <chun.m.chang@gmail.com>
# Date: 2022-04-14 03:45:41
# Description:
#   Bug 1763630 - Connect device input via a main-thread only NativeInputTrack r=padenot
#   
#   We should keep a main-thread only NativeInputTrack member variable in
#   AudioProcessingTrack and use it to connect and disconnect the device
#   input which open and close audio microphone in MTG.
# ==============================================================================

diff -r 45536e4f0cf1 -r 094c8649451f dom/media/webrtc/MediaEngineWebRTCAudio.h
--- a/dom/media/webrtc/MediaEngineWebRTCAudio.h	Wed Apr 13 16:11:51 2022 +0000
+++ b/dom/media/webrtc/MediaEngineWebRTCAudio.h	Wed Apr 13 16:21:44 2022 +0000
@@ -9,6 +9,7 @@
 #include "AudioPacketizer.h"
 #include "AudioSegment.h"
 #include "AudioDeviceInfo.h"
+#include "DeviceInputTrack.h"
 #include "MediaEngineWebRTC.h"
 #include "MediaTrackListener.h"
 #include "modules/audio_processing/include/audio_processing.h"
@@ -225,6 +226,10 @@
   // input data. Graph thread should use mInputs to get the source
   RefPtr<MediaInputPort> mPort;
 
+  // Only accessed on the main thread. This is the track producing raw audio
+  // input data. Graph thread should MediaInputPort::GetSource() to get this
+  RefPtr<NativeInputTrack> mDeviceInputTrack;
+
   // Only accessed on the main thread. Used for bookkeeping on main thread, such
   // that DisconnectDeviceInput can be idempotent.
   // XXX Should really be a CubebUtils::AudioDeviceID, but they aren't
