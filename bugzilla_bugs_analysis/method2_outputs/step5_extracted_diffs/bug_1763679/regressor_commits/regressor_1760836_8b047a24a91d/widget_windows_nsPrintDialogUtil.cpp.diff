# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/windows/nsPrintDialogUtil.cpp
# Commit: 8b047a24a91d
# Full Hash: 8b047a24a91df99818fd01165b6b00d05258a3d4
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2022-03-31 09:35:41
# Regressor Bug: 1760836
# File Overlap Count: 1
# Description:
#   Bug 1760836 - Support printing to an nsIOutputStream. r=jfkthame,jrmuizel,webdriver-reviewers,geckoview-reviewers,agi
#   
#   The trickiest bits are the PrintTargetCG ones, the rest is just plumbing
#   and cleanups and tests, but let me know if you want those to be split
#   out, can do.
# ==============================================================================

diff -r a04583558158 -r 8b047a24a91d widget/windows/nsPrintDialogUtil.cpp
--- a/widget/windows/nsPrintDialogUtil.cpp	Wed Mar 30 18:46:53 2022 +0000
+++ b/widget/windows/nsPrintDialogUtil.cpp	Wed Mar 30 18:51:58 2022 +0000
@@ -314,11 +314,13 @@
   if (prntdlg.Flags & PD_PRINTTOFILE) {
     char16ptr_t fileName = &(((wchar_t*)devnames)[devnames->wOutputOffset]);
     NS_ASSERTION(wcscmp(fileName, L"FILE:") == 0, "FileName must be `FILE:`");
+    aPrintSettings->SetOutputDestination(
+        nsIPrintSettings::kOutputDestinationFile);
     aPrintSettings->SetToFileName(nsDependentString(fileName));
-    aPrintSettings->SetPrintToFile(true);
   } else {
     // clear "print to file" info
-    aPrintSettings->SetPrintToFile(false);
+    aPrintSettings->SetOutputDestination(
+        nsIPrintSettings::kOutputDestinationPrinter);
     aPrintSettings->SetToFileName(u""_ns);
   }
 
