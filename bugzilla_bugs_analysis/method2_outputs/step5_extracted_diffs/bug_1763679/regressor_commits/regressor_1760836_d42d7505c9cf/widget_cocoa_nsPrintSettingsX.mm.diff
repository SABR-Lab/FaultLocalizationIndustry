# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/cocoa/nsPrintSettingsX.mm
# Commit: d42d7505c9cf
# Full Hash: d42d7505c9cf4b0a2f3bae83a007928fee2b596d
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2022-03-30 03:54:32
# Regressor Bug: 1760836
# File Overlap Count: 1
# Description:
#   Bug 1760836 - Support printing to an nsIOutputStream. r=jfkthame,jrmuizel,webdriver-reviewers,geckoview-reviewers,agi
#   
#   The trickiest bits are the PrintTargetCG ones, the rest is just plumbing
#   and cleanups and tests, but let me know if you want those to be split
#   out, can do.
# ==============================================================================

diff -r 99efc2e54ea0 -r d42d7505c9cf widget/cocoa/nsPrintSettingsX.mm
--- a/widget/cocoa/nsPrintSettingsX.mm	Tue Mar 29 17:24:11 2022 +0000
+++ b/widget/cocoa/nsPrintSettingsX.mm	Tue Mar 29 17:50:58 2022 +0000
@@ -180,7 +180,9 @@
   }
 
   if (mDisposition.IsEmpty()) {
-    if (mPrintToFile) {
+    // NOTE: It's unclear what to do for kOutputDestinationStream but this is
+    // only for the native print dialog where that can't happen.
+    if (mOutputDestination == kOutputDestinationFile) {
       [printInfo setJobDisposition:NSPrintSaveJob];
     } else {
       [printInfo setJobDisposition:NSPrintSpoolJob];
@@ -292,7 +294,12 @@
     mScaling = round(double([aPrintInfo scalingFactor]) * 100.0) / 100.0;
   }
 
-  mPrintToFile = [aPrintInfo jobDisposition] == NSPrintSaveJob;
+  mOutputDestination = [&] {
+    if ([aPrintInfo jobDisposition] == NSPrintSaveJob) {
+      return kOutputDestinationFile;
+    }
+    return kOutputDestinationPrinter;
+  }();
 
   NSDictionary* dict = [aPrintInfo dictionary];
   const char* filePath = [[dict objectForKey:NSPrintJobSavingURL] fileSystemRepresentation];