# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/nsPrintSettingsImpl.cpp
# Commit: d42d7505c9cf
# Full Hash: d42d7505c9cf4b0a2f3bae83a007928fee2b596d
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2022-03-30 03:54:32
# Regressor Bug: 1760836
# File Overlap Count: 1
# Description:
#   Bug 1760836 - Support printing to an nsIOutputStream. r=jfkthame,jrmuizel,webdriver-reviewers,geckoview-reviewers,agi
#   
#   The trickiest bits are the PrintTargetCG ones, the rest is just plumbing
#   and cleanups and tests, but let me know if you want those to be split
#   out, can do.
# ==============================================================================

diff -r 99efc2e54ea0 -r d42d7505c9cf widget/nsPrintSettingsImpl.cpp
--- a/widget/nsPrintSettingsImpl.cpp	Tue Mar 29 17:24:11 2022 +0000
+++ b/widget/nsPrintSettingsImpl.cpp	Tue Mar 29 17:50:58 2022 +0000
@@ -20,33 +20,7 @@
 
 NS_IMPL_ISUPPORTS(nsPrintSettings, nsIPrintSettings)
 
-nsPrintSettings::nsPrintSettings()
-    : mScaling(1.0),
-      mPrintBGColors(false),
-      mPrintBGImages(false),
-      mIsCancelled(false),
-      mSaveOnCancel(true),
-      mPrintSilent(false),
-      mShrinkToFit(true),
-      mShowMarginGuides(false),
-      mHonorPageRuleMargins(true),
-      mIsPrintSelectionRBEnabled(false),
-      mPrintSelectionOnly(false),
-      mPrintPageDelay(50),
-      mPaperWidth(8.5),
-      mPaperHeight(11.0),
-      mPaperSizeUnit(kPaperSizeInches),
-      mPrintReversed(false),
-      mPrintInColor(true),
-      mOrientation(kPortraitOrientation),
-      mResolution(0),
-      mDuplex(0),
-      mNumCopies(1),
-      mNumPagesPerSheet(1),
-      mPrintToFile(false),
-      mOutputFormat(kOutputFormatNative),
-      mIsInitedFromPrinter(false),
-      mIsInitedFromPrefs(false) {
+nsPrintSettings::nsPrintSettings() {
   /* member initializers and constructor code */
   int32_t marginWidth = NS_INCHES_TO_INT_TWIPS(DEFAULT_MARGIN_WIDTH);
   mMargin.SizeTo(marginWidth, marginWidth, marginWidth, marginWidth);
@@ -219,13 +193,25 @@
   return NS_OK;
 }
 
-NS_IMETHODIMP nsPrintSettings::GetPrintToFile(bool* aPrintToFile) {
-  NS_ENSURE_ARG_POINTER(aPrintToFile);
-  *aPrintToFile = mPrintToFile;
+NS_IMETHODIMP nsPrintSettings::GetOutputDestination(
+    OutputDestinationType* aDestination) {
+  *aDestination = mOutputDestination;
   return NS_OK;
 }
-NS_IMETHODIMP nsPrintSettings::SetPrintToFile(bool aPrintToFile) {
-  mPrintToFile = aPrintToFile;
+
+NS_IMETHODIMP nsPrintSettings::SetOutputDestination(
+    OutputDestinationType aDestination) {
+  mOutputDestination = aDestination;
+  return NS_OK;
+}
+
+NS_IMETHODIMP nsPrintSettings::SetOutputStream(nsIOutputStream* aStream) {
+  mOutputStream = aStream;
+  return NS_OK;
+}
+
+NS_IMETHODIMP nsPrintSettings::GetOutputStream(nsIOutputStream** aStream) {
+  NS_IF_ADDREF(*aStream = mOutputStream.get());
   return NS_OK;
 }
 
@@ -946,7 +932,8 @@
   mNumCopies = rhs.mNumCopies;
   mNumPagesPerSheet = rhs.mNumPagesPerSheet;
   mPrinter = rhs.mPrinter;
-  mPrintToFile = rhs.mPrintToFile;
+  mOutputDestination = rhs.mOutputDestination;
+  mOutputStream = rhs.mOutputStream;
   mToFileName = rhs.mToFileName;
   mOutputFormat = rhs.mOutputFormat;
   mIsInitedFromPrinter = rhs.mIsInitedFromPrinter;