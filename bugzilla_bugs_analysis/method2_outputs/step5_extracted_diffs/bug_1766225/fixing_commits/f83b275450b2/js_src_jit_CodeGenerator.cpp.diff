# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit/CodeGenerator.cpp
# Commit: f83b275450b2
# Full Hash: f83b275450b27f49396bc919af8d4a98fb75edcb
# Author: Andr√© Bargull <andre.bargull@gmail.com>
# Date: 2022-04-25 21:36:55
# Description:
#   Bug 1766225: Save volatile output register before calling post-write barrier. r=jandem
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D144549
# ==============================================================================

diff -r f234874664b4 -r f83b275450b2 js/src/jit/CodeGenerator.cpp
--- a/js/src/jit/CodeGenerator.cpp	Mon Apr 25 15:51:58 2022 +0000
+++ b/js/src/jit/CodeGenerator.cpp	Mon Apr 25 16:34:03 2022 +0000
@@ -11747,6 +11747,9 @@
 
     LiveRegisterSet volatileRegs = liveVolatileRegs(lir);
     volatileRegs.takeUnchecked(temp);
+    if (output.volatile_()) {
+      volatileRegs.addUnchecked(output);
+    }
 
     masm.PushRegsInMask(volatileRegs);
     emitPostWriteBarrier(output);
@@ -11916,6 +11919,9 @@
 
     LiveRegisterSet volatileRegs = liveVolatileRegs(lir);
     volatileRegs.takeUnchecked(temp);
+    if (output.volatile_()) {
+      volatileRegs.addUnchecked(output);
+    }
 
     masm.PushRegsInMask(volatileRegs);
     emitPostWriteBarrier(output);
