# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/ipc/win/DocAccessibleChild.h
# Commit: 94aa863a913a
# Full Hash: 94aa863a913a0f935b5e7636e49e5a33727c638a
# Author: James Teh <jteh@mozilla.com>
# Date: 2022-06-01 09:46:32
# Regressor Bug: 1756728
# File Overlap Count: 1
# Description:
#   Bug 1756728 part 1: Make it possible to retrieve a BrowsingContext from a DocAccessibleParent. r=morgan
#   
#   Previously, even for remote in-process iframes, it was only possible to retrieve the top level BrowsingContext for the remote process by getting the managing BrowserParent.
#   This makes it possible to get the correct BrowsingContext even for in-process iframes.
#   
# ==============================================================================

diff -r f6b6083e77c9 -r 94aa863a913a accessible/ipc/win/DocAccessibleChild.h
--- a/accessible/ipc/win/DocAccessibleChild.h	Wed Jun 01 00:01:50 2022 +0000
+++ b/accessible/ipc/win/DocAccessibleChild.h	Wed Jun 01 00:34:17 2022 +0000
@@ -14,6 +14,10 @@
 #include "mozilla/mscom/Ptr.h"
 
 namespace mozilla {
+namespace dom {
+class BrowsingContext;
+}
+
 namespace a11y {
 
 /*
@@ -309,10 +313,13 @@
   struct SerializedChildDocConstructor final : public DeferredEvent {
     SerializedChildDocConstructor(DocAccessibleChild* aIPCDoc,
                                   DocAccessibleChild* aParentIPCDoc,
-                                  uint64_t aUniqueID, uint32_t aMsaaID)
+                                  uint64_t aUniqueID,
+                                  dom::BrowsingContext* aBrowsingContext,
+                                  uint32_t aMsaaID)
         : DeferredEvent(aParentIPCDoc),
           mIPCDoc(aIPCDoc),
           mUniqueID(aUniqueID),
+          mBrowsingContext(aBrowsingContext),
           mMsaaID(aMsaaID) {}
 
     void Dispatch(DocAccessibleChild* aParentIPCDoc) override {
@@ -320,12 +327,14 @@
           static_cast<dom::BrowserChild*>(aParentIPCDoc->Manager());
       MOZ_ASSERT(browserChild);
       Unused << browserChild->SendPDocAccessibleConstructor(
-          mIPCDoc, aParentIPCDoc, mUniqueID, mMsaaID, IAccessibleHolder());
+          mIPCDoc, aParentIPCDoc, mUniqueID, mBrowsingContext, mMsaaID,
+          IAccessibleHolder());
       mIPCDoc->SetConstructedInParentProcess();
     }
 
     DocAccessibleChild* mIPCDoc;
     uint64_t mUniqueID;
+    dom::BrowsingContext* mBrowsingContext;
     uint32_t mMsaaID;
   };
 