# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/nsQuoteList.cpp
# Commit: e25543fae7ee
# Full Hash: e25543fae7ee03ac57b9cfbfeb2418c9e2f490fc
# Author: Martin Robinson <mrobinson@igalia.com>
# Date: 2022-06-23 03:54:50
# Regressor Bug: 1463600
# File Overlap Count: 1
# Description:
#   Bug 1463600 - Implement CSS 'contain: style' r=emilio
#   
#   Add an implementation of CSS `contain: style`. This introduces two new
#   data structures, the ContainStyleScope and ContainStyleScopeManager.
#   
# ==============================================================================

diff -r 4230bdcf07ae -r e25543fae7ee layout/base/nsQuoteList.cpp
--- a/layout/base/nsQuoteList.cpp	Wed Jun 22 16:15:57 2022 +0000
+++ b/layout/base/nsQuoteList.cpp	Wed Jun 22 16:16:59 2022 +0000
@@ -12,6 +12,7 @@
 #include "nsIFrame.h"
 #include "nsIFrameInlines.h"
 #include "nsContainerFrame.h"
+#include "mozilla/ContainStyleScopeManager.h"
 #include "mozilla/ErrorResult.h"
 #include "mozilla/dom/Text.h"
 #include "mozilla/intl/Quotes.h"
@@ -99,9 +100,21 @@
   return result;
 }
 
+static int32_t GetDepthBeforeFirstQuoteNode(ContainStyleScope* aScope) {
+  for (auto* ancestor = aScope->GetParent(); ancestor;
+       ancestor = ancestor->GetParent()) {
+    auto& quoteList = ancestor->GetQuoteList();
+    if (auto* node = static_cast<nsQuoteNode*>(
+            aScope->GetPrecedingElementInGenConList(&quoteList))) {
+      return node->DepthAfter();
+    }
+  }
+  return 0;
+}
+
 void nsQuoteList::Calc(nsQuoteNode* aNode) {
   if (aNode == FirstNode()) {
-    aNode->mDepthBefore = 0;
+    aNode->mDepthBefore = GetDepthBeforeFirstQuoteNode(mScope);
   } else {
     aNode->mDepthBefore = Prev(aNode)->DepthAfter();
   }