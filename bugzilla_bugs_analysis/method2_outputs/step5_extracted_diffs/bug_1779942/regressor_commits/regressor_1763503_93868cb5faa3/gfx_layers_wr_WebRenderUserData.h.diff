# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/layers/wr/WebRenderUserData.h
# Commit: 93868cb5faa3
# Full Hash: 93868cb5faa3fb33a1c1e7425f8a207db0dd8093
# Author: sotaro <sotaro.ikeda.g@gmail.com>
# Date: 2022-05-13 09:35:38
# Regressor Bug: 1763503
# File Overlap Count: 1
# Description:
#   Bug 1763503 - Hold layers::CanvasRenderer in ClientWebGLContext::mNotLost r=jgilbert,gfx-reviewers
#   
#   bug 1733732 decreased the size of the display port on Android. When you scroll to the bottom of the page, the canvas leaves the display port. It triggers to destroy WebRenderCanvasData and WebRenderCanvasRendererAsync. And then RenderAndroidSurfaceTextureHost::NotifyNotUsed() is called and RenderAndroidSurfaceTextureHost is destroyed.
#   
#   Then if scrolling makes the canvas into the display port again, WebRenderCanvasData, WebRenderCanvasRendererAsync and RenderAndroidSurfaceTextureHost are recreated again. But there is no rendering update at SharedSurface_SurfaceTexture. Since the page does WebGL rendering only once during page load.
# ==============================================================================

diff -r 0cb803c9f1bd -r 93868cb5faa3 gfx/layers/wr/WebRenderUserData.h
--- a/gfx/layers/wr/WebRenderUserData.h	Thu May 12 23:40:14 2022 +0000
+++ b/gfx/layers/wr/WebRenderUserData.h	Fri May 13 00:17:42 2022 +0000
@@ -40,6 +40,7 @@
 namespace layers {
 
 class BasicLayerManager;
+class CanvasRenderer;
 class ImageClient;
 class ImageContainer;
 class WebRenderBridgeChild;
@@ -322,6 +323,7 @@
   void ClearCanvasRenderer();
   WebRenderCanvasRendererAsync* GetCanvasRenderer();
   WebRenderCanvasRendererAsync* CreateCanvasRenderer();
+  bool SetCanvasRenderer(CanvasRenderer* aCanvasRenderer);
 
   void SetImageContainer(ImageContainer* aImageContainer);
   ImageContainer* GetImageContainer();
