# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/cookie/CookieServiceParent.h
# Commit: 33f21aec0e20
# Full Hash: 33f21aec0e20d39623554816399ee76d13d7e08f
# Author: edguloien <eguloien@mozilla.com>
# Date: 2022-08-23 21:47:27
# Regressor Bug: 1713203
# File Overlap Count: 1
# Description:
#   Bug 1713203 - Added check for host, scheme and origin attributes check before cookie change broadcast to content processes r=dveditz,dragana,nika
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D146346
# ==============================================================================

diff -r fe25d4f35ef8 -r 33f21aec0e20 netwerk/cookie/CookieServiceParent.h
--- a/netwerk/cookie/CookieServiceParent.h	Tue Aug 23 17:30:19 2022 +0000
+++ b/netwerk/cookie/CookieServiceParent.h	Tue Aug 23 17:36:24 2022 +0000
@@ -7,6 +7,7 @@
 #define mozilla_net_CookieServiceParent_h
 
 #include "mozilla/net/PCookieServiceParent.h"
+#include "mozilla/net/CookieKey.h"
 
 class nsIArray;
 class nsICookie;
@@ -14,6 +15,8 @@
 class OriginAttributes;
 }
 
+class nsIEffectiveTLDService;
+
 namespace mozilla {
 namespace net {
 
@@ -33,9 +36,9 @@
 
   void RemoveAll();
 
-  void RemoveCookie(nsICookie* aCookie);
+  void RemoveCookie(const Cookie& aCookie);
 
-  void AddCookie(nsICookie* aCookie);
+  void AddCookie(const Cookie& aCookie);
 
   // This will return true if the CookieServiceParent is currently processing
   // an update from the content process. This is used in ContentParent to make
@@ -43,6 +46,10 @@
   // processes, not the one they originated from.
   bool ProcessingCookie() { return mProcessingCookie; }
 
+  bool CookieMatchesContentList(const Cookie& cookie);
+  void UpdateCookieInContentList(nsIURI* aHostURI,
+                                 const OriginAttributes& aOriginAttrs);
+
  protected:
   virtual void ActorDestroy(ActorDestroyReason aWhy) override;
 
@@ -62,8 +69,10 @@
   static void SerialializeCookieList(const nsTArray<Cookie*>& aFoundCookieList,
                                      nsTArray<CookieStruct>& aCookiesList);
 
+  nsCOMPtr<nsIEffectiveTLDService> mTLDService;
   RefPtr<CookieService> mCookieService;
   bool mProcessingCookie;
+  nsTHashMap<CookieKey, bool> mCookieKeysInContent;
 };
 
 }  // namespace net