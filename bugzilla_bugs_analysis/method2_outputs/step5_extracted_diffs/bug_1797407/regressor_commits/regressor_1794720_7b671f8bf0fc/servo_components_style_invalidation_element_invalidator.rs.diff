# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/components/style/invalidation/element/invalidator.rs
# Commit: 7b671f8bf0fc
# Full Hash: 7b671f8bf0fc98548adbd5d9eccf1fac41addd69
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2022-10-20 21:51:26
# Regressor Bug: 1794720
# File Overlap Count: 1
# Description:
#   Bug 1794720 - fix invalidation of sibling combinators in different slots. r=firefox-style-system-reviewers,layout-reviewers,boris
#   
#   This extends the code to deal with sibling invalidation to handle the
#   case where the flat tree doesn't match the DOM tree. In the test-case
#   for example, dom is:
# ==============================================================================

diff -r 6c6037523786 -r 7b671f8bf0fc servo/components/style/invalidation/element/invalidator.rs
--- a/servo/components/style/invalidation/element/invalidator.rs	Thu Oct 20 08:36:24 2022 +0000
+++ b/servo/components/style/invalidation/element/invalidator.rs	Thu Oct 20 08:39:18 2022 +0000
@@ -80,6 +80,10 @@
     /// Executes an action when `Self` is invalidated.
     fn invalidated_self(&mut self, element: E);
 
+    /// Executes an action when `sibling` is invalidated as a sibling of
+    /// `of`.
+    fn invalidated_sibling(&mut self, sibling: E, of: E);
+
     /// Executes an action when any descendant of `Self` is invalidated.
     fn invalidated_descendants(&mut self, element: E, child: E);
 }
@@ -397,7 +401,7 @@
             );
 
             if invalidated_sibling {
-                sibling_invalidator.processor.invalidated_self(sibling);
+                sibling_invalidator.processor.invalidated_sibling(sibling, self.element);
             }
 
             any_invalidated |= invalidated_sibling;