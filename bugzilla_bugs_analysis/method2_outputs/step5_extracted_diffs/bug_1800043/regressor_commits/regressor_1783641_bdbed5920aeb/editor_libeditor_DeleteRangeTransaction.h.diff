# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/libeditor/DeleteRangeTransaction.h
# Commit: bdbed5920aeb
# Full Hash: bdbed5920aeb2adc75f03ac0f6c427b3ac456395
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2022-10-26 03:47:46
# Regressor Bug: 1783641
# File Overlap Count: 2
# Description:
#   Bug 1783641: Deleting a selected word deletes surrounding whitespace on MacOS. r=masayuki
#   
#   Native behaviour on MacOS dictates one whitespace being removed after double-clicking a word and pressing delete.
#   This behaviour is achieved by saving the information that the selection is created by doubleclick to the `nsFrameSelection`
#   and using it in the `DeleteRangeTransaction`, where the range is extended by one whitespace character before or after the range.
# ==============================================================================

diff -r a32dbcfbd95f -r bdbed5920aeb editor/libeditor/DeleteRangeTransaction.h
--- a/editor/libeditor/DeleteRangeTransaction.h	Tue Oct 25 07:00:26 2022 +0000
+++ b/editor/libeditor/DeleteRangeTransaction.h	Tue Oct 25 07:00:26 2022 +0000
@@ -55,6 +55,24 @@
 
  protected:
   /**
+   * Extend the range by adding a surrounding whitespace character to the range
+   * that is about to be deleted. This method depends on the pref
+   * `layout.word_select.delete_space_after_doubleclick_selection`.
+   *
+   * Considered cases:
+   *   "one [two] three" -> "one [two ]three" -> "one three"
+   *   "[one] two" -> "[one ]two" -> "two"
+   *   "one [two]" -> "one[ two]" -> "one"
+   *   "one [two], three" -> "one[ two], three" -> "one, three"
+   *   "one  [two]" -> "one [ two]" -> "one "
+   *
+   * @param aRange  [inout] The range that is about to be deleted.
+   * @return                NS_OK, unless nsRange::SetStart / ::SetEnd fails.
+   */
+  nsresult MaybeExtendDeletingRangeWithSurroundingWhitespace(
+      nsRange& aRange) const;
+
+  /**
    * CreateTxnsToDeleteBetween() creates a DeleteTextTransaction or some
    * DeleteNodeTransactions to remove text or nodes between aStart and aEnd
    * and appends the created transactions to the array.