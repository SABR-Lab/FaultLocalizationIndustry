# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: security/manager/ssl/nsITLSSocketControl.idl
# Commit: ee9744982673
# Full Hash: ee974498267381418f06efd6ab92c1f2c5f3735d
# Author: Dana Keeler <dkeeler@mozilla.com>
# Date: 2022-11-15 16:44:51
# Regressor Bug: 1791633
# File Overlap Count: 1
# Description:
#   Bug 1791633 - separate nsITLSSocketControl from nsITransportSecurityInfo r=necko-reviewers,kershaw,jschanck
#   
#   Depends on D160311
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D160313
# ==============================================================================

diff -r f5a4bfdaba40 -r ee9744982673 security/manager/ssl/nsITLSSocketControl.idl
--- a/security/manager/ssl/nsITLSSocketControl.idl	Tue Nov 15 05:34:40 2022 +0000
+++ b/security/manager/ssl/nsITLSSocketControl.idl	Tue Nov 15 05:34:40 2022 +0000
@@ -7,8 +7,9 @@
 #include "nsISupports.idl"
 
 interface nsIInterfaceRequestor;
+interface nsITlsHandshakeCallbackListener;
+interface nsITransportSecurityInfo;
 interface nsIX509Cert;
-interface nsITlsHandshakeCallbackListener;
 
 %{C++
 #include "nsStringFwd.h"
@@ -16,10 +17,12 @@
 %}
 [ref] native nsCStringTArrayRef(nsTArray<nsCString>);
 
+// An interface describing an object that controls and holds information about
+// a TLS handshake.
+// NB: The implementations of this interface may only be used on the socket
+// thread (except for asyncGetSecurityInfo);
 [scriptable, builtinclass, uuid(418265c8-654e-4fbb-ba62-4eed27de1f03)]
 interface nsITLSSocketControl : nsISupports {
-    attribute nsIInterfaceRequestor     notificationCallbacks;
-
     void proxyStartSSL();
     void StartTLS();
 
@@ -92,11 +95,6 @@
      */
     readonly attribute uint32_t providerFlags;
 
-    /*
-     * The original TLS flags from the socket provider.
-     */
-    readonly attribute uint32_t providerTlsFlags;
-
     /* These values are defined by TLS. */
     const short SSL_VERSION_3   = 0x0300;
     const short TLS_VERSION_1   = 0x0301;
@@ -162,4 +160,23 @@
     [noscript] void disableEarlyData();
 
     [noscript] void setHandshakeCallbackListener(in nsITlsHandshakeCallbackListener callback);
+
+    /**
+     * The id used to uniquely identify the connection to the peer.
+     */
+    readonly attribute ACString peerId;
+
+    /**
+     * The securityInfo of the TLS handshake.
+     */
+    readonly attribute nsITransportSecurityInfo securityInfo;
+
+    /**
+     * Asynchronously obtain the securityInfo of the TLS handshake. Resolves
+     * with an nsITransportSecurityInfo. This should probably only be used in
+     * tests, where JS running on the main thread cannot access any of the
+     * other fields of nsITLSSocketControl.
+     */
+    [implicit_jscontext, must_use]
+    Promise asyncGetSecurityInfo();
 };