# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: media/webrtc/signaling/src/peerconnection/RTCStatsReport.cpp
# Commit: 8d554870dce8
# Full Hash: 8d554870dce84fbcfefd842c235efcaa5aae23db
# Author: Tom Tung <ttung@mozilla.com>
# Date: 2020-04-07 21:44:02
# Regressor Bug: 1586761
# File Overlap Count: 1
# Description:
#   Bug 1586761 - P5 - Use new methods in media r=tjr,baku
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D63906
# ==============================================================================

diff -r f185ed882616 -r 8d554870dce8 media/webrtc/signaling/src/peerconnection/RTCStatsReport.cpp
--- a/media/webrtc/signaling/src/peerconnection/RTCStatsReport.cpp	Wed Mar 25 14:14:37 2020 +0000
+++ b/media/webrtc/signaling/src/peerconnection/RTCStatsReport.cpp	Wed Mar 25 14:16:15 2020 +0000
@@ -26,6 +26,8 @@
     // 053826b10f838f77c27507e5efecc96e34718541/dom/performance/Performance.cpp#111-117
     mStartWallClockRaw =
         PerformanceService::GetOrCreate()->TimeOrigin(mStartMonotonic);
+    MOZ_ASSERT(window->AsGlobal());
+    mCrossOriginIsolated = window->AsGlobal()->CrossOriginIsolated();
   }
 }
 
@@ -42,10 +44,13 @@
   // mRandomTimelineSeed is not set in the unit-tests.
   if (mRandomTimelineSeed) {
     msSinceStart = nsRFPService::ReduceTimePrecisionAsMSecs(
-        msSinceStart, mRandomTimelineSeed);
+        msSinceStart, mRandomTimelineSeed, /* aIsSystemPrincipal */ false,
+        mCrossOriginIsolated);
   }
-  return msSinceStart +
-         nsRFPService::ReduceTimePrecisionAsMSecs(mStartWallClockRaw, 0);
+  return msSinceStart + nsRFPService::ReduceTimePrecisionAsMSecs(
+                            mStartWallClockRaw, 0,
+                            /* aIsSystemPrincipal */ false,
+                            mCrossOriginIsolated);
 }
 
 NS_IMPL_CYCLE_COLLECTION_WRAPPERCACHE(RTCStatsReport, mParent)