# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: editor/libeditor/HTMLEditUtils.h
# Commit: b9a3b6f27a8d
# Full Hash: b9a3b6f27a8d20c0b3ce38dc1a8f07cc4015afac
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2022-08-04 04:34:13
# Regressor Bug: 1774704
# File Overlap Count: 1
# Description:
#   Bug 1774704 - part 1: Make `HTMLEditor::EnsureCaretInBlockElement` only computes new caret point in the given element r=m_kato
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D152963
# ==============================================================================

diff -r d554ca7850eb -r b9a3b6f27a8d editor/libeditor/HTMLEditUtils.h
--- a/editor/libeditor/HTMLEditUtils.h	Thu Aug 04 00:21:53 2022 +0000
+++ b/editor/libeditor/HTMLEditUtils.h	Thu Aug 04 00:21:53 2022 +0000
@@ -20,6 +20,7 @@
 #include "mozilla/EnumSet.h"
 #include "mozilla/IntegerRange.h"
 #include "mozilla/Maybe.h"
+#include "mozilla/Result.h"
 #include "mozilla/dom/AbstractRange.h"
 #include "mozilla/dom/AncestorIterator.h"
 #include "mozilla/dom/Element.h"
@@ -1950,6 +1951,19 @@
       const Element& aEditingHost);
 
   /**
+   * ComputePointToPutCaretInElementIfOutside() returns a good point in aElement
+   * to put caret if aCurrentPoint is outside of aElement.
+   *
+   * @param aElement        The result is a point in aElement.
+   * @param aCurrentPoint   The current (candidate) caret point.  Only if this
+   *                        is outside aElement, returns a point in aElement.
+   */
+  template <typename EditorDOMPointType, typename EditorDOMPointTypeInput>
+  static Result<EditorDOMPointType, nsresult>
+  ComputePointToPutCaretInElementIfOutside(
+      const Element& aElement, const EditorDOMPointTypeInput& aCurrentPoint);
+
+  /**
    * Content-based query returns true if <aProperty aAttribute=aValue> effects
    * aNode.  If <aProperty aAttribute=aValue> contains aNode, but
    * <aProperty aAttribute=SomeOtherValue> also contains aNode and the second is