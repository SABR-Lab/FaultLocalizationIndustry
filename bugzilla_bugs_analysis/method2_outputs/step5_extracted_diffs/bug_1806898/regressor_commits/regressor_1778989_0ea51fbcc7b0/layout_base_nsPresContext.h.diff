# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/nsPresContext.h
# Commit: 0ea51fbcc7b0
# Full Hash: 0ea51fbcc7b0c3b09e25a5933bbe9f4f10cc3ae4
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2022-08-10 15:45:33
# Regressor Bug: 1778989
# File Overlap Count: 1
# Description:
#   Bug 1778989 - Add some basic container query interleaving. r=dholbert
#   
#   This is far from fully perfect (specially when dealing with nested
#   containers, we need to be smarter when updating there), but it's
#   incremental progress.
# ==============================================================================

diff -r 7c95dc77a749 -r 0ea51fbcc7b0 layout/base/nsPresContext.h
--- a/layout/base/nsPresContext.h	Wed Aug 10 14:34:51 2022 +0300
+++ b/layout/base/nsPresContext.h	Wed Aug 10 11:28:08 2022 +0000
@@ -1086,6 +1086,16 @@
     mHasWarnedAboutTooLargeDashedOrDottedRadius = true;
   }
 
+  void RegisterContainerQueryFrame(nsIFrame* aFrame);
+  void UnregisterContainerQueryFrame(nsIFrame* aFrame);
+  bool HasContainerQueryFrames() const {
+    return !mContainerQueryFrames.IsEmpty();
+  }
+
+  void FinishedContainerQueryUpdate();
+
+  bool UpdateContainerQueryStyles();
+
   mozilla::intl::Bidi& GetBidiEngine();
 
   gfxFontFeatureValueSet* GetFontFeatureValuesLookup() const {
@@ -1290,6 +1300,13 @@
   // that we can avoid repeatedly reporting the same font.
   nsTHashSet<nsCString> mBlockedFonts;
 
+  // The set of container query boxes currently in the document.
+  nsTHashSet<nsIFrame*> mContainerQueryFrames;
+  // The set of container query elements currently in the document that have
+  // been updated so far. This is necessary to avoid reentering on container
+  // query style changes which cause us to do frame reconstruction.
+  nsTHashSet<nsIContent*> mUpdatedContainerQueryContents;
+
   ScrollStyles mViewportScrollStyles;
 
   uint16_t mImageAnimationMode;