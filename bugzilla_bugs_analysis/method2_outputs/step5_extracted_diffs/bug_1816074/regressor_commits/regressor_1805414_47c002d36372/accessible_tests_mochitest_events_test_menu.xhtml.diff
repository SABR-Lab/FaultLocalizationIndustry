# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/tests/mochitest/events/test_menu.xhtml
# Commit: 47c002d36372
# Full Hash: 47c002d3637247e71ee901f32421deaecc9d8ea3
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-01-05 03:40:49
# Regressor Bug: 1805414
# File Overlap Count: 2
# Description:
#   Bug 1805414 - Remove nsMenuFrame and nsMenuParent. r=smaug,Jamie,desktop-theme-reviewers,settings-reviewers,dao
#   
#   Move most the event handling stuff to the DOM. I've left nsMenuBarFrame
#   for now, but I will be removing that in the future.
#   
# ==============================================================================

diff -r 0c989b2bcd78 -r 47c002d36372 accessible/tests/mochitest/events/test_menu.xhtml
--- a/accessible/tests/mochitest/events/test_menu.xhtml	Wed Jan 04 18:28:34 2023 +0000
+++ b/accessible/tests/mochitest/events/test_menu.xhtml	Wed Jan 04 19:01:13 2023 +0000
@@ -14,12 +14,12 @@
   <script type="application/javascript"
           src="../events.js" />
 
-  <script type="application/javascript">
+  <script><![CDATA[
     function openFileMenu()
     {
       this.eventSeq = [
-        new invokerChecker(EVENT_MENU_START, getNode("menubar")),
-        new invokerChecker(EVENT_MENUPOPUP_START, getNode("menupopup-file"))
+        new invokerChecker(EVENT_MENU_START, "menubar"),
+        new invokerChecker("popupshown", "menupopup-file")
         // new invokerChecker(EVENT_FOCUS, getNode("menuitem-newtab")) intermitent failure
       ];
 
@@ -37,8 +37,8 @@
     function openEditMenu()
     {
       this.eventSeq = [
-        new invokerChecker(EVENT_MENUPOPUP_END, getNode("menupopup-file")),
-        new invokerChecker(EVENT_MENUPOPUP_START, getNode("menupopup-edit"))
+        new invokerChecker("popuphidden", "menupopup-file"),
+        new invokerChecker("popupshown", "menupopup-edit"),
         // new invokerChecker(EVENT_FOCUS, getNode("menuitem-undo")) intermitent failure
       ];
 
@@ -57,8 +57,7 @@
     {
       this.eventSeq = [
         //new invokerChecker(EVENT_FOCUS, document), intermitent failure
-        new invokerChecker(EVENT_MENUPOPUP_END, getNode("menupopup-edit")),
-        new invokerChecker(EVENT_MENU_END, getNode("menubar"))
+        new invokerChecker("popuphidden", "menupopup-edit"),
       ];
 
       this.invoke = function closeEditMenu_invoke()
@@ -68,7 +67,7 @@
 
       this.getID = function closeEditMenu_getID()
       {
-        return "close edit menu, leave menubar";
+        return "close edit menu";
       }
     }
 
@@ -111,7 +110,7 @@
     {
       this.eventSeq = [
         //new invokerChecker(EVENT_FOCUS, document), intermitent failure
-        new invokerChecker(EVENT_MENU_END, getNode("menubar"))
+        new invokerChecker(EVENT_MENU_END, "menubar")
       ];
 
       this.invoke = function leaveMenubar_invoke()
@@ -136,7 +135,7 @@
 
     function doTests()
     {
-      if (!WIN) {
+      if (!WIN && !LINUX) {
         todo(false, "Enable this test on other platforms.");
         SimpleTest.finish();
         return;
@@ -150,6 +149,7 @@
       gQueue.push(new openFileMenu());
       gQueue.push(new openEditMenu());
       gQueue.push(new closeEditMenu());
+      gQueue.push(new leaveMenubar());
 
       // Alt key is used to active menubar and focus menu item on Windows,
       // other platforms requires setting a ui.key.menuAccessKeyFocuses
@@ -165,7 +165,7 @@
 
     SimpleTest.waitForExplicitFinish();
     addA11yLoadEvent(doTests);
-  </script>
+  ]]></script>
 
   <hbox flex="1" style="overflow: auto;">
     <body xmlns="http://www.w3.org/1999/xhtml">