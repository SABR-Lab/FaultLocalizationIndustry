# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/generic/test/test_bug632379.xhtml
# Commit: 47c002d36372
# Full Hash: 47c002d3637247e71ee901f32421deaecc9d8ea3
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-01-05 03:40:49
# Regressor Bug: 1805414
# File Overlap Count: 2
# Description:
#   Bug 1805414 - Remove nsMenuFrame and nsMenuParent. r=smaug,Jamie,desktop-theme-reviewers,settings-reviewers,dao
#   
#   Move most the event handling stuff to the DOM. I've left nsMenuBarFrame
#   for now, but I will be removing that in the future.
#   
# ==============================================================================

diff -r 0c989b2bcd78 -r 47c002d36372 layout/generic/test/test_bug632379.xhtml
--- a/layout/generic/test/test_bug632379.xhtml	Wed Jan 04 18:28:34 2023 +0000
+++ b/layout/generic/test/test_bug632379.xhtml	Wed Jan 04 19:01:13 2023 +0000
@@ -17,7 +17,7 @@
 <toolbox flex="1">
   <menubar>
     <menu label="MENU" accesskey="m" id="mainMenu">
-      <menupopup maxheight="100" onpopupshown="openSubmenu()">
+      <menupopup maxheight="100" onpopupshown="openSubmenu(this, event)">
         <menu label="menu1" accesskey="1" id="menu1">
           <menupopup onpopupshown="snapshot(this)">
             <menuitem label="item"/>
@@ -178,7 +178,7 @@
 
 function snapshot(elem)
 {
-    info("snapshot() called");
+    info(`snapshot(${elem.parentNode.id}) called`);
     pos[count] = elem.getBoundingClientRect().top;
     info(elem.querySelector("menuitem").getBoundingClientRect().height);
     ++count;
@@ -204,11 +204,12 @@
     $("mainMenu").open = true;
 }
 
-function openSubmenu()
+function openSubmenu(mainMenu, e)
 {
-    if (!gFinished) {
-        info("openSubmenu() called");
+    if (e.originalTarget != mainMenu) {
+        return;
     }
+    info("openSubmenu() called");
     // open a submenu in the middle
     sendString("5");
 }