# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/content/tests/chrome/test_menulist_keynav.xhtml
# Commit: 47c002d36372
# Full Hash: 47c002d3637247e71ee901f32421deaecc9d8ea3
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-01-05 03:40:49
# Regressor Bug: 1805414
# File Overlap Count: 2
# Description:
#   Bug 1805414 - Remove nsMenuFrame and nsMenuParent. r=smaug,Jamie,desktop-theme-reviewers,settings-reviewers,dao
#   
#   Move most the event handling stuff to the DOM. I've left nsMenuBarFrame
#   for now, but I will be removing that in the future.
#   
# ==============================================================================

diff -r 0c989b2bcd78 -r 47c002d36372 toolkit/content/tests/chrome/test_menulist_keynav.xhtml
--- a/toolkit/content/tests/chrome/test_menulist_keynav.xhtml	Wed Jan 04 18:28:34 2023 +0000
+++ b/toolkit/content/tests/chrome/test_menulist_keynav.xhtml	Wed Jan 04 19:01:13 2023 +0000
@@ -65,6 +65,7 @@
     keyCheck(list, "KEY_ArrowUp", 1, 1, "cursor up");
 
     // On Windows, wrapping doesn't occur.
+    expectCommandEvent = !iswin;
     keyCheck(list, "KEY_ArrowUp", iswin ? 1 : 4, 1, "cursor up wrap");
 
     list.selectedIndex = 4;
@@ -88,8 +89,7 @@
 
 function pressLetter()
 {
-  // A command event should be fired only if the menulist is closed, or on Windows,
-  // where items are selected immediately.
+  // A command event should be fired only if the menulist is closed.
   expectCommandEvent = !gOpenPhase || iswin;
 
   sendString("G");
@@ -97,12 +97,6 @@
 
   keyCheck(list, "T", 2, 1, "letter pressed");
 
-  if (!gOpenPhase) {
-    SpecialPowers.setIntPref("ui.menu.incremental_search.timeout", 0); // prevent to timeout
-    keyCheck(list, "T", 2, 1, "same letter pressed");
-    SpecialPowers.clearUserPref("ui.menu.incremental_search.timeout");
-  }
-
   setTimeout(pressedAgain, 1200);
 }
 
@@ -203,6 +197,7 @@
 
 function keyCheck(list, key, index, defaultindex, testname)
 {
+  info(`keyCheck(${index}, ${key}, ${index}, ${defaultindex}, ${testname}, ${expectCommandEvent})`);
   var item = $("i" + index);
   var defaultitem = $("i" + defaultindex || 1);
 
@@ -267,8 +262,8 @@
   is(commandEventsCount, iswin ? 1 : 0, "selectedIndex after cursor down command event");
   is(list.menupopup.state, "open", "cursor down popup state");
   synthesizeKey("KEY_PageDown");
-  is(list.selectedIndex, iswin ? 3 : 1, "selectedIndex after page down");
-  is(commandEventsCount, iswin ? 2 : 0, "selectedIndex after page down command event");
+  is(list.selectedIndex, iswin ? 2 : 1, "selectedIndex after page down");
+  is(commandEventsCount, iswin ? 1 : 0, "selectedIndex after page down command event");
   is(list.menupopup.state, "open", "page down popup state");
 
   // Check whether cursor up and down wraps.