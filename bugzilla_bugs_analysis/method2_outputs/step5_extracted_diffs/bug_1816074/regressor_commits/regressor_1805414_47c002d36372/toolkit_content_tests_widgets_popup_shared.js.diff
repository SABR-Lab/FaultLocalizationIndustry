# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/content/tests/widgets/popup_shared.js
# Commit: 47c002d36372
# Full Hash: 47c002d3637247e71ee901f32421deaecc9d8ea3
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-01-05 03:40:49
# Regressor Bug: 1805414
# File Overlap Count: 2
# Description:
#   Bug 1805414 - Remove nsMenuFrame and nsMenuParent. r=smaug,Jamie,desktop-theme-reviewers,settings-reviewers,dao
#   
#   Move most the event handling stuff to the DOM. I've left nsMenuBarFrame
#   for now, but I will be removing that in the future.
#   
# ==============================================================================

diff -r 0c989b2bcd78 -r 47c002d36372 toolkit/content/tests/widgets/popup_shared.js
--- a/toolkit/content/tests/widgets/popup_shared.js	Wed Jan 04 18:28:34 2023 +0000
+++ b/toolkit/content/tests/widgets/popup_shared.js	Wed Jan 04 19:01:13 2023 +0000
@@ -32,6 +32,7 @@
 var gTestIndex = -1;
 var gTestStepIndex = 0;
 var gTestEventIndex = 0;
+var gActualEvents = [];
 var gAutoHide = false;
 var gExpectedEventDetails = null;
 var gExpectedTriggerNode = null;
@@ -78,6 +79,14 @@
   }
 }
 
+function info(message) {
+  if (window.opener) {
+    window.opener.SimpleTest.info(message);
+  } else {
+    SimpleTest.info(message);
+  }
+}
+
 function is(left, right, message) {
   if (window.opener) {
     window.opener.SimpleTest.is(left, right, message);
@@ -123,6 +132,8 @@
       return;
     }
 
+    gActualEvents.push(`${event.type} ${event.target.id}`);
+
     var eventitem = events[gTestEventIndex].split(" ");
     var matches;
     if (eventitem[1] == "#tooltip") {
@@ -205,6 +216,8 @@
       if (events.length <= gTestEventIndex) {
         setTimeout(checkResult, 0);
       }
+    } else {
+      info(`Actual events so far: ${JSON.stringify(gActualEvents)}`);
     }
   }
 }
@@ -230,7 +243,9 @@
 }
 
 function goNextStep() {
+  info(`events: ${JSON.stringify(gActualEvents)}`);
   gTestEventIndex = 0;
+  gActualEvents = [];
 
   var step = null;
   var test = gPopupTests[gTestIndex];
@@ -270,6 +285,7 @@
     var test = gPopupTests[gTestIndex];
     // Set the location hash so it's easy to see which test is running
     document.location.hash = test.testname;
+    info("Starting " + test.testname);
 
     // skip the test if the condition returns false
     if ("condition" in test && !test.condition()) {