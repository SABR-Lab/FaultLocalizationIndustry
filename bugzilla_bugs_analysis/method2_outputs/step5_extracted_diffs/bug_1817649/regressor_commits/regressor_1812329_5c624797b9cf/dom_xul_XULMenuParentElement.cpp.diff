# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/xul/XULMenuParentElement.cpp
# Commit: 5c624797b9cf
# Full Hash: 5c624797b9cfc9a130d143a7d018c7c0d4a60b60
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-02-08 21:41:44
# Regressor Bug: 1812329
# File Overlap Count: 1
# Description:
#   Bug 1812329 - Remove nsMenuBarFrame. r=smaug
#   
#   This ended up being a lot more straight-forward than the menu changes.
#   
#   TLDR:
# ==============================================================================

diff -r 59c4e9d17bfc -r 5c624797b9cf dom/xul/XULMenuParentElement.cpp
--- a/dom/xul/XULMenuParentElement.cpp	Wed Feb 08 13:06:36 2023 +0000
+++ b/dom/xul/XULMenuParentElement.cpp	Wed Feb 08 13:12:23 2023 +0000
@@ -5,20 +5,20 @@
 
 #include "XULMenuParentElement.h"
 #include "XULButtonElement.h"
+#include "XULMenuBarElement.h"
 #include "XULPopupElement.h"
 #include "mozilla/LookAndFeel.h"
+#include "mozilla/StaticAnalysisFunctions.h"
 #include "mozilla/TextEvents.h"
 #include "mozilla/dom/DocumentInlines.h"
 #include "mozilla/dom/KeyboardEvent.h"
 #include "mozilla/EventDispatcher.h"
 #include "nsDebug.h"
-#include "nsMenuBarFrame.h"
 #include "nsMenuPopupFrame.h"
 #include "nsString.h"
 #include "nsStringFwd.h"
 #include "nsUTF8Utils.h"
 #include "nsXULElement.h"
-#include "nsMenuBarListener.h"
 #include "nsXULPopupManager.h"
 
 namespace mozilla::dom {
@@ -127,8 +127,9 @@
   }
   mActiveItem = nullptr;
 
-  if (nsMenuBarFrame* f = do_QueryFrame(GetPrimaryFrame())) {
-    f->SetActive(!!aChild);
+  if (auto* menuBar = XULMenuBarElement::FromNode(*this)) {
+    // KnownLive because `this` is known-live by definition.
+    MOZ_KnownLive(menuBar)->SetActive(!!aChild);
   }
 
   if (!aChild) {
@@ -388,4 +389,10 @@
   return foundMenuBeforeCurrent;
 }
 
+void XULMenuParentElement::HandleEnterKeyPress(WidgetEvent& aEvent) {
+  if (RefPtr child = GetActiveMenuChild()) {
+    child->HandleEnterKeyPress(aEvent);
+  }
+}
+
 }  // namespace mozilla::dom