# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/cookie/CookieJarSettings.h
# Commit: f605a7ddf950
# Full Hash: f605a7ddf9502fe74187f430417e9686d10d4b96
# Author: Tim Huang <tihuang@mozilla.com>
# Date: 2023-03-03 09:56:45
# Regressor Bug: 1816064
# File Overlap Count: 1
# Description:
#   Bug 1816064 - Part 2: Implement the fingerprinting randomization key to cookieJarSettings. r=tjr,pbz
#   
#   This patch adds a fingerprintingRandomizationKey to the
#   nsICookieJarSettings. The random key will be generated when loading a
#   top-level http channel and set to the cookieJarSettings. The key will
# ==============================================================================

diff -r 68074ac5a154 -r f605a7ddf950 netwerk/cookie/CookieJarSettings.h
--- a/netwerk/cookie/CookieJarSettings.h	Thu Mar 02 21:47:06 2023 +0000
+++ b/netwerk/cookie/CookieJarSettings.h	Thu Mar 02 21:47:06 2023 +0000
@@ -7,6 +7,8 @@
 #ifndef mozilla_net_CookieJarSettings_h
 #define mozilla_net_CookieJarSettings_h
 
+#include "mozilla/Maybe.h"
+
 #include "nsICookieJarSettings.h"
 #include "nsTArray.h"
 
@@ -165,6 +167,10 @@
   }
   const nsAString& GetPartitionKey() { return mPartitionKey; };
 
+  void SetFingerprintingRandomizationKey(const nsTArray<uint8_t>& aKey) {
+    mFingerprintingRandomKey.emplace(aKey.Clone());
+  }
+
   // Utility function to test if the passed cookiebahvior is
   // BEHAVIOR_REJECT_TRACKER, BEHAVIOR_REJECT_TRACKER_AND_PARTITION_FOREIGN or
   // BEHAVIOR_REJECT_FOREIGN when
@@ -248,6 +254,14 @@
   //   This all occurrs in the nscontentUtils::ShouldResistFingerprinting
   //   functions which you should be using.
   bool mShouldResistFingerprinting;
+
+  // The key used to generate the random noise for randomizing the browser
+  // fingerprint. The key is decided by the session key and the top-level site.
+  // So, the browse fingerprint will look different to the same tracker
+  // under different top-level sites. Also, the fingerprint will change as
+  // browsing session changes. This can prevent trackers to identify individuals
+  // by using browser fingerprints.
+  Maybe<nsTArray<uint8_t>> mFingerprintingRandomKey;
 };
 
 }  // namespace net