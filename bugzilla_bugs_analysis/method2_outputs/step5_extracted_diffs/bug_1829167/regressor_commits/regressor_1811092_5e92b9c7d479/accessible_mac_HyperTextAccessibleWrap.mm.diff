# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/mac/HyperTextAccessibleWrap.mm
# Commit: 5e92b9c7d479
# Full Hash: 5e92b9c7d4794af1d7ab0fb5c278c2e681a18fc6
# Author: Eitan Isaacson <eitan@monotonous.org>
# Date: 2023-01-28 21:11:06
# Regressor Bug: 1811092
# File Overlap Count: 1
# Description:
#   Bug 1811092 - P1: Add new async add/set text selection message. r=Jamie
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D167201
# ==============================================================================

diff -r 7cebaa85f4ff -r 5e92b9c7d479 accessible/mac/HyperTextAccessibleWrap.mm
--- a/accessible/mac/HyperTextAccessibleWrap.mm	Fri Jan 27 20:03:06 2023 +0000
+++ b/accessible/mac/HyperTextAccessibleWrap.mm	Fri Jan 27 20:15:11 2023 +0000
@@ -11,7 +11,7 @@
 #include "HTMLListAccessible.h"
 #include "nsAccUtils.h"
 #include "nsFrameSelection.h"
-#include "TextRange.h"
+#include "TextLeafRange.h"
 #include "TreeWalker.h"
 
 using namespace mozilla;
@@ -634,8 +634,15 @@
 void HyperTextAccessibleWrap::SelectRange(int32_t aStartOffset,
                                           HyperTextAccessible* aEndContainer,
                                           int32_t aEndOffset) {
-  TextRange range(this, this, aStartOffset, aEndContainer, aEndOffset);
-  range.SetSelectionAt(0);
+  TextLeafPoint start = ToTextLeafPoint(aStartOffset);
+  TextLeafPoint end = aEndContainer ? aEndContainer->ToTextLeafPoint(aEndOffset)
+                                    : TextLeafPoint();
+
+  TextLeafRange range(start, end);
+
+  if (range) {
+    range.SetSelection(0);
+  }
 }
 
 TextPoint HyperTextAccessibleWrap::FindTextPoint(