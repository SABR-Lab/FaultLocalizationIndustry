# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/tests/browser/hittest/browser_test_general.js
# Commit: 2687a2f6d5d3
# Full Hash: 2687a2f6d5d355bfad12fb1746c92a68cf740e3f
# Author: Morgan Rae Reschenberg <mreschenberg@mozilla.com>
# Date: 2023-06-22 09:14:13
# Regressor Bug: 1837024
# File Overlap Count: 1
# Description:
#   Bug 1837024: Only do fuzzy hittesting on descendants of clipped accs r=Jamie
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D181166
# ==============================================================================

diff -r 54f3fddcb9bf -r 2687a2f6d5d3 accessible/tests/browser/hittest/browser_test_general.js
--- a/accessible/tests/browser/hittest/browser_test_general.js	Wed Jun 21 21:51:37 2023 +0000
+++ b/accessible/tests/browser/hittest/browser_test_general.js	Wed Jun 21 22:42:07 2023 +0000
@@ -313,3 +313,27 @@
   },
   { chrome: false, iframe: true, remoteIframe: true }
 );
+
+/**
+ * Verify that hit testing is appropriately fuzzy when working with generics with siblings.
+ * We should return the deepest text leaf as the deepest match instead of the generic itself.
+ */
+addAccessibleTask(
+  `
+<div id="generic"><span aria-hidden="true" id="visible">Mozilla</span><span id="invisible" style="display: block !important;border: 0 !important;clip: rect(0 0 0 0) !important;height: 1px !important;margin: -1px !important;overflow: hidden !important;padding: 0 !important;position: absolute !important;white-space: nowrap !important;width: 1px !important;">Mozilla</span><br>I am some other text</div>`,
+  async function (browser, docAcc) {
+    const generic = findAccessibleChildByID(docAcc, "generic");
+    const invisible = findAccessibleChildByID(docAcc, "invisible");
+    const dpr = await getContentDPR(browser);
+
+    await testChildAtPoint(
+      dpr,
+      1,
+      1,
+      generic,
+      invisible, // Direct Child
+      invisible.firstChild // Deepest Child
+    );
+  },
+  { chrome: false, iframe: true, remoteIframe: true }
+);