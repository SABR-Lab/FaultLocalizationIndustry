# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/svg/SVGObserverUtils.cpp
# Commit: 78e7cb2837e7
# Full Hash: 78e7cb2837e7dec0ef55a2f5f383625335ad2520
# Author: Robert Longson <longsonr@gmail.com>
# Date: 2023-08-17 15:01:15
# Description:
#   Bug 1848851 - Check target element is valid type before notifying r=emilio
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D186358
# ==============================================================================

diff -r 970525aa04f1 -r 78e7cb2837e7 layout/svg/SVGObserverUtils.cpp
--- a/layout/svg/SVGObserverUtils.cpp	Thu Aug 17 10:06:10 2023 +0000
+++ b/layout/svg/SVGObserverUtils.cpp	Thu Aug 17 10:06:16 2023 +0000
@@ -461,12 +461,12 @@
  public:
   NS_DECL_ISUPPORTS
 
-  SVGRenderingObserverProperty(URLAndReferrerInfo* aURI, nsIFrame* aFrame,
-                               bool aReferenceImage,
-                               uint32_t aFlags = OBSERVE_ATTRIBUTE_CHANGES |
-                                                 OBSERVE_CONTENT_CHANGES)
+  SVGRenderingObserverProperty(
+      URLAndReferrerInfo* aURI, nsIFrame* aFrame, bool aReferenceImage,
+      uint32_t aFlags = OBSERVE_ATTRIBUTE_CHANGES | OBSERVE_CONTENT_CHANGES,
+      TargetIsValidCallback aTargetIsValidCallback = nullptr)
       : SVGIDRenderingObserver(aURI, aFrame->GetContent(), aReferenceImage,
-                               aFlags),
+                               aFlags, aTargetIsValidCallback),
         mFrameReference(aFrame) {}
 
  protected:
@@ -500,12 +500,17 @@
   }
 }
 
+static bool IsSVGGeometryElement(const Element& aObserved) {
+  return aObserved.IsSVGGeometryElement();
+}
+
 class SVGTextPathObserver final : public SVGRenderingObserverProperty {
  public:
   SVGTextPathObserver(URLAndReferrerInfo* aURI, nsIFrame* aFrame,
                       bool aReferenceImage)
       : SVGRenderingObserverProperty(aURI, aFrame, aReferenceImage,
-                                     OBSERVE_ATTRIBUTE_CHANGES) {}
+                                     OBSERVE_ATTRIBUTE_CHANGES,
+                                     IsSVGGeometryElement) {}
 
  protected:
   void OnRenderingChange() override;
@@ -555,7 +560,8 @@
 
   SVGMPathObserver(URLAndReferrerInfo* aURI, SVGMPathElement* aElement)
       : SVGIDRenderingObserver(aURI, aElement, /* aReferenceImage = */ false,
-                               OBSERVE_ATTRIBUTE_CHANGES) {}
+                               OBSERVE_ATTRIBUTE_CHANGES,
+                               IsSVGGeometryElement) {}
 
  protected:
   virtual ~SVGMPathObserver() = default;  // non-public