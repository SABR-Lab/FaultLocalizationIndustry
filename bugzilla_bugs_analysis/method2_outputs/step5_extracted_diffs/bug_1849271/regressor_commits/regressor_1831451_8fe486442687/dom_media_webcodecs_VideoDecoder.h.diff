# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/webcodecs/VideoDecoder.h
# Commit: 8fe486442687
# Full Hash: 8fe4864426874b31f061149ae6f73fe5c8f9f96c
# Author: Chun-Min Chang <chun.m.chang@gmail.com>
# Date: 2023-06-30 04:06:43
# Regressor Bug: 1831451
# File Overlap Count: 1
# Description:
#   Bug 1831451 - Generate a unique Id for both ConfigureMessage and DecoderAgent r=alwu
#   
#   To batter tracking the ControlMessage logs, ConfigureMessage should
#   generate a unique Id for itself and its following DecodeMessages and
#   FlushMessages. Besides, that unique id can be assigned to DecoderAgent
# ==============================================================================

diff -r b3c2b04d4a36 -r 8fe486442687 dom/media/webcodecs/VideoDecoder.h
--- a/dom/media/webcodecs/VideoDecoder.h	Thu Jun 29 22:33:14 2023 +0000
+++ b/dom/media/webcodecs/VideoDecoder.h	Thu Jun 29 22:33:14 2023 +0000
@@ -154,7 +154,8 @@
       UniquePtr<ControlMessage>& aMessage);
 
   // Returns true when mAgent can be created.
-  bool CreateDecoderAgent(UniquePtr<VideoDecoderConfig>&& aConfig,
+  bool CreateDecoderAgent(DecoderAgent::Id aId,
+                          UniquePtr<VideoDecoderConfig>&& aConfig,
                           UniquePtr<TrackInfo>&& aInfo);
   void DestroyDecoderAgentIfAny();
 
@@ -177,6 +178,9 @@
   uint32_t mDecodeQueueSize;
   bool mDequeueEventScheduled;
 
+  // A unique id tracking the ConfigureMessage and will be used as the
+  // DecoderAgent's Id.
+  uint32_t mLatestConfigureId;
   // Tracking how many decode data has been enqueued and this number will be
   // used as the DecodeMessage's Id.
   size_t mDecodeCounter;
