# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/html/TextControlState.cpp
# Commit: 72ea7455c255
# Full Hash: 72ea7455c255078356b5694d9c94012a3abe5e50
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-09-13 20:53:35
# Description:
#   Bug 1851730 - Pass known value to PrepareEditor() when deferring preparation. r=masayuki
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D187981
# ==============================================================================

diff -r ff3b223bcb34 -r 72ea7455c255 dom/html/TextControlState.cpp
--- a/dom/html/TextControlState.cpp	Wed Sep 13 08:53:31 2023 +0000
+++ b/dom/html/TextControlState.cpp	Wed Sep 13 09:05:51 2023 +0000
@@ -1175,9 +1175,10 @@
     if (!mParent && mTextControlStateDestroyed) {
       mTextControlState.DeleteOrCacheForReuse();
     }
-    if (!mTextControlStateDestroyed && mPreareEditorLater) {
+    if (!mTextControlStateDestroyed && mPrepareEditorLater) {
       MOZ_ASSERT(nsContentUtils::IsSafeToRunScript());
-      mTextControlState.PrepareEditor();
+      MOZ_ASSERT(Is(TextControlAction::SetValue));
+      mTextControlState.PrepareEditor(&mSettingValue);
     }
   }
 
@@ -1204,7 +1205,7 @@
         settingValue = handlingSomething;
       }
     }
-    settingValue->mPreareEditorLater = true;
+    settingValue->mPrepareEditorLater = true;
   }
 
   /**
@@ -1321,7 +1322,7 @@
     if (mTextControlAction == aTextControlAction) {
       return true;
     }
-    return mParent ? mParent->IsHandling(aTextControlAction) : false;
+    return mParent && mParent->IsHandling(aTextControlAction);
   }
   TextControlElement* GetTextControlElement() const { return mTextCtrlElement; }
   TextInputListener* GetTextInputListener() const { return mTextInputListener; }
@@ -1377,7 +1378,7 @@
   TextControlAction const mTextControlAction;
   bool mTextControlStateDestroyed = false;
   bool mEditActionHandled = false;
-  bool mPreareEditorLater = false;
+  bool mPrepareEditorLater = false;
   bool mBeforeInputEventHasBeenDispatched = false;
 };
 