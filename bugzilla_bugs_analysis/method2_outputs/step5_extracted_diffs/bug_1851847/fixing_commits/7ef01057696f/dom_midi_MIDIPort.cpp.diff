# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/midi/MIDIPort.cpp
# Commit: 7ef01057696f
# Full Hash: 7ef01057696f2030d84c979d94902e4380d17241
# Author: Gabriele Svelto <gsvelto@mozilla.com>
# Date: 2023-09-15 22:05:51
# Description:
#   Bug 1851847 - Check that we really do have a document before creating a MIDI port r=padenot
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D187989
# ==============================================================================

diff -r e01b2daadf43 -r 7ef01057696f dom/midi/MIDIPort.cpp
--- a/dom/midi/MIDIPort.cpp	Fri Sep 15 12:46:03 2023 +0300
+++ b/dom/midi/MIDIPort.cpp	Fri Sep 15 10:08:47 2023 +0000
@@ -63,7 +63,16 @@
 }
 
 bool MIDIPort::Initialize(const MIDIPortInfo& aPortInfo, bool aSysexEnabled) {
-  nsIURI* uri = GetDocumentIfCurrent()->GetDocumentURI();
+  nsCOMPtr<Document> document = GetDocumentIfCurrent();
+  if (!document) {
+    return false;
+  }
+
+  nsCOMPtr<nsIURI> uri = document->GetDocumentURI();
+  if (!uri) {
+    return false;
+  }
+
   nsAutoCString origin;
   nsresult rv = nsContentUtils::GetWebExposedOriginSerialization(uri, origin);
   if (NS_FAILED(rv)) {
