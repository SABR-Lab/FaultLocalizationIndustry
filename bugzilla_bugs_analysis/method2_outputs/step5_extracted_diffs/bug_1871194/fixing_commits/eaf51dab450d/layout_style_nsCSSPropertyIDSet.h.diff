# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: layout/style/nsCSSPropertyIDSet.h
# Commit: eaf51dab450d
# Full Hash: eaf51dab450ddb8a82772f837df4ba0689624922
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2023-12-22 16:44:53
# Description:
#   Bug 1871194 - Improve nsCSSPropertyIDSet interaction with AnimatedPropertyID. r=zrhoffman
#   
#   Make it less error-prone by adding a HasProperty(AnimatedPropertyId&)
#   overload.
#   
# ==============================================================================

diff -r 71d4c5581b64 -r eaf51dab450d layout/style/nsCSSPropertyIDSet.h
--- a/layout/style/nsCSSPropertyIDSet.h	Thu Dec 21 15:58:59 2023 +0000
+++ b/layout/style/nsCSSPropertyIDSet.h	Thu Dec 21 16:08:47 2023 +0000
@@ -14,6 +14,7 @@
 #include "mozilla/ArrayUtils.h"
 // For COMPOSITOR_ANIMATABLE_PROPERTY_LIST and
 // COMPOSITOR_ANIMATABLE_PROPERTY_LIST_LENGTH
+#include "mozilla/AnimatedPropertyID.h"
 #include "mozilla/CompositorAnimatableProperties.h"
 #include "nsCSSProps.h"  // For operator<< for nsCSSPropertyID
 #include "nsCSSPropertyID.h"
@@ -25,7 +26,7 @@
  */
 class nsCSSPropertyIDSet {
  public:
-  nsCSSPropertyIDSet() { Empty(); }
+  constexpr nsCSSPropertyIDSet() : mProperties{0} {}
   // auto-generated copy-constructor OK
 
   explicit constexpr nsCSSPropertyIDSet(
@@ -39,8 +40,9 @@
   }
 
   void AssertInSetRange(nsCSSPropertyID aProperty) const {
-    NS_ASSERTION(0 <= aProperty && aProperty < eCSSProperty_COUNT_no_shorthands,
-                 "out of bounds");
+    MOZ_DIAGNOSTIC_ASSERT(
+        0 <= aProperty && aProperty < eCSSProperty_COUNT_no_shorthands,
+        "out of bounds");
   }
 
   // Conversion of aProperty to |size_t| after AssertInSetRange
@@ -59,6 +61,10 @@
         ~(property_set_type(1) << (p % kBitsInChunk));
   }
 
+  bool HasProperty(const mozilla::AnimatedPropertyID& aProperty) const {
+    return !aProperty.IsCustom() && HasProperty(aProperty.mID);
+  }
+
   bool HasProperty(nsCSSPropertyID aProperty) const {
     AssertInSetRange(aProperty);
     size_t p = aProperty;
