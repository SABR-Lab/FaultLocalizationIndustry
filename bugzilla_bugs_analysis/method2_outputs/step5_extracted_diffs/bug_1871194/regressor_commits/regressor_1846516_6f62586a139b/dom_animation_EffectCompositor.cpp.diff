# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/animation/EffectCompositor.cpp
# Commit: 6f62586a139b
# Full Hash: 6f62586a139b1fcc4817dddd924400958d89a6bb
# Author: Zach Hoffman <zach@zrhoffman.net>
# Date: 2023-12-18 17:17:57
# Regressor Bug: 1846516
# File Overlap Count: 2
# Description:
#   Bug 1846516 - [css-properties-values-api] Animate custom properties in a discrete way. r=firefox-style-system-reviewers,emilio
#   
#   This patch also updates the bug ID for a FIXME leftover from bug 1840478
#   to bug 1869476, since the same FIXME is added in D190758.
#   
# ==============================================================================

diff -r 729abedf9bda -r 6f62586a139b dom/animation/EffectCompositor.cpp
--- a/dom/animation/EffectCompositor.cpp	Mon Dec 18 09:24:08 2023 +0000
+++ b/dom/animation/EffectCompositor.cpp	Mon Dec 18 09:24:08 2023 +0000
@@ -608,6 +608,9 @@
     nsCSSPropertyIDSet propertiesToTrackAsSet;
     for (KeyframeEffect* effect : aEffectSet) {
       for (const AnimationProperty& property : effect->Properties()) {
+        if (property.mProperty.IsCustom()) {
+          continue;
+        }
         if (nsCSSProps::PropHasFlags(property.mProperty.mID,
                                      CSSPropFlags::CanAnimateOnCompositor) &&
             !propertiesToTrackAsSet.HasProperty(property.mProperty.mID)) {
@@ -684,6 +687,9 @@
     CascadeLevel cascadeLevel = effect->GetAnimation()->CascadeLevel();
 
     for (const AnimationProperty& prop : effect->Properties()) {
+      if (prop.mProperty.IsCustom()) {
+        continue;
+      }
       if (overriddenProperties.HasProperty(prop.mProperty.mID)) {
         propertiesWithImportantRules.AddProperty(prop.mProperty.mID);
       }