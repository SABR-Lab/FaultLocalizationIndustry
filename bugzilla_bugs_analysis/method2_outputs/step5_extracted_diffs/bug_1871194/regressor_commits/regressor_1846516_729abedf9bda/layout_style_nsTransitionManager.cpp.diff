# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/style/nsTransitionManager.cpp
# Commit: 729abedf9bda
# Full Hash: 729abedf9bda03da3f75ad660fafc2fa92a67bf5
# Author: Zach Hoffman <zach@zrhoffman.net>
# Date: 2023-12-18 17:17:57
# Regressor Bug: 1846516
# File Overlap Count: 1
# Description:
#   Bug 1846516 - [css-properties-values-api] Use AnimatedPropertyID to communicate between Gecko and Servo. r=emilio,layout-reviewers,firefox-style-system-reviewers
#   
#   Co-authored-by: Frederic Wang <fred.wang@free.fr>
#   Co-authored-by: Emilio Cobos √Ålvarez <emilio@crisal.io>
#   
# ==============================================================================

diff -r 63603267402e -r 729abedf9bda layout/style/nsTransitionManager.cpp
--- a/layout/style/nsTransitionManager.cpp	Mon Dec 18 09:24:08 2023 +0000
+++ b/layout/style/nsTransitionManager.cpp	Mon Dec 18 09:24:08 2023 +0000
@@ -169,7 +169,7 @@
           // or because the new value is not interpolable); a new transition
           // would have anim->ToValue() matching currentValue.
           !Servo_ComputedValues_TransitionValueMatches(
-              &aNewStyle, property.mID, anim->ToValue().mServo.get())) {
+              &aNewStyle, &property, anim->ToValue().mServo.get())) {
         // Stop the transition.
         DoCancelTransition(aElement, aPseudoType, aElementTransitions, i);
       }
@@ -189,7 +189,7 @@
   RefPtr<StyleLockedDeclarationBlock> decl =
       Servo_AnimationValue_Uncompute(aValue.mServo).Consume();
   frame.mPropertyValues.AppendElement(
-      PropertyValuePair(aProperty.mID, std::move(decl)));
+      PropertyValuePair(aProperty, std::move(decl)));
   return frame;
 }
 
@@ -205,11 +205,7 @@
 }
 
 static bool IsTransitionable(const AnimatedPropertyID& aProperty) {
-  // TODO(bug 1846516): handle custom property.
-  if (aProperty.IsCustom()) {
-    return false;
-  }
-  return Servo_Property_IsTransitionable(aProperty.mID);
+  return Servo_Property_IsTransitionable(&aProperty);
 }
 
 static Maybe<CSSTransition::ReplacedTransitionProperties>
@@ -321,7 +317,7 @@
   AnimationValue startValue, endValue;
   const StyleShouldTransitionResult result =
       Servo_ComputedValues_ShouldTransition(
-          &aOldStyle, &aNewStyle, aProperty.mID,
+          &aOldStyle, &aNewStyle, &aProperty,
           oldTransition ? oldTransition->ToValue().mServo.get() : nullptr,
           &startValue.mServo, &endValue.mServo);
 