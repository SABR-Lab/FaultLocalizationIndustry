# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/components/style/properties/properties.mako.rs
# Commit: 729abedf9bda
# Full Hash: 729abedf9bda03da3f75ad660fafc2fa92a67bf5
# Author: Zach Hoffman <zach@zrhoffman.net>
# Date: 2023-12-18 17:17:57
# Regressor Bug: 1846516
# File Overlap Count: 1
# Description:
#   Bug 1846516 - [css-properties-values-api] Use AnimatedPropertyID to communicate between Gecko and Servo. r=emilio,layout-reviewers,firefox-style-system-reviewers
#   
#   Co-authored-by: Frederic Wang <fred.wang@free.fr>
#   Co-authored-by: Emilio Cobos √Ålvarez <emilio@crisal.io>
#   
# ==============================================================================

diff -r 63603267402e -r 729abedf9bda servo/components/style/properties/properties.mako.rs
--- a/servo/components/style/properties/properties.mako.rs	Mon Dec 18 09:24:08 2023 +0000
+++ b/servo/components/style/properties/properties.mako.rs	Mon Dec 18 09:24:08 2023 +0000
@@ -18,6 +18,7 @@
 use std::fmt::{self, Write};
 use std::mem;
 
+use crate::Atom;
 use cssparser::{Parser, ParserInput, TokenSerializationType};
 #[cfg(feature = "servo")] use euclid::SideOffsets2D;
 #[cfg(feature = "gecko")] use crate::gecko_bindings::structs::{self, nsCSSPropertyID};
@@ -2089,6 +2090,23 @@
         Some(NonCustomPropertyId::from_nscsspropertyid(id)?.to_property_id())
     }
 
+    /// Returns a property id from Gecko's AnimatedPropertyID.
+    #[cfg(feature = "gecko")]
+    #[allow(non_upper_case_globals)]
+    #[inline]
+    pub fn from_gecko_animated_property_id(property: &structs::AnimatedPropertyID) -> Result<Self, ()> {
+        Ok(if property.mID == nsCSSPropertyID::eCSSPropertyExtra_variable {
+            if property.mCustomName.mRawPtr.is_null() {
+                return Err(());
+            }
+            PropertyId::Custom(unsafe {
+                Atom::from_raw(property.mCustomName.mRawPtr)
+            })
+        } else {
+            NonCustomPropertyId::from_nscsspropertyid(property.mID)?.to_property_id()
+        })
+    }
+
     /// Returns true if the property is a shorthand or shorthand alias.
     #[inline]
     pub fn is_shorthand(&self) -> bool {