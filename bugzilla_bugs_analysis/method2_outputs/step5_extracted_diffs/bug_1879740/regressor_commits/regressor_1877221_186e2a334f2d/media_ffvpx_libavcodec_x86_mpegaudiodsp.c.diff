# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: media/ffvpx/libavcodec/x86/mpegaudiodsp.c
# Commit: 186e2a334f2d
# Full Hash: 186e2a334f2deb37b29f44b28bc8c83babeeb9a4
# Author: Paul Adenot <paul@paul.cx>
# Date: 2024-02-09 09:37:17
# Regressor Bug: 1877221
# File Overlap Count: 1
# Description:
#   Bug 1877221 - Pull in new ffmpeg code, reapply patch. r=media-playback-reviewers,chunmin
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D199909
# ==============================================================================

diff -r c5920de78d16 -r 186e2a334f2d media/ffvpx/libavcodec/x86/mpegaudiodsp.c
--- a/media/ffvpx/libavcodec/x86/mpegaudiodsp.c	Thu Feb 08 10:39:53 2024 +0000
+++ b/media/ffvpx/libavcodec/x86/mpegaudiodsp.c	Thu Feb 08 10:39:54 2024 +0000
@@ -45,6 +45,9 @@
 void ff_four_imdct36_float_avx(float *out, float *buf, float *in, float *win,
                                float *tmpbuf);
 
+void ff_dct32_float_sse2(float *out, const float *in);
+void ff_dct32_float_avx (float *out, const float *in);
+
 DECLARE_ALIGNED(16, static float, mdct_win_sse)[2][4][4*40];
 
 #if HAVE_6REGS && HAVE_SSE_INLINE
@@ -267,6 +270,7 @@
 #if HAVE_SSE
     if (EXTERNAL_SSE2(cpu_flags)) {
         s->imdct36_blocks_float = imdct36_blocks_sse2;
+        s->dct32_float          = ff_dct32_float_sse2;
     }
     if (EXTERNAL_SSE3(cpu_flags)) {
         s->imdct36_blocks_float = imdct36_blocks_sse3;
@@ -279,6 +283,8 @@
     if (EXTERNAL_AVX(cpu_flags)) {
         s->imdct36_blocks_float = imdct36_blocks_avx;
     }
+    if (EXTERNAL_AVX_FAST(cpu_flags))
+        s->dct32_float          = ff_dct32_float_avx;
 #endif
 #endif /* HAVE_X86ASM */
 }