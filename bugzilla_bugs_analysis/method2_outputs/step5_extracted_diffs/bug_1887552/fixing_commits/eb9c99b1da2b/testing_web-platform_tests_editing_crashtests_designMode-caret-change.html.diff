# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: testing/web-platform/tests/editing/crashtests/designMode-caret-change.html
# Commit: eb9c99b1da2b
# Full Hash: eb9c99b1da2b59ad1888a9710a3d56652bdd850c
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-03-26 16:49:15
# Description:
#   Bug 1887552 - Simplify caret visibility code. r=sefeng,geckoview-reviewers
#   
#   Make the "is hidden due to non-collapsed selection" use the regular
#   caret-hiding mechanism, so that we make sure nsCaret and paint are
#   consistent on their caret visibility.
# ==============================================================================

diff -r 66c42f5f482f -r eb9c99b1da2b testing/web-platform/tests/editing/crashtests/designMode-caret-change.html
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/testing/web-platform/tests/editing/crashtests/designMode-caret-change.html	Tue Mar 26 10:53:17 2024 +0000
@@ -0,0 +1,37 @@
+<!doctype html>
+<html class="test-wait reftest-wait">
+<style>
+button {
+  background-repeat: no-repeat;
+}
+*:last-child {
+  opacity: 0;
+  animation: kf ease-in, steps(65, start) 0.92 paused;
+  border-radius: inherit
+}
+@keyframes kf {}
+</style>
+<script>
+let animationEnded = false;
+let selectionChanged = false;
+function maybeFinishTest() {
+  if (animationEnded && selectionChanged) {
+    requestAnimationFrame(() => requestAnimationFrame(() => {
+      document.documentElement.className = "";
+    }));
+  }
+}
+document.addEventListener("DOMContentLoaded", () => {
+  document.designMode = "on"
+  window.onanimationend = () => {
+    document.execCommand("insertHTML", false, "A")
+    animationEnded = true;
+    maybeFinishTest();
+  }
+  document.onselectionchange = () => {
+    document.execCommand("selectAll", false)
+    selectionChanged = true;
+    maybeFinishTest();
+  }
+})
+</script>