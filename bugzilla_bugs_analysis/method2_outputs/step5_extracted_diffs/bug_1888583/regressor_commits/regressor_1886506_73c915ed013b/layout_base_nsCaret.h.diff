# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/nsCaret.h
# Commit: 73c915ed013b
# Full Hash: 73c915ed013b1b6a0435a839e95c38023984612b
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-03-23 09:29:17
# Regressor Bug: 1886506
# File Overlap Count: 1
# Description:
#   Bug 1886506 - Fix caret paint invalidation issues. r=sefeng
#   
#   The caret position is in the DOM, and sometimes can get out of sync.
#   
#   While that is an issue, it's not new: The code before the regressing bug
# ==============================================================================

diff -r dda9d04389e1 -r 73c915ed013b layout/base/nsCaret.h
--- a/layout/base/nsCaret.h	Fri Mar 22 12:19:50 2024 +0000
+++ b/layout/base/nsCaret.h	Fri Mar 22 12:20:14 2024 +0000
@@ -14,7 +14,6 @@
 #include "nsCoord.h"
 #include "nsIFrame.h"
 #include "nsISelectionListener.h"
-#include "nsIWeakReferenceUtils.h"
 #include "nsPoint.h"
 #include "nsRect.h"
 
@@ -114,6 +113,9 @@
    */
   void SchedulePaint();
 
+  nsIFrame* GetLastPaintedFrame() { return mLastPaintedFrame; }
+  void SetLastPaintedFrame(nsIFrame* aFrame) { mLastPaintedFrame = aFrame; }
+
   /**
    * Returns a frame to paint in, and the bounds of the painted caret
    * relative to that frame.
@@ -122,6 +124,7 @@
    * off).
    */
   nsIFrame* GetPaintGeometry(nsRect* aRect);
+
   /**
    * Same as the overload above, but returns the caret and hook rects
    * separately, and also computes the color if requested.
@@ -221,6 +224,9 @@
 
   CaretPosition mCaretPosition;
 
+  // The last frame we painted the caret in.
+  WeakFrame mLastPaintedFrame;
+
   /**
    * mBlinkCount is used to control the number of times to blink the caret
    * before stopping the blink. This is reset each time we reset the