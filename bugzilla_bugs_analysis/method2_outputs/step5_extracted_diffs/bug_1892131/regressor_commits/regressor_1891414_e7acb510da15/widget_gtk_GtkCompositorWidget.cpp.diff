# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/gtk/GtkCompositorWidget.cpp
# Commit: e7acb510da15
# Full Hash: e7acb510da15fa91629c3d97eae4e7dbb1c4ffa9
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-04-16 21:40:37
# Regressor Bug: 1891414
# File Overlap Count: 1
# Description:
#   Bug 1891414 - Improve opaque region tracking in GTK. r=stransky
#   
#   Use the opaque region we get from Gecko, rather than hardcoding the
#   titlebar rect / corners.
#   
# ==============================================================================

diff -r 235e497e1648 -r e7acb510da15 widget/gtk/GtkCompositorWidget.cpp
--- a/widget/gtk/GtkCompositorWidget.cpp	Tue Apr 16 13:45:09 2024 +0000
+++ b/widget/gtk/GtkCompositorWidget.cpp	Tue Apr 16 13:58:07 2024 +0000
@@ -141,15 +141,10 @@
 }
 
 LayoutDeviceIntRegion GtkCompositorWidget::GetTransparentRegion() {
-  // We need to clear target buffer alpha values of popup windows as
-  // SW-WR paints with alpha blending (see Bug 1674473).
-  if (!mWidget || mWidget->IsPopup()) {
-    return LayoutDeviceIntRect(LayoutDeviceIntPoint(0, 0), GetClientSize());
-  }
-
-  // Clear background of titlebar area to render titlebar
-  // transparent corners correctly.
-  return mWidget->GetTitlebarRect();
+  LayoutDeviceIntRegion fullRegion(
+      LayoutDeviceIntRect(LayoutDeviceIntPoint(), GetClientSize()));
+  fullRegion.SubOut(mWidget->GetOpaqueRegion());
+  return fullRegion;
 }
 
 #ifdef MOZ_WAYLAND