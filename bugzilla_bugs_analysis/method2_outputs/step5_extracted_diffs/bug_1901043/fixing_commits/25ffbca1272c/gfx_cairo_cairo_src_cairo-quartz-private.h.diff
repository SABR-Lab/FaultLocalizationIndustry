# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/cairo/cairo/src/cairo-quartz-private.h
# Commit: 25ffbca1272c
# Full Hash: 25ffbca1272cb30429764878ac1e77a5f3d45ef6
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2024-06-20 21:38:27
# Description:
#   Bug 1901043 - Revert to the pre-1.18.0 version of _cairo_surface_to_cgimage() and cairo_quartz_image_surface code. r=gfx-reviewers,lsalzman
#   
#   This eliminates the new _cairo_quartz_surface_snapshot, and the CGContextRef-based
#   version of cairo_quartz_image_surface,  which seems to be the potentially-problematic
#   codepath.
# ==============================================================================

diff -r 031c8a5d110b -r 25ffbca1272c gfx/cairo/cairo/src/cairo-quartz-private.h
--- a/gfx/cairo/cairo/src/cairo-quartz-private.h	Thu Jun 20 10:41:02 2024 +0000
+++ b/gfx/cairo/cairo/src/cairo-quartz-private.h	Thu Jun 20 10:41:14 2024 +0000
@@ -81,7 +81,8 @@
     cairo_surface_t base;
 
     int width, height;
-    CGContextRef cgContext;
+
+    CGImageRef image;
     cairo_image_surface_t *imageSurface;
 } cairo_quartz_image_surface_t;
 
@@ -113,6 +114,16 @@
 cairo_status_t _cairo_quartz_surface_to_png (cairo_surface_t *abstract_surface, const char *dest);
 cairo_private void _cairo_quartz_image_to_png (CGImageRef, const char *dest);
 
+cairo_private CGImageRef
+CairoQuartzCreateCGImage (cairo_format_t format,
+			      unsigned int width,
+			      unsigned int height,
+			      unsigned int stride,
+			      void *data,
+			      cairo_bool_t interpolate,
+			      CGColorSpaceRef colorSpaceOverride,
+			      CGDataProviderReleaseDataCallback releaseCallback,
+			      void *releaseInfo);
 #else
 
 # error Cairo was not compiled with support for the quartz backend