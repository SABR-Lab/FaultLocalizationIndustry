# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/cairo/cairo/src/cairo-recording-surface-private.h
# Commit: 3cdfb39376b7
# Full Hash: 3cdfb39376b736597fe658a322389117686b7e82
# Author: Jonathan Kew <jkew@mozilla.com>
# Date: 2024-05-07 09:13:07
# Regressor Bug: 1892913
# File Overlap Count: 3
# Description:
#   Bug 1892913 - patch 1 - Update cairo source to 1.18.0 r=gfx-reviewers,lsalzman
#   
#   Wholesale replacement of files in gfx/cairo/cairo with contents of the 1.18.0 release tarball,
#   omitting subdirectories that are not part of the core library build.
#   
# ==============================================================================

diff -r 9daa351f875b -r 3cdfb39376b7 gfx/cairo/cairo/src/cairo-recording-surface-private.h
--- a/gfx/cairo/cairo/src/cairo-recording-surface-private.h	Mon May 06 19:22:35 2024 +0000
+++ b/gfx/cairo/cairo/src/cairo-recording-surface-private.h	Mon May 06 19:25:12 2024 +0000
@@ -1,3 +1,4 @@
+/* -*- Mode: c; tab-width: 8; c-basic-offset: 4; indent-tabs-mode: t; -*- */
 /* cairo - a vector graphics library with display and print output
  *
  * Copyright Â© 2005 Red Hat, Inc
@@ -55,14 +56,19 @@
 } cairo_command_type_t;
 
 typedef enum {
-    CAIRO_RECORDING_REGION_ALL,
+    CAIRO_RECORDING_REGION_ALL = 0,
     CAIRO_RECORDING_REGION_NATIVE,
     CAIRO_RECORDING_REGION_IMAGE_FALLBACK
 } cairo_recording_region_type_t;
 
+typedef enum {
+    CAIRO_RECORDING_REPLAY,
+    CAIRO_RECORDING_CREATE_REGIONS,
+    CAIRO_RECORDING_REPLAY_REGION
+} cairo_recording_replay_type_t;
+
 typedef struct _cairo_command_header {
     cairo_command_type_t	 type;
-    cairo_recording_region_type_t region;
     cairo_operator_t		 op;
     cairo_rectangle_int_t	 extents;
     cairo_clip_t		*clip;
@@ -149,15 +155,33 @@
     cairo_bool_t optimize_clears;
     cairo_bool_t has_bilevel_alpha;
     cairo_bool_t has_only_op_over;
+    cairo_bool_t has_tags;
 
     struct bbtree {
 	cairo_box_t extents;
 	struct bbtree *left, *right;
 	cairo_command_header_t *chain;
     } bbtree;
+
+    /* The mutex protects modification to all subsequent fields. */
+    cairo_mutex_t mutex;
+
+    cairo_list_t region_array_list;
+
 } cairo_recording_surface_t;
 
-slim_hidden_proto (cairo_recording_surface_create);
+typedef struct _cairo_recording_region_element {
+    cairo_recording_region_type_t region;
+    unsigned int source_id;
+    unsigned int mask_id;
+} cairo_recording_region_element_t;
+
+typedef struct _cairo_recording_region_array {
+    unsigned int id;
+    cairo_reference_count_t ref_count;
+    cairo_array_t regions; /* cairo_recording_region_element_t */
+    cairo_list_t link;
+} cairo_recording_regions_array_t;
 
 cairo_private cairo_int_status_t
 _cairo_recording_surface_get_path (cairo_surface_t	 *surface,
@@ -173,21 +197,38 @@
 				 cairo_surface_t *target);
 
 cairo_private cairo_status_t
-_cairo_recording_surface_replay_with_clip (cairo_surface_t *surface,
-					   const cairo_matrix_t *surface_transform,
-					   cairo_surface_t *target,
-					   const cairo_clip_t *target_clip);
+_cairo_recording_surface_replay_with_foreground_color (cairo_surface_t     *surface,
+                                                       cairo_surface_t     *target,
+                                                       const cairo_color_t *foreground_color,
+                                                       cairo_bool_t        *foreground_used);
+
+cairo_private cairo_status_t
+_cairo_recording_surface_replay_with_transform (cairo_surface_t          *surface,
+						const cairo_matrix_t     *surface_transform,
+						cairo_surface_t          *target,
+						cairo_bool_t              surface_is_unbounded,
+						cairo_bool_t              replay_all);
 
 cairo_private cairo_status_t
-_cairo_recording_surface_replay_and_create_regions (cairo_surface_t *surface,
+_cairo_recording_surface_replay_with_clip (cairo_surface_t               *surface,
+					   const cairo_matrix_t          *surface_transform,
+					   cairo_surface_t               *target,
+					   const cairo_clip_t            *target_clip);
+
+cairo_private cairo_status_t
+_cairo_recording_surface_replay_and_create_regions (cairo_surface_t      *surface,
+                                                    unsigned int          regions_id,
 						    const cairo_matrix_t *surface_transform,
-						    cairo_surface_t *target,
-						    cairo_bool_t surface_is_unbounded);
+						    cairo_surface_t      *target,
+						    cairo_bool_t          surface_is_unbounded,
+						    cairo_bool_t          replay_all);
+
 cairo_private cairo_status_t
 _cairo_recording_surface_replay_region (cairo_surface_t			*surface,
-					const cairo_rectangle_int_t *surface_extents,
+                                        unsigned int                     regions_id,
+					const cairo_rectangle_int_t     *surface_extents,
 					cairo_surface_t			*target,
-					cairo_recording_region_type_t	region);
+					cairo_recording_region_type_t	 region);
 
 cairo_private cairo_status_t
 _cairo_recording_surface_get_bbox (cairo_recording_surface_t *recording,
@@ -205,4 +246,26 @@
 cairo_private cairo_bool_t
 _cairo_recording_surface_has_only_op_over (cairo_recording_surface_t *surface);
 
+cairo_private cairo_bool_t
+_cairo_recording_surface_has_tags (cairo_surface_t *surface);
+
+cairo_private cairo_status_t
+_cairo_recording_surface_region_array_attach (cairo_surface_t *surface,
+                                              unsigned int    *id);
+
+cairo_private void
+_cairo_recording_surface_region_array_reference (cairo_surface_t *surface,
+                                                 unsigned int     id);
+
+cairo_private void
+_cairo_recording_surface_region_array_remove (cairo_surface_t *surface,
+                                              unsigned int     id);
+
+cairo_private void
+_cairo_debug_print_recording_surface (FILE            *file,
+				      cairo_surface_t *surface,
+                                      unsigned int     regions_id,
+				      int              indent,
+				      cairo_bool_t     recurse);
+
 #endif /* CAIRO_RECORDING_SURFACE_H */