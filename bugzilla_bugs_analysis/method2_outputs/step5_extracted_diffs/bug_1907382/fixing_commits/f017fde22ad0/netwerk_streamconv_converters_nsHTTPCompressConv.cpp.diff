# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: netwerk/streamconv/converters/nsHTTPCompressConv.cpp
# Commit: f017fde22ad0
# Full Hash: f017fde22ad051ef7f96caad31c04d6ef19c77bb
# Author: Randell Jesup <rjesup@mozilla.com>
# Date: 2024-08-13 15:48:32
# Description:
#   Bug 1907382: add belt-and-suspenders assertion for Zstd stream creation r=necko-reviewers,kershaw
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D216869
# ==============================================================================

diff -r 1d0d9ff947e6 -r f017fde22ad0 netwerk/streamconv/converters/nsHTTPCompressConv.cpp
--- a/netwerk/streamconv/converters/nsHTTPCompressConv.cpp	Tue Aug 13 10:11:50 2024 +0000
+++ b/netwerk/streamconv/converters/nsHTTPCompressConv.cpp	Tue Aug 13 10:16:18 2024 +0000
@@ -59,6 +59,7 @@
  public:
   ZstdWrapper() {
     mDStream = ZSTD_createDStream();
+    MOZ_RELEASE_ASSERT(mDStream);  // we'll crash anyways if it fails
     ZSTD_DCtx_setParameter(mDStream, ZSTD_d_windowLogMax, 23 /*8*1024*1024*/);
   }
   ~ZstdWrapper() {
