# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit/JSJitFrameIter.cpp
# Commit: cda8bed19391
# Full Hash: cda8bed193914e4e6bedf875aecd9abbcc74606e
# Author: Jan de Mooij <jdemooij@mozilla.com>
# Date: 2024-08-02 15:37:12
# Description:
#   Bug 1910880 - Use a real JIT exit frame for Wasm JitEntry stub. r=rhunt
#   
#   JS JIT callers can call Wasm code either directly from Ion or through the JitEntry stub.
#   In the JitEntry case, we didn't have a real JS JIT exit frame. To make JS frame iteration
#   still work in this case, a special `JSJitToWasm` frame type was used to transition from Wasm
# ==============================================================================

diff -r 9b92adc2e91f -r cda8bed19391 js/src/jit/JSJitFrameIter.cpp
--- a/js/src/jit/JSJitFrameIter.cpp	Fri Aug 02 06:59:32 2024 +0000
+++ b/js/src/jit/JSJitFrameIter.cpp	Fri Aug 02 07:14:08 2024 +0000
@@ -38,20 +38,16 @@
   MOZ_ASSERT(!TlsContext.get()->inUnsafeCallWithABI);
 }
 
-JSJitFrameIter::JSJitFrameIter(const JitActivation* activation,
-                               FrameType frameType, uint8_t* fp, bool unwinding)
-    : current_(fp), type_(frameType), activation_(activation) {
+JSJitFrameIter::JSJitFrameIter(const JitActivation* activation, uint8_t* fp,
+                               bool unwinding)
+    : current_(fp), type_(FrameType::Exit), activation_(activation) {
   // This constructor is only used when resuming iteration after iterating Wasm
   // frames in the same JitActivation so ignore activation_->bailoutData().
-  //
-  // Note: FrameType::JSJitToWasm is used for JIT => Wasm calls through the Wasm
-  // JIT entry trampoline. FrameType::Exit is used for direct Ion => Wasm calls.
   if (unwinding) {
     MOZ_ASSERT(fp == activation->jsExitFP());
   } else {
     MOZ_ASSERT(fp > activation->jsOrWasmExitFP());
   }
-  MOZ_ASSERT(type_ == FrameType::JSJitToWasm || type_ == FrameType::Exit);
   MOZ_ASSERT(!TlsContext.get()->inUnsafeCallWithABI);
 }
 
@@ -409,9 +405,6 @@
     case FrameType::Exit:
       fprintf(stderr, " Exit frame\n");
       break;
-    case FrameType::JSJitToWasm:
-      fprintf(stderr, " Wasm exit frame\n");
-      break;
   };
   fputc('\n', stderr);
 }
@@ -815,7 +808,6 @@
     case FrameType::TrampolineNative:
     case FrameType::Exit:
     case FrameType::Bailout:
-    case FrameType::JSJitToWasm:
       // Rectifier and Baseline Interpreter entry frames are handled before
       // this switch. The other frame types can't call JS functions directly.
       break;