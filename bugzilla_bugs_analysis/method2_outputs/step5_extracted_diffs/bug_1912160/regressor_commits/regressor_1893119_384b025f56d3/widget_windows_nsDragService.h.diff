# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/windows/nsDragService.h
# Commit: 384b025f56d3
# Full Hash: 384b025f56d3f87e045ecede6b1a16b71c0b5d4f
# Author: David P <daparks@mozilla.com>
# Date: 2024-07-04 16:09:52
# Regressor Bug: 1893119
# File Overlap Count: 1
# Description:
#   Bug 1893119: Part 21 - Separate nsIDragService and nsIDragSession implementations r=gstoll,geckoview-reviewers,rkraesig,win-reviewers,m_kato
#   
#   Split the class inheritance trees for nsIDragService and nsIDragSession.
#   Remember that, before the start of this patch series, the inheritance
#   diagram was:
# ==============================================================================

diff -r beeda5ef3712 -r 384b025f56d3 widget/windows/nsDragService.h
--- a/widget/windows/nsDragService.h	Thu Jul 04 07:48:11 2024 +0000
+++ b/widget/windows/nsDragService.h	Thu Jul 04 07:48:11 2024 +0000
@@ -13,10 +13,10 @@
 struct IDataObject;
 class nsDataObjCollection;
 
-// Temporary inheritance from nsBaseDragService instead of nsBaseDragSession
-// (which nsBaseDragService temporarily inherits).
-// This will be undone at the end of this patch series.
-class nsDragSession : public nsBaseDragService {
+/**
+ *  Windows native nsIDragSession implementation
+ */
+class nsDragSession : public nsBaseDragSession {
  public:
   virtual ~nsDragSession();
 
@@ -30,9 +30,21 @@
   void SetIDataObject(IDataObject* aDataObj);
   IDataObject* GetDataObject() { return mDataObject; }
 
+  MOZ_CAN_RUN_SCRIPT virtual nsresult InvokeDragSessionImpl(
+      nsIWidget* aWidget, nsIArray* anArrayTransferables,
+      const mozilla::Maybe<mozilla::CSSIntRegion>& aRegion,
+      uint32_t aActionType);
+
   MOZ_CAN_RUN_SCRIPT nsresult EndDragSessionImpl(
       bool aDoneDrag, uint32_t aKeyModifiers) override;
 
+  MOZ_CAN_RUN_SCRIPT nsresult StartInvokingDragSession(nsIWidget* aWidget,
+                                                       IDataObject* aDataObj,
+                                                       uint32_t aActionType);
+
+  // A drop occurred within the application vs. outside of it.
+  void SetDroppedLocal();
+
  protected:
   // determine if we have a single data object or one of our private
   // collections
@@ -45,29 +57,16 @@
                        SHDRAGIMAGE* psdi);
 
   IDataObject* mDataObject = nullptr;
-};
-
-// Temporary inheritance from nsDragSession instead of nsBaseDragService
-// (which nsDragSession temporarily inherits).
-// This will be undone at the end of this patch series.
-class nsDragService final : public nsDragSession {
- public:
-  // nsBaseDragService
-  MOZ_CAN_RUN_SCRIPT virtual nsresult InvokeDragSessionImpl(
-      nsIWidget* aWidget, nsIArray* anArrayTransferables,
-      const mozilla::Maybe<mozilla::CSSIntRegion>& aRegion,
-      uint32_t aActionType);
-
-  // native impl.
-  MOZ_CAN_RUN_SCRIPT nsresult StartInvokingDragSession(nsIWidget* aWidget,
-                                                       IDataObject* aDataObj,
-                                                       uint32_t aActionType);
-
-  // A drop occurred within the application vs. outside of it.
-  void SetDroppedLocal();
-
- protected:
   bool mSentLocalDropEvent = false;
 };
 
+/**
+ *  Windows native nsIDragService implementation
+ */
+class nsDragService final : public nsBaseDragService {
+ public:
+  already_AddRefed<nsIDragSession> CreateDragSession() override;
+
+};
+
 #endif  // nsDragService_h__