# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/layers/ipc/CanvasTranslator.cpp
# Commit: b62942faef2f
# Full Hash: b62942faef2f7106add3113546adef97a14e05b2
# Author: Lee Salzman <lsalzman@mozilla.com>
# Date: 2024-08-22 09:21:17
# Description:
#   Bug 1913773 - Ensure mCurrentShmem is valid. r=aosmond
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D219832
# ==============================================================================

diff -r 1a4a6fac8bba -r b62942faef2f gfx/layers/ipc/CanvasTranslator.cpp
--- a/gfx/layers/ipc/CanvasTranslator.cpp	Wed Aug 21 23:31:31 2024 +0000
+++ b/gfx/layers/ipc/CanvasTranslator.cpp	Thu Aug 22 03:35:52 2024 +0000
@@ -296,7 +296,7 @@
   CheckAndSignalWriter();
 
   // Default sized buffers will have been queued for recycling.
-  if (mCurrentShmem.Size() == mDefaultBufferSize) {
+  if (mCurrentShmem.IsValid() && mCurrentShmem.Size() == mDefaultBufferSize) {
     mCanvasShmems.emplace(std::move(mCurrentShmem));
   }
 