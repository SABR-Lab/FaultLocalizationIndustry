# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: gfx/layers/ipc/CanvasTranslator.h
# Commit: b62942faef2f
# Full Hash: b62942faef2f7106add3113546adef97a14e05b2
# Author: Lee Salzman <lsalzman@mozilla.com>
# Date: 2024-08-22 09:21:17
# Description:
#   Bug 1913773 - Ensure mCurrentShmem is valid. r=aosmond
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D219832
# ==============================================================================

diff -r 1a4a6fac8bba -r b62942faef2f gfx/layers/ipc/CanvasTranslator.h
--- a/gfx/layers/ipc/CanvasTranslator.h	Wed Aug 21 23:31:31 2024 +0000
+++ b/gfx/layers/ipc/CanvasTranslator.h	Thu Aug 22 03:35:52 2024 +0000
@@ -444,8 +444,12 @@
 
   struct CanvasShmem {
     RefPtr<ipc::SharedMemory> shmem;
-    auto Size() { return shmem->Size(); }
+    bool IsValid() const { return !!shmem; }
+    auto Size() { return shmem ? shmem->Size() : 0; }
     gfx::MemReader CreateMemReader() {
+      if (!shmem) {
+        return {nullptr, 0};
+      }
       return {static_cast<char*>(shmem->Memory()), Size()};
     }
   };
