# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/components/style/properties/properties.mako.rs
# Commit: 2de2533b5e62
# Full Hash: 2de2533b5e622f7f6f75e6ad9ec773b1cf997cc8
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-09-11 21:40:06
# Regressor Bug: 1909625
# File Overlap Count: 2
# Description:
#   Bug 1909625 - Ignore CSS zoom and text zoom for canvas. r=gfx-reviewers,lsalzman
#   
#   The spec doesn't mention anything about applying them, and other
#   browsers don't, so let's just be consistent...
#   
# ==============================================================================

diff -r c5bedc884f33 -r 2de2533b5e62 servo/components/style/properties/properties.mako.rs
--- a/servo/components/style/properties/properties.mako.rs	Wed Sep 11 13:21:58 2024 +0000
+++ b/servo/components/style/properties/properties.mako.rs	Wed Sep 11 13:46:45 2024 +0000
@@ -2722,6 +2722,16 @@
         self.get_box().clone_zoom()
     }
 
+    /// The zoom we need to apply for this element, without including ancestor effective zooms.
+    pub fn resolved_specified_zoom(&self) -> computed::Zoom {
+        let zoom = self.specified_zoom();
+        if zoom.is_document() {
+            self.inherited_effective_zoom().inverted()
+        } else {
+            zoom
+        }
+    }
+
     /// Inherited zoom.
     pub fn inherited_effective_zoom(&self) -> computed::Zoom {
         self.inherited_style.effective_zoom
@@ -2758,7 +2768,7 @@
         let lh = device.calc_line_height(&font, writing_mode, None);
         if line_height_base == LineHeightBase::InheritedStyle {
             // Apply our own zoom if our style source is the parent style.
-            computed::NonNegativeLength::new(self.get_box().clone_zoom().zoom(lh.px()))
+            computed::NonNegativeLength::new(self.resolved_specified_zoom().zoom(lh.px()))
         } else {
             lh
         }