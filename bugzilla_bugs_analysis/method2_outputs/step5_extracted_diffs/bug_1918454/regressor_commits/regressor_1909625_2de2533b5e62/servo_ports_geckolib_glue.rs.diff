# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: servo/ports/geckolib/glue.rs
# Commit: 2de2533b5e62
# Full Hash: 2de2533b5e622f7f6f75e6ad9ec773b1cf997cc8
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-09-11 21:40:06
# Regressor Bug: 1909625
# File Overlap Count: 2
# Description:
#   Bug 1909625 - Ignore CSS zoom and text zoom for canvas. r=gfx-reviewers,lsalzman
#   
#   The spec doesn't mention anything about applying them, and other
#   browsers don't, so let's just be consistent...
#   
# ==============================================================================

diff -r c5bedc884f33 -r 2de2533b5e62 servo/ports/geckolib/glue.rs
--- a/servo/ports/geckolib/glue.rs	Wed Sep 11 13:21:58 2024 +0000
+++ b/servo/ports/geckolib/glue.rs	Wed Sep 11 13:46:45 2024 +0000
@@ -5054,6 +5054,21 @@
 }
 
 #[no_mangle]
+pub unsafe extern "C" fn Servo_DeclarationBlock_SanitizeForCanvas(
+    declarations: &LockedDeclarationBlock,
+) {
+    use style::properties::PropertyDeclaration;
+    use style::values::specified::{LineHeight, XTextScale, Zoom};
+    // From canvas spec, force to set line-height property to 'normal' font property.
+    // Also, for compat, disable text scaling and CSS zoom.
+    write_locked_arc(declarations, |decls: &mut PropertyDeclarationBlock| {
+        decls.push(PropertyDeclaration::LineHeight(LineHeight::Normal), Importance::Normal);
+        decls.push(PropertyDeclaration::Zoom(Zoom::Document), Importance::Normal);
+        decls.push(PropertyDeclaration::XTextScale(XTextScale::None), Importance::Normal);
+    });
+}
+
+#[no_mangle]
 pub unsafe extern "C" fn Servo_DeclarationBlock_SetProperty(
     declarations: &LockedDeclarationBlock,
     property: &nsACString,