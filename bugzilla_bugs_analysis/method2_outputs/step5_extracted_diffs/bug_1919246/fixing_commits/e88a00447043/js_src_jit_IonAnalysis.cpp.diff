# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: js/src/jit/IonAnalysis.cpp
# Commit: e88a00447043
# Full Hash: e88a004470438bca174824203a6438444875e71f
# Author: Jan de Mooij <jdemooij@mozilla.com>
# Date: 2024-09-18 04:13:51
# Description:
#   Bug 1919246 - Back out D221953 and add tests. r=mgaudet
#   
#   For now back out D221953 because it was an optional change to improve codegen a bit
#   for loops that contain an OSR loop, but it's probably not worth the complexity to
#   try to handle this.
# ==============================================================================

diff -r a7c3ba245e04 -r e88a00447043 js/src/jit/IonAnalysis.cpp
--- a/js/src/jit/IonAnalysis.cpp	Tue Sep 17 16:21:19 2024 +0000
+++ b/js/src/jit/IonAnalysis.cpp	Tue Sep 17 16:29:02 2024 +0000
@@ -5081,6 +5081,13 @@
       continue;
     }
 
+    // If there's an OSR block entering the loop in the middle, it's tricky,
+    // so don't try to handle it, for now.
+    if (canOsr) {
+      UnmarkLoopBlocks(graph, header);
+      continue;
+    }
+
     // Move all blocks between header and backedge that aren't marked to
     // the end of the loop, making the loop itself contiguous.
     MakeLoopContiguous(graph, header, numMarked);
