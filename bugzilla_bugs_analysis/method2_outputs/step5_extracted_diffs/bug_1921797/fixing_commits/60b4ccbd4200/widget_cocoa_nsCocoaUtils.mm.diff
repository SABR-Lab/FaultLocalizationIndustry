# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: widget/cocoa/nsCocoaUtils.mm
# Commit: 60b4ccbd4200
# Full Hash: 60b4ccbd42007a3959517c1b5fed741ba8b9d79a
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-10-02 09:50:09
# Description:
#   Bug 1921797 - Check for degenerate ratio in nsCocoaUtis. r=mac-reviewers,mstange,bradwerth
#   
#   This is the straight-forward, uncontroversial fix, that can be uplifted.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D224211
# ==============================================================================

diff -r 5f5ca231643e -r 60b4ccbd4200 widget/cocoa/nsCocoaUtils.mm
--- a/widget/cocoa/nsCocoaUtils.mm	Tue Oct 01 20:02:38 2024 +0000
+++ b/widget/cocoa/nsCocoaUtils.mm	Tue Oct 01 20:31:41 2024 +0000
@@ -515,7 +515,7 @@
   {
     const bool gotWidth = NS_SUCCEEDED(aImage->GetWidth(&width));
     const bool gotHeight = NS_SUCCEEDED(aImage->GetHeight(&height));
-    if (auto ratio = aImage->GetIntrinsicRatio()) {
+    if (auto ratio = aImage->GetIntrinsicRatio(); ratio && *ratio) {
       if (gotWidth != gotHeight) {
         if (gotWidth) {
           height = ratio->Inverted().ApplyTo(width);
