# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/quota/ActorsParent.cpp
# Commit: f799f35b1c84
# Full Hash: f799f35b1c84a8c16f1cca5e09cda13372dc8528
# Author: Jan Varga <jvarga@mozilla.com>
# Date: 2024-10-10 09:22:33
# Regressor Bug: 1866402
# File Overlap Count: 1
# Description:
#   Bug 1866402 - Change all origin operations which uninit origins to return an array of origin metadata; r=dom-storage-reviewers,jari
#   
#   This is a preparation for unsetting some flags when origins are either cleared
#   or reset.
#   
# ==============================================================================

diff -r 0afeb47f38b0 -r f799f35b1c84 dom/quota/ActorsParent.cpp
--- a/dom/quota/ActorsParent.cpp	Wed Oct 09 22:16:49 2024 +0000
+++ b/dom/quota/ActorsParent.cpp	Wed Oct 09 22:16:50 2024 +0000
@@ -96,6 +96,7 @@
 #include "mozilla/dom/quota/DirectoryLock.h"
 #include "mozilla/dom/quota/DirectoryLockInlines.h"
 #include "mozilla/dom/quota/FileUtils.h"
+#include "mozilla/dom/quota/MozPromiseUtils.h"
 #include "mozilla/dom/quota/PersistenceType.h"
 #include "mozilla/dom/quota/QuotaManagerService.h"
 #include "mozilla/dom/quota/ResultExtensions.h"
@@ -5844,7 +5845,11 @@
 
   clearOriginOp->RunImmediately();
 
-  return clearOriginOp->OnResults();
+  return Map<BoolPromise>(
+      clearOriginOp->OnResults(),
+      [](OriginMetadataArrayPromise::ResolveOrRejectValue&& aValue) {
+        return true;
+      });
 }
 
 RefPtr<BoolPromise> QuotaManager::ClearStoragesForClient(
@@ -5875,7 +5880,11 @@
 
   clearStoragesForOriginPrefixOp->RunImmediately();
 
-  return clearStoragesForOriginPrefixOp->OnResults();
+  return Map<BoolPromise>(
+      clearStoragesForOriginPrefixOp->OnResults(),
+      [](OriginMetadataArrayPromise::ResolveOrRejectValue&& aValue) {
+        return true;
+      });
 }
 
 RefPtr<BoolPromise> QuotaManager::ClearStoragesForOriginAttributesPattern(
@@ -5889,7 +5898,11 @@
 
   clearDataOp->RunImmediately();
 
-  return clearDataOp->OnResults();
+  return Map<BoolPromise>(
+      clearDataOp->OnResults(),
+      [](OriginMetadataArrayPromise::ResolveOrRejectValue&& aValue) {
+        return true;
+      });
 }
 
 RefPtr<BoolPromise> QuotaManager::ClearPrivateRepository() {
@@ -5940,7 +5953,11 @@
 
   shutdownOriginOp->RunImmediately();
 
-  return shutdownOriginOp->OnResults();
+  return Map<BoolPromise>(
+      shutdownOriginOp->OnResults(),
+      [](OriginMetadataArrayPromise::ResolveOrRejectValue&& aValue) {
+        return true;
+      });
 }
 
 RefPtr<BoolPromise> QuotaManager::ShutdownStoragesForClient(