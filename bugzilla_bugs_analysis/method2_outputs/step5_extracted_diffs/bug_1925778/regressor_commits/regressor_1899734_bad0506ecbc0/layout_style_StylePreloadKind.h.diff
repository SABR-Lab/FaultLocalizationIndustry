# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/style/StylePreloadKind.h
# Commit: bad0506ecbc0
# Full Hash: bad0506ecbc0f1448e23a4398bf1c2e6aeb3f529
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-09-26 21:26:53
# Regressor Bug: 1899734
# File Overlap Count: 1
# Description:
#   Bug 1921110 - Distinguish rel=preload from early-hints preload. r=arai,firefox-style-system-reviewers,zrhoffman
#   
#   No behavior change right now, but this is needed to fix the initiator in
#   bug 1899734.
#   
# ==============================================================================

diff -r 722852dd8923 -r bad0506ecbc0 layout/style/StylePreloadKind.h
--- a/layout/style/StylePreloadKind.h	Thu Sep 26 15:23:51 2024 +0000
+++ b/layout/style/StylePreloadKind.h	Thu Sep 26 15:33:15 2024 +0000
@@ -22,11 +22,32 @@
   FromLinkRelPreloadElement,
   // A preload for a "Link" rel=preload response header.
   FromLinkRelPreloadHeader,
+  // A preload from an early-hints header.
+  FromEarlyHintsHeader,
 };
 
-inline bool IsLinkRelPreload(StylePreloadKind aKind) {
+inline bool IsLinkRelPreloadOrEarlyHint(StylePreloadKind aKind) {
   return aKind == StylePreloadKind::FromLinkRelPreloadElement ||
-         aKind == StylePreloadKind::FromLinkRelPreloadHeader;
+         aKind == StylePreloadKind::FromLinkRelPreloadHeader ||
+         aKind == StylePreloadKind::FromEarlyHintsHeader;
+}
+
+inline bool ShouldAssumeStandardsMode(StylePreloadKind aKind) {
+  switch (aKind) {
+    case StylePreloadKind::FromLinkRelPreloadHeader:
+    case StylePreloadKind::FromEarlyHintsHeader:
+      // For header preloads we guess non-quirks, because otherwise it is
+      // useless for modern pages.
+      //
+      // Link element preload is generally good because the speculative html
+      // parser deals with quirks mode properly.
+      return true;
+    case StylePreloadKind::None:
+    case StylePreloadKind::FromParser:
+    case StylePreloadKind::FromLinkRelPreloadElement:
+      break;
+  }
+  return false;
 }
 
 }  // namespace mozilla::css