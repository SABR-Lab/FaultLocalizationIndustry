# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/generic/nsFrameStateBits.h
# Commit: f2c924263ffe
# Full Hash: f2c924263ffece6d0b30e6a52dfd32792c5bf5ab
# Author: Frédéric Wang <fwang@igalia.com>
# Date: 2024-01-16 16:37:21
# Regressor Bug: 1765615
# File Overlap Count: 1
# Description:
#   Bug 1765615 - Introduce NS_BLOCK_DYNAMIC_BFC state bit. r=layout-reviewers,emilio
#   
#   After D198523, NS_BLOCK_FLOAT_MGR and NS_BLOCK_MARGIN_ROOT are always
#   set simultaneously when initiating a frame, so we can merge them into a
#   single NS_BLOCK_STATIC_BFC flag. The freed bit is used to define a new
# ==============================================================================

diff -r d72041117125 -r f2c924263ffe layout/generic/nsFrameStateBits.h
--- a/layout/generic/nsFrameStateBits.h	Tue Jan 16 07:00:26 2024 +0000
+++ b/layout/generic/nsFrameStateBits.h	Tue Jan 16 07:58:47 2024 +0000
@@ -528,24 +528,28 @@
 
 FRAME_STATE_BIT(Block, 21, NS_BLOCK_HAS_PUSHED_FLOATS)
 
-// This indicates that this is a frame from which child margins can be
+// This indicates that the frame establishes a block formatting context i.e.
+//
+// 1. This indicates that this is a frame from which child margins can be
 // calculated. The absence of this flag implies that child margin calculations
 // should ignore the frame and look further up the parent chain. Used in
 // nsBlockReflowContext::ComputeCollapsedBStartMargin() via
 // nsBlockFrame::IsMarginRoot().
-//
 // This causes the BlockReflowState's constructor to set the
 // mIsBStartMarginRoot and mIsBEndMarginRoot flags.
-FRAME_STATE_BIT(Block, 22, NS_BLOCK_MARGIN_ROOT)
+//
+// 2. This indicates that a block frame should create its own float manager.
+// This is required by each block frame that can contain floats. The float
+// manager is used to reserve space for the floated frames.
+FRAME_STATE_BIT(Block, 22, NS_BLOCK_STATIC_BFC)
 
-// This indicates that a block frame should create its own float manager. This
-// is required by each block frame that can contain floats. The float manager is
-// used to reserve space for the floated frames.
-FRAME_STATE_BIT(Block, 23, NS_BLOCK_FLOAT_MGR)
+// This is the same as NS_BLOCK_STATIC_BFC but can be updated dynamically after
+// the frame construction (e.g. paint/layout containment).
+// FIXME(bug 1874823): Try and merge this and NS_BLOCK_STATIC_BFC.
+FRAME_STATE_BIT(Block, 23, NS_BLOCK_DYNAMIC_BFC)
 
-// For setting the relevant bits on a block formatting context:
-#define NS_BLOCK_FORMATTING_CONTEXT_STATE_BITS \
-(NS_BLOCK_FLOAT_MGR | NS_BLOCK_MARGIN_ROOT)
+// For testing the relevant bits on a block formatting context:
+#define NS_BLOCK_BFC_STATE_BITS (NS_BLOCK_STATIC_BFC | NS_BLOCK_DYNAMIC_BFC)
 
 FRAME_STATE_BIT(Block, 24, NS_BLOCK_HAS_LINE_CURSOR)
 