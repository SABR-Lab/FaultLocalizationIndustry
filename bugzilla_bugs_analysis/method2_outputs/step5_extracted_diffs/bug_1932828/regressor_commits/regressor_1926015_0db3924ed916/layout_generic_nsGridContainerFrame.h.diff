# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/generic/nsGridContainerFrame.h
# Commit: 0db3924ed916
# Full Hash: 0db3924ed9160b5d0ae0693c24082a11c43d49c2
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-11-22 09:28:00
# Regressor Bug: 1926015
# File Overlap Count: 1
# Description:
#   Bug 1926015 - Percentage-basis aware intrinsic cache. r=TYLin,dholbert
#   
#   This avoids returning wrong intrinsic values with different calls into
#   intrinsic size computation, which is wrong by definition.
#   
# ==============================================================================

diff -r 8a1a1450e750 -r 0db3924ed916 layout/generic/nsGridContainerFrame.h
--- a/layout/generic/nsGridContainerFrame.h	Thu Nov 21 19:17:26 2024 +0000
+++ b/layout/generic/nsGridContainerFrame.h	Thu Nov 21 19:55:31 2024 +0000
@@ -10,6 +10,7 @@
 #define nsGridContainerFrame_h___
 
 #include "mozilla/CSSOrderAwareFrameIterator.h"
+#include "mozilla/IntrinsicISizesCache.h"
 #include "mozilla/MathAlgorithms.h"
 #include "mozilla/Maybe.h"
 #include "mozilla/HashTable.h"
@@ -333,9 +334,7 @@
       mozilla::PresShell* aPresShell, ComputedStyle* aStyle);
   explicit nsGridContainerFrame(ComputedStyle* aStyle,
                                 nsPresContext* aPresContext)
-      : nsContainerFrame(aStyle, aPresContext, kClassID),
-        mCachedMinISize(NS_INTRINSIC_ISIZE_UNKNOWN),
-        mCachedPrefISize(NS_INTRINSIC_ISIZE_UNKNOWN) {
+      : nsContainerFrame(aStyle, aPresContext, kClassID) {
     for (auto& perAxisBaseline : mBaseline) {
       for (auto& baseline : perAxisBaseline) {
         baseline = NS_INTRINSIC_ISIZE_UNKNOWN;
@@ -532,11 +531,7 @@
   void AddImplicitNamedAreasInternal(LineNameList& aNameList,
                                      ImplicitNamedAreas*& aAreas);
 
-  /**
-   * Cached values to optimize IntrinsicISize().
-   */
-  nscoord mCachedMinISize;
-  nscoord mCachedPrefISize;
+  mozilla::IntrinsicISizesCache mCachedIntrinsicSizes;
 
   // Our baselines, one per BaselineSharingGroup per axis.
   PerLogicalAxis<PerBaseline<nscoord>> mBaseline;