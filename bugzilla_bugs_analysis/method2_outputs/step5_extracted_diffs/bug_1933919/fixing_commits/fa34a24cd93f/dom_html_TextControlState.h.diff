# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/html/TextControlState.h
# Commit: fa34a24cd93f
# Full Hash: fa34a24cd93f2f33cdf6a1bba8f9ec420653cbbc
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-11-29 05:32:38
# Description:
#   Bug 1933919 - Don't check for maxlength when collapsing the selection. r=masayuki
#   
#   Apparently in some situations it might not be set? Not super familiar
#   with this code.
#   
# ==============================================================================

diff -r 495c6765094e -r fa34a24cd93f dom/html/TextControlState.h
--- a/dom/html/TextControlState.h	Fri Nov 29 00:35:55 2024 +0000
+++ b/dom/html/TextControlState.h	Fri Nov 29 02:20:58 2024 +0000
@@ -349,18 +349,17 @@
     uint32_t GetStart() const { return mStart; }
     bool SetStart(uint32_t value) {
       uint32_t newValue = std::min(value, *mMaxLength);
-      bool changed = mStart != newValue;
-      mStart = newValue;
-      mIsDirty |= changed;
-      return changed;
+      return SetStartInternal(newValue);
     }
     uint32_t GetEnd() const { return mEnd; }
     bool SetEnd(uint32_t value) {
       uint32_t newValue = std::min(value, *mMaxLength);
-      bool changed = mEnd != newValue;
-      mEnd = newValue;
-      mIsDirty |= changed;
-      return changed;
+      return SetEndInternal(newValue);
+    }
+    void CollapseToStart() {
+      // 0 is always a fine value regardless of max length.
+      SetStartInternal(0);
+      SetEndInternal(0);
     }
     SelectionDirection GetDirection() const { return mDirection; }
     bool SetDirection(SelectionDirection value) {
@@ -383,6 +382,20 @@
     void SetIsDirty() { mIsDirty = true; }
 
    private:
+    bool SetStartInternal(uint32_t aNewValue) {
+      bool changed = mStart != aNewValue;
+      mStart = aNewValue;
+      mIsDirty |= changed;
+      return changed;
+    }
+
+    bool SetEndInternal(uint32_t aNewValue) {
+      bool changed = mEnd != aNewValue;
+      mEnd = aNewValue;
+      mIsDirty |= changed;
+      return changed;
+    }
+
     uint32_t mStart = 0;
     uint32_t mEnd = 0;
     Maybe<uint32_t> mMaxLength;