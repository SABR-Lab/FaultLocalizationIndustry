# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/base/RestyleManager.cpp
# Commit: 68ff26df3346
# Full Hash: 68ff26df33468fe750b39f175b43b8507718ece4
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-01-18 21:34:14
# Regressor Bug: 1875137
# File Overlap Count: 1
# Description:
#   Bug 1875137 - Don't ignore state changes in display: none subtrees if needed for :has(). r=dshin
#   
#   Just like we do for attribute invalidation.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D198929
# ==============================================================================

diff -r f61c77fafa8a -r 68ff26df3346 layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp	Thu Jan 18 13:11:53 2024 +0000
+++ b/layout/base/RestyleManager.cpp	Thu Jan 18 13:18:51 2024 +0000
@@ -3445,7 +3445,9 @@
   // undisplayed elements, since we don't know if it is needed.
   IncrementUndisplayedRestyleGeneration();
 
-  if (!aElement->HasServoData()) {
+  if (!aElement->HasServoData() &&
+      !(aElement->GetSelectorFlags() &
+        NodeSelectorFlags::RelativeSelectorSearchDirectionAncestorSibling)) {
     return;
   }
 