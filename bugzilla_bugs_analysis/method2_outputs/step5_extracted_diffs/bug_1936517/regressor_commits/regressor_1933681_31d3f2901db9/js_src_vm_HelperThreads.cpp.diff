# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/src/vm/HelperThreads.cpp
# Commit: 31d3f2901db9
# Full Hash: 31d3f2901db927a29898c5208a2624b4225382c1
# Author: Tooru Fujisawa <arai_a@mac.com>
# Date: 2024-12-05 09:58:04
# Regressor Bug: 1933681
# File Overlap Count: 1
# Description:
#   Bug 1933681 - Part 1: Allocate InitialStencilAndDelazifications in CompileGlobalScriptToStencilAndMaybeInstantiate. r=nbp
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D230387
# ==============================================================================

diff -r 2694b90c0deb -r 31d3f2901db9 js/src/vm/HelperThreads.cpp
--- a/js/src/vm/HelperThreads.cpp	Thu Dec 05 02:39:42 2024 +0200
+++ b/js/src/vm/HelperThreads.cpp	Wed Dec 04 23:44:33 2024 +0000
@@ -1096,7 +1096,7 @@
 
 void js::StartOffThreadDelazification(
     JSContext* maybeCx, const JS::ReadOnlyCompileOptions& options,
-    const frontend::CompilationStencil& stencil) {
+    frontend::InitialStencilAndDelazifications* stencils) {
   // Skip delazify tasks if we parse everything on-demand or ahead.
   auto strategy = options.eagerDelazificationStrategy();
   if (strategy == JS::DelazificationOption::OnDemandOnly ||
@@ -1115,7 +1115,7 @@
 
   JSRuntime* maybeRuntime = maybeCx ? maybeCx->runtime() : nullptr;
   UniquePtr<DelazifyTask> task;
-  task = DelazifyTask::Create(maybeRuntime, options, stencil);
+  task = DelazifyTask::Create(maybeRuntime, options, stencils);
   if (!task) {
     return;
   }
@@ -1129,14 +1129,14 @@
 
 UniquePtr<DelazifyTask> DelazifyTask::Create(
     JSRuntime* maybeRuntime, const JS::ReadOnlyCompileOptions& options,
-    const frontend::CompilationStencil& stencil) {
+    frontend::InitialStencilAndDelazifications* stencils) {
   UniquePtr<DelazifyTask> task;
   task.reset(js_new<DelazifyTask>(maybeRuntime, options.prefableOptions()));
   if (!task) {
     return nullptr;
   }
 
-  if (!task->init(options, stencil)) {
+  if (!task->init(options, stencils)) {
     // In case of errors, skip this and delazify on-demand.
     return nullptr;
   }
@@ -1158,8 +1158,8 @@
 }
 
 bool DelazifyTask::init(const JS::ReadOnlyCompileOptions& options,
-                        const frontend::CompilationStencil& stencil) {
-  return delazificationCx.init(options, stencil);
+                        frontend::InitialStencilAndDelazifications* stencils) {
+  return delazificationCx.init(options, stencils);
 }
 
 size_t DelazifyTask::sizeOfExcludingThis(