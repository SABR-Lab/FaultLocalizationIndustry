# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/cookie/CookieService.h
# Commit: 08acd8256071
# Full Hash: 08acd8256071ad86345dec3fa66767635b07a4b1
# Author: Tim Huang <tihuang@mozilla.com>
# Date: 2025-01-09 04:16:57
# Regressor Bug: 1915355
# File Overlap Count: 1
# Description:
#   Bug 1915355 - Part 4: Implement the third-party cookie blocking excpetion in CookieService. r=cookie-reviewers,baku,valentin
#   
#   The patch integrates the third-party cookie blocking excpetion in
#   CookieService.
#   
# ==============================================================================

diff -r 3ae9463ee988 -r 08acd8256071 netwerk/cookie/CookieService.h
--- a/netwerk/cookie/CookieService.h	Wed Jan 08 19:25:58 2025 +0000
+++ b/netwerk/cookie/CookieService.h	Wed Jan 08 19:25:59 2025 +0000
@@ -13,10 +13,12 @@
 
 #include "Cookie.h"
 #include "CookieCommons.h"
+#include "ThirdPartyCookieBlockingExceptions.h"
 
 #include "nsString.h"
 #include "nsIMemoryReporter.h"
 #include "mozilla/MemoryReporting.h"
+#include "mozilla/MozPromise.h"
 
 class nsIConsoleReportCollector;
 class nsICookieJarSettings;
@@ -58,6 +60,12 @@
   static already_AddRefed<nsICookieService> GetXPCOMSingleton();
   nsresult Init();
 
+  static void Update3PCBExceptionInfo(nsIChannel* aChannel);
+
+  ThirdPartyCookieBlockingExceptions& ThirdPartyCookieBlockingExceptionsRef() {
+    return mThirdPartyCookieBlockingExceptions;
+  }
+
   /**
    * Start watching the observer service for messages indicating that an app has
    * been uninstalled.  When an app is uninstalled, we get the cookie service
@@ -126,6 +134,8 @@
   nsCOMPtr<mozIThirdPartyUtil> mThirdPartyUtil;
   nsCOMPtr<nsIEffectiveTLDService> mTLDService;
 
+  ThirdPartyCookieBlockingExceptions mThirdPartyCookieBlockingExceptions;
+
   // we have two separate Cookie Storages: one for normal browsing and one for
   // private browsing.
   RefPtr<CookieStorage> mPersistentStorage;