# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/gtk/DMABufSurface.h
# Commit: 20a5670ea914
# Full Hash: 20a5670ea9141e93bcdeca586122a82ba1ce8d49
# Author: stransky <stransky@redhat.com>
# Date: 2025-01-08 04:42:02
# Regressor Bug: 1940037
# File Overlap Count: 1
# Description:
#   Bug 1940037 [Wayland] Use SURFACE_YUV/SURFACE_RGBA dmabuf surface type only r=emilio
#   
#   We need to add exact FOURCC dmabuf surface format with correct modifers so use RGBA/YUV surface type only.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D233240
# ==============================================================================

diff -r 38d1226c5470 -r 20a5670ea914 widget/gtk/DMABufSurface.h
--- a/widget/gtk/DMABufSurface.h	Tue Jan 07 11:50:02 2025 +0000
+++ b/widget/gtk/DMABufSurface.h	Tue Jan 07 11:58:50 2025 +0000
@@ -78,12 +78,11 @@
 
   enum SurfaceType {
     SURFACE_RGBA = 0,
-    SURFACE_NV12 = 1,
-    SURFACE_YUV420 = 2,
+    SURFACE_YUV = 1,
   };
 
 #ifdef MOZ_LOGGING
-  constexpr static const char* sSurfaceTypeNames[] = {"RGBA", "NV12", "YUV420"};
+  constexpr static const char* sSurfaceTypeNames[] = {"RGBA", "YUV"};
 #endif
 
   // Import surface from SurfaceDescriptor. This is usually
@@ -217,14 +216,18 @@
 
   virtual ~DMABufSurface();
 
+  // Surface type (RGBA or YUV)
   SurfaceType mSurfaceType;
-  uint64_t mBufferModifiers[DMABUF_BUFFER_PLANES];
 
-  int mBufferPlaneCount;
+  // Configuration of surface planes, it depends on surface modifiers.
+  // RGBA surface may use one RGBA plane or two planes (RGB + A)
+  // YUV surfaces use various planes setup (Y + UV planes or Y+U+V planes)
+  int mBufferPlaneCount = 0;
   RefPtr<mozilla::gfx::FileHandleWrapper> mDmabufFds[DMABUF_BUFFER_PLANES];
   int32_t mDrmFormats[DMABUF_BUFFER_PLANES];
   int32_t mStrides[DMABUF_BUFFER_PLANES];
   int32_t mOffsets[DMABUF_BUFFER_PLANES];
+  uint64_t mBufferModifiers[DMABUF_BUFFER_PLANES];
 
   struct gbm_bo* mGbmBufferObject[DMABUF_BUFFER_PLANES];
   void* mMappedRegion[DMABUF_BUFFER_PLANES];
