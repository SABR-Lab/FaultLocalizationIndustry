# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/Document.cpp
# Commit: 130794a57298
# Full Hash: 130794a57298f50adb259e805866e563ec72cf63
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2024-11-20 04:44:54
# Regressor Bug: 1388910
# File Overlap Count: 3
# Description:
#   Bug 1388910 - Remove -moz-user-modify property. r=dshin
#   
#   We successfully unshipped it in bug 1920118.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D229530
# ==============================================================================

diff -r 059d2181d771 -r 130794a57298 dom/base/Document.cpp
--- a/dom/base/Document.cpp	Tue Nov 19 19:31:58 2024 +0000
+++ b/dom/base/Document.cpp	Tue Nov 19 19:35:35 2024 +0000
@@ -1368,7 +1368,6 @@
       mStyleSetFilled(false),
       mQuirkSheetAdded(false),
       mContentEditableSheetAdded(false),
-      mDesignModeSheetAdded(false),
       mMayHaveTitleElement(false),
       mDOMLoadingSet(false),
       mDOMInteractiveSet(false),
@@ -3279,17 +3278,12 @@
   mStyleSetFilled = true;
 }
 
-void Document::RemoveContentEditableStyleSheets() {
+void Document::RemoveContentEditableStyleSheet() {
   MOZ_ASSERT(IsHTMLOrXHTML());
 
   ServoStyleSet& styleSet = EnsureStyleSet();
   auto* cache = GlobalStyleSheetCache::Singleton();
   bool changed = false;
-  if (mDesignModeSheetAdded) {
-    styleSet.RemoveStyleSheet(*cache->DesignModeSheet());
-    mDesignModeSheetAdded = false;
-    changed = true;
-  }
   if (mContentEditableSheetAdded) {
     styleSet.RemoveStyleSheet(*cache->ContentEditableSheet());
     mContentEditableSheetAdded = false;
@@ -3301,7 +3295,7 @@
   }
 }
 
-void Document::AddContentEditableStyleSheetsToStyleSet(bool aDesignMode) {
+void Document::AddContentEditableStyleSheetToStyleSet() {
   MOZ_ASSERT(IsHTMLOrXHTML());
   MOZ_DIAGNOSTIC_ASSERT(mStyleSetFilled,
                         "Caller should ensure we're being rendered");
@@ -3314,15 +3308,6 @@
     mContentEditableSheetAdded = true;
     changed = true;
   }
-  if (mDesignModeSheetAdded != aDesignMode) {
-    if (mDesignModeSheetAdded) {
-      styleSet.RemoveStyleSheet(*cache->DesignModeSheet());
-    } else {
-      styleSet.AppendStyleSheet(*cache->DesignModeSheet());
-    }
-    mDesignModeSheetAdded = !mDesignModeSheetAdded;
-    changed = true;
-  }
   if (changed) {
     ApplicableStylesChanged();
   }
@@ -6037,7 +6022,7 @@
   if (IsEditingOn()) {
     mEditingState = EditingState::eTearingDown;
     if (IsHTMLOrXHTML()) {
-      RemoveContentEditableStyleSheets();
+      RemoveContentEditableStyleSheet();
     }
   }
 }
@@ -6248,7 +6233,7 @@
     // because new style may change whether focused element will be focusable
     // or not.
     if (IsHTMLOrXHTML()) {
-      AddContentEditableStyleSheetsToStyleSet(designMode);
+      AddContentEditableStyleSheetToStyleSet();
     }
 
     if (designMode) {
@@ -7407,7 +7392,6 @@
   mStyleSetFilled = false;
   mQuirkSheetAdded = false;
   mContentEditableSheetAdded = false;
-  mDesignModeSheetAdded = false;
 }
 
 void Document::DisallowBFCaching(uint32_t aStatus) {