# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/workers/WorkerNavigator.cpp
# Commit: 66b1ea756834
# Full Hash: 66b1ea7568345993cf943e82038f7bec36cf6ea1
# Author: Andrew Sutherland <asutherland@asutherland.org>
# Date: 2025-01-25 09:38:30
# Description:
#   Bug 1941852 - Properly traverse and unlink ServiceWorkerContainer. r=smaug,dom-worker-reviewers
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D235398
# ==============================================================================

diff -r 3202bd04101f -r 66b1ea756834 dom/workers/WorkerNavigator.cpp
--- a/dom/workers/WorkerNavigator.cpp	Fri Jan 24 20:26:33 2025 +0200
+++ b/dom/workers/WorkerNavigator.cpp	Fri Jan 24 18:02:03 2025 +0000
@@ -53,6 +53,7 @@
   NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mWebGpu)
   NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mLocks)
   NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mPermissions)
+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mServiceWorkerContainer)
 NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END
 
 WorkerNavigator::WorkerNavigator(const NavigatorProperties& aProperties,
@@ -92,6 +93,8 @@
   }
 
   mPermissions = nullptr;
+
+  mServiceWorkerContainer = nullptr;
 }
 
 JSObject* WorkerNavigator::WrapObject(JSContext* aCx,
