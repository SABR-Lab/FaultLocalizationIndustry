# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: testing/web-platform/tests/uievents/mouse/crashtests/retrieve_coords_after_moving_target_outside_subdoc_and_hide_the_subdoc.html
# Commit: c9b281a867f3
# Full Hash: c9b281a867f33bb3aa88dd8318abe1c50d22e81d
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2025-02-08 21:03:38
# Description:
#   Bug 1946461 - Make `Event::GetPrimaryFrameOfEventTarget` return `nullptr` if target is moved outside the original `nsPresContext` r=smaug,emilio
#   
#   Chrome returns some computed value for `offsetX` and `offsetY` even in this
#   hacky case, but we should return `{0, 0}` for now to keep the traditional
#   behavior [1] and avoid the crash because Chrome's behavior is also tricky
# ==============================================================================

diff -r 24d23a09f65c -r c9b281a867f3 testing/web-platform/tests/uievents/mouse/crashtests/retrieve_coords_after_moving_target_outside_subdoc_and_hide_the_subdoc.html
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/testing/web-platform/tests/uievents/mouse/crashtests/retrieve_coords_after_moving_target_outside_subdoc_and_hide_the_subdoc.html	Fri Feb 07 22:04:59 2025 +0000
@@ -0,0 +1,37 @@
+<!doctype html>
+<html class="test-wait">
+<head>
+<meta charset="utf-8">
+<title>Retrieve coordinates after event target is moved to outside the subdocument and hide the subdocument</title>
+<script src="/resources/testdriver.js"></script>
+<script src="/resources/testdriver-vendor.js"></script>
+<script>
+"use strict";
+
+addEventListener("load", async () => {
+  const iframe = document.querySelector("iframe");
+  const div = iframe.contentDocument.getElementById("target");
+  let clickEvent;
+  div.addEventListener("click", event => clickEvent = event, {once: true});
+  await test_driver.click(div);
+  document.body.appendChild(div);
+  iframe.hidden = true;
+  await new Promise(resolve => requestAnimationFrame(() => requestAnimationFrame(resolve)));
+  div.innerText = clickEvent.screenX;
+  div.innerText = clickEvent.screenY;
+  div.innerText = clickEvent.clientX;
+  div.innerText = clickEvent.clientY;
+  div.innerText = clickEvent.offsetX;
+  div.innerText = clickEvent.offsetY;
+  div.innerText = clickEvent.pageX;
+  div.innerText = clickEvent.pageY;
+  div.innerText = clickEvent.layerX;
+  div.innerText = clickEvent.layerY;
+  document.documentElement.removeAttribute("class");
+}, {once: true});
+</script>
+</head>
+<body>
+  <iframe srcdoc="<body><div id='target' style='height:32px'></div></body>"></iframe>
+</body>
+</html>
