# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/nsBaseDragService.cpp
# Commit: 0ea945553f63
# Full Hash: 0ea945553f63659b99fd37265c5e7a764f70504d
# Author: Masayuki Nakano <masayuki@d-toybox.com>
# Date: 2024-12-03 16:21:08
# Regressor Bug: 1680669
# File Overlap Count: 1
# Description:
#   Bug 1680669 - part 6: Make methods of `MouseEvent` and static methods of `Event` aware of fractional coordinates r=smaug,emilio,webdriver-reviewers
#   
#   `screenX`, `screenY`, `clientX`, `clientY`, `x`, `y`, `offsetX` and `offsetY`
#   are now `double`.  This patch makes the event classes aware of DOM events.
#   
# ==============================================================================

diff -r 98d5a05c6c6e -r 0ea945553f63 widget/nsBaseDragService.cpp
--- a/widget/nsBaseDragService.cpp	Tue Dec 03 07:10:01 2024 +0000
+++ b/widget/nsBaseDragService.cpp	Tue Dec 03 07:10:05 2024 +0000
@@ -451,7 +451,7 @@
   mSourceTopWindowContext =
       mSourceWindowContext ? mSourceWindowContext->TopWindowContext() : nullptr;
 
-  mScreenPosition = aDragEvent->ScreenPoint(CallerType::System);
+  mScreenPosition = RoundedToInt(aDragEvent->ScreenPoint(CallerType::System));
   mInputSource = aDragEvent->InputSource(CallerType::System);
 
   // If dragging within a XUL tree and no custom drag image was
@@ -523,7 +523,7 @@
   mSourceWindowContext = mDragStartData->GetSourceWindowContext();
   mSourceTopWindowContext = mDragStartData->GetSourceTopWindowContext();
 
-  mScreenPosition = aDragEvent->ScreenPoint(CallerType::System);
+  mScreenPosition = RoundedToInt(aDragEvent->ScreenPoint(CallerType::System));
   mInputSource = aDragEvent->InputSource(CallerType::System);
 
   nsresult rv = InvokeDragSession(
@@ -578,7 +578,7 @@
   mDragStartData = nullptr;
   mRegion = Nothing();
 
-  mScreenPosition = aDragEvent->ScreenPoint(CallerType::System);
+  mScreenPosition = RoundedToInt(aDragEvent->ScreenPoint(CallerType::System));
   mInputSource = aDragEvent->InputSource(CallerType::System);
 
   // XXXndeakin this should actually be the deepest node that contains both