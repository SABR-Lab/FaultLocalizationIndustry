# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/protocol/http/HttpTransactionParent.h
# Commit: 9a3830b72b1f
# Full Hash: 9a3830b72b1f2a9640a7ff945b91d17d67828bcd
# Author: Kershaw Chang <kershaw@mozilla.com>
# Date: 2025-02-24 17:07:55
# Regressor Bug: 1948203
# File Overlap Count: 5
# Description:
#   Bug 1948203 - Skip alt-svc validation if we already connected to the server, r=necko-reviewers,jesup
#   
#   This patch optimizes how Firefox handles speculative connections for alt-svc headers. When a server sends an alt-svc header, Firefox normally creates a speculative connection to validate it. With this patch, if the connectionâ€™s hash key matches the one generated from the alt-svc header, the validation step is skipped since an equivalent connection is already in place, avoiding unnecessary work.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D238218
# ==============================================================================

diff -r d5962b430cd3 -r 9a3830b72b1f netwerk/protocol/http/HttpTransactionParent.h
--- a/netwerk/protocol/http/HttpTransactionParent.h	Mon Feb 24 09:01:12 2025 +0000
+++ b/netwerk/protocol/http/HttpTransactionParent.h	Mon Feb 24 09:20:35 2025 +0000
@@ -23,12 +23,8 @@
 class ChannelEventQueue;
 class nsHttpConnectionInfo;
 
-#define HTTP_TRANSACTION_PARENT_IID                  \
-  {                                                  \
-    0xb83695cb, 0xc24b, 0x4c53, {                    \
-      0x85, 0x9b, 0x77, 0x77, 0x3e, 0xc5, 0x44, 0xe5 \
-    }                                                \
-  }
+#define HTTP_TRANSACTION_PARENT_IID \
+  {0xb83695cb, 0xc24b, 0x4c53, {0x85, 0x9b, 0x77, 0x77, 0x3e, 0xc5, 0x44, 0xe5}}
 
 // HttpTransactionParent plays the role of nsHttpTransaction and delegates the
 // work to the nsHttpTransaction in socket process.
@@ -56,7 +52,8 @@
       const bool& aDataToChildProcess, const bool& aRestarted,
       const uint32_t& aHTTPSSVCReceivedStage, const bool& aSupportsHttp3,
       const nsIRequest::TRRMode& aMode, const TRRSkippedReason& aSkipReason,
-      const uint32_t& aCaps, const TimeStamp& aOnStartRequestStartTime);
+      const uint32_t& aCaps, const TimeStamp& aOnStartRequestStartTime,
+      const HttpConnectionInfoCloneArgs& aArgs);
   mozilla::ipc::IPCResult RecvOnTransportStatus(
       const nsresult& aStatus, const int64_t& aProgress,
       const int64_t& aProgressMax,
@@ -70,7 +67,6 @@
       const Maybe<nsHttpHeaderArray>& responseTrailers,
       Maybe<TransactionObserverResult>&& aTransactionObserverResult,
       const TimeStamp& aLastActiveTabOptHit,
-      const HttpConnectionInfoCloneArgs& aArgs,
       const TimeStamp& aOnStopRequestStartTime);
   mozilla::ipc::IPCResult RecvOnInitFailed(const nsresult& aStatus);
 
@@ -118,7 +114,8 @@
       const bool& aDataToChildProcess, const bool& aRestarted,
       const uint32_t& aHTTPSSVCReceivedStage, const bool& aSupportsHttp3,
       const nsIRequest::TRRMode& aMode, const TRRSkippedReason& aSkipReason,
-      const uint32_t& aCaps, const TimeStamp& aOnStartRequestStartTime);
+      const uint32_t& aCaps, const TimeStamp& aOnStartRequestStartTime,
+      nsHttpConnectionInfo* aConnInfo);
   void DoOnDataAvailable(const nsCString& aData, const uint64_t& aOffset,
                          const uint32_t& aCount,
                          const TimeStamp& aOnDataAvailableStartTime);
@@ -127,7 +124,6 @@
       const int64_t& aTransferSize, const TimingStructArgs& aTimings,
       const Maybe<nsHttpHeaderArray>& responseTrailers,
       Maybe<TransactionObserverResult>&& aTransactionObserverResult,
-      nsHttpConnectionInfo* aConnInfo,
       const TimeStamp& aOnStopRequestStartTime);
   void DoNotifyListener();
   void ContinueDoNotifyListener();