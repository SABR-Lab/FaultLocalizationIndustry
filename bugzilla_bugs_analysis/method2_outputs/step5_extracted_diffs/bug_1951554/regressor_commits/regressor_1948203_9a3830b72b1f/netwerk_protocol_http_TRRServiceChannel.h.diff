# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/protocol/http/TRRServiceChannel.h
# Commit: 9a3830b72b1f
# Full Hash: 9a3830b72b1f2a9640a7ff945b91d17d67828bcd
# Author: Kershaw Chang <kershaw@mozilla.com>
# Date: 2025-02-24 17:07:55
# Regressor Bug: 1948203
# File Overlap Count: 5
# Description:
#   Bug 1948203 - Skip alt-svc validation if we already connected to the server, r=necko-reviewers,jesup
#   
#   This patch optimizes how Firefox handles speculative connections for alt-svc headers. When a server sends an alt-svc header, Firefox normally creates a speculative connection to validate it. With this patch, if the connectionâ€™s hash key matches the one generated from the alt-svc header, the validation step is skipped since an equivalent connection is already in place, avoiding unnecessary work.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D238218
# ==============================================================================

diff -r d5962b430cd3 -r 9a3830b72b1f netwerk/protocol/http/TRRServiceChannel.h
--- a/netwerk/protocol/http/TRRServiceChannel.h	Mon Feb 24 09:01:12 2025 +0000
+++ b/netwerk/protocol/http/TRRServiceChannel.h	Mon Feb 24 09:20:35 2025 +0000
@@ -24,12 +24,8 @@
 class nsHttpHandler;
 
 // Use to support QI nsIChannel to TRRServiceChannel
-#define NS_TRRSERVICECHANNEL_IID                     \
-  {                                                  \
-    0x361c4bb1, 0xd6b2, 0x493b, {                    \
-      0x86, 0xbc, 0x88, 0xd3, 0x5d, 0x16, 0x38, 0xfa \
-    }                                                \
-  }
+#define NS_TRRSERVICECHANNEL_IID \
+  {0x361c4bb1, 0xd6b2, 0x493b, {0x86, 0xbc, 0x88, 0xd3, 0x5d, 0x16, 0x38, 0xfa}}
 
 // TRRServiceChannel is designed to fetch DNS data from DoH server. This channel
 // MUST only be used by TRR.
@@ -143,7 +139,7 @@
   virtual void DoNotifyListenerCleanup() override;
   virtual void DoAsyncAbort(nsresult aStatus) override;
   bool IsIsolated() { return false; };
-  void ProcessAltService();
+  void ProcessAltService(nsHttpConnectionInfo* aTransConnInfo);
   nsresult CallOnStartRequest();
 
   void MaybeStartDNSPrefetch();