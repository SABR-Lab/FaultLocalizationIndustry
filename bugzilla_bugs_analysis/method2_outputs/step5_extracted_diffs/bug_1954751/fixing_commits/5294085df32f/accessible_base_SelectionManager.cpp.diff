# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: accessible/base/SelectionManager.cpp
# Commit: 5294085df32f
# Full Hash: 5294085df32fd90ab14254894ff85acad1fa43de
# Author: James Teh <jteh@mozilla.com>
# Date: 2025-03-25 04:32:21
# Description:
#   Bug 1954751: SelectionManager::SelectionRangeChanged: Fail gracefully if the range's closest common ancestor is null. r=eeejay
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D242113
# ==============================================================================

diff -r d7a4577be698 -r 5294085df32f accessible/base/SelectionManager.cpp
--- a/accessible/base/SelectionManager.cpp	Mon Mar 24 22:15:04 2025 +0000
+++ b/accessible/base/SelectionManager.cpp	Mon Mar 24 22:30:25 2025 +0000
@@ -219,6 +219,11 @@
   dom::Document* doc = start->OwnerDoc();
   MOZ_ASSERT(doc);
   nsINode* node = aRange.GetClosestCommonInclusiveAncestor();
+  if (!node) {
+    // Bug 1954751: This can happen when a Selection is being garbage collected,
+    // but it's unclear exactly what other circumstances are involved.
+    return false;
+  }
   HyperTextAccessible* acc = nsAccUtils::GetTextContainer(node);
   if (!acc) {
     return true;
