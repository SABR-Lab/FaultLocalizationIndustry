# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/notification/NotificationParent.h
# Commit: f9f3e107f36c
# Full Hash: f9f3e107f36c8cce438711ecef1b1a9574ae8f93
# Author: Kagami Sascha Rosylight <saschanaz@outlook.com>
# Date: 2025-03-22 09:02:07
# Regressor Bug: 1948339
# File Overlap Count: 2
# Description:
#   Bug 1948339 - Part 2: Add NotificationObserver r=asuth
#   
#   This also makes page-bound notifications to not be stored via NotificationStorage.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D240642
# ==============================================================================

diff -r b84ed8a9da4c -r f9f3e107f36c dom/notification/NotificationParent.h
--- a/dom/notification/NotificationParent.h	Fri Mar 21 09:52:31 2025 +0000
+++ b/dom/notification/NotificationParent.h	Fri Mar 21 09:52:31 2025 +0000
@@ -15,14 +15,22 @@
 
 enum class CloseMode;
 
+enum class AlertTopic : uint8_t {
+  Disable,
+  Settings,
+  Click,
+  Show,
+  Finished,
+};
+
 class NotificationParent final : public PNotificationParent,
-                                 public nsIObserver {
+                                 public nsISupports,
+                                 public SupportsWeakPtr {
   using IPCResult = mozilla::ipc::IPCResult;
 
  public:
   // Threadsafe to pass the class from PBackground to main thread
   NS_DECL_THREADSAFE_ISUPPORTS
-  NS_DECL_NSIOBSERVER
 
   NotificationParent(NotNull<nsIPrincipal*> aPrincipal,
                      NotNull<nsIPrincipal*> aEffectiveStoragePrincipal,
@@ -35,6 +43,7 @@
         mScope(aScope),
         mOptions(aNotification.options()) {};
 
+  nsresult HandleAlertTopic(AlertTopic aTopic);
   IPCResult RecvShow(ShowResolver&& aResolver);
   IPCResult RecvClose();
 
@@ -42,16 +51,13 @@
       Endpoint<PNotificationParent>&& aParentEndpoint,
       PBackgroundParent::CreateNotificationParentResolver&& aResolver);
 
-  void ActorDestroy(ActorDestroyReason aWhy) override;
-
  private:
   ~NotificationParent() = default;
 
   nsresult Show();
-  nsresult FireClickEvent(nsISupports* aSubject);
-  nsresult FireCloseEvent();
+  nsresult FireClickEvent();
 
-  void Unregister(CloseMode aCloseMode);
+  void Unregister();
 
   Maybe<NotificationParent::ShowResolver> mResolver;
 