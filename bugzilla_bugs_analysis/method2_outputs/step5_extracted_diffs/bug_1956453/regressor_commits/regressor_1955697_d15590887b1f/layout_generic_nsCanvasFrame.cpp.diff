# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/generic/nsCanvasFrame.cpp
# Commit: d15590887b1f
# Full Hash: d15590887b1f090d45bf0e40e2dbc3e82ef81ebc
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-03-25 21:02:33
# Regressor Bug: 1955697
# File Overlap Count: 1
# Description:
#   Bug 1955697 - Remove nsDisplayCanvasThemedBackground. r=mstange
#   
#   We don't set appearance on `::-moz-canvas` and co.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D242627
# ==============================================================================

diff -r 4d2ee9dc112f -r d15590887b1f layout/generic/nsCanvasFrame.cpp
--- a/layout/generic/nsCanvasFrame.cpp	Tue Mar 25 08:09:58 2025 +0000
+++ b/layout/generic/nsCanvasFrame.cpp	Tue Mar 25 08:09:58 2025 +0000
@@ -332,15 +332,6 @@
   return true;
 }
 
-void nsDisplayCanvasThemedBackground::Paint(nsDisplayListBuilder* aBuilder,
-                                            gfxContext* aCtx) {
-  auto* frame = static_cast<nsCanvasFrame*>(mFrame);
-  nsPoint offset = ToReferenceFrame();
-  nsRect bgClipRect = frame->CanvasArea() + offset;
-
-  PaintInternal(aBuilder, aCtx, GetPaintRect(aBuilder, aCtx), &bgClipRect);
-}
-
 /**
  * A display item to paint the focus ring for the document.
  *
@@ -375,6 +366,8 @@
   MOZ_ASSERT(IsVisibleForPainting(),
              "::-moz-{scrolled-,}canvas doesn't inherit from anything that can "
              "be invisible, and we don't specify visibility in UA sheets");
+  MOZ_ASSERT(!IsThemed(),
+             "::-moz-{scrolled-,}canvas doesn't have native appearance");
   if (GetPrevInFlow()) {
     DisplayOverflowContainers(aBuilder, aLists);
   }
@@ -387,24 +380,14 @@
   // the overflow area, so just add nsDisplayCanvasBackground instead of
   // calling DisplayBorderBackgroundOutline.
   ComputedStyle* bg = nullptr;
-  nsIFrame* dependentFrame = nullptr;
-  bool isThemed = IsThemed();
-  if (!isThemed) {
-    dependentFrame = nsCSSRendering::FindBackgroundFrame(this);
-    if (dependentFrame) {
-      bg = dependentFrame->Style();
-      if (dependentFrame == this) {
-        dependentFrame = nullptr;
-      }
+  nsIFrame* dependentFrame = nsCSSRendering::FindBackgroundFrame(this);
+  if (dependentFrame) {
+    bg = dependentFrame->Style();
+    if (dependentFrame == this) {
+      dependentFrame = nullptr;
     }
   }
 
-  if (isThemed) {
-    aLists.BorderBackground()->AppendNewToTop<nsDisplayCanvasThemedBackground>(
-        aBuilder, this);
-    return;
-  }
-
   if (!bg) {
     return;
   }