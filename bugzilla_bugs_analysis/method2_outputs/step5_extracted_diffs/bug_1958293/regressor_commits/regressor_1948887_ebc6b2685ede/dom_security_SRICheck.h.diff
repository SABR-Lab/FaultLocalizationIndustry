# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/security/SRICheck.h
# Commit: ebc6b2685ede
# Full Hash: ebc6b2685ede6059d3acf880a837783061777270
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-02-22 09:14:45
# Regressor Bug: 1948887
# File Overlap Count: 1
# Description:
#   Bug 1948887 - Allow parsing sheets with SRI metadata off the main thread. r=dshin
#   
#   Flush reports when back on the main thread, and stash the tainting
#   around since LoadInfo is main-thread only.
#   
# ==============================================================================

diff -r 57759a2ddebc -r ebc6b2685ede dom/security/SRICheck.h
--- a/dom/security/SRICheck.h	Fri Feb 21 15:06:55 2025 +0000
+++ b/dom/security/SRICheck.h	Fri Feb 21 15:09:28 2025 +0000
@@ -11,6 +11,7 @@
 #include "nsStringFwd.h"
 #include "nsCOMPtr.h"
 #include "nsICryptoHash.h"
+#include "mozilla/LoadTainting.h"
 
 class nsIChannel;
 class nsIConsoleReportCollector;
@@ -54,9 +55,16 @@
   // Append the following bytes to the content used to compute the hash. Once
   // all bytes are streamed, use the Verify function to check the integrity.
   nsresult Update(uint32_t aStringLen, const uint8_t* aString);
+  nsresult Update(Span<const uint8_t>);
 
   // Verify that the computed hash corresponds to the metadata.
   nsresult Verify(const SRIMetadata& aMetadata, nsIChannel* aChannel,
+                  LoadTainting aLoadTainting, const nsACString& aSourceFileURI,
+                  nsIConsoleReportCollector* aReporter);
+
+  // Like Verify(), but takes the load tainting from the channel's load info
+  // (which is main-thread only).
+  nsresult Verify(const SRIMetadata& aMetadata, nsIChannel* aChannel,
                   const nsACString& aSourceFileURI,
                   nsIConsoleReportCollector* aReporter);
 