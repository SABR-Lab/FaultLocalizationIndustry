# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: gfx/thebes/gfxHarfBuzzShaper.cpp
# Commit: 66e788b91a78
# Full Hash: 66e788b91a785ecda515f8a25dc56acab6fc2d63
# Author: Cristina Horotan <chorotan@mozilla.com>
# Date: 2025-05-08 09:24:40
# Regressor Bug: 1961387
# File Overlap Count: 7
# Description:
#   Revert "Bug 1961387 - Add a reftest with larger glyphs, for CBDT version of Noto Color Emoji. r=gfx-reviewers,lsalzman" for causing crashes (bug 1965123)
#   
#   This reverts commit 05d7f427e840f62d7cd9eaffe83df511aad7aa08.
#   
#   Revert "Bug 1961387 - Account for scaling of color-bitmap fonts when setting up the font-unit scale factor. r=gfx-reviewers,lsalzman"
# ==============================================================================

diff -r 82516541b4b1 -r 66e788b91a78 gfx/thebes/gfxHarfBuzzShaper.cpp
--- a/gfx/thebes/gfxHarfBuzzShaper.cpp	Thu May 08 09:06:49 2025 +0300
+++ b/gfx/thebes/gfxHarfBuzzShaper.cpp	Thu May 08 09:13:55 2025 +0300
@@ -571,10 +571,12 @@
   if (mVmtxTable) {
     bool emptyGlyf;
     const Glyf* glyf = FindGlyf(aGlyph, &emptyGlyf);
-    // If we didn't find any 'glyf' data, fall through to the default below;
-    // note that the glyph might still actually render (via SVG or COLR data),
-    // so we need to provide a reasonable origin.
-    if (glyf && !emptyGlyf) {
+    if (glyf) {
+      if (emptyGlyf) {
+        *aY = 0;
+        return;
+      }
+
       const ::GlyphMetrics* metrics = reinterpret_cast<const ::GlyphMetrics*>(
           hb_blob_get_data(mVmtxTable, nullptr));
       int16_t lsb;
