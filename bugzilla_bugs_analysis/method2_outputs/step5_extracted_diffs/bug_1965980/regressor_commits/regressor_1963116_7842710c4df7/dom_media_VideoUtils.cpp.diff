# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/VideoUtils.cpp
# Commit: 7842710c4df7
# Full Hash: 7842710c4df7504f91041b66691da6ec2e13d908
# Author: Paul Adenot <paul@paul.cx>
# Date: 2025-05-12 21:36:30
# Regressor Bug: 1963116
# File Overlap Count: 1
# Description:
#   Bug 1963116 - Use larger stacks for MediaPDecoder threads on Windows. r=media-playback-reviewers,alwu
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D247901
# ==============================================================================

diff -r 57a6ed77b498 -r 7842710c4df7 dom/media/VideoUtils.cpp
--- a/dom/media/VideoUtils.cpp	Mon May 12 09:56:23 2025 +0000
+++ b/dom/media/VideoUtils.cpp	Mon May 12 09:56:23 2025 +0000
@@ -279,7 +279,12 @@
 
   // Ensure a larger stack for platform decoder threads
   if (aType == MediaThreadType::PLATFORM_DECODER) {
-    const uint32_t minStackSize = 512 * 1024;
+    uint32_t minStackSize = 512 * 1024;
+    #ifdef XP_WIN
+    // libaom can require a larger stack size on Windows, because it uses
+    // large stack buffers
+    minStackSize *= 2;
+    #endif
     uint32_t stackSize;
     MOZ_ALWAYS_SUCCEEDS(pool->GetThreadStackSize(&stackSize));
     if (stackSize < minStackSize) {
