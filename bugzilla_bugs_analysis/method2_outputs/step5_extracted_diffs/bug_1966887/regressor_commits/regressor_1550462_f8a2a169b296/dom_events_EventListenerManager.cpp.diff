# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/events/EventListenerManager.cpp
# Commit: f8a2a169b296
# Full Hash: f8a2a169b2969d29e04733ae27a56459e5359973
# Author: Alexandru Marc <amarc@mozila.com>
# Date: 2025-05-16 09:19:19
# Regressor Bug: 1550462
# File Overlap Count: 1
# Description:
#   Revert "Bug 1550462 - part 3: Enable `pointerrawupdate` event r=smaug" for causing mochitest failures @ test_pointerrawupdate_event_count.html
#   
#   This reverts commit eb27445e0352d6b4df540adb40e21f72fc052e80.
#   
#   Revert "Bug 1550462 - part 2: Make `PresShell::HandleEvent` dispatch preceding `pointerrawupdate` event r=smaug,dom-core,edgar"
# ==============================================================================

diff -r 8d25773fc82f -r f8a2a169b296 dom/events/EventListenerManager.cpp
--- a/dom/events/EventListenerManager.cpp	Fri May 16 06:20:47 2025 +0000
+++ b/dom/events/EventListenerManager.cpp	Fri May 16 09:30:09 2025 +0300
@@ -25,12 +25,8 @@
 #include "mozilla/MemoryReporting.h"
 #include "mozilla/Preferences.h"
 #include "mozilla/PresShell.h"
-#include "mozilla/ScopeExit.h"
-#include "mozilla/StaticPrefs_dom.h"
-#include "mozilla/TimeStamp.h"
 #include "mozilla/dom/AbortSignal.h"
 #include "mozilla/dom/BindingUtils.h"
-#include "mozilla/dom/ChromeUtils.h"
 #include "mozilla/dom/EventCallbackDebuggerNotification.h"
 #include "mozilla/dom/Element.h"
 #include "mozilla/dom/Event.h"
@@ -41,6 +37,9 @@
 #include "mozilla/dom/ScriptSettings.h"
 #include "mozilla/dom/TouchEvent.h"
 #include "mozilla/dom/UserActivation.h"
+#include "mozilla/ScopeExit.h"
+#include "mozilla/TimeStamp.h"
+#include "mozilla/dom/ChromeUtils.h"
 
 #include "EventListenerService.h"
 #include "nsCOMPtr.h"
@@ -146,7 +145,6 @@
       mMayHaveTouchEventListener(false),
       mMayHaveMouseEnterLeaveEventListener(false),
       mMayHavePointerEnterLeaveEventListener(false),
-      mMayHavePointerRawUpdateEventListener(false),
       mMayHaveSelectionChangeEventListener(false),
       mMayHaveFormSelectEventListener(false),
       mMayHaveTransitionEventListener(false),
@@ -415,18 +413,6 @@
           window->SetHasPointerEnterLeaveEventListeners();
         }
         break;
-      case ePointerRawUpdate:
-        if (!StaticPrefs::dom_event_pointer_rawupdate_enabled()) {
-          break;
-        }
-        mMayHavePointerRawUpdateEventListener = true;
-        if (nsPIDOMWindowInner* window = GetInnerWindowForTarget()) {
-          NS_WARNING_ASSERTION(
-              !nsContentUtils::IsChromeDoc(window->GetExtantDoc()),
-              "Please do not use pointerrawupdate event in chrome.");
-          window->MaybeSetHasPointerRawUpdateEventListeners();
-        }
-        break;
       case eGamepadButtonDown:
       case eGamepadButtonUp:
       case eGamepadAxisMove:
@@ -876,15 +862,6 @@
       DisableDevice(aUserType);
     }
   }
-
-  // XXX Should we clear mMayHavePointerRawUpdateEventListener if the last
-  // pointerrawupdate event listener is removed?  If so, nsPIDOMWindowInner
-  // needs to count how may event listener managers had some pointerrawupdate
-  // event listener.  If we've notified the window of having a pointerrawupdate
-  // event listener, some behavior is changed because pointerrawupdate event
-  // dispatcher needs to handle some things before dispatching an event to the
-  // DOM.  However, it is expected that web apps using `pointerrawupdate` don't
-  // remove the event listeners.
 }
 
 static bool IsDefaultPassiveWhenOnRoot(EventMessage aMessage) {
@@ -1852,20 +1829,16 @@
     // After dispatching wheel, legacy mouse scroll events are dispatched
     // and listeners on those can also default prevent the behavior.
     if (aEvent->mMessage == eWheel) {
-      if (const auto& listeners =
-              mListenerMap.GetListenersForType(nsGkAtoms::onDOMMouseScroll)) {
+      if (const auto& listeners = mListenerMap.GetListenersForType(nsGkAtoms::onDOMMouseScroll)) {
         for (const Listener& listener : listeners->NonObservingRange()) {
-          if (!listener.mFlags.mPassive &&
-              ListenerCanHandle(&listener, aEvent)) {
+          if (!listener.mFlags.mPassive && ListenerCanHandle(&listener, aEvent)) {
             return true;
           }
         }
       }
-      if (const auto& listeners = mListenerMap.GetListenersForType(
-              nsGkAtoms::onMozMousePixelScroll)) {
+      if (const auto& listeners = mListenerMap.GetListenersForType(nsGkAtoms::onMozMousePixelScroll)) {
         for (const Listener& listener : listeners->NonObservingRange()) {
-          if (!listener.mFlags.mPassive &&
-              ListenerCanHandle(&listener, aEvent)) {
+          if (!listener.mFlags.mPassive && ListenerCanHandle(&listener, aEvent)) {
             return true;
           }
         }