# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/WidgetEventImpl.cpp
# Commit: f8a2a169b296
# Full Hash: f8a2a169b2969d29e04733ae27a56459e5359973
# Author: Alexandru Marc <amarc@mozila.com>
# Date: 2025-05-16 09:19:19
# Regressor Bug: 1550462
# File Overlap Count: 1
# Description:
#   Revert "Bug 1550462 - part 3: Enable `pointerrawupdate` event r=smaug" for causing mochitest failures @ test_pointerrawupdate_event_count.html
#   
#   This reverts commit eb27445e0352d6b4df540adb40e21f72fc052e80.
#   
#   Revert "Bug 1550462 - part 2: Make `PresShell::HandleEvent` dispatch preceding `pointerrawupdate` event r=smaug,dom-core,edgar"
# ==============================================================================

diff -r 8d25773fc82f -r f8a2a169b296 widget/WidgetEventImpl.cpp
--- a/widget/WidgetEventImpl.cpp	Fri May 16 06:20:47 2025 +0000
+++ b/widget/WidgetEventImpl.cpp	Fri May 16 09:30:09 2025 +0300
@@ -73,7 +73,6 @@
     case ePointerOut:
     case ePointerEnter:
     case ePointerLeave:
-    case ePointerRawUpdate:
     case ePointerGotCapture:
     case ePointerLostCapture:
     case ePointerClick:
@@ -122,7 +121,6 @@
     case ePointerOut:
     case ePointerEnter:
     case ePointerLeave:
-    case ePointerRawUpdate:
     case ePointerCancel:
     case ePointerGotCapture:
     case ePointerLostCapture:
@@ -174,12 +172,6 @@
     case eTouchPointerCancel:
       return true;
 
-    case eMouseRawUpdate:
-    case eTouchRawUpdate:
-      MOZ_ASSERT_UNREACHABLE(
-          "Internal raw update events shouldn't be dispatched to the DOM");
-      return true;
-
     default:
       return false;
   }
@@ -390,7 +382,6 @@
     case eMouseOut:
     case eMouseHitTest:
     case eMouseMove:
-    case eMouseRawUpdate:
       return true;
     // TODO: Perhaps, we should rename this method.
     case ePointerClick:
@@ -538,7 +529,7 @@
 bool WidgetEvent::IsAllowedToDispatchDOMEvent() const {
   switch (mClass) {
     case eMouseEventClass:
-      if (mMessage == eMouseRawUpdate || mMessage == eMouseTouchDrag) {
+      if (mMessage == eMouseTouchDrag) {
         return false;
       }
       [[fallthrough]];
@@ -548,7 +539,7 @@
       // DOM events.
       // Synthesized button up events also do not cause DOM events because they
       // do not have a reliable mRefPoint.
-      return AsMouseEvent()->IsReal();
+      return AsMouseEvent()->mReason == WidgetMouseEvent::eReal;
 
     case eWheelEventClass: {
       // wheel event whose all delta values are zero by user pref applied, it
@@ -558,7 +549,7 @@
              wheelEvent->mDeltaZ != 0.0;
     }
     case eTouchEventClass:
-      return mMessage != eTouchRawUpdate && mMessage != eTouchPointerCancel;
+      return mMessage != eTouchPointerCancel;
     // Following events are handled in EventStateManager, so, we don't need to
     // dispatch DOM event for them into the DOM tree.
     case eQueryContentEventClass:
@@ -915,7 +906,6 @@
   switch (mMessage) {
     // This method is designed for mouse events.
     case eMouseMove:
-    case eMouseRawUpdate:
     case eMouseUp:
     case eMouseDown:
     case eMouseEnterIntoWidget:
@@ -944,7 +934,6 @@
     case ePointerClick:
     case ePointerAuxClick:
     case ePointerMove:
-    case ePointerRawUpdate:
     case ePointerUp:
     case ePointerDown:
     case ePointerCancel: