# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/TextDirectiveCreator.cpp
# Commit: 29735d438f26
# Full Hash: 29735d438f2634e2c6c1d8e80857bfb144d36483
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-05-27 03:54:23
# Regressor Bug: 1957557
# File Overlap Count: 1
# Description:
#   Bug 1957557, part 7 - Create Text Fragments: Compute word boundary distances for context terms. r=dom-core,farre
#   
#   The distances are always in search direction:
#   For prefix and end terms, the positions are
#   relative to the end of the term and use the word
# ==============================================================================

diff -r 3c7adffd2377 -r 29735d438f26 dom/base/TextDirectiveCreator.cpp
--- a/dom/base/TextDirectiveCreator.cpp	Mon May 26 08:18:28 2025 +0000
+++ b/dom/base/TextDirectiveCreator.cpp	Mon May 26 08:18:28 2025 +0000
@@ -47,6 +47,7 @@
   return CreateInstance(aDocument, range)
       .andThen([](auto self) -> Result<nsCString, ErrorResult> {
         MOZ_TRY(self->CollectContextTerms());
+        self->CollectContextTermWordBoundaryDistances();
         return VoidCString();
       });
 }
@@ -282,5 +283,40 @@
   return Ok();
 }
 
+void ExactMatchTextDirectiveCreator::CollectContextTermWordBoundaryDistances() {
+  mPrefixWordBeginDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Left>(
+          mPrefixContent);
+  TEXT_FRAGMENT_LOG("Word begin distances for prefix term: {}",
+                    mPrefixWordBeginDistances);
+  mSuffixWordEndDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Right>(
+          mSuffixContent);
+  TEXT_FRAGMENT_LOG("Word end distances for suffix term: {}",
+                    mSuffixWordEndDistances);
+}
+
+void RangeBasedTextDirectiveCreator::CollectContextTermWordBoundaryDistances() {
+  mPrefixWordBeginDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Left>(
+          mPrefixContent);
+  TEXT_FRAGMENT_LOG("Word begin distances for prefix term: {}",
+                    mPrefixWordBeginDistances);
+  mStartWordEndDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Right>(
+          mStartContent);
+  TEXT_FRAGMENT_LOG("Word end distances for start term: {}",
+                    mStartWordEndDistances);
+  mEndWordBeginDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Left>(
+          mEndContent);
+  TEXT_FRAGMENT_LOG("Word begin distances for end term: {}",
+                    mEndWordBeginDistances);
+  mSuffixWordEndDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Right>(
+          mSuffixContent);
+  TEXT_FRAGMENT_LOG("Word end distances for suffix term: {}",
+                    mSuffixWordEndDistances);
+}
 
 }  // namespace mozilla::dom