# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/TextDirectiveCreator.h
# Commit: 3c7adffd2377
# Full Hash: 3c7adffd2377f555f81660494a099946869dd27f
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-05-27 03:54:23
# Regressor Bug: 1957557
# File Overlap Count: 1
# Description:
#   Bug 1957557, part 6 - Create Text Fragments: Collect context terms for exact and range-based matching. r=dom-core,farre
#   
#   This patch converts all required context around the target range
#   into normal and fold case string representations.
#   Prefix and suffix terms can reach until the next block boundary.
# ==============================================================================

diff -r 91f90a472a4c -r 3c7adffd2377 dom/base/TextDirectiveCreator.h
--- a/dom/base/TextDirectiveCreator.h	Mon May 26 08:18:28 2025 +0000
+++ b/dom/base/TextDirectiveCreator.h	Mon May 26 08:18:28 2025 +0000
@@ -79,6 +79,32 @@
   static Result<UniquePtr<TextDirectiveCreator>, ErrorResult> CreateInstance(
       Document& aDocument, AbstractRange* aRange);
 
+  /**
+   * @brief Collects text content surrounding the target range.
+   *
+   * The context terms are then stored both in normal and fold case form.
+   */
+  virtual Result<Ok, ErrorResult> CollectContextTerms() = 0;
+
+  /**
+   * @brief Common helper which collects the prefix term of the target range.
+   */
+  Result<Ok, ErrorResult> CollectPrefixContextTerm();
+
+  /**
+   * @brief Common helper which collects the suffix term of the target range.
+   */
+  Result<Ok, ErrorResult> CollectSuffixContextTerm();
+
+  nsString mPrefixContent;
+  nsString mPrefixFoldCaseContent;
+
+  nsString mStartContent;
+  nsString mStartFoldCaseContent;
+
+  nsString mSuffixContent;
+  nsString mSuffixFoldCaseContent;
+
   Document& mDocument;
   RefPtr<AbstractRange> mRange;
 
@@ -100,6 +126,10 @@
  private:
   using TextDirectiveCreator::TextDirectiveCreator;
 
+  Result<Ok, ErrorResult> CollectContextTerms() override;
+
+  nsString mEndContent;
+  nsString mEndFoldCaseContent;
 };
 
 /**
@@ -110,6 +140,8 @@
  private:
   using TextDirectiveCreator::TextDirectiveCreator;
 
+  Result<Ok, ErrorResult> CollectContextTerms() override;
+
 };
 }  // namespace mozilla::dom
 #endif
