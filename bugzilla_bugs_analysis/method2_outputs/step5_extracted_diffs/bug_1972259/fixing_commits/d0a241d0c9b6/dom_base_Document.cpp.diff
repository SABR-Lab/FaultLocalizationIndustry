# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/base/Document.cpp
# Commit: d0a241d0c9b6
# Full Hash: d0a241d0c9b60dd81a2de262111995582864544c
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-06-17 21:30:38
# Description:
#   Bug 1972259 - Skip view transition on page swap. r=nical
#   
#   This fixes the crash, but it causes the commented out assertion to fire,
#   probably because the delete op is queued already with the wrong
#   pipeline, which I think means the snapshots leak.
# ==============================================================================

diff -r a8e744a89b81 -r d0a241d0c9b6 dom/base/Document.cpp
--- a/dom/base/Document.cpp	Tue Jun 17 10:12:37 2025 +0000
+++ b/dom/base/Document.cpp	Tue Jun 17 10:43:10 2025 +0000
@@ -12484,7 +12484,11 @@
     mAnimationController->OnPageHide();
   }
 
-  if (!inFrameLoaderSwap) {
+  if (inFrameLoaderSwap) {
+    if (RefPtr transition = mActiveViewTransition) {
+      transition->SkipTransition(SkipTransitionReason::PageSwap);
+    }
+  } else {
     if (aPersisted) {
       // We do not stop the animations (bug 1024343) when the page is refreshing
       // while being dragged out.