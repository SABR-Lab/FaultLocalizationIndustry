# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/basetypes/HyperTextAccessibleBase.cpp
# Commit: 57c30f1adca5
# Full Hash: 57c30f1adca5fb5ccd4a9a09192c41e207e28d88
# Author: Serban Stanca <sstanca@mozilla.com>
# Date: 2025-07-13 21:41:00
# Regressor Bug: 1950748
# File Overlap Count: 3
# Description:
#   Revert "Bug 1950748 part 3: Don't return a caret inside an editor when no editor is focused. r=morgan" as requested for causing accessibility crashes (bug 1977012).
#   
#   This reverts commit aaf970807d281c28c1e937491719d996cb11648a.
#   
#   This reverts commit f5f2e3cf4d34c2430372ba790d77620837d56b75.
# ==============================================================================

diff -r 05ceace27341 -r 57c30f1adca5 accessible/basetypes/HyperTextAccessibleBase.cpp
--- a/accessible/basetypes/HyperTextAccessibleBase.cpp	Sun Jul 13 14:48:08 2025 +0000
+++ b/accessible/basetypes/HyperTextAccessibleBase.cpp	Mon Jul 14 00:37:50 2025 +0300
@@ -329,15 +329,12 @@
   if (!child) {
     return TextLeafPoint();
   }
+  if (HyperTextAccessibleBase* childHt = child->AsHyperTextBase()) {
+    return childHt->ToTextLeafPoint(
+        aDescendToEnd ? static_cast<int32_t>(childHt->CharacterCount()) : 0,
+        aDescendToEnd);
+  }
   int32_t offset = aOffset - GetChildOffset(child);
-  if (HyperTextAccessibleBase* childHt = child->AsHyperTextBase()) {
-    // This child is an embedded object, so the offset can only be 0 or 1.
-    MOZ_ASSERT(offset == 0 || offset == 1);
-    // Offset 1 refers to the end of this container, so descend to its end.
-    const bool end = aDescendToEnd || offset == 1;
-    return childHt->ToTextLeafPoint(
-        end ? static_cast<int32_t>(childHt->CharacterCount()) : 0, end);
-  }
   return TextLeafPoint(child, offset);
 }
 