# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/notification/NotificationUtils.cpp
# Commit: 003b4c7a0320
# Full Hash: 003b4c7a032033d1cb6c9c2c313d75db2db1dbe1
# Author: Kagami Sascha Rosylight <saschanaz@outlook.com>
# Date: 2025-07-23 09:41:41
# Description:
#   Bug 1978141 - Add a missing null check after GetNotificationStorage r=asuth
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D257902
# ==============================================================================

diff -r d9c9549105cb -r 003b4c7a0320 dom/notification/NotificationUtils.cpp
--- a/dom/notification/NotificationUtils.cpp	Tue Jul 22 14:06:01 2025 +0000
+++ b/dom/notification/NotificationUtils.cpp	Tue Jul 22 14:12:46 2025 +0000
@@ -219,6 +219,11 @@
 
   nsCOMPtr<nsINotificationStorage> notificationStorage =
       GetNotificationStorage(aPrincipal->GetIsInPrivateBrowsing());
+  if (!notificationStorage) {
+    return NotificationsPromise::CreateAndReject(NS_ERROR_NOT_AVAILABLE,
+                                                 __func__)
+        .forget();
+  }
 
   rv = notificationStorage->Get(origin, NS_ConvertUTF8toUTF16(aScope), aTag,
                                 callback);
