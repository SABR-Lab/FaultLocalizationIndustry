# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/test/gtest/TestTextDirective.cpp
# Commit: 851ad0761b61
# Full Hash: 851ad0761b619ebf4b4982a18ab0bb627d7dd240
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-07-19 09:41:31
# Regressor Bug: 1976473
# File Overlap Count: 2
# Description:
#   Bug 1976473 - Text Fragments: Treat punctuation as part of a word when computing word boundary distances. r=dom-core,avandolder,mccr8
#   
#   Finding word boundaries uses `intl::WordBreaker::FindWord()`, which stops at punctuation.
#   As a result, finding word boundary distances for the string "foo bar. baz" would have had found
#   the distances `[3,7,8,12]` when going LTR and `[3,5,8,12]` when going RTL.
# ==============================================================================

diff -r 6a6745867aa0 -r 851ad0761b61 dom/base/test/gtest/TestTextDirective.cpp
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/dom/base/test/gtest/TestTextDirective.cpp	Fri Jul 18 18:16:32 2025 +0000
@@ -0,0 +1,40 @@
+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
+/* vim: set ts=8 sts=2 et sw=2 tw=80: */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+#include "gtest/gtest.h"
+#include "TextDirectiveUtil.h"
+
+using namespace mozilla::dom;
+
+TEST(TestTextDirective, ComputeWordBoundaryDistancesLTR)
+{
+  nsString text(u"Hello, world! This is a test.");
+  nsTArray<uint32_t> wordEndDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Right>(
+          text);
+  EXPECT_EQ(wordEndDistances.Length(), 6u);
+  EXPECT_EQ(wordEndDistances[0], 5u);   // "Hello"
+  EXPECT_EQ(wordEndDistances[1], 12u);  // "Hello, world"
+  EXPECT_EQ(wordEndDistances[2], 18u);  // "Hello, world! This"
+  EXPECT_EQ(wordEndDistances[3], 21u);  // "Hello, world! This is"
+  EXPECT_EQ(wordEndDistances[4], 23u);  // "Hello, world! This is a"
+  EXPECT_EQ(wordEndDistances[5], 28u);  // "Hello, world! This is a test"
+}
+
+TEST(TestTextDirective, ComputeWordBoundaryDistancesRTL)
+{
+  nsString text(u"Hello, world! This is a test.");
+  nsTArray<uint32_t> wordBeginDistances =
+      TextDirectiveUtil::ComputeWordBoundaryDistances<TextScanDirection::Left>(
+          text);
+  EXPECT_EQ(wordBeginDistances.Length(), 6u);
+  EXPECT_EQ(wordBeginDistances[0], 5u);   // "test."
+  EXPECT_EQ(wordBeginDistances[1], 7u);   // "a test."
+  EXPECT_EQ(wordBeginDistances[2], 10u);  // "is a test."
+  EXPECT_EQ(wordBeginDistances[3], 15u);  // "This is a test."
+  EXPECT_EQ(wordBeginDistances[4], 22u);  // "world! This is a test."
+  EXPECT_EQ(wordBeginDistances[5], 29u);  // "Hello, world! This is a test."
+}