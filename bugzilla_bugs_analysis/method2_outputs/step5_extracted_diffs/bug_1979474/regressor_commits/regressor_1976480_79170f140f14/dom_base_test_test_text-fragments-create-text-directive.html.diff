# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/test/test_text-fragments-create-text-directive.html
# Commit: 79170f140f14
# Full Hash: 79170f140f14b8cc4b668e6137a623118ddc49cf
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-07-23 09:41:41
# Regressor Bug: 1976480
# File Overlap Count: 2
# Description:
#   Bug 1976480 - Text Fragments: Don't extend the selection if only punctuation is selected. r=dom-core,avandolder,mccr8
#   
#   This patch adds a new check in the beginning of the algorithm which leaves the
#   input range unchanged if its content is only punctuation characters.
#   This edge case is handled by checking if all characters are punctuation and would return early, hence not going into the algorithm that extends the range to word boundaries
# ==============================================================================

diff -r 7336d25e87e7 -r 79170f140f14 dom/base/test/test_text-fragments-create-text-directive.html
--- a/dom/base/test/test_text-fragments-create-text-directive.html	Tue Jul 22 17:25:32 2025 +0000
+++ b/dom/base/test/test_text-fragments-create-text-directive.html	Tue Jul 22 17:27:30 2025 +0000
@@ -56,6 +56,8 @@
   <div>Foo Bar</div>
   <div id="rangeBasedWithPrefixAtBlockBoundaries">Some text Foo Bar more text</div>
   <div id="rangeBasedWithPrefixAtBlockBoundariesEnd">End of Range</div>
+  <!-- Test case for Bug 1976480. -->
+  <div id="quotationMark">"Quotation mark"</div>
   <script>
     document.addEventListener("DOMContentLoaded", () => {
       const empty = document.createTextNode("");
@@ -378,6 +380,33 @@
           content: "Bar more text\n  End",
           textDirective: "text=Bar%20more,End"
         },
+        {
+          name: "Test for Bug 1976480: Selected quotation mark should not be extended to the next word",
+          startContainer: quotationMark.firstChild,
+          startOffset: 0,
+          endContainer: quotationMark.firstChild,
+          endOffset: 1,
+          content: "\"",
+          textDirective: "text=Range-,%22"
+        },
+        {
+          name: "Test for Bug 1976480: Selected quotation mark should not be extended to the previous word",
+          startContainer: quotationMark.firstChild,
+          startOffset: 15,
+          endContainer: quotationMark.firstChild,
+          endOffset: 16,
+          content: "\"",
+          textDirective: "text=mark-,%22"
+        },
+        {
+          name: "Test for Bug 1976480: Text inside quotation marks should not have the selection extended to the quotation marks",
+          startContainer: quotationMark.firstChild,
+          startOffset: 1,
+          endContainer: quotationMark.firstChild,
+          endOffset: 15,
+          content: "Quotation mark",
+          textDirective: "text=Quotation%20mark"
+        },
       ]) {
         const range = document.createRange();
         range.setStart(testCase.startContainer, testCase.startOffset);
