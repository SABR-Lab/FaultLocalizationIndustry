# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: widget/Theme.cpp
# Commit: 124efdbe177c
# Full Hash: 124efdbe177c23cb51af54d16e3f1404f5c664ad
# Author: Timothy Nikkel <tnikkel@gmail.com>
# Date: 2025-08-12 09:46:05
# Description:
#   Bug 1981495. In Theme::PaintCircleShadow check if we can create a similar draw target before trying to create one. r=gfx-reviewers,nical
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D260615
# ==============================================================================

diff -r 43fcb1ed39b3 -r 124efdbe177c widget/Theme.cpp
--- a/widget/Theme.cpp	Tue Aug 12 02:12:07 2025 +0000
+++ b/widget/Theme.cpp	Tue Aug 12 03:43:25 2025 +0000
@@ -603,6 +603,9 @@
   if (dtSize.IsEmpty()) {
     return;
   }
+  if (!aDrawTarget.CanCreateSimilarDrawTarget(dtSize, SurfaceFormat::A8)) {
+    return;
+  }
   RefPtr<DrawTarget> ellipseDT = aDrawTarget.CreateSimilarDrawTargetForFilter(
       dtSize, SurfaceFormat::A8, blurFilter, blurFilter,
       sourceRectInFilterSpace, destinationPointOfSourceRect);