# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: layout/forms/nsMeterFrame.cpp
# Commit: 13735d3c75cb
# Full Hash: 13735d3c75cb7a6fabbdcae93bdfce3376d526e4
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-06-17 09:24:05
# Regressor Bug: 1971450
# File Overlap Count: 1
# Description:
#   Bug 1971450 - Remove internal appearance values for meter / progress / range thumb / chunk. r=dshin
#   
#   This is technically a behavior change because we don't really look at
#   the appearance value of the progressbar etc anymore. We could do that if
#   wanted, but it's more consistent to just look at the individual frame
# ==============================================================================

diff -r 275b63046ac5 -r 13735d3c75cb layout/forms/nsMeterFrame.cpp
--- a/layout/forms/nsMeterFrame.cpp	Mon Jun 16 22:22:24 2025 +0000
+++ b/layout/forms/nsMeterFrame.cpp	Mon Jun 16 22:28:59 2025 +0000
@@ -76,6 +76,17 @@
   NS_QUERYFRAME_ENTRY(nsIAnonymousContentCreator)
 NS_QUERYFRAME_TAIL_INHERITING(nsContainerFrame)
 
+void nsMeterFrame::BuildDisplayList(nsDisplayListBuilder* aBuilder,
+                                    const nsDisplayListSet& aLists) {
+  if (IsThemed()) {
+    DisplayBorderBackgroundOutline(aBuilder, aLists);
+  } else {
+    // XXX nsProgressFrame uses BuildDisplayListForInline, does it matter?
+    // Which one is right?
+    nsContainerFrame::BuildDisplayList(aBuilder, aLists);
+  }
+}
+
 void nsMeterFrame::Reflow(nsPresContext* aPresContext,
                           ReflowOutput& aDesiredSize,
                           const ReflowInput& aReflowInput,
@@ -189,15 +200,6 @@
 }
 
 bool nsMeterFrame::ShouldUseNativeStyle() const {
-  nsIFrame* barFrame = mBarDiv->GetPrimaryFrame();
-
-  // Use the native style if these conditions are satisfied:
-  // - both frames use the native appearance;
-  // - neither frame has author specified rules setting the border or the
-  //   background.
   return StyleDisplay()->EffectiveAppearance() == StyleAppearance::Meter &&
-         !Style()->HasAuthorSpecifiedBorderOrBackground() && barFrame &&
-         barFrame->StyleDisplay()->EffectiveAppearance() ==
-             StyleAppearance::Meterchunk &&
-         !barFrame->Style()->HasAuthorSpecifiedBorderOrBackground();
+         !Style()->HasAuthorSpecifiedBorderOrBackground();
 }