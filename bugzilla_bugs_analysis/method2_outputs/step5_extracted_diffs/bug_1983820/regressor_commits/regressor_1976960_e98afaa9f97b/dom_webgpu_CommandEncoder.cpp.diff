# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/webgpu/CommandEncoder.cpp
# Commit: e98afaa9f97b
# Full Hash: e98afaa9f97b8847044dd904b60cf637d5fda5e6
# Author: Erich Gubler <erichdongubler@gmail.com>
# Date: 2025-07-17 09:30:54
# Regressor Bug: 1976960
# File Overlap Count: 1
# Description:
#   Bug 1976960 - refactor(webgpu): work with copy of `aDesc` in `CommandEncoder::BeginRenderPass` r=webgpu-reviewers,nical
#   
#   In preparation for remainder of the patch stack, clone `aDesc` so we have a mutable copy. We'll actually mutate it once we start accepting `Texture`s and not just `TextureView`s, which we'll convert in-place to views.
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D257053
# ==============================================================================

diff -r cd7e513397ce -r e98afaa9f97b dom/webgpu/CommandEncoder.cpp
--- a/dom/webgpu/CommandEncoder.cpp	Thu Jul 17 04:08:37 2025 +0000
+++ b/dom/webgpu/CommandEncoder.cpp	Thu Jul 17 04:08:37 2025 +0000
@@ -219,15 +219,17 @@
 
 already_AddRefed<RenderPassEncoder> CommandEncoder::BeginRenderPass(
     const dom::GPURenderPassDescriptor& aDesc) {
-  for (const auto& at : aDesc.mColorAttachments) {
+  dom::GPURenderPassDescriptor desc{aDesc};
+
+  for (auto& at : desc.mColorAttachments) {
     TrackPresentationContext(at.mView->GetTargetContext());
     if (at.mResolveTarget.WasPassed()) {
       TrackPresentationContext(at.mResolveTarget.Value().GetTargetContext());
     }
   }
 
-  RefPtr<RenderPassEncoder> pass = new RenderPassEncoder(this, aDesc);
-  pass->SetLabel(aDesc.mLabel);
+  RefPtr<RenderPassEncoder> pass = new RenderPassEncoder(this, desc);
+  pass->SetLabel(desc.mLabel);
   if (mState == CommandEncoderState::Ended) {
     // Because we do not call wgpu until the pass is ended, we need to generate
     // this error ourselves in order to report it at the correct time.
