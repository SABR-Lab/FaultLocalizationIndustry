# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp
# Commit: 38b84e79ac24
# Full Hash: 38b84e79ac242620692c73302abeab8baae9d426
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-08-26 09:53:22
# Description:
#   Bug 1984876 - Fix HostIgnoreByProxy with empty input. r=mccr8
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D262377
# ==============================================================================

diff -r 6814fb42593d -r 38b84e79ac24 toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp
--- a/toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp	Mon Aug 25 15:23:34 2025 +0000
+++ b/toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp	Mon Aug 25 15:27:16 2025 +0000
@@ -272,12 +272,17 @@
 
 static bool HostIgnoredByProxy(const nsACString& aIgnore,
                                const nsACString& aHost) {
-  if (aIgnore.Equals(aHost, nsCaseInsensitiveCStringComparator)) return true;
-
+  if (aIgnore.IsEmpty()) {
+    return false;
+  }
+  if (aIgnore.Equals(aHost, nsCaseInsensitiveCStringComparator)) {
+    return true;
+  }
   if (aIgnore.First() == '*' &&
       StringEndsWith(aHost, nsDependentCSubstring(aIgnore, 1),
-                     nsCaseInsensitiveCStringComparator))
+                     nsCaseInsensitiveCStringComparator)) {
     return true;
+  }
 
   int32_t mask = 128;
   nsReadingIterator<char> start;
@@ -303,8 +308,9 @@
   nsDependentCSubstring ignoreStripped(start, slash);
   PRIPv6Addr ignoreAddr, hostAddr;
   if (!ConvertToIPV6Addr(ignoreStripped, &ignoreAddr, &mask) ||
-      !ConvertToIPV6Addr(aHost, &hostAddr, nullptr))
+      !ConvertToIPV6Addr(aHost, &hostAddr, nullptr)) {
     return false;
+  }
 
   proxy_MaskIPv6Addr(ignoreAddr, mask);
   proxy_MaskIPv6Addr(hostAddr, mask);
