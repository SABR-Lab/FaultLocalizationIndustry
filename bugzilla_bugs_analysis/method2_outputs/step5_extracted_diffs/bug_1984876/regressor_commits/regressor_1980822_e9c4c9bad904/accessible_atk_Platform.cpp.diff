# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: accessible/atk/Platform.cpp
# Commit: e9c4c9bad904
# Full Hash: e9c4c9bad904fbba96c6e69baa347200f49814fc
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-08-04 21:33:32
# Regressor Bug: 1980822
# File Overlap Count: 1
# Description:
#   Bug 1980822 - Modernize GSettings interface. r=stransky
#   
#   We don't really need to support scripting except for a single shell
#   test. Expose a much more reduced API for that instead.
#   
# ==============================================================================

diff -r 8323476e4964 -r e9c4c9bad904 accessible/atk/Platform.cpp
--- a/accessible/atk/Platform.cpp	Mon Aug 04 09:36:44 2025 +0000
+++ b/accessible/atk/Platform.cpp	Mon Aug 04 09:37:04 2025 +0000
@@ -10,8 +10,8 @@
 #include "mozilla/GRefPtr.h"
 #include "mozilla/GUniquePtr.h"
 #include "mozilla/UniquePtrExtensions.h"
+#include "mozilla/widget/GSettings.h"
 #include "nsIAccessibleEvent.h"
-#include "nsIGSettingsService.h"
 #include "nsMai.h"
 #include "nsServiceManagerUtils.h"
 #include "nsWindow.h"
@@ -258,24 +258,9 @@
 #endif
 
   // check GSettings
-  nsCOMPtr<nsIGSettingsService> gsettings =
-      do_GetService(NS_GSETTINGSSERVICE_CONTRACTID);
-
-  if (gsettings) {
-    bool shouldEnable = false;
-    nsCOMPtr<nsIGSettingsCollection> a11y_settings;
-    gsettings->GetCollectionForSchema(
-        nsLiteralCString("org.gnome.desktop.interface"),
-        getter_AddRefs(a11y_settings));
-    if (a11y_settings) {
-      a11y_settings->GetBoolean(nsLiteralCString("toolkit-accessibility"),
-                                &shouldEnable);
-    }
-
-    return shouldEnable;
-  }
-
-  return false;
+  return widget::GSettings::GetBoolean("org.gnome.desktop.interface"_ns,
+                                       "toolkit-accessibility"_ns)
+      .valueOr(false);
 }
 
 uint64_t a11y::GetCacheDomainsForKnownClients(uint64_t aCacheDomains) {