# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: widget/cocoa/nsCocoaWindow.mm
# Commit: 50d91cd836e6
# Full Hash: 50d91cd836e67bc4d493fad2d57bb83a8e10f7a9
# Author: Steven Michaud <smichaud@pobox.com>
# Date: 2025-09-04 04:25:41
# Description:
#   Bug 1986701 - Link mChildView only after mNativeLayerRoot is initialized. r=mstange
#   
#   Differential Revision: https://phabricator.services.mozilla.com/D263616
# ==============================================================================

diff -r c83a86718c33 -r 50d91cd836e6 widget/cocoa/nsCocoaWindow.mm
--- a/widget/cocoa/nsCocoaWindow.mm	Wed Sep 03 20:37:19 2025 +0000
+++ b/widget/cocoa/nsCocoaWindow.mm	Wed Sep 03 20:45:12 2025 +0000
@@ -4745,12 +4745,15 @@
       initWithFrame:mWindow.childViewFrameRectForCurrentBounds
          geckoChild:this];
   mChildView.autoresizingMask = NSViewWidthSizable | NSViewHeightSizable;
-  [contentView addSubview:mChildView];
 
   mNativeLayerRoot =
       NativeLayerRootCA::CreateForCALayer(mChildView.rootCALayer);
   mNativeLayerRoot->SetBackingScale(BackingScaleFactor());
 
+  // Link mChildView into the native NSView hierarchy only after
+  // mNativeLayerRoot is initialized. This resolves bug 1986701.
+  [contentView addSubview:mChildView];
+
   [WindowDataMap.sharedWindowDataMap ensureDataForWindow:mWindow];
 
   NS_ASSERTION(!mTextInputHandler, "mTextInputHandler has already existed");
