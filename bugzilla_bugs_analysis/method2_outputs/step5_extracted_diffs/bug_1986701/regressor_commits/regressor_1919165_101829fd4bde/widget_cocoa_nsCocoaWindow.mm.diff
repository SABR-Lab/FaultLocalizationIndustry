# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: widget/cocoa/nsCocoaWindow.mm
# Commit: 101829fd4bde
# Full Hash: 101829fd4bde830a207d8aeaaa294c66f0543cc5
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-05-02 02:16:50
# Regressor Bug: 1919165
# File Overlap Count: 1
# Description:
#   Bug 1963574 - Remove AppWindow early return from nsCocoaWindow::BackingScaleFactorChanged. r=mstange,mac-reviewers
#   
#   Other platforms don't have it, and it is required for correctness.
#   
#   On macOS before bug 1919165 it used to be fine, because
# ==============================================================================

diff -r dbc1626fa807 -r 101829fd4bde widget/cocoa/nsCocoaWindow.mm
--- a/widget/cocoa/nsCocoaWindow.mm	Wed Apr 30 17:45:17 2025 +0000
+++ b/widget/cocoa/nsCocoaWindow.mm	Wed Apr 30 17:52:02 2025 +0000
@@ -744,7 +744,8 @@
       "Shouldn't need to invalidate with accelerated OMTC layers!");
 
   EnsureContentLayerForMainThreadPainting();
-  mContentLayerInvalidRegion.OrWith(aRect.Intersect(LayoutDeviceIntRect(LayoutDeviceIntPoint(), GetClientBounds().Size())));
+  mContentLayerInvalidRegion.OrWith(aRect.Intersect(
+      LayoutDeviceIntRect(LayoutDeviceIntPoint(), GetClientBounds().Size())));
   [mChildView markLayerForDisplay];
 
   NS_OBJC_END_TRY_IGNORE_BLOCK;
@@ -6264,13 +6265,10 @@
     mNativeLayerRoot->SetBackingScale(newScale);
   }
   NotifyAPZOfDPIChange();
-
-  if (!mWidgetListener || mWidgetListener->GetAppWindow()) {
-    return;
-  }
-
-  if (PresShell* presShell = mWidgetListener->GetPresShell()) {
-    presShell->BackingScaleFactorChanged();
+  if (mWidgetListener) {
+    if (PresShell* presShell = mWidgetListener->GetPresShell()) {
+      presShell->BackingScaleFactorChanged();
+    }
   }
 }
 
