# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: toolkit/components/browser/nsWebBrowser.h
# Commit: 18c714c3af0f
# Full Hash: 18c714c3af0f77750cc36ec9f162e9d84d3f537f
# Author: Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date: 2025-04-29 20:49:47
# Regressor Bug: 1919165
# File Overlap Count: 1
# Description:
#   Bug 1919165 - Remove support for WindowType::Child, which is now unused. r=stransky
#   
#   We don't take this codepath anymore in any platform. Windows and GTK
#   were already asserting against it.
#   
# ==============================================================================

diff -r 734373410b28 -r 18c714c3af0f toolkit/components/browser/nsWebBrowser.h
--- a/toolkit/components/browser/nsWebBrowser.h	Tue Apr 29 14:04:48 2025 +0000
+++ b/toolkit/components/browser/nsWebBrowser.h	Tue Apr 29 14:04:53 2025 +0000
@@ -72,24 +72,6 @@
   friend class nsDocShellTreeOwner;
 
  public:
-  // The implementation of non-refcounted nsIWidgetListener, which would hold a
-  // strong reference on stack before calling nsWebBrowser's
-  // MOZ_CAN_RUN_SCRIPT methods.
-  class WidgetListenerDelegate : public nsIWidgetListener {
-   public:
-    explicit WidgetListenerDelegate(nsWebBrowser* aWebBrowser)
-        : mWebBrowser(aWebBrowser) {}
-    MOZ_CAN_RUN_SCRIPT_BOUNDARY virtual void WindowActivated() override;
-    MOZ_CAN_RUN_SCRIPT_BOUNDARY virtual void WindowDeactivated() override;
-    MOZ_CAN_RUN_SCRIPT_BOUNDARY virtual bool PaintWindow(
-        nsIWidget* aWidget, mozilla::LayoutDeviceIntRegion aRegion) override;
-
-   private:
-    // The lifetime of WidgetListenerDelegate is bound to nsWebBrowser so we
-    // just use raw pointer here.
-    nsWebBrowser* mWebBrowser;
-  };
-
   NS_DECL_CYCLE_COLLECTING_ISUPPORTS
   NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(nsWebBrowser, nsIWebBrowser)
 
@@ -122,13 +104,6 @@
   void EnsureDocShellTreeOwner();
 
   nsIWidget* EnsureWidget();
-
-  // nsIWidgetListener methods for WidgetListenerDelegate.
-  MOZ_CAN_RUN_SCRIPT void WindowActivated();
-  MOZ_CAN_RUN_SCRIPT void WindowDeactivated();
-  MOZ_CAN_RUN_SCRIPT bool PaintWindow(nsIWidget* aWidget,
-                                      mozilla::LayoutDeviceIntRegion aRegion);
-
   explicit nsWebBrowser(int aItemType);
 
  protected:
@@ -136,7 +111,6 @@
   RefPtr<nsDocShell> mDocShell;
   mozilla::OriginAttributes mOriginAttributes;
 
-  nsCOMPtr<nsIWidget> mInternalWidget;
   nsCOMPtr<nsIWindowWatcher> mWWatch;
   const uint32_t mContentType;
   bool mShouldEnableHistory;
@@ -145,8 +119,6 @@
 
   nsCOMPtr<nsIPrintSettings> mPrintSettings;
 
-  WidgetListenerDelegate mWidgetListenerDelegate;
-
   // cached background color
   nscolor mBackgroundColor;
 