diff -r f4284b0494fc -r a576f5346c6c dom/quota/OriginOperations.cpp
--- a/dom/quota/OriginOperations.cpp	Wed Jun 11 20:01:43 2025 +0000
+++ b/dom/quota/OriginOperations.cpp	Wed Jun 11 20:09:11 2025 +0000
@@ -10,6 +10,7 @@
 #include <cstdint>
 #include <utility>
 
+#include "DirectoryMetadata.h"
 #include "ErrorList.h"
 #include "FileUtils.h"
 #include "GroupInfo.h"
@@ -1327,7 +1328,12 @@
       OkIf(aQuotaManager.IsTemporaryOriginInitializedInternal(mOriginMetadata)),
       NS_ERROR_NOT_INITIALIZED);
 
-  int64_t timestamp = PR_Now();
+  auto maybeOriginStateMetadata =
+      aQuotaManager.GetOriginStateMetadata(mOriginMetadata);
+
+  auto originStateMetadata = maybeOriginStateMetadata.extract();
+
+  originStateMetadata.mLastAccessTime = PR_Now();
 
   QM_TRY_INSPECT(const auto& file,
                  aQuotaManager.GetOriginDirectory(mOriginMetadata));
@@ -1338,22 +1344,16 @@
   QM_TRY_INSPECT(const bool& exists, MOZ_TO_RESULT_INVOKE_MEMBER(file, Exists));
 
   if (exists) {
-    QM_TRY(MOZ_TO_RESULT(file->Append(nsLiteralString(METADATA_V2_FILE_NAME))));
-
-    QM_TRY_INSPECT(const auto& stream,
-                   GetBinaryOutputStream(*file, FileFlag::Update));
-    MOZ_ASSERT(stream);
-
-    QM_TRY(MOZ_TO_RESULT(stream->Write64(timestamp)));
-
-    QM_TRY(MOZ_TO_RESULT(stream->Close()));
+    QM_TRY(
+        MOZ_TO_RESULT(SaveDirectoryMetadataHeader(*file, originStateMetadata)));
 
     mSaved = true;
 
     aQuotaManager.IncreaseSaveOriginAccessTimeCountInternal();
   }
 
-  aQuotaManager.UpdateOriginAccessTime(mOriginMetadata, timestamp);
+  aQuotaManager.UpdateOriginAccessTime(mOriginMetadata,
+                                       originStateMetadata.mLastAccessTime);
 
   return NS_OK;
 }
@@ -3597,22 +3597,11 @@
         }()));
 
     if (!persisted) {
-      QM_TRY_INSPECT(const auto& file,
-                     CloneFileAndAppend(
-                         *directory, nsLiteralString(METADATA_V2_FILE_NAME)));
-
-      QM_TRY_INSPECT(const auto& stream,
-                     GetBinaryOutputStream(*file, FileFlag::Update));
-
-      MOZ_ASSERT(stream);
-
-      // Update origin access time while we are here.
-      QM_TRY(MOZ_TO_RESULT(stream->Write64(PR_Now())));
-
-      // Set the persisted flag to true.
-      QM_TRY(MOZ_TO_RESULT(stream->WriteBoolean(true)));
-
-      QM_TRY(MOZ_TO_RESULT(stream->Close()));
+      // Set the persisted flag to true and also update origin access time
+      // while we are here.
+      QM_TRY(MOZ_TO_RESULT(SaveDirectoryMetadataHeader(
+          *directory, OriginStateMetadata{/* aLastAccessTime */ PR_Now(),
+                                          /* aPersisted */ true})));
 
       // Directory metadata has been successfully updated.
       // Update OriginInfo too if temporary storage was already initialized.