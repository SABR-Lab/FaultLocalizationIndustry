diff -r e1c5be04b3a0 -r cc6bc73fbbfd js/loader/ModuleLoadRequest.cpp
--- a/js/loader/ModuleLoadRequest.cpp	Wed Sep 24 23:17:54 2025 +0000
+++ b/js/loader/ModuleLoadRequest.cpp	Thu Sep 25 05:12:32 2025 +0300
@@ -53,9 +53,9 @@
     ModuleLoadRequest* aRootModule)
     : ScriptLoadRequest(ScriptKind::eModule, aURI, aReferrerPolicy,
                         aFetchOptions, aIntegrity, aReferrer, aContext),
-      mKind(aKind),
+      mIsTopLevel(aKind == Kind::TopLevel || aKind == Kind::DynamicImport),
       mModuleType(aModuleType),
-      mErroredLoadingImports(false),
+      mIsDynamicImport(aKind == Kind::DynamicImport),
       mLoader(aLoader),
       mRootModule(aRootModule) {
   MOZ_ASSERT(mLoader);
@@ -66,12 +66,23 @@
 }
 
 bool ModuleLoadRequest::IsErrored() const {
-  if (!mModuleScript || mErroredLoadingImports) {
-    return true;
+  return !mModuleScript || mModuleScript->HasParseError();
+}
+
+void ModuleLoadRequest::Cancel() {
+  if (IsCanceled()) {
+    return;
   }
 
-  MOZ_ASSERT_IF(mModuleScript->HasErrorToRethrow(), !IsDynamicImport());
-  return mModuleScript->HasParseError() || mModuleScript->HasErrorToRethrow();
+  if (IsFinished()) {
+    return;
+  }
+
+  ScriptLoadRequest::Cancel();
+
+  mModuleScript = nullptr;
+  mReferrerScript = nullptr;
+  mModuleRequestObj = nullptr;
 }
 
 void ModuleLoadRequest::SetReady() {
@@ -97,6 +108,10 @@
   MOZ_ASSERT(IsFetching() || IsPendingFetchingError());
 
   mModuleScript = mLoader->GetFetchedModule(ModuleMapKey(mURI, mModuleType));
+  if (IsErrored()) {
+    ModuleErrored();
+    return;
+  }
 }
 
 void ModuleLoadRequest::LoadFailed() {
@@ -126,7 +141,13 @@
   }
 
   MOZ_ASSERT(!IsFinished());
-  MOZ_ASSERT(IsErrored());
+
+  mozilla::DebugOnly<bool> hasRethrow =
+      mModuleScript && mModuleScript->HasErrorToRethrow();
+
+  // When LoadRequestedModules fails, we will set error to rethrow to the module
+  // script and call ModuleErrored().
+  MOZ_ASSERT(IsErrored() || hasRethrow);
 
   if (IsFinished()) {
     // Cancelling an outstanding import will error this request.
@@ -139,7 +160,7 @@
 
 void ModuleLoadRequest::LoadFinished() {
   RefPtr<ModuleLoadRequest> request(this);
-  if (IsDynamicImport()) {
+  if (IsTopLevel() && IsDynamicImport()) {
     mLoader->RemoveDynamicImport(request);
   }
 