{
  "bug_id": "803963",
  "summary": "crash in nsContentList::ContentAppended with Ask Toolbar bundled with Avira Antivirus",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Firefox",
  "component": "Extension Compatibility",
  "version": "Trunk",
  "severity": "critical",
  "priority": "--",
  "creation_time": "2012-10-21T12:35:01Z",
  "last_change_time": "2013-10-08T15:16:40Z",
  "is_recent": false,
  "crash_signature_raw": "[@ nsContentList::ContentAppended(nsIDocument*, nsIContent*, nsIContent*, int)]",
  "crash_signatures": [
    "nsContentList::ContentAppended(nsIDocument*, nsIContent*, nsIContent*, int)"
  ],
  "keywords": [
    "crash",
    "reproducible",
    "topcrash"
  ],
  "regressed_by": [],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=803963",
  "socorro_links": [],
  "socorro_crash_ids": [],
  "has_socorro_link": false,
  "has_direct_crash_id": false,
  "stack_traces": [
    {
      "comment_id": 6749532,
      "comment_count": 0,
      "creator": "scoobidiver@netcourrier.com",
      "creation_time": "2012-10-21T12:35:01Z",
      "raw_text": "It's #40 top browser crasher (#28 w/o hangs) in 16.0.1 and #90 in 17.0b1.\n\nIt's correlated to Avira and Ask Toolbar embbedded with Avira:\n     99% (198/200) vs.   3% (3948/122954) toolbar@ask.com\n     97% (194/200) vs.   2% (2926/122954) avsda.dll\n\nSignature \tnsContentList::ContentAppended(nsIDocument*, nsIContent*, nsIContent*, int) More Reports Search\nUUID\t4c497a83-b33d-4fcb-819d-054d52121018\nDate Processed\t2012-10-18 01:04:07\nUptime\t18\nLast Crash\t23 seconds before submission\nInstall Age\t3.4 days since version was first installed.\nInstall Time\t2012-10-14 15:10:32\nProduct\tFirefox\nVersion\t16.0.1\nBuild ID\t20121010144125\nRelease Channel\trelease\nOS\tWindows NT\nOS Version\t6.1.7601 Service Pack 1\nBuild Architecture\tx86\nBuild Architecture Info\tGenuineIntel family 6 model 37 stepping 5\nCrash Reason\tEXCEPTION_ACCESS_VIOLATION_READ\nCrash Address\t0x1c\nUser Comments\tI clicked on a page on Comicbookmovie.com and the site crashed several times.\nApp Notes \t\nAdapterVendorID: 0x10de, AdapterDeviceID: 0x0a22, AdapterSubsysID: 1141174b, AdapterDriverVersion: 8.17.12.7533\nD2D? D2D+ DWrite? DWrite+ D3D10 Layers? D3D10 Layers+ \nEMCheckCompatibility\tTrue\nAdapter Vendor ID\t0x10de\nAdapter Device ID\t0x0a22\nTotal Virtual Memory\t4294836224\nAvailable Virtual Memory\t3676008448\nSystem Memory Use Percentage\t31\nAvailable Page File\t10695479296\nAvailable Physical Memory\t4419989504\n\nFrame \tModule \tSignature \tSource\n0 \txul.dll \tnsContentList::ContentAppended \tcontent/base/src/nsContentList.cpp:745\n1 \txul.dll \tnsNodeUtils::ContentAppended \tcontent/base/src/nsNodeUtils.cpp:120\n2 \txul.dll \tnsINode::doInsertChildAt \tcontent/base/src/nsINode.cpp:1321\n3 \txul.dll \tnsGenericElement::InsertChildAt \tcontent/base/src/nsGenericElement.cpp:2626\n4 \txul.dll \tnsINode::ReplaceOrInsertBefore \tcontent/base/src/nsINode.cpp:1890\n5 \txul.dll \tnsINode::AppendChild \tobj-firefox/dist/include/nsINode.h:504\n6 \txul.dll \tnsIDOMNode_AppendChild \tobj-firefox/js/xpconnect/src/dom_quickstubs.cpp:5401\n7 \tmozjs.dll \tjs::InvokeKernel \tjs/src/jsinterp.cpp:344\n8 \tmozjs.dll \tjs::Interpret \tjs/src/jsinterp.cpp:2442\n9 \tmozjs.dll \tjs::InvokeKernel \tjs/src/jsinterp.cpp:355\n10 \tmozjs.dll \tjs::Invoke \tjs/src/jsinterp.cpp:387\n11 \tmozjs.dll \tJS_CallFunctionValue \tjs/src/jsapi.cpp:5604\n12 \txul.dll \tnsJSContext::CallEventHandler \tdom/base/nsJSEnvironment.cpp:1892\n13 \txul.dll \tnsGlobalWindow::RunTimeoutHandler \tdom/base/nsGlobalWindow.cpp:9552\n14 \txul.dll \tnsGlobalWindow::RunTimeout \tdom/base/nsGlobalWindow.cpp:9806\n15 \txul.dll \tnsGlobalWindow::TimerCallback \tdom/base/nsGlobalWindow.cpp:10077\n16 \txul.dll \tnsTimerImpl::Fire \txpcom/threads/nsTimerImpl.cpp:473\n17 \txul.dll \tnsThread::ProcessNextEvent \txpcom/threads/nsThread.cpp:624\n18 \txul.dll \tmozilla::ipc::RPCChannel::DequeueTask::`scalar deleting destructor' \t\n19 \tnspr4.dll \t_MD_CURRENT_THREAD \tnsprpub/pr/src/md/windows/w95thred.c:312\n20 \txul.dll \tmozilla::ipc::MessagePump::Run \tipc/glue/MessagePump.cpp:82\n21 \txul.dll \tMessageLoop::RunHandler \tipc/chromium/src/base/message_loop.cc:201\n22 \txul.dll \tnsRange::ContentRemoved \tcontent/base/src/nsRange.cpp:571\n23 \txul.dll \tnsBaseAppShell::Run \twidget/xpwidgets/nsBaseAppShell.cpp:163\n24 \txul.dll \tFindSubstring<wchar_t,char> \txpcom/string/src/nsStringObsolete.cpp:680\n25 \txul.dll \tnsBlockFrame::GetLineCursor \tlayout/generic/nsBlockFrame.h:369\n26 \txul.dll \tnsSupportsArray::GrowArrayBy \txpcom/ds/nsSupportsArray.cpp:133\n27 \txul.dll \tnsSupportsArray::GrowArrayBy \txpcom/ds/nsSupportsArray.cpp:132\n28 \txul.dll \tnsBlockFrame::GetLineCursor \tlayout/generic/nsBlockFrame.h:369\n\nMore reports at:\nhttps://crash-stats.mozilla.com/report/list?signature=nsContentList%3A%3AContentAppended%28nsIDocument*%2C+nsIContent*%2C+nsIContent*%2C+int%29",
      "matched_patterns": [
        "ns[A-Z]\\w+::\\w+"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "nsContentList::ContentAppended",
          "file": "content/base/src/nsContentList.cpp",
          "line": 745,
          "raw": "0 \txul.dll \tnsContentList::ContentAppended \tcontent/base/src/nsContentList.cpp:745"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "nsNodeUtils::ContentAppended",
          "file": "content/base/src/nsNodeUtils.cpp",
          "line": 120,
          "raw": "1 \txul.dll \tnsNodeUtils::ContentAppended \tcontent/base/src/nsNodeUtils.cpp:120"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "nsINode::doInsertChildAt",
          "file": "content/base/src/nsINode.cpp",
          "line": 1321,
          "raw": "2 \txul.dll \tnsINode::doInsertChildAt \tcontent/base/src/nsINode.cpp:1321"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "nsGenericElement::InsertChildAt",
          "file": "content/base/src/nsGenericElement.cpp",
          "line": 2626,
          "raw": "3 \txul.dll \tnsGenericElement::InsertChildAt \tcontent/base/src/nsGenericElement.cpp:2626"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "nsINode::ReplaceOrInsertBefore",
          "file": "content/base/src/nsINode.cpp",
          "line": 1890,
          "raw": "4 \txul.dll \tnsINode::ReplaceOrInsertBefore \tcontent/base/src/nsINode.cpp:1890"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "nsINode::AppendChild",
          "file": "obj-firefox/dist/include/nsINode.h",
          "line": 504,
          "raw": "5 \txul.dll \tnsINode::AppendChild \tobj-firefox/dist/include/nsINode.h:504"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "nsIDOMNode_AppendChild",
          "file": "obj-firefox/js/xpconnect/src/dom_quickstubs.cpp",
          "line": 5401,
          "raw": "6 \txul.dll \tnsIDOMNode_AppendChild \tobj-firefox/js/xpconnect/src/dom_quickstubs.cpp:5401"
        },
        {
          "frame_index": 7,
          "module": "mozjs.dll",
          "function": "js::InvokeKernel",
          "file": "js/src/jsinterp.cpp",
          "line": 344,
          "raw": "7 \tmozjs.dll \tjs::InvokeKernel \tjs/src/jsinterp.cpp:344"
        },
        {
          "frame_index": 8,
          "module": "mozjs.dll",
          "function": "js::Interpret",
          "file": "js/src/jsinterp.cpp",
          "line": 2442,
          "raw": "8 \tmozjs.dll \tjs::Interpret \tjs/src/jsinterp.cpp:2442"
        },
        {
          "frame_index": 9,
          "module": "mozjs.dll",
          "function": "js::InvokeKernel",
          "file": "js/src/jsinterp.cpp",
          "line": 355,
          "raw": "9 \tmozjs.dll \tjs::InvokeKernel \tjs/src/jsinterp.cpp:355"
        },
        {
          "frame_index": 10,
          "module": "mozjs.dll",
          "function": "js::Invoke",
          "file": "js/src/jsinterp.cpp",
          "line": 387,
          "raw": "10 \tmozjs.dll \tjs::Invoke \tjs/src/jsinterp.cpp:387"
        },
        {
          "frame_index": 11,
          "module": "mozjs.dll",
          "function": "JS_CallFunctionValue",
          "file": "js/src/jsapi.cpp",
          "line": 5604,
          "raw": "11 \tmozjs.dll \tJS_CallFunctionValue \tjs/src/jsapi.cpp:5604"
        },
        {
          "frame_index": 12,
          "module": "xul.dll",
          "function": "nsJSContext::CallEventHandler",
          "file": "dom/base/nsJSEnvironment.cpp",
          "line": 1892,
          "raw": "12 \txul.dll \tnsJSContext::CallEventHandler \tdom/base/nsJSEnvironment.cpp:1892"
        },
        {
          "frame_index": 13,
          "module": "xul.dll",
          "function": "nsGlobalWindow::RunTimeoutHandler",
          "file": "dom/base/nsGlobalWindow.cpp",
          "line": 9552,
          "raw": "13 \txul.dll \tnsGlobalWindow::RunTimeoutHandler \tdom/base/nsGlobalWindow.cpp:9552"
        },
        {
          "frame_index": 14,
          "module": "xul.dll",
          "function": "nsGlobalWindow::RunTimeout",
          "file": "dom/base/nsGlobalWindow.cpp",
          "line": 9806,
          "raw": "14 \txul.dll \tnsGlobalWindow::RunTimeout \tdom/base/nsGlobalWindow.cpp:9806"
        },
        {
          "frame_index": 15,
          "module": "xul.dll",
          "function": "nsGlobalWindow::TimerCallback",
          "file": "dom/base/nsGlobalWindow.cpp",
          "line": 10077,
          "raw": "15 \txul.dll \tnsGlobalWindow::TimerCallback \tdom/base/nsGlobalWindow.cpp:10077"
        },
        {
          "frame_index": 16,
          "module": "xul.dll",
          "function": "nsTimerImpl::Fire",
          "file": "xpcom/threads/nsTimerImpl.cpp",
          "line": 473,
          "raw": "16 \txul.dll \tnsTimerImpl::Fire \txpcom/threads/nsTimerImpl.cpp:473"
        },
        {
          "frame_index": 17,
          "module": "xul.dll",
          "function": "nsThread::ProcessNextEvent",
          "file": "xpcom/threads/nsThread.cpp",
          "line": 624,
          "raw": "17 \txul.dll \tnsThread::ProcessNextEvent \txpcom/threads/nsThread.cpp:624"
        },
        {
          "frame_index": 18,
          "module": "xul.dll",
          "function": "mozilla::ipc::RPCChannel::DequeueTask::`scalar deleting destructor'",
          "file": "",
          "line": null,
          "raw": "18 \txul.dll \tmozilla::ipc::RPCChannel::DequeueTask::`scalar deleting destructor'"
        },
        {
          "frame_index": 19,
          "module": "nspr4.dll",
          "function": "_MD_CURRENT_THREAD",
          "file": "nsprpub/pr/src/md/windows/w95thred.c",
          "line": 312,
          "raw": "19 \tnspr4.dll \t_MD_CURRENT_THREAD \tnsprpub/pr/src/md/windows/w95thred.c:312"
        },
        {
          "frame_index": 20,
          "module": "xul.dll",
          "function": "mozilla::ipc::MessagePump::Run",
          "file": "ipc/glue/MessagePump.cpp",
          "line": 82,
          "raw": "20 \txul.dll \tmozilla::ipc::MessagePump::Run \tipc/glue/MessagePump.cpp:82"
        },
        {
          "frame_index": 21,
          "module": "xul.dll",
          "function": "MessageLoop::RunHandler",
          "file": "ipc/chromium/src/base/message_loop.cc",
          "line": 201,
          "raw": "21 \txul.dll \tMessageLoop::RunHandler \tipc/chromium/src/base/message_loop.cc:201"
        },
        {
          "frame_index": 22,
          "module": "xul.dll",
          "function": "nsRange::ContentRemoved",
          "file": "content/base/src/nsRange.cpp",
          "line": 571,
          "raw": "22 \txul.dll \tnsRange::ContentRemoved \tcontent/base/src/nsRange.cpp:571"
        },
        {
          "frame_index": 23,
          "module": "xul.dll",
          "function": "nsBaseAppShell::Run",
          "file": "widget/xpwidgets/nsBaseAppShell.cpp",
          "line": 163,
          "raw": "23 \txul.dll \tnsBaseAppShell::Run \twidget/xpwidgets/nsBaseAppShell.cpp:163"
        },
        {
          "frame_index": 24,
          "module": "xul.dll",
          "function": "FindSubstring<wchar_t,char>",
          "file": "xpcom/string/src/nsStringObsolete.cpp",
          "line": 680,
          "raw": "24 \txul.dll \tFindSubstring<wchar_t,char> \txpcom/string/src/nsStringObsolete.cpp:680"
        },
        {
          "frame_index": 25,
          "module": "xul.dll",
          "function": "nsBlockFrame::GetLineCursor",
          "file": "layout/generic/nsBlockFrame.h",
          "line": 369,
          "raw": "25 \txul.dll \tnsBlockFrame::GetLineCursor \tlayout/generic/nsBlockFrame.h:369"
        },
        {
          "frame_index": 26,
          "module": "xul.dll",
          "function": "nsSupportsArray::GrowArrayBy",
          "file": "xpcom/ds/nsSupportsArray.cpp",
          "line": 133,
          "raw": "26 \txul.dll \tnsSupportsArray::GrowArrayBy \txpcom/ds/nsSupportsArray.cpp:133"
        },
        {
          "frame_index": 27,
          "module": "xul.dll",
          "function": "nsSupportsArray::GrowArrayBy",
          "file": "xpcom/ds/nsSupportsArray.cpp",
          "line": 132,
          "raw": "27 \txul.dll \tnsSupportsArray::GrowArrayBy \txpcom/ds/nsSupportsArray.cpp:132"
        },
        {
          "frame_index": 28,
          "module": "xul.dll",
          "function": "nsBlockFrame::GetLineCursor",
          "file": "layout/generic/nsBlockFrame.h",
          "line": 369,
          "raw": "28 \txul.dll \tnsBlockFrame::GetLineCursor \tlayout/generic/nsBlockFrame.h:369"
        }
      ],
      "frame_count": 29
    },
    {
      "comment_id": 7040112,
      "comment_count": 16,
      "creator": "ajvincent@gmail.com",
      "creation_time": "2013-01-25T21:12:35Z",
      "raw_text": "Looking into this: I get a ton of assertions, and then the crash:\n\n###!!! ASSERTION: nsHTMLDocument::Close(): Trying to remove nonexistent wyciwyg channel!: 'mWyciwygChannel', file c:/ff18/mozilla/content/html/document/src/nsHTMLDocument.cpp, line 1643\n###!!! ASSERTION: This is unsafe! Fix the caller! Userdata callback disabled.: 'Error', file c:/ff18/mozilla/content/base/src/nsNodeUtils.cpp, line 305\n###!!! ASSERTION: This is unsafe! Fix the caller!: 'Error', file c:/ff18/mozilla/content/events/src/nsEventDispatcher.cpp, line 513\n###!!! ASSERTION: Want to fire DOMNodeRemoved event, but it's not safe: '(aChild->IsNodeOfType(nsINode::eCONTENT) && static_cast<nsIContent*>(aChild)-> IsInNativeAnonymousSubtree()) || IsSafeToRunScript() || sDOMNodeRemovedSuppressCount', file c:/ff18/mozilla/content/base/src/nsContentUtils.cpp, line 3921\n###!!! ASSERTION: Did we run script inappropriately?: 'aKid->GetNodeParent() == this', file c:/ff18/mozilla/content/base/src/nsINode.cpp, line 1313\n###!!! ASSERTION: aRoot not an ancestor of |this|?: 'cur', file c:\\ff18\\fx-debug\\dist\\include\\nsINode.h, line 1199\n\n \txul.dll!nsINode::GetNextSibling()  Line 1150 + 0xa bytes\tC++\n \txul.dll!nsINode::GetNextNodeImpl(const nsINode * aRoot=0x15897c38, const bool aSkipChildren=false)  Line 1213 + 0x8 bytes\tC++\n \txul.dll!nsINode::GetNextNode(const nsINode * aRoot=0x15897c38)  Line 1163\tC++\n \txul.dll!nsContentList::ContentAppended(nsIDocument * aDocument=0x10dd9168, nsIContent * aContainer=0x15897c38, nsIContent * aFirstNewContent=0x14d15068, int aNewIndexInContainer=47)  Line 848 + 0xc bytes\tC++\n \txul.dll!nsNodeUtils::ContentAppended(nsIContent * aContainer=0x15897c38, nsIContent * aFirstNewContent=0x14d15068, int aNewIndexInContainer=47)  Line 129 + 0xe6 bytes\tC++\n\n\n0 anonymous() [\"http://db3.stj.s-msn.com/br/csl/js/1/jquery-1.3.2.min.js\":19]\n    this = function (E,F){return new o.fn.init(E,F)}\n1 anonymous() [\"http://db3.stj.s-msn.com/br/csl/js/1/jquery-1.3.2.min.js\":19]\n    this = function (E,F){return new o.fn.init(E,F)}\n2 anonymous() [\"http://db3.stj.s-msn.com/br/csl/js/1/jquery-1.3.2.min.js\":19]\n    this = function (E,F){return new o.fn.init(E,F)}\n3 anonymous() [\"http://wetter.msn.com/\":101]\n    this = [object Window @ 0x11a92cd0 (native @ 0x14de1348)]",
      "matched_patterns": [
        "ns[A-Z]\\w+::\\w+"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "nsINode::GetNextSibling()",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsINode::GetNextSibling()  Line 1150 + 0xa bytes\tC++"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "nsINode::GetNextNodeImpl(const",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsINode::GetNextNodeImpl(const nsINode * aRoot=0x15897c38, const bool aSkipChildren=false)  Line 1213 + 0x8 bytes\tC++"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "nsINode::GetNextNode(const",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsINode::GetNextNode(const nsINode * aRoot=0x15897c38)  Line 1163\tC++"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "nsContentList::ContentAppended(nsIDocument",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsContentList::ContentAppended(nsIDocument * aDocument=0x10dd9168, nsIContent * aContainer=0x15897c38, nsIContent * aFirstNewContent=0x14d15068, int aNewIndexInContainer=47)  Line 848 + 0xc bytes\tC++"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "nsNodeUtils::ContentAppended(nsIContent",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsNodeUtils::ContentAppended(nsIContent * aContainer=0x15897c38, nsIContent * aFirstNewContent=0x14d15068, int aNewIndexInContainer=47)  Line 129 + 0xe6 bytes\tC++"
        }
      ],
      "frame_count": 5
    },
    {
      "comment_id": 7040577,
      "comment_count": 17,
      "creator": "ajvincent@gmail.com",
      "creation_time": "2013-01-25T23:08:18Z",
      "raw_text": "Created attachment 706616\nstack trace of an interesting assertion\n\nNear the top of this assertion we have:\n\nxul.dll!nsINode::RemoveChild(nsINode * aOldChild=0x0abe39e8)  Line 442 + 0x16 bytes\tC++\n\nthis\t0x143977e0\tnsINode * const\nIn that frame we have this as a HEAD element, and aOldChild is a SCRIPT element with src \"http://platform.twitter.com/widgets.js\".\n\nBut deeper in the stack, we have:\n\n>\txul.dll!nsINode::AppendChild(nsINode * aNewChild=0x0abe39e8, tag_nsresult * aReturn=0x003bbf28)  Line 505\tC++\nthis\t0x143977e0\tnsINode * const\n\nSo there's some code telling us to remove the script element we are in the process of adding.",
      "matched_patterns": [
        "ns[A-Z]\\w+::\\w+",
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "nsINode::RemoveChild(nsINode",
          "offset": "",
          "file": "",
          "line": null,
          "raw": "xul.dll!nsINode::RemoveChild(nsINode * aOldChild=0x0abe39e8)  Line 442 + 0x16 bytes\tC++"
        }
      ],
      "frame_count": 1
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 3,
  "total_parsed_frames": 35
}