{
  "bug_id": "1993904",
  "summary": "Crash in [@ nsLocalFile::MoveOrCopyAsSingleFileOrDir] from IsDirectory",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "XPCOM",
  "version": "unspecified",
  "severity": "--",
  "priority": "--",
  "creation_time": "2025-10-13T08:24:30Z",
  "last_change_time": "2025-12-01T21:16:18Z",
  "is_recent": true,
  "crash_signature_raw": "[@ nsLocalFile::MoveOrCopyAsSingleFileOrDir]",
  "crash_signatures": [
    "nsLocalFile::MoveOrCopyAsSingleFileOrDir"
  ],
  "keywords": [
    "crash",
    "regression"
  ],
  "regressed_by": [
    1980886
  ],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1993904",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/b57aead6-569c-49e3-895e-19d5e0251012",
      "crash_id": "b57aead6-569c-49e3-895e-19d5e0251012",
      "comment_index": 0,
      "comment_text": "Crash report: https://crash-stats.mozilla.org/report/index/b57aead6-569c-49e3-895e-19d5e0251012\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(NS_SUCCEEDED(IsDirectory(&isDir)))\n```\n\nTop 10 frames:\n```\n0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1872\n1  xul.dll  nsLocalFile::RenameTo(nsIFile*, nsTSubstring<char16_t> const&)  xpcom/io/nsLocalFileWin.cpp:2317\n2  xul.dll  nsLocalFile::RenameToNative(nsIFile*, nsTSubstring<char> const&)  xpcom/io/nsLocalFileWin.cpp:2326\n3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles::<lambda_8>::operat...  netwerk/cache2/CacheFileIOManager.cpp:4484\n3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles()  netwerk/cache2/CacheFileIOManager.cpp:4456\n4  xul.dll  mozilla::net::CacheFileIOManager::Shutdown()  netwerk/cache2/CacheFileIOManager.cpp:1322\n5  xul.dll  mozilla::net::CacheObserver::Observe(nsISupports*, char const*, char16_t const*)  netwerk/cache2/CacheObserver.cpp:225\n6  xul.dll  nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverList.cpp:71\n6  xul.dll  nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverService.cpp:288\n7  xul.dll  mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bo...  xpcom/base/AppShutdown.cpp:442\n```\nFrom what I can tell this appears to be regression introduced by the changes in bug 1978495. The crashes are only happening on Windows at the moment even though this does not appear to be a Windows-specific issue, at least on the surface."
    }
  ],
  "socorro_crash_ids": [
    "b57aead6-569c-49e3-895e-19d5e0251012"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17713567,
      "comment_count": 0,
      "creator": "gsvelto@mozilla.com",
      "creation_time": "2025-10-13T08:24:30Z",
      "raw_text": "Crash report: https://crash-stats.mozilla.org/report/index/b57aead6-569c-49e3-895e-19d5e0251012\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(NS_SUCCEEDED(IsDirectory(&isDir)))\n```\n\nTop 10 frames:\n```\n0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1872\n1  xul.dll  nsLocalFile::RenameTo(nsIFile*, nsTSubstring<char16_t> const&)  xpcom/io/nsLocalFileWin.cpp:2317\n2  xul.dll  nsLocalFile::RenameToNative(nsIFile*, nsTSubstring<char> const&)  xpcom/io/nsLocalFileWin.cpp:2326\n3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles::<lambda_8>::operat...  netwerk/cache2/CacheFileIOManager.cpp:4484\n3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles()  netwerk/cache2/CacheFileIOManager.cpp:4456\n4  xul.dll  mozilla::net::CacheFileIOManager::Shutdown()  netwerk/cache2/CacheFileIOManager.cpp:1322\n5  xul.dll  mozilla::net::CacheObserver::Observe(nsISupports*, char const*, char16_t const*)  netwerk/cache2/CacheObserver.cpp:225\n6  xul.dll  nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverList.cpp:71\n6  xul.dll  nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverService.cpp:288\n7  xul.dll  mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bo...  xpcom/base/AppShutdown.cpp:442\n```\nFrom what I can tell this appears to be regression introduced by the changes in bug 1978495. The crashes are only happening on Windows at the moment even though this does not appear to be a Windows-specific issue, at least on the surface.",
      "matched_patterns": [
        "mozilla::\\S+::\\S+\\s*\\(",
        "ns[A-Z]\\w+::\\w+",
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...",
          "file": "xpcom/io/nsLocalFileWin.cpp",
          "line": 1872,
          "raw": "0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1872"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "nsLocalFile::RenameTo(nsIFile*, nsTSubstring<char16_t> const&)",
          "file": "xpcom/io/nsLocalFileWin.cpp",
          "line": 2317,
          "raw": "1  xul.dll  nsLocalFile::RenameTo(nsIFile*, nsTSubstring<char16_t> const&)  xpcom/io/nsLocalFileWin.cpp:2317"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "nsLocalFile::RenameToNative(nsIFile*, nsTSubstring<char> const&)",
          "file": "xpcom/io/nsLocalFileWin.cpp",
          "line": 2326,
          "raw": "2  xul.dll  nsLocalFile::RenameToNative(nsIFile*, nsTSubstring<char> const&)  xpcom/io/nsLocalFileWin.cpp:2326"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles::<lambda_8>::operat...",
          "file": "netwerk/cache2/CacheFileIOManager.cpp",
          "line": 4484,
          "raw": "3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles::<lambda_8>::operat...  netwerk/cache2/CacheFileIOManager.cpp:4484"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles()",
          "file": "netwerk/cache2/CacheFileIOManager.cpp",
          "line": 4456,
          "raw": "3  xul.dll  mozilla::net::CacheFileIOManager::SyncRemoveAllCacheFiles()  netwerk/cache2/CacheFileIOManager.cpp:4456"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "mozilla::net::CacheFileIOManager::Shutdown()",
          "file": "netwerk/cache2/CacheFileIOManager.cpp",
          "line": 1322,
          "raw": "4  xul.dll  mozilla::net::CacheFileIOManager::Shutdown()  netwerk/cache2/CacheFileIOManager.cpp:1322"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "mozilla::net::CacheObserver::Observe(nsISupports*, char const*, char16_t const*)",
          "file": "netwerk/cache2/CacheObserver.cpp",
          "line": 225,
          "raw": "5  xul.dll  mozilla::net::CacheObserver::Observe(nsISupports*, char const*, char16_t const*)  netwerk/cache2/CacheObserver.cpp:225"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*)",
          "file": "xpcom/ds/nsObserverList.cpp",
          "line": 71,
          "raw": "6  xul.dll  nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverList.cpp:71"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*)",
          "file": "xpcom/ds/nsObserverService.cpp",
          "line": 288,
          "raw": "6  xul.dll  nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*)  xpcom/ds/nsObserverService.cpp:288"
        },
        {
          "frame_index": 7,
          "module": "xul.dll",
          "function": "mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bo...",
          "file": "xpcom/base/AppShutdown.cpp",
          "line": 442,
          "raw": "7  xul.dll  mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bo...  xpcom/base/AppShutdown.cpp:442"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}