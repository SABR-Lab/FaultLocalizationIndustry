{
  "bug_id": "1996506",
  "summary": "Crash in [@ NS_CycleCollectorSuspect3 | nsCycleCollectingAutoRefCnt::incr] via nsCoreUtils::GetDocShellFor",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "Disability Access APIs",
  "version": "unspecified",
  "severity": "S2",
  "priority": "--",
  "creation_time": "2025-10-27T06:32:40Z",
  "last_change_time": "2025-12-11T12:10:39Z",
  "is_recent": true,
  "crash_signature_raw": "[@ NS_CycleCollectorSuspect3 | nsCycleCollectingAutoRefCnt::incr]",
  "crash_signatures": [
    "NS_CycleCollectorSuspect3 | nsCycleCollectingAutoRefCnt::incr"
  ],
  "keywords": [
    "crash",
    "topcrash"
  ],
  "regressed_by": [],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1996506",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/ad2a5767-2793-409c-9bdb-1776d0251025",
      "crash_id": "ad2a5767-2793-409c-9bdb-1776d0251025",
      "comment_index": 0,
      "comment_text": "It seems that a11y increments ref count of XPCOM on Android UI thread.\n\nCrash report: https://crash-stats.mozilla.org/report/index/ad2a5767-2793-409c-9bdb-1776d0251025\n\nMOZ_CRASH Reason:\n```\nMOZ_DIAGNOSTIC_ASSERT(data) (Cycle collected object used on a thread without a cycle collector.)\n```\n\nTop 10 frames:\n```\n0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:242\n0  libxul.so  NS_CycleCollectorSuspect3  xpcom/base/nsCycleCollector.cpp:4077\n1  libxul.so  nsCycleCollectingAutoRefCnt::incr(void*, nsCycleCollectionParticipant*)  xpcom/base/nsISupportsImpl.h:265\n1  libxul.so  nsCycleCollectingAutoRefCnt::incr(nsISupports*)  xpcom/base/nsISupportsImpl.h:252\n1  libxul.so  nsDocLoader::AddRef()  uriloader/base/nsDocLoader.cpp:194\n1  libxul.so  nsDocShell::AddRef()  docshell/base/nsDocShell.cpp:572\n1  libxul.so  {virtual override thunk({offset(-392)}, nsDocShell::AddRef())}  docshell/base/nsDocShell.cpp:0\n2  libxul.so  mozilla::RefPtrTraits<nsIDocShell>::AddRef(nsIDocShell*)  mfbt/RefPtr.h:48\n2  libxul.so  nsCOMPtr<nsIDocShell>::nsCOMPtr(nsIDocShell*)  xpcom/base/nsCOMPtr.h:423\n2  libxul.so  nsCoreUtils::GetDocShellFor(nsINode*)  accessible/base/nsCoreUtils.cpp:334\n```"
    }
  ],
  "socorro_crash_ids": [
    "ad2a5767-2793-409c-9bdb-1776d0251025"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17734018,
      "comment_count": 0,
      "creator": "m_kato@ga2.so-net.ne.jp",
      "creation_time": "2025-10-27T06:32:40Z",
      "raw_text": "It seems that a11y increments ref count of XPCOM on Android UI thread.\n\nCrash report: https://crash-stats.mozilla.org/report/index/ad2a5767-2793-409c-9bdb-1776d0251025\n\nMOZ_CRASH Reason:\n```\nMOZ_DIAGNOSTIC_ASSERT(data) (Cycle collected object used on a thread without a cycle collector.)\n```\n\nTop 10 frames:\n```\n0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:242\n0  libxul.so  NS_CycleCollectorSuspect3  xpcom/base/nsCycleCollector.cpp:4077\n1  libxul.so  nsCycleCollectingAutoRefCnt::incr(void*, nsCycleCollectionParticipant*)  xpcom/base/nsISupportsImpl.h:265\n1  libxul.so  nsCycleCollectingAutoRefCnt::incr(nsISupports*)  xpcom/base/nsISupportsImpl.h:252\n1  libxul.so  nsDocLoader::AddRef()  uriloader/base/nsDocLoader.cpp:194\n1  libxul.so  nsDocShell::AddRef()  docshell/base/nsDocShell.cpp:572\n1  libxul.so  {virtual override thunk({offset(-392)}, nsDocShell::AddRef())}  docshell/base/nsDocShell.cpp:0\n2  libxul.so  mozilla::RefPtrTraits<nsIDocShell>::AddRef(nsIDocShell*)  mfbt/RefPtr.h:48\n2  libxul.so  nsCOMPtr<nsIDocShell>::nsCOMPtr(nsIDocShell*)  xpcom/base/nsCOMPtr.h:423\n2  libxul.so  nsCoreUtils::GetDocShellFor(nsINode*)  accessible/base/nsCoreUtils.cpp:334\n```",
      "matched_patterns": [
        "mozilla::\\S+::\\S+\\s*\\(",
        "ns[A-Z]\\w+::\\w+",
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "MOZ_CrashSequence(void*, long)",
          "file": "mfbt/Assertions.h",
          "line": 242,
          "raw": "0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:242"
        },
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "NS_CycleCollectorSuspect3",
          "file": "xpcom/base/nsCycleCollector.cpp",
          "line": 4077,
          "raw": "0  libxul.so  NS_CycleCollectorSuspect3  xpcom/base/nsCycleCollector.cpp:4077"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "nsCycleCollectingAutoRefCnt::incr(void*, nsCycleCollectionParticipant*)",
          "file": "xpcom/base/nsISupportsImpl.h",
          "line": 265,
          "raw": "1  libxul.so  nsCycleCollectingAutoRefCnt::incr(void*, nsCycleCollectionParticipant*)  xpcom/base/nsISupportsImpl.h:265"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "nsCycleCollectingAutoRefCnt::incr(nsISupports*)",
          "file": "xpcom/base/nsISupportsImpl.h",
          "line": 252,
          "raw": "1  libxul.so  nsCycleCollectingAutoRefCnt::incr(nsISupports*)  xpcom/base/nsISupportsImpl.h:252"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "nsDocLoader::AddRef()",
          "file": "uriloader/base/nsDocLoader.cpp",
          "line": 194,
          "raw": "1  libxul.so  nsDocLoader::AddRef()  uriloader/base/nsDocLoader.cpp:194"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "nsDocShell::AddRef()",
          "file": "docshell/base/nsDocShell.cpp",
          "line": 572,
          "raw": "1  libxul.so  nsDocShell::AddRef()  docshell/base/nsDocShell.cpp:572"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "{virtual override thunk({offset(-392)}, nsDocShell::AddRef())}",
          "file": "docshell/base/nsDocShell.cpp",
          "line": 0,
          "raw": "1  libxul.so  {virtual override thunk({offset(-392)}, nsDocShell::AddRef())}  docshell/base/nsDocShell.cpp:0"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::RefPtrTraits<nsIDocShell>::AddRef(nsIDocShell*)",
          "file": "mfbt/RefPtr.h",
          "line": 48,
          "raw": "2  libxul.so  mozilla::RefPtrTraits<nsIDocShell>::AddRef(nsIDocShell*)  mfbt/RefPtr.h:48"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "nsCOMPtr<nsIDocShell>::nsCOMPtr(nsIDocShell*)",
          "file": "xpcom/base/nsCOMPtr.h",
          "line": 423,
          "raw": "2  libxul.so  nsCOMPtr<nsIDocShell>::nsCOMPtr(nsIDocShell*)  xpcom/base/nsCOMPtr.h:423"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "nsCoreUtils::GetDocShellFor(nsINode*)",
          "file": "accessible/base/nsCoreUtils.cpp",
          "line": 334,
          "raw": "2  libxul.so  nsCoreUtils::GetDocShellFor(nsINode*)  accessible/base/nsCoreUtils.cpp:334"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}