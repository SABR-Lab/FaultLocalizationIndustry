{
  "bug_id": "1998803",
  "summary": "Crash in [@ DMABufSurfaceYUV::GetUsedMemoryYUV]",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "Audio/Video: Playback",
  "version": "unspecified",
  "severity": "S4",
  "priority": "--",
  "creation_time": "2025-11-06T21:01:53Z",
  "last_change_time": "2025-12-10T01:22:53Z",
  "is_recent": true,
  "crash_signature_raw": "[@ DMABufSurfaceYUV::GetUsedMemoryYUV]",
  "crash_signatures": [
    "DMABufSurfaceYUV::GetUsedMemoryYUV"
  ],
  "keywords": [
    "crash"
  ],
  "regressed_by": [],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1998803",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/5cf6a5a3-2190-4197-853a-181020251106",
      "crash_id": "5cf6a5a3-2190-4197-853a-181020251106",
      "comment_index": 0,
      "comment_text": "Crash report: https://crash-stats.mozilla.org/report/index/5cf6a5a3-2190-4197-853a-181020251106\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(DMABufSurfaceYUV::GetUsedMemoryYUV(): unknown format!)\n```\n\nTop 10 frames:\n```\n0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:237\n0  libxul.so  DMABufSurfaceYUV::GetUsedMemoryYUV(int, int, int)  widget/gtk/DMABufSurface.cpp:1534\n1  libxul.so  DMABufSurfaceYUV::ReleaseVADRMPRIMESurfaceDescriptor(_VADRMPRIMESurfaceDescri...  widget/gtk/DMABufSurface.cpp:1635\n2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1799\n2  libxul.so  mozilla::ScopeExit<mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, lo...  mfbt/ScopeExit.h:106\n2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1848\n3  libxul.so  mozilla::FFmpegVideoDecoder<61>::DoDecode(mozilla::MediaRawData*, unsigned ch...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1311\n4  libxul.so  mozilla::FFmpegDataDecoder<53>::DoDecode(mozilla::MediaRawData*, bool*, nsTAr...  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:277\n5  libxul.so  mozilla::FFmpegDataDecoder<61>::ProcessDrain()  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:308\n6  libxul.so  mozilla::detail::RunnableMethodArguments<>::apply<mozilla::FFmpegDataDecoder<...  xpcom/threads/nsThreadUtils.h:1083\n```\n\nFirst seen in build [20250818083741](https://hg-edge.mozilla.org/mozilla-central/pushloghtml?fromchange=26a4b3bbf1f2411870927b34a12ecbd0b0f51bda&tochange=39f0dc0f24d549dd713351d8c6f84fab09227dce) maybe bug 1983367?"
    }
  ],
  "socorro_crash_ids": [
    "5cf6a5a3-2190-4197-853a-181020251106"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17751957,
      "comment_count": 0,
      "creator": "dsmith@mozilla.com",
      "creation_time": "2025-11-06T21:01:53Z",
      "raw_text": "Crash report: https://crash-stats.mozilla.org/report/index/5cf6a5a3-2190-4197-853a-181020251106\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(DMABufSurfaceYUV::GetUsedMemoryYUV(): unknown format!)\n```\n\nTop 10 frames:\n```\n0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:237\n0  libxul.so  DMABufSurfaceYUV::GetUsedMemoryYUV(int, int, int)  widget/gtk/DMABufSurface.cpp:1534\n1  libxul.so  DMABufSurfaceYUV::ReleaseVADRMPRIMESurfaceDescriptor(_VADRMPRIMESurfaceDescri...  widget/gtk/DMABufSurface.cpp:1635\n2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1799\n2  libxul.so  mozilla::ScopeExit<mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, lo...  mfbt/ScopeExit.h:106\n2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1848\n3  libxul.so  mozilla::FFmpegVideoDecoder<61>::DoDecode(mozilla::MediaRawData*, unsigned ch...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1311\n4  libxul.so  mozilla::FFmpegDataDecoder<53>::DoDecode(mozilla::MediaRawData*, bool*, nsTAr...  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:277\n5  libxul.so  mozilla::FFmpegDataDecoder<61>::ProcessDrain()  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:308\n6  libxul.so  mozilla::detail::RunnableMethodArguments<>::apply<mozilla::FFmpegDataDecoder<...  xpcom/threads/nsThreadUtils.h:1083\n```\n\nFirst seen in build [20250818083741](https://hg-edge.mozilla.org/mozilla-central/pushloghtml?fromchange=26a4b3bbf1f2411870927b34a12ecbd0b0f51bda&tochange=39f0dc0f24d549dd713351d8c6f84fab09227dce) maybe bug 1983367?",
      "matched_patterns": [
        "mozilla::\\S+::\\S+\\s*\\(",
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "MOZ_CrashSequence(void*, long)",
          "file": "mfbt/Assertions.h",
          "line": 237,
          "raw": "0  libxul.so  MOZ_CrashSequence(void*, long)  mfbt/Assertions.h:237"
        },
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "DMABufSurfaceYUV::GetUsedMemoryYUV(int, int, int)",
          "file": "widget/gtk/DMABufSurface.cpp",
          "line": 1534,
          "raw": "0  libxul.so  DMABufSurfaceYUV::GetUsedMemoryYUV(int, int, int)  widget/gtk/DMABufSurface.cpp:1534"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "DMABufSurfaceYUV::ReleaseVADRMPRIMESurfaceDescriptor(_VADRMPRIMESurfaceDescri...",
          "file": "widget/gtk/DMABufSurface.cpp",
          "line": 1635,
          "raw": "1  libxul.so  DMABufSurfaceYUV::ReleaseVADRMPRIMESurfaceDescriptor(_VADRMPRIMESurfaceDescri...  widget/gtk/DMABufSurface.cpp:1635"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...",
          "file": "dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp",
          "line": 1799,
          "raw": "2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1799"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::ScopeExit<mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, lo...",
          "file": "mfbt/ScopeExit.h",
          "line": 106,
          "raw": "2  libxul.so  mozilla::ScopeExit<mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, lo...  mfbt/ScopeExit.h:106"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...",
          "file": "dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp",
          "line": 1848,
          "raw": "2  libxul.so  mozilla::FFmpegVideoDecoder<61>::CreateImageVAAPI(long, long, long, nsTArray<...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1848"
        },
        {
          "frame_index": 3,
          "module": "libxul.so",
          "function": "mozilla::FFmpegVideoDecoder<61>::DoDecode(mozilla::MediaRawData*, unsigned ch...",
          "file": "dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp",
          "line": 1311,
          "raw": "3  libxul.so  mozilla::FFmpegVideoDecoder<61>::DoDecode(mozilla::MediaRawData*, unsigned ch...  dom/media/platforms/ffmpeg/FFmpegVideoDecoder.cpp:1311"
        },
        {
          "frame_index": 4,
          "module": "libxul.so",
          "function": "mozilla::FFmpegDataDecoder<53>::DoDecode(mozilla::MediaRawData*, bool*, nsTAr...",
          "file": "dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp",
          "line": 277,
          "raw": "4  libxul.so  mozilla::FFmpegDataDecoder<53>::DoDecode(mozilla::MediaRawData*, bool*, nsTAr...  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:277"
        },
        {
          "frame_index": 5,
          "module": "libxul.so",
          "function": "mozilla::FFmpegDataDecoder<61>::ProcessDrain()",
          "file": "dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp",
          "line": 308,
          "raw": "5  libxul.so  mozilla::FFmpegDataDecoder<61>::ProcessDrain()  dom/media/platforms/ffmpeg/FFmpegDataDecoder.cpp:308"
        },
        {
          "frame_index": 6,
          "module": "libxul.so",
          "function": "mozilla::detail::RunnableMethodArguments<>::apply<mozilla::FFmpegDataDecoder<...",
          "file": "xpcom/threads/nsThreadUtils.h",
          "line": 1083,
          "raw": "6  libxul.so  mozilla::detail::RunnableMethodArguments<>::apply<mozilla::FFmpegDataDecoder<...  xpcom/threads/nsThreadUtils.h:1083"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}