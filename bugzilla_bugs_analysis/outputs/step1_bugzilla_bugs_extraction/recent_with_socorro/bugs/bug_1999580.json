{
  "bug_id": "1999580",
  "summary": "Crash in [@ mozilla::gfx::DrawTarget::GetFormat]",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "Graphics: Canvas2D",
  "version": "unspecified",
  "severity": "--",
  "priority": "--",
  "creation_time": "2025-11-12T00:41:08Z",
  "last_change_time": "2025-11-19T19:14:36Z",
  "is_recent": true,
  "crash_signature_raw": "[@ mozilla::gfx::DrawTarget::GetFormat]",
  "crash_signatures": [
    "mozilla::gfx::DrawTarget::GetFormat"
  ],
  "keywords": [
    "crash",
    "regression"
  ],
  "regressed_by": [
    1999048
  ],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1999580",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/8bf97946-48ee-4338-bccc-95c110251111",
      "crash_id": "8bf97946-48ee-4338-bccc-95c110251111",
      "comment_index": 0,
      "comment_text": "\nCrash report: https://crash-stats.mozilla.org/report/index/8bf97946-48ee-4338-bccc-95c110251111\n\n\n\nReason: ```EXCEPTION_ACCESS_VIOLATION_READ```\n\n\nTop 10 frames of crashing thread:\n```\n0  xul.dll  mozilla::gfx::DrawTarget::GetFormat const  gfx/2d/2D.h:2050\n0  xul.dll  mozilla::gfx::SharedContextWebgl::ReadSnapshotIntoPBO  dom/canvas/DrawTargetWebgl.cpp:1301\n1  xul.dll  mozilla::gfx::SourceSurfaceWebgl::OnUnlinkTexture  dom/canvas/SourceSurfaceWebgl.cpp:203\n2  xul.dll  mozilla::gfx::SharedContextWebgl::UnlinkSurfaceTexture  dom/canvas/DrawTargetWebgl.cpp:278\n2  xul.dll  mozilla::gfx::SharedContextWebgl::PruneTextureHandle  dom/canvas/DrawTargetWebgl.cpp:4239\n3  xul.dll  mozilla::gfx::SharedContextWebgl::ClearAllTextures  dom/canvas/DrawTargetWebgl.cpp:315\n4  xul.dll  mozilla::gfx::SharedContextWebgl::ClearCachesIfNecessary  dom/canvas/DrawTargetWebgl.cpp:410\n5  xul.dll  mozilla::gfx::DrawTargetWebgl::BeginFrame  dom/canvas/DrawTargetWebgl.cpp:6508\n6  xul.dll  mozilla::layers::CanvasTranslator::CreateDrawTarget  gfx/layers/ipc/CanvasTranslator.cpp:1139\n7  xul.dll  mozilla::layers::RecordedCanvasDrawTargetCreation::PlayCanvasEvent const  gfx/layers/RecordedCanvasEventImpl.h:484\n```\n\n\n\nBy querying Nightly crashes reported within the last 2 months, here are some insights about the signature:\n\n- **First crash report:** 2025-11-11\n- **Process type:** GPU\n- **Is startup crash:** No\n- **Has user comments:** No\n- **Is null crash:** Yes - all crashes happened on null or near null memory address\n\n\n\n\n\n\nBy analyzing the backtrace, the regression may have been introduced by a patch [1] to fix Bug 1999048.\n\n[1] https://hg.mozilla.org/mozilla-central/rev?node=7991523200df\n\n\n\n:lsalzman, since you are the author of the potential regressor, could you please take a look?"
    }
  ],
  "socorro_crash_ids": [
    "8bf97946-48ee-4338-bccc-95c110251111"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17758892,
      "comment_count": 0,
      "creator": "release-mgmt-account-bot@mozilla.tld",
      "creation_time": "2025-11-12T00:41:08Z",
      "raw_text": "\nCrash report: https://crash-stats.mozilla.org/report/index/8bf97946-48ee-4338-bccc-95c110251111\n\n\n\nReason: ```EXCEPTION_ACCESS_VIOLATION_READ```\n\n\nTop 10 frames of crashing thread:\n```\n0  xul.dll  mozilla::gfx::DrawTarget::GetFormat const  gfx/2d/2D.h:2050\n0  xul.dll  mozilla::gfx::SharedContextWebgl::ReadSnapshotIntoPBO  dom/canvas/DrawTargetWebgl.cpp:1301\n1  xul.dll  mozilla::gfx::SourceSurfaceWebgl::OnUnlinkTexture  dom/canvas/SourceSurfaceWebgl.cpp:203\n2  xul.dll  mozilla::gfx::SharedContextWebgl::UnlinkSurfaceTexture  dom/canvas/DrawTargetWebgl.cpp:278\n2  xul.dll  mozilla::gfx::SharedContextWebgl::PruneTextureHandle  dom/canvas/DrawTargetWebgl.cpp:4239\n3  xul.dll  mozilla::gfx::SharedContextWebgl::ClearAllTextures  dom/canvas/DrawTargetWebgl.cpp:315\n4  xul.dll  mozilla::gfx::SharedContextWebgl::ClearCachesIfNecessary  dom/canvas/DrawTargetWebgl.cpp:410\n5  xul.dll  mozilla::gfx::DrawTargetWebgl::BeginFrame  dom/canvas/DrawTargetWebgl.cpp:6508\n6  xul.dll  mozilla::layers::CanvasTranslator::CreateDrawTarget  gfx/layers/ipc/CanvasTranslator.cpp:1139\n7  xul.dll  mozilla::layers::RecordedCanvasDrawTargetCreation::PlayCanvasEvent const  gfx/layers/RecordedCanvasEventImpl.h:484\n```\n\n\n\nBy querying Nightly crashes reported within the last 2 months, here are some insights about the signature:\n\n- **First crash report:** 2025-11-11\n- **Process type:** GPU\n- **Is startup crash:** No\n- **Has user comments:** No\n- **Is null crash:** Yes - all crashes happened on null or near null memory address\n\n\n\n\n\n\nBy analyzing the backtrace, the regression may have been introduced by a patch [1] to fix Bug 1999048.\n\n[1] https://hg.mozilla.org/mozilla-central/rev?node=7991523200df\n\n\n\n:lsalzman, since you are the author of the potential regressor, could you please take a look?",
      "matched_patterns": [
        "ns[A-Z]\\w+::\\w+",
        "(?i)(crash|stack)\\s*(trace|dump|report)",
        "(?i)crashing\\s+thread"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "mozilla::gfx::DrawTarget::GetFormat const",
          "file": "gfx/2d/2D.h",
          "line": 2050,
          "raw": "0  xul.dll  mozilla::gfx::DrawTarget::GetFormat const  gfx/2d/2D.h:2050"
        },
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "mozilla::gfx::SharedContextWebgl::ReadSnapshotIntoPBO",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 1301,
          "raw": "0  xul.dll  mozilla::gfx::SharedContextWebgl::ReadSnapshotIntoPBO  dom/canvas/DrawTargetWebgl.cpp:1301"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "mozilla::gfx::SourceSurfaceWebgl::OnUnlinkTexture",
          "file": "dom/canvas/SourceSurfaceWebgl.cpp",
          "line": 203,
          "raw": "1  xul.dll  mozilla::gfx::SourceSurfaceWebgl::OnUnlinkTexture  dom/canvas/SourceSurfaceWebgl.cpp:203"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "mozilla::gfx::SharedContextWebgl::UnlinkSurfaceTexture",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 278,
          "raw": "2  xul.dll  mozilla::gfx::SharedContextWebgl::UnlinkSurfaceTexture  dom/canvas/DrawTargetWebgl.cpp:278"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "mozilla::gfx::SharedContextWebgl::PruneTextureHandle",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 4239,
          "raw": "2  xul.dll  mozilla::gfx::SharedContextWebgl::PruneTextureHandle  dom/canvas/DrawTargetWebgl.cpp:4239"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "mozilla::gfx::SharedContextWebgl::ClearAllTextures",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 315,
          "raw": "3  xul.dll  mozilla::gfx::SharedContextWebgl::ClearAllTextures  dom/canvas/DrawTargetWebgl.cpp:315"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "mozilla::gfx::SharedContextWebgl::ClearCachesIfNecessary",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 410,
          "raw": "4  xul.dll  mozilla::gfx::SharedContextWebgl::ClearCachesIfNecessary  dom/canvas/DrawTargetWebgl.cpp:410"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "mozilla::gfx::DrawTargetWebgl::BeginFrame",
          "file": "dom/canvas/DrawTargetWebgl.cpp",
          "line": 6508,
          "raw": "5  xul.dll  mozilla::gfx::DrawTargetWebgl::BeginFrame  dom/canvas/DrawTargetWebgl.cpp:6508"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "mozilla::layers::CanvasTranslator::CreateDrawTarget",
          "file": "gfx/layers/ipc/CanvasTranslator.cpp",
          "line": 1139,
          "raw": "6  xul.dll  mozilla::layers::CanvasTranslator::CreateDrawTarget  gfx/layers/ipc/CanvasTranslator.cpp:1139"
        },
        {
          "frame_index": 7,
          "module": "xul.dll",
          "function": "mozilla::layers::RecordedCanvasDrawTargetCreation::PlayCanvasEvent const",
          "file": "gfx/layers/RecordedCanvasEventImpl.h",
          "line": 484,
          "raw": "7  xul.dll  mozilla::layers::RecordedCanvasDrawTargetCreation::PlayCanvasEvent const  gfx/layers/RecordedCanvasEventImpl.h:484"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}