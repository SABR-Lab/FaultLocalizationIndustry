{
  "bug_id": "2002421",
  "summary": "[SkPDF] Crash in [@ DWriteFontTypeface::onGetAdvancedMetrics]",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "Printing: Output",
  "version": "unspecified",
  "severity": "--",
  "priority": "--",
  "creation_time": "2025-11-25T23:15:04Z",
  "last_change_time": "2025-12-10T15:54:00Z",
  "is_recent": true,
  "crash_signature_raw": "[@ DWriteFontTypeface::onGetAdvancedMetrics]",
  "crash_signatures": [
    "DWriteFontTypeface::onGetAdvancedMetrics"
  ],
  "keywords": [
    "crash"
  ],
  "regressed_by": [],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=2002421",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/a5178dd9-7e6e-4c1f-917e-091cc0251125",
      "crash_id": "a5178dd9-7e6e-4c1f-917e-091cc0251125",
      "comment_index": 0,
      "comment_text": "This occurs when trying to save as PDF on Windows with the pref print.experimental.skpdf set to true.\n\nCrash report: https://crash-stats.mozilla.org/report/index/a5178dd9-7e6e-4c1f-917e-091cc0251125\n\nReason:\n```\nEXCEPTION_ACCESS_VIOLATION_READ\n```\n\nTop 10 frames:\n```\n0  xul.dll  DWriteFontTypeface::onGetAdvancedMetrics() const  gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp:767\n1  xul.dll  SkTypeface::getAdvancedMetrics() const  gfx/skia/skia/src/core/SkTypeface.cpp:510\n2  xul.dll  SkPDFFont::GetMetrics(SkTypeface const&, SkPDFDocument*)  gfx/skia/skia/src/pdf/SkPDFFont.cpp:266\n3  xul.dll  SkPDFDevice::internalDrawGlyphRun(sktext::GlyphRun const&, SkPoint, SkPaint c...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:950\n4  xul.dll  SkPDFDevice::onDrawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPai...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:1107\n5  xul.dll  SkDevice::drawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint co...  gfx/skia/skia/src/core/SkDevice.cpp:432\n5  xul.dll  SkCanvas::onDrawGlyphRunList(sktext::GlyphRunList const&, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2432\n6  xul.dll  SkCanvas::onDrawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2417\n7  xul.dll  SkCanvas::drawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2567\n8  xul.dll  SkCanvas::drawTextBlob(sk_sp<SkTextBlob> const&, float, float, SkPaint const&)  gfx/skia/skia/include/core/SkCanvas.h:2029\n```"
    }
  ],
  "socorro_crash_ids": [
    "a5178dd9-7e6e-4c1f-917e-091cc0251125"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17781174,
      "comment_count": 0,
      "creator": "jteh@mozilla.com",
      "creation_time": "2025-11-25T23:15:04Z",
      "raw_text": "This occurs when trying to save as PDF on Windows with the pref print.experimental.skpdf set to true.\n\nCrash report: https://crash-stats.mozilla.org/report/index/a5178dd9-7e6e-4c1f-917e-091cc0251125\n\nReason:\n```\nEXCEPTION_ACCESS_VIOLATION_READ\n```\n\nTop 10 frames:\n```\n0  xul.dll  DWriteFontTypeface::onGetAdvancedMetrics() const  gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp:767\n1  xul.dll  SkTypeface::getAdvancedMetrics() const  gfx/skia/skia/src/core/SkTypeface.cpp:510\n2  xul.dll  SkPDFFont::GetMetrics(SkTypeface const&, SkPDFDocument*)  gfx/skia/skia/src/pdf/SkPDFFont.cpp:266\n3  xul.dll  SkPDFDevice::internalDrawGlyphRun(sktext::GlyphRun const&, SkPoint, SkPaint c...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:950\n4  xul.dll  SkPDFDevice::onDrawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPai...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:1107\n5  xul.dll  SkDevice::drawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint co...  gfx/skia/skia/src/core/SkDevice.cpp:432\n5  xul.dll  SkCanvas::onDrawGlyphRunList(sktext::GlyphRunList const&, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2432\n6  xul.dll  SkCanvas::onDrawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2417\n7  xul.dll  SkCanvas::drawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2567\n8  xul.dll  SkCanvas::drawTextBlob(sk_sp<SkTextBlob> const&, float, float, SkPaint const&)  gfx/skia/skia/include/core/SkCanvas.h:2029\n```",
      "matched_patterns": [
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "DWriteFontTypeface::onGetAdvancedMetrics() const",
          "file": "gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp",
          "line": 767,
          "raw": "0  xul.dll  DWriteFontTypeface::onGetAdvancedMetrics() const  gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp:767"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "SkTypeface::getAdvancedMetrics() const",
          "file": "gfx/skia/skia/src/core/SkTypeface.cpp",
          "line": 510,
          "raw": "1  xul.dll  SkTypeface::getAdvancedMetrics() const  gfx/skia/skia/src/core/SkTypeface.cpp:510"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "SkPDFFont::GetMetrics(SkTypeface const&, SkPDFDocument*)",
          "file": "gfx/skia/skia/src/pdf/SkPDFFont.cpp",
          "line": 266,
          "raw": "2  xul.dll  SkPDFFont::GetMetrics(SkTypeface const&, SkPDFDocument*)  gfx/skia/skia/src/pdf/SkPDFFont.cpp:266"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "SkPDFDevice::internalDrawGlyphRun(sktext::GlyphRun const&, SkPoint, SkPaint c...",
          "file": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp",
          "line": 950,
          "raw": "3  xul.dll  SkPDFDevice::internalDrawGlyphRun(sktext::GlyphRun const&, SkPoint, SkPaint c...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:950"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "SkPDFDevice::onDrawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPai...",
          "file": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp",
          "line": 1107,
          "raw": "4  xul.dll  SkPDFDevice::onDrawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPai...  gfx/skia/skia/src/pdf/SkPDFDevice.cpp:1107"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "SkDevice::drawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint co...",
          "file": "gfx/skia/skia/src/core/SkDevice.cpp",
          "line": 432,
          "raw": "5  xul.dll  SkDevice::drawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint co...  gfx/skia/skia/src/core/SkDevice.cpp:432"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "SkCanvas::onDrawGlyphRunList(sktext::GlyphRunList const&, SkPaint const&)",
          "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
          "line": 2432,
          "raw": "5  xul.dll  SkCanvas::onDrawGlyphRunList(sktext::GlyphRunList const&, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2432"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "SkCanvas::onDrawTextBlob(SkTextBlob const*, float, float, SkPaint const&)",
          "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
          "line": 2417,
          "raw": "6  xul.dll  SkCanvas::onDrawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2417"
        },
        {
          "frame_index": 7,
          "module": "xul.dll",
          "function": "SkCanvas::drawTextBlob(SkTextBlob const*, float, float, SkPaint const&)",
          "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
          "line": 2567,
          "raw": "7  xul.dll  SkCanvas::drawTextBlob(SkTextBlob const*, float, float, SkPaint const&)  gfx/skia/skia/src/core/SkCanvas.cpp:2567"
        },
        {
          "frame_index": 8,
          "module": "xul.dll",
          "function": "SkCanvas::drawTextBlob(sk_sp<SkTextBlob> const&, float, float, SkPaint const&)",
          "file": "gfx/skia/skia/include/core/SkCanvas.h",
          "line": 2029,
          "raw": "8  xul.dll  SkCanvas::drawTextBlob(sk_sp<SkTextBlob> const&, float, float, SkPaint const&)  gfx/skia/skia/include/core/SkCanvas.h:2029"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}