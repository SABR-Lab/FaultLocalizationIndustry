{
  "bug_id": "2003364",
  "summary": "Diagnostic crash in [@ nsLocalFile::MoveOrCopyAsSingleFileOrDir] with SetNamedSecurityInfoW",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "XPCOM",
  "version": "unspecified",
  "severity": "--",
  "priority": "--",
  "creation_time": "2025-12-01T21:15:33Z",
  "last_change_time": "2025-12-03T04:38:08Z",
  "is_recent": true,
  "crash_signature_raw": "[@ nsLocalFile::MoveOrCopyAsSingleFileOrDir]",
  "crash_signatures": [
    "nsLocalFile::MoveOrCopyAsSingleFileOrDir"
  ],
  "keywords": [
    "crash",
    "regression"
  ],
  "regressed_by": [
    1980886
  ],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=2003364",
  "socorro_links": [
    {
      "url": "https://crash-stats.mozilla.org/report/index/3ddef68e-6ac1-4d6c-b80e-26b150251201",
      "crash_id": "3ddef68e-6ac1-4d6c-b80e-26b150251201",
      "comment_index": 0,
      "comment_text": "Crash report: https://crash-stats.mozilla.org/report/index/3ddef68e-6ac1-4d6c-b80e-26b150251201\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(ERROR_SUCCESS == ::SetNamedSecurityInfoW(destPath.get(), SE_FILE_OBJECT, DACL_SECURITY_INFORMATION | UNPROTECTED_DACL_SECURITY_INFORMATION, nullptr, nullptr, childDacl, nullptr))\n```\n\nTop 10 frames:\n```\n0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1953\n1  xul.dll  nsLocalFile::CopyMove(nsIFile*, nsTSubstring<char16_t> const&, unsigned int)  xpcom/io/nsLocalFileWin.cpp:2074\n2  xul.dll  mozilla::IOUtils::CopyOrMoveSync<nsresult (nsIFile::*)(nsIFile*, const nsTSub...  xpcom/ioutils/IOUtils.cpp:1738\n3  xul.dll  mozilla::IOUtils::MoveSync(nsIFile*, nsIFile*, bool)  xpcom/ioutils/IOUtils.cpp:1608\n4  xul.dll  mozilla::IOUtils::Move::<lambda_8>::operator()<mozilla::DataMutexBase<mozilla...  xpcom/ioutils/IOUtils.cpp:684\n4  xul.dll  mozilla::IOUtils::EventQueue::Dispatch<mozilla::Ok, `lambda at /builds/worker...  xpcom/ioutils/IOUtils.cpp:2564\n4  xul.dll  mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/x...  xpcom/threads/nsThreadUtils.h:549\n5  xul.dll  mozilla::TaskQueue::Runner::Run()  xpcom/threads/TaskQueue.cpp:263\n6  xul.dll  nsThreadPool::Run()  xpcom/threads/nsThreadPool.cpp:449\n7  xul.dll  nsThread::ProcessNextEvent(bool, bool*)  xpcom/threads/nsThread.cpp:1158\n```\n\nIt looks like this assertion was added in bug 1980886. Bug 1993904 fixed a different assertion with this crash signature."
    }
  ],
  "socorro_crash_ids": [
    "3ddef68e-6ac1-4d6c-b80e-26b150251201"
  ],
  "has_socorro_link": true,
  "has_direct_crash_id": true,
  "stack_traces": [
    {
      "comment_id": 17788890,
      "comment_count": 0,
      "creator": "continuation@gmail.com",
      "creation_time": "2025-12-01T21:15:33Z",
      "raw_text": "Crash report: https://crash-stats.mozilla.org/report/index/3ddef68e-6ac1-4d6c-b80e-26b150251201\n\nMOZ_CRASH Reason:\n```\nMOZ_CRASH(ERROR_SUCCESS == ::SetNamedSecurityInfoW(destPath.get(), SE_FILE_OBJECT, DACL_SECURITY_INFORMATION | UNPROTECTED_DACL_SECURITY_INFORMATION, nullptr, nullptr, childDacl, nullptr))\n```\n\nTop 10 frames:\n```\n0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1953\n1  xul.dll  nsLocalFile::CopyMove(nsIFile*, nsTSubstring<char16_t> const&, unsigned int)  xpcom/io/nsLocalFileWin.cpp:2074\n2  xul.dll  mozilla::IOUtils::CopyOrMoveSync<nsresult (nsIFile::*)(nsIFile*, const nsTSub...  xpcom/ioutils/IOUtils.cpp:1738\n3  xul.dll  mozilla::IOUtils::MoveSync(nsIFile*, nsIFile*, bool)  xpcom/ioutils/IOUtils.cpp:1608\n4  xul.dll  mozilla::IOUtils::Move::<lambda_8>::operator()<mozilla::DataMutexBase<mozilla...  xpcom/ioutils/IOUtils.cpp:684\n4  xul.dll  mozilla::IOUtils::EventQueue::Dispatch<mozilla::Ok, `lambda at /builds/worker...  xpcom/ioutils/IOUtils.cpp:2564\n4  xul.dll  mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/x...  xpcom/threads/nsThreadUtils.h:549\n5  xul.dll  mozilla::TaskQueue::Runner::Run()  xpcom/threads/TaskQueue.cpp:263\n6  xul.dll  nsThreadPool::Run()  xpcom/threads/nsThreadPool.cpp:449\n7  xul.dll  nsThread::ProcessNextEvent(bool, bool*)  xpcom/threads/nsThread.cpp:1158\n```\n\nIt looks like this assertion was added in bug 1980886. Bug 1993904 fixed a different assertion with this crash signature.",
      "matched_patterns": [
        "mozilla::\\S+::\\S+\\s*\\(",
        "ns[A-Z]\\w+::\\w+",
        "(?i)(crash|stack)\\s*(trace|dump|report)"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "xul.dll",
          "function": "nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...",
          "file": "xpcom/io/nsLocalFileWin.cpp",
          "line": 1953,
          "raw": "0  xul.dll  nsLocalFile::MoveOrCopyAsSingleFileOrDir(nsIFile*, nsTSubstring<char16_t> con...  xpcom/io/nsLocalFileWin.cpp:1953"
        },
        {
          "frame_index": 1,
          "module": "xul.dll",
          "function": "nsLocalFile::CopyMove(nsIFile*, nsTSubstring<char16_t> const&, unsigned int)",
          "file": "xpcom/io/nsLocalFileWin.cpp",
          "line": 2074,
          "raw": "1  xul.dll  nsLocalFile::CopyMove(nsIFile*, nsTSubstring<char16_t> const&, unsigned int)  xpcom/io/nsLocalFileWin.cpp:2074"
        },
        {
          "frame_index": 2,
          "module": "xul.dll",
          "function": "mozilla::IOUtils::CopyOrMoveSync<nsresult (nsIFile::*)(nsIFile*, const nsTSub...",
          "file": "xpcom/ioutils/IOUtils.cpp",
          "line": 1738,
          "raw": "2  xul.dll  mozilla::IOUtils::CopyOrMoveSync<nsresult (nsIFile::*)(nsIFile*, const nsTSub...  xpcom/ioutils/IOUtils.cpp:1738"
        },
        {
          "frame_index": 3,
          "module": "xul.dll",
          "function": "mozilla::IOUtils::MoveSync(nsIFile*, nsIFile*, bool)",
          "file": "xpcom/ioutils/IOUtils.cpp",
          "line": 1608,
          "raw": "3  xul.dll  mozilla::IOUtils::MoveSync(nsIFile*, nsIFile*, bool)  xpcom/ioutils/IOUtils.cpp:1608"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "mozilla::IOUtils::Move::<lambda_8>::operator()<mozilla::DataMutexBase<mozilla...",
          "file": "xpcom/ioutils/IOUtils.cpp",
          "line": 684,
          "raw": "4  xul.dll  mozilla::IOUtils::Move::<lambda_8>::operator()<mozilla::DataMutexBase<mozilla...  xpcom/ioutils/IOUtils.cpp:684"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "mozilla::IOUtils::EventQueue::Dispatch<mozilla::Ok, `lambda at /builds/worker...",
          "file": "xpcom/ioutils/IOUtils.cpp",
          "line": 2564,
          "raw": "4  xul.dll  mozilla::IOUtils::EventQueue::Dispatch<mozilla::Ok, `lambda at /builds/worker...  xpcom/ioutils/IOUtils.cpp:2564"
        },
        {
          "frame_index": 4,
          "module": "xul.dll",
          "function": "mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/x...",
          "file": "xpcom/threads/nsThreadUtils.h",
          "line": 549,
          "raw": "4  xul.dll  mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/x...  xpcom/threads/nsThreadUtils.h:549"
        },
        {
          "frame_index": 5,
          "module": "xul.dll",
          "function": "mozilla::TaskQueue::Runner::Run()",
          "file": "xpcom/threads/TaskQueue.cpp",
          "line": 263,
          "raw": "5  xul.dll  mozilla::TaskQueue::Runner::Run()  xpcom/threads/TaskQueue.cpp:263"
        },
        {
          "frame_index": 6,
          "module": "xul.dll",
          "function": "nsThreadPool::Run()",
          "file": "xpcom/threads/nsThreadPool.cpp",
          "line": 449,
          "raw": "6  xul.dll  nsThreadPool::Run()  xpcom/threads/nsThreadPool.cpp:449"
        },
        {
          "frame_index": 7,
          "module": "xul.dll",
          "function": "nsThread::ProcessNextEvent(bool, bool*)",
          "file": "xpcom/threads/nsThread.cpp",
          "line": 1158,
          "raw": "7  xul.dll  nsThread::ProcessNextEvent(bool, bool*)  xpcom/threads/nsThread.cpp:1158"
        }
      ],
      "frame_count": 10
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 10
}