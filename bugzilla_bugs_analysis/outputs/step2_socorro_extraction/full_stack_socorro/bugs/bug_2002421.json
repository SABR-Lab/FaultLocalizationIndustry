{
  "bug_id": "2002421",
  "summary": "[SkPDF] Crash in [@ DWriteFontTypeface::onGetAdvancedMetrics]",
  "product": "Core",
  "component": "Printing: Output",
  "creation_time": "2025-11-25T23:15:04Z",
  "crash_signatures": [
    "DWriteFontTypeface::onGetAdvancedMetrics"
  ],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=2002421",
  "socorro_crash_ids": [
    "a5178dd9-7e6e-4c1f-917e-091cc0251125"
  ],
  "stack_source": "socorro",
  "crash_id": "a5178dd9-7e6e-4c1f-917e-091cc0251125",
  "socorro_metadata": {
    "signature": "",
    "crash_reason": "",
    "moz_crash_reason": "",
    "crashing_thread": {
      "index": 0,
      "name": "MainThread"
    }
  },
  "stack_trace": {
    "source": "socorro",
    "crash_id": "a5178dd9-7e6e-4c1f-917e-091cc0251125",
    "frames": [
      {
        "frame_index": 0,
        "module": "xul.dll",
        "function": "DWriteFontTypeface::onGetAdvancedMetrics() const",
        "source": "gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp:767",
        "file": "gfx/skia/skia/src/ports/SkTypeface_win_dw.cpp",
        "line": 767,
        "trust": "context"
      },
      {
        "frame_index": 1,
        "module": "xul.dll",
        "function": "SkTypeface::getAdvancedMetrics() const",
        "source": "gfx/skia/skia/src/core/SkTypeface.cpp:510",
        "file": "gfx/skia/skia/src/core/SkTypeface.cpp",
        "line": 510,
        "trust": "cfi"
      },
      {
        "frame_index": 2,
        "module": "xul.dll",
        "function": "SkPDFFont::GetMetrics(SkTypeface const&, SkPDFDocument*)",
        "source": "gfx/skia/skia/src/pdf/SkPDFFont.cpp:266",
        "file": "gfx/skia/skia/src/pdf/SkPDFFont.cpp",
        "line": 266,
        "trust": "cfi"
      },
      {
        "frame_index": 3,
        "module": "xul.dll",
        "function": "SkPDFDevice::internalDrawGlyphRun(sktext::GlyphRun const&, SkPoint, SkPaint const&)",
        "source": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp:950",
        "file": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp",
        "line": 950,
        "trust": "cfi"
      },
      {
        "frame_index": 4,
        "module": "xul.dll",
        "function": "SkPDFDevice::onDrawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint const&)",
        "source": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp:1107",
        "file": "gfx/skia/skia/src/pdf/SkPDFDevice.cpp",
        "line": 1107,
        "trust": "cfi"
      },
      {
        "frame_index": 5,
        "module": "xul.dll",
        "function": "SkDevice::drawGlyphRunList(SkCanvas*, sktext::GlyphRunList const&, SkPaint const&)",
        "source": "gfx/skia/skia/src/core/SkDevice.cpp:432",
        "file": "gfx/skia/skia/src/core/SkDevice.cpp",
        "line": 432,
        "trust": "inlined"
      },
      {
        "frame_index": 5,
        "module": "xul.dll",
        "function": "SkCanvas::onDrawGlyphRunList(sktext::GlyphRunList const&, SkPaint const&)",
        "source": "gfx/skia/skia/src/core/SkCanvas.cpp:2432",
        "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
        "line": 2432,
        "trust": "cfi"
      },
      {
        "frame_index": 6,
        "module": "xul.dll",
        "function": "SkCanvas::onDrawTextBlob(SkTextBlob const*, float, float, SkPaint const&)",
        "source": "gfx/skia/skia/src/core/SkCanvas.cpp:2417",
        "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
        "line": 2417,
        "trust": "cfi"
      },
      {
        "frame_index": 7,
        "module": "xul.dll",
        "function": "SkCanvas::drawTextBlob(SkTextBlob const*, float, float, SkPaint const&)",
        "source": "gfx/skia/skia/src/core/SkCanvas.cpp:2567",
        "file": "gfx/skia/skia/src/core/SkCanvas.cpp",
        "line": 2567,
        "trust": "cfi"
      },
      {
        "frame_index": 8,
        "module": "xul.dll",
        "function": "SkCanvas::drawTextBlob(sk_sp<SkTextBlob> const&, float, float, SkPaint const&)",
        "source": "gfx/skia/skia/include/core/SkCanvas.h:2029",
        "file": "gfx/skia/skia/include/core/SkCanvas.h",
        "line": 2029,
        "trust": "inlined"
      },
      {
        "frame_index": 8,
        "module": "xul.dll",
        "function": "mozilla::gfx::DrawTargetSkia::DrawGlyphs(mozilla::gfx::ScaledFont*, mozilla::gfx::GlyphBuffer const&, mozilla::gfx::Pattern const&, mozilla::gfx::StrokeOptions const*, mozilla::gfx::DrawOptions const&, SkShader*)",
        "source": "gfx/2d/DrawTargetSkia.cpp:1318",
        "file": "gfx/2d/DrawTargetSkia.cpp",
        "line": 1318,
        "trust": "cfi"
      },
      {
        "frame_index": 9,
        "module": "xul.dll",
        "function": "mozilla::gfx::DrawTargetSkia::FillGlyphs(mozilla::gfx::ScaledFont*, mozilla::gfx::GlyphBuffer const&, mozilla::gfx::Pattern const&, mozilla::gfx::DrawOptions const&)",
        "source": "gfx/2d/DrawTargetSkia.cpp:1449",
        "file": "gfx/2d/DrawTargetSkia.cpp",
        "line": 1449,
        "trust": "cfi"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "mozilla::gfx::RecordedFillGlyphs::DrawGlyphs(mozilla::gfx::DrawTarget*, mozilla::gfx::ScaledFont*, mozilla::gfx::GlyphBuffer const&, mozilla::gfx::Pattern const&) const",
        "source": "gfx/2d/RecordedEventImpl.h:471",
        "file": "gfx/2d/RecordedEventImpl.h",
        "line": 471,
        "trust": "cfi"
      },
      {
        "frame_index": 11,
        "module": "xul.dll",
        "function": "mozilla::gfx::RecordedDrawGlyphs<mozilla::gfx::RecordedFillGlyphs>::PlayEvent(mozilla::gfx::Translator*) const",
        "source": "gfx/2d/RecordedEventImpl.h:2783",
        "file": "gfx/2d/RecordedEventImpl.h",
        "line": 2783,
        "trust": "cfi"
      },
      {
        "frame_index": 12,
        "module": "xul.dll",
        "function": "std::_Func_class<bool, mozilla::gfx::RecordedEvent*>::operator()(mozilla::gfx::RecordedEvent*) const",
        "source": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/functional:951",
        "file": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/functional",
        "line": 951,
        "trust": "inlined"
      },
      {
        "frame_index": 12,
        "module": "xul.dll",
        "function": "mozilla::gfx::RecordedEvent::DoWithEvent<mozilla::gfx::EventStream>(mozilla::gfx::EventStream&, mozilla::gfx::RecordedEvent::EventType, std::function<bool (mozilla::gfx::RecordedEvent*)> const&)",
        "source": "gfx/2d/RecordedEventImpl.h:4723",
        "file": "gfx/2d/RecordedEventImpl.h",
        "line": 4723,
        "trust": "cfi"
      },
      {
        "frame_index": 13,
        "module": "xul.dll",
        "function": "mozilla::gfx::RecordedEvent::DoWithEventFromStream(mozilla::gfx::EventStream&, mozilla::gfx::RecordedEvent::EventType, std::function<bool (mozilla::gfx::RecordedEvent*)> const&)",
        "source": "gfx/2d/RecordedEvent.cpp:25",
        "file": "gfx/2d/RecordedEvent.cpp",
        "line": 25,
        "trust": "inlined"
      },
      {
        "frame_index": 13,
        "module": "xul.dll",
        "function": "mozilla::layout::PrintTranslator::TranslateRecording(mozilla::layout::PRFileDescStream&)",
        "source": "layout/printing/PrintTranslator.cpp:54",
        "file": "layout/printing/PrintTranslator.cpp",
        "line": 54,
        "trust": "cfi"
      },
      {
        "frame_index": 14,
        "module": "xul.dll",
        "function": "mozilla::layout::RemotePrintJobParent::PrintPage(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layout::PRFileDescStream&, nsRefCountedHashtable<nsIntegralHashKey<unsigned long long, 0>, RefPtr<mozilla::gfx::RecordedDependentSurface> >*)",
        "source": "layout/printing/ipc/RemotePrintJobParent.cpp:177",
        "file": "layout/printing/ipc/RemotePrintJobParent.cpp",
        "line": 177,
        "trust": "cfi"
      },
      {
        "frame_index": 15,
        "module": "xul.dll",
        "function": "mozilla::layout::RemotePrintJobParent::FinishProcessingPage(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, nsRefCountedHashtable<nsIntegralHashKey<unsigned long long, 0>, RefPtr<mozilla::gfx::RecordedDependentSurface> >*)",
        "source": "layout/printing/ipc/RemotePrintJobParent.cpp:156",
        "file": "layout/printing/ipc/RemotePrintJobParent.cpp",
        "line": 156,
        "trust": "inlined"
      },
      {
        "frame_index": 15,
        "module": "xul.dll",
        "function": "mozilla::layout::RemotePrintJobParent::RecvProcessPage(int const&, int const&, nsTArray<unsigned long long>&&)",
        "source": "layout/printing/ipc/RemotePrintJobParent.cpp:130",
        "file": "layout/printing/ipc/RemotePrintJobParent.cpp",
        "line": 130,
        "trust": "cfi"
      },
      {
        "frame_index": 16,
        "module": "xul.dll",
        "function": "mozilla::layout::PRemotePrintJobParent::OnMessageReceived(IPC::Message const&)",
        "source": "ipc/ipdl/PRemotePrintJobParent.cpp:379",
        "file": "ipc/ipdl/PRemotePrintJobParent.cpp",
        "line": 379,
        "trust": "cfi"
      },
      {
        "frame_index": 17,
        "module": "xul.dll",
        "function": "mozilla::dom::PContentParent::OnMessageReceived(IPC::Message const&)",
        "source": "ipc/ipdl/PContentParent.cpp:6702",
        "file": "ipc/ipdl/PContentParent.cpp",
        "line": 6702,
        "trust": "cfi"
      },
      {
        "frame_index": 18,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&)",
        "source": "ipc/glue/MessageChannel.cpp:1793",
        "file": "ipc/glue/MessageChannel.cpp",
        "line": 1793,
        "trust": "inlined"
      },
      {
        "frame_index": 18,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessageChannel::DispatchMessage(mozilla::ipc::ActorLifecycleProxy*, std::unique_ptr<IPC::Message, std::default_delete<IPC::Message> >)",
        "source": "ipc/glue/MessageChannel.cpp:1719",
        "file": "ipc/glue/MessageChannel.cpp",
        "line": 1719,
        "trust": "inlined"
      },
      {
        "frame_index": 18,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::ActorLifecycleProxy*, mozilla::ipc::MessageChannel::MessageTask&)",
        "source": "ipc/glue/MessageChannel.cpp:1508",
        "file": "ipc/glue/MessageChannel.cpp",
        "line": 1508,
        "trust": "inlined"
      },
      {
        "frame_index": 18,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessageChannel::MessageTask::Run()",
        "source": "ipc/glue/MessageChannel.cpp:1610",
        "file": "ipc/glue/MessageChannel.cpp",
        "line": 1610,
        "trust": "cfi"
      },
      {
        "frame_index": 19,
        "module": "xul.dll",
        "function": "mozilla::RunnableTask::Run()",
        "source": "xpcom/threads/TaskController.cpp:705",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 705,
        "trust": "inlined"
      },
      {
        "frame_index": 19,
        "module": "xul.dll",
        "function": "mozilla::TaskController::RunTask(mozilla::Task*)",
        "source": "xpcom/threads/TaskController.cpp:196",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 196,
        "trust": "inlined"
      },
      {
        "frame_index": 19,
        "module": "xul.dll",
        "function": "mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&)",
        "source": "xpcom/threads/TaskController.cpp:1325",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 1325,
        "trust": "cfi"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&)",
        "source": "xpcom/threads/TaskController.cpp:1148",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 1148,
        "trust": "inlined"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "mozilla::TaskController::ProcessPendingMTTask(bool)",
        "source": "xpcom/threads/TaskController.cpp:641",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 641,
        "trust": "inlined"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "mozilla::TaskController::TaskController::<lambda_6>::operator()() const",
        "source": "xpcom/threads/TaskController.cpp:333",
        "file": "xpcom/threads/TaskController.cpp",
        "line": 333,
        "trust": "inlined"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:333:7'>::Run()",
        "source": "xpcom/threads/nsThreadUtils.h:549",
        "file": "xpcom/threads/nsThreadUtils.h",
        "line": 549,
        "trust": "inlined"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "nsThread::ProcessNextEvent(bool, bool*)",
        "source": "xpcom/threads/nsThread.cpp:1164",
        "file": "xpcom/threads/nsThread.cpp",
        "line": 1164,
        "trust": "inlined"
      },
      {
        "frame_index": 20,
        "module": "xul.dll",
        "function": "NS_ProcessNextEvent(nsIThread*, bool)",
        "source": "xpcom/threads/nsThreadUtils.cpp:461",
        "file": "xpcom/threads/nsThreadUtils.cpp",
        "line": 461,
        "trust": "cfi"
      },
      {
        "frame_index": 21,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*)",
        "source": "ipc/glue/MessagePump.cpp:85",
        "file": "ipc/glue/MessagePump.cpp",
        "line": 85,
        "trust": "cfi"
      },
      {
        "frame_index": 22,
        "module": "xul.dll",
        "function": "MessageLoop::RunInternal()",
        "source": "ipc/chromium/src/base/message_loop.cc:368",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 368,
        "trust": "inlined"
      },
      {
        "frame_index": 22,
        "module": "xul.dll",
        "function": "MessageLoop::RunHandler()",
        "source": "ipc/chromium/src/base/message_loop.cc:361",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 361,
        "trust": "cfi"
      },
      {
        "frame_index": 23,
        "module": "xul.dll",
        "function": "MessageLoop::Run()",
        "source": "ipc/chromium/src/base/message_loop.cc:343",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 343,
        "trust": "inlined"
      },
      {
        "frame_index": 23,
        "module": "xul.dll",
        "function": "nsBaseAppShell::Run()",
        "source": "widget/nsBaseAppShell.cpp:152",
        "file": "widget/nsBaseAppShell.cpp",
        "line": 152,
        "trust": "cfi"
      },
      {
        "frame_index": 24,
        "module": "xul.dll",
        "function": "nsAppShell::Run()",
        "source": "widget/windows/nsAppShell.cpp:673",
        "file": "widget/windows/nsAppShell.cpp",
        "line": 673,
        "trust": "cfi"
      },
      {
        "frame_index": 25,
        "module": "xul.dll",
        "function": "nsAppStartup::Run()",
        "source": "toolkit/components/startup/nsAppStartup.cpp:290",
        "file": "toolkit/components/startup/nsAppStartup.cpp",
        "line": 290,
        "trust": "cfi"
      },
      {
        "frame_index": 26,
        "module": "xul.dll",
        "function": "XREMain::XRE_mainRun()",
        "source": "toolkit/xre/nsAppRunner.cpp:5918",
        "file": "toolkit/xre/nsAppRunner.cpp",
        "line": 5918,
        "trust": "cfi"
      },
      {
        "frame_index": 27,
        "module": "xul.dll",
        "function": "XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&)",
        "source": "toolkit/xre/nsAppRunner.cpp:6173",
        "file": "toolkit/xre/nsAppRunner.cpp",
        "line": 6173,
        "trust": "cfi"
      },
      {
        "frame_index": 28,
        "module": "xul.dll",
        "function": "XRE_main(int, char**, mozilla::BootstrapConfig const&)",
        "source": "toolkit/xre/nsAppRunner.cpp:6246",
        "file": "toolkit/xre/nsAppRunner.cpp",
        "line": 6246,
        "trust": "cfi"
      },
      {
        "frame_index": 29,
        "module": "firefox.exe",
        "function": "do_main(int, char**, char**)",
        "source": "browser/app/nsBrowserApp.cpp:268",
        "file": "browser/app/nsBrowserApp.cpp",
        "line": 268,
        "trust": "inlined"
      },
      {
        "frame_index": 29,
        "module": "firefox.exe",
        "function": "NS_internal_main(int, char**, char**)",
        "source": "browser/app/nsBrowserApp.cpp:532",
        "file": "browser/app/nsBrowserApp.cpp",
        "line": 532,
        "trust": "inlined"
      },
      {
        "frame_index": 29,
        "module": "firefox.exe",
        "function": "wmain(int, wchar_t**)",
        "source": "toolkit/xre/nsWindowsWMain.cpp:150",
        "file": "toolkit/xre/nsWindowsWMain.cpp",
        "line": 150,
        "trust": "cfi"
      },
      {
        "frame_index": 30,
        "module": "firefox.exe",
        "function": "invoke_main()",
        "source": "/builds/worker/workspace/obj-build/browser/app/D:/a/_work/1/s/src/vctools/crt/vcstartup/src/startup/exe_common.inl:90",
        "file": "/builds/worker/workspace/obj-build/browser/app/D:/a/_work/1/s/src/vctools/crt/vcstartup/src/startup/exe_common.inl",
        "line": 90,
        "trust": "inlined"
      },
      {
        "frame_index": 30,
        "module": "firefox.exe",
        "function": "__scrt_common_main_seh()",
        "source": "/builds/worker/workspace/obj-build/browser/app/D:/a/_work/1/s/src/vctools/crt/vcstartup/src/startup/exe_common.inl:288",
        "file": "/builds/worker/workspace/obj-build/browser/app/D:/a/_work/1/s/src/vctools/crt/vcstartup/src/startup/exe_common.inl",
        "line": 288,
        "trust": "cfi"
      },
      {
        "frame_index": 31,
        "module": "kernel32.dll",
        "function": "BaseThreadInitThunk",
        "source": "",
        "file": "",
        "line": null,
        "trust": "cfi"
      },
      {
        "frame_index": 32,
        "module": "ntdll.dll",
        "function": "RtlUserThreadStart",
        "source": "",
        "file": "",
        "line": null,
        "trust": "cfi"
      }
    ],
    "frame_count": 53
  }
}