{
  "bug_id": "1999580",
  "summary": "Crash in [@ mozilla::gfx::DrawTarget::GetFormat]",
  "product": "Core",
  "component": "Graphics: Canvas2D",
  "creation_time": "2025-11-12T00:41:08Z",
  "crash_signatures": [
    "mozilla::gfx::DrawTarget::GetFormat"
  ],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1999580",
  "socorro_crash_ids": [
    "8bf97946-48ee-4338-bccc-95c110251111"
  ],
  "stack_source": "socorro",
  "crash_id": "8bf97946-48ee-4338-bccc-95c110251111",
  "socorro_metadata": {
    "signature": "",
    "crash_reason": "",
    "moz_crash_reason": "",
    "crashing_thread": {
      "index": 35,
      "name": "CanvasRenderer"
    }
  },
  "stack_trace": {
    "source": "socorro",
    "crash_id": "8bf97946-48ee-4338-bccc-95c110251111",
    "frames": [
      {
        "frame_index": 0,
        "module": "xul.dll",
        "function": "mozilla::gfx::DrawTarget::GetFormat() const",
        "source": "gfx/2d/2D.h:2050",
        "file": "gfx/2d/2D.h",
        "line": 2050,
        "trust": "inlined"
      },
      {
        "frame_index": 0,
        "module": "xul.dll",
        "function": "mozilla::gfx::SharedContextWebgl::ReadSnapshotIntoPBO(mozilla::gfx::SourceSurfaceWebgl*, mozilla::gfx::TextureHandle*)",
        "source": "dom/canvas/DrawTargetWebgl.cpp:1301",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 1301,
        "trust": "context"
      },
      {
        "frame_index": 1,
        "module": "xul.dll",
        "function": "mozilla::gfx::SourceSurfaceWebgl::OnUnlinkTexture(mozilla::gfx::SharedContextWebgl*, bool)",
        "source": "dom/canvas/SourceSurfaceWebgl.cpp:203",
        "file": "dom/canvas/SourceSurfaceWebgl.cpp",
        "line": 203,
        "trust": "cfi"
      },
      {
        "frame_index": 2,
        "module": "xul.dll",
        "function": "mozilla::gfx::SharedContextWebgl::UnlinkSurfaceTexture(RefPtr<mozilla::gfx::TextureHandle> const&, bool)",
        "source": "dom/canvas/DrawTargetWebgl.cpp:278",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 278,
        "trust": "inlined"
      },
      {
        "frame_index": 2,
        "module": "xul.dll",
        "function": "mozilla::gfx::SharedContextWebgl::PruneTextureHandle(RefPtr<mozilla::gfx::TextureHandle> const&)",
        "source": "dom/canvas/DrawTargetWebgl.cpp:4239",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 4239,
        "trust": "cfi"
      },
      {
        "frame_index": 3,
        "module": "xul.dll",
        "function": "mozilla::gfx::SharedContextWebgl::ClearAllTextures()",
        "source": "dom/canvas/DrawTargetWebgl.cpp:315",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 315,
        "trust": "cfi"
      },
      {
        "frame_index": 4,
        "module": "xul.dll",
        "function": "mozilla::gfx::SharedContextWebgl::ClearCachesIfNecessary()",
        "source": "dom/canvas/DrawTargetWebgl.cpp:410",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 410,
        "trust": "cfi"
      },
      {
        "frame_index": 5,
        "module": "xul.dll",
        "function": "mozilla::gfx::DrawTargetWebgl::BeginFrame(bool)",
        "source": "dom/canvas/DrawTargetWebgl.cpp:6508",
        "file": "dom/canvas/DrawTargetWebgl.cpp",
        "line": 6508,
        "trust": "cfi"
      },
      {
        "frame_index": 6,
        "module": "xul.dll",
        "function": "mozilla::layers::CanvasTranslator::CreateDrawTarget(mozilla::gfx::ReferencePtr, mozilla::layers::RemoteTextureOwnerId, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::SurfaceFormat)",
        "source": "gfx/layers/ipc/CanvasTranslator.cpp:1139",
        "file": "gfx/layers/ipc/CanvasTranslator.cpp",
        "line": 1139,
        "trust": "cfi"
      },
      {
        "frame_index": 7,
        "module": "xul.dll",
        "function": "mozilla::layers::RecordedCanvasDrawTargetCreation::PlayCanvasEvent(mozilla::layers::CanvasTranslator*) const",
        "source": "gfx/layers/RecordedCanvasEventImpl.h:484",
        "file": "gfx/layers/RecordedCanvasEventImpl.h",
        "line": 484,
        "trust": "inlined"
      },
      {
        "frame_index": 7,
        "module": "xul.dll",
        "function": "mozilla::layers::CanvasTranslator::HandleExtensionEvent(int)",
        "source": "gfx/layers/ipc/CanvasTranslator.cpp:864",
        "file": "gfx/layers/ipc/CanvasTranslator.cpp",
        "line": 864,
        "trust": "cfi"
      },
      {
        "frame_index": 8,
        "module": "xul.dll",
        "function": "mozilla::layers::CanvasTranslator::TranslateRecording()",
        "source": "gfx/layers/ipc/CanvasTranslator.cpp:695",
        "file": "gfx/layers/ipc/CanvasTranslator.cpp",
        "line": 695,
        "trust": "cfi"
      },
      {
        "frame_index": 9,
        "module": "xul.dll",
        "function": "mozilla::layers::CanvasTranslator::HandleCanvasTranslatorEvents()",
        "source": "gfx/layers/ipc/CanvasTranslator.cpp:781",
        "file": "gfx/layers/ipc/CanvasTranslator.cpp",
        "line": 781,
        "trust": "cfi"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "mozilla::detail::RunnableMethodArguments<>::apply<nsMemoryReporterManager, nsresult (nsMemoryReporterManager::*)()>::<lambda_1>::operator()() const",
        "source": "xpcom/threads/nsThreadUtils.h:1083",
        "file": "xpcom/threads/nsThreadUtils.h",
        "line": 1083,
        "trust": "inlined"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "std::invoke(mozilla::detail::RunnableMethodArguments<>::apply<nsMemoryReporterManager, nsresult (nsMemoryReporterManager::*)()>::<lambda_1>&&)",
        "source": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/type_traits:1729",
        "file": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/type_traits",
        "line": 1729,
        "trust": "inlined"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "std::_Apply_impl(mozilla::detail::RunnableMethodArguments<>::apply<nsMemoryReporterManager, nsresult (nsMemoryReporterManager::*)()>::<lambda_1>&&, std::tuple<>&, std::integer_sequence<unsigned long long>)",
        "source": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/tuple:1077",
        "file": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/tuple",
        "line": 1077,
        "trust": "inlined"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "std::apply(mozilla::detail::RunnableMethodArguments<>::apply<nsMemoryReporterManager, nsresult (nsMemoryReporterManager::*)()>::<lambda_1>&&, std::tuple<>&)",
        "source": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/tuple:1088",
        "file": "/builds/worker/fetches/vs/VC/Tools/MSVC/14.39.33519/include/tuple",
        "line": 1088,
        "trust": "inlined"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "mozilla::detail::RunnableMethodArguments<>::apply(nsMemoryReporterManager*, nsresult (nsMemoryReporterManager::*)())",
        "source": "xpcom/threads/nsThreadUtils.h:1081",
        "file": "xpcom/threads/nsThreadUtils.h",
        "line": 1081,
        "trust": "inlined"
      },
      {
        "frame_index": 10,
        "module": "xul.dll",
        "function": "mozilla::detail::RunnableMethodImpl<nsMemoryReporterManager*, nsresult (nsMemoryReporterManager::*)(), 1, 0>::Run()",
        "source": "xpcom/threads/nsThreadUtils.h:1132",
        "file": "xpcom/threads/nsThreadUtils.h",
        "line": 1132,
        "trust": "cfi"
      },
      {
        "frame_index": 11,
        "module": "xul.dll",
        "function": "nsThread::ProcessNextEvent(bool, bool*)",
        "source": "xpcom/threads/nsThread.cpp:1160",
        "file": "xpcom/threads/nsThread.cpp",
        "line": 1160,
        "trust": "inlined"
      },
      {
        "frame_index": 11,
        "module": "xul.dll",
        "function": "NS_ProcessNextEvent(nsIThread*, bool)",
        "source": "xpcom/threads/nsThreadUtils.cpp:461",
        "file": "xpcom/threads/nsThreadUtils.cpp",
        "line": 461,
        "trust": "cfi"
      },
      {
        "frame_index": 12,
        "module": "xul.dll",
        "function": "mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*)",
        "source": "ipc/glue/MessagePump.cpp:299",
        "file": "ipc/glue/MessagePump.cpp",
        "line": 299,
        "trust": "cfi"
      },
      {
        "frame_index": 13,
        "module": "xul.dll",
        "function": "MessageLoop::RunInternal()",
        "source": "ipc/chromium/src/base/message_loop.cc:368",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 368,
        "trust": "inlined"
      },
      {
        "frame_index": 13,
        "module": "xul.dll",
        "function": "MessageLoop::RunHandler()",
        "source": "ipc/chromium/src/base/message_loop.cc:361",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 361,
        "trust": "cfi"
      },
      {
        "frame_index": 14,
        "module": "xul.dll",
        "function": "MessageLoop::Run()",
        "source": "ipc/chromium/src/base/message_loop.cc:343",
        "file": "ipc/chromium/src/base/message_loop.cc",
        "line": 343,
        "trust": "inlined"
      },
      {
        "frame_index": 14,
        "module": "xul.dll",
        "function": "nsThread::ThreadFunc(void*)",
        "source": "xpcom/threads/nsThread.cpp:375",
        "file": "xpcom/threads/nsThread.cpp",
        "line": 375,
        "trust": "cfi"
      },
      {
        "frame_index": 15,
        "module": "nss3.dll",
        "function": "_PR_NativeRunThread(void*)",
        "source": "nsprpub/pr/src/threads/combined/pruthr.c:382",
        "file": "nsprpub/pr/src/threads/combined/pruthr.c",
        "line": 382,
        "trust": "cfi"
      },
      {
        "frame_index": 16,
        "module": "nss3.dll",
        "function": "pr_root(void*)",
        "source": "nsprpub/pr/src/md/windows/w95thred.c:129",
        "file": "nsprpub/pr/src/md/windows/w95thred.c",
        "line": 129,
        "trust": "cfi"
      },
      {
        "frame_index": 17,
        "module": "ucrtbase.dll",
        "function": "thread_start<unsigned int (__cdecl*)(void*), 1>",
        "source": "",
        "file": "",
        "line": null,
        "trust": "cfi"
      },
      {
        "frame_index": 18,
        "module": "kernel32.dll",
        "function": "BaseThreadInitThunk",
        "source": "",
        "file": "",
        "line": null,
        "trust": "cfi"
      },
      {
        "frame_index": 19,
        "module": "mozglue.dll",
        "function": "mozilla::interceptor::FuncHook<mozilla::interceptor::WindowsDllInterceptor<mozilla::interceptor::VMSharingPolicyShared>, void (*)(int, void*, void*)>::operator()(int&, void*&, void*&) const",
        "source": "toolkit/xre/dllservices/mozglue/nsWindowsDllInterceptor.h:144",
        "file": "toolkit/xre/dllservices/mozglue/nsWindowsDllInterceptor.h",
        "line": 144,
        "trust": "inlined"
      },
      {
        "frame_index": 19,
        "module": "mozglue.dll",
        "function": "patched_BaseThreadInitThunk(int, void*, void*)",
        "source": "toolkit/xre/dllservices/mozglue/WindowsDllBlocklist.cpp:566",
        "file": "toolkit/xre/dllservices/mozglue/WindowsDllBlocklist.cpp",
        "line": 566,
        "trust": "cfi"
      },
      {
        "frame_index": 20,
        "module": "ntdll.dll",
        "function": "RtlUserThreadStart",
        "source": "",
        "file": "",
        "line": null,
        "trust": "cfi"
      }
    ],
    "frame_count": 33
  },
  "regressed_by": [
    "1999048"
  ],
  "regressor_count": 1,
  "source": "step2",
  "bugzilla_status": "RESOLVED",
  "bugzilla_resolution": "FIXED",
  "bugzilla_lookup_timestamp": "2025-12-15T15:53:28.606175"
}