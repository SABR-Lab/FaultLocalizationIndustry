{
  "bug_id": "1972221",
  "summary": "Startup crash [@ mozilla::dom::quota::QuotaManager::GetOriginStateMetadata ]",
  "status": "RESOLVED",
  "resolution": "FIXED",
  "product": "Core",
  "component": "Storage: Quota Manager",
  "version": "Firefox 141",
  "severity": "S2",
  "priority": "P1",
  "creation_time": "2025-06-15T12:28:09Z",
  "last_change_time": "2025-09-09T09:24:13Z",
  "is_recent": false,
  "crash_signature_raw": "[@ mozilla::dom::quota::QuotaManager::GetOriginStateMetadata ]",
  "crash_signatures": [
    "mozilla::dom::quota::QuotaManager::GetOriginStateMetadata"
  ],
  "keywords": [
    "regression",
    "topcrash"
  ],
  "regressed_by": [
    "1962133"
  ],
  "regressions": [],
  "bugzilla_url": "https://bugzilla.mozilla.org/show_bug.cgi?id=1972221",
  "socorro_links": [],
  "socorro_crash_ids": [],
  "has_socorro_link": false,
  "has_direct_crash_id": false,
  "stack_traces": [
    {
      "comment_id": 17537940,
      "comment_count": 0,
      "creator": "viktor_jaegerskuepper@freenet.de",
      "creation_time": "2025-06-15T12:28:09Z",
      "raw_text": "Crash ID: daf6aadb-d6b1-4496-9969-2cd670250615\n\nAfter the latest Nightly version (2025-06-15-09-03-40) was downloaded, I closed Firefox and started it again, but it crashed immediately. For some reason it is not recognized as a startup crash (Startup Crash: False)\n\nMOZ_CRASH Reason (Sanitized): MOZ_DIAGNOSTIC_ASSERT(mTemporaryStorageInitializedInternal)\nCrash Reason: SIGSEGV / SEGV_MAPERR\n\nFrames from crashing thread:\n\n0 \tlibxul.so \tMOZ_CrashSequence(void*, long) \tmfbt/Assertions.h:248 \tinlined\n0 \tlibxul.so \tmozilla::dom::quota::QuotaManager::GetOriginStateMetadata(mozilla::dom::quota::OriginMetadata const&) \tdom/quota/ActorsParent.cpp:7249 \tcontext\n1 \tlibxul.so \tmozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&)::$_1::operator()() const \tdom/quota/OriginOperations.cpp:3576 \tinlined\n1 \tlibxul.so \tmozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&) \tdom/quota/OriginOperations.cpp:3576 \tcfi\n2 \tlibxul.so \tmozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::operator()(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const \tdom/quota/OriginOperationBase.cpp:98 \tinlined\n2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::InvokeMethod<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:652 \tinlined\n2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::InvokeCallbackMethod<true, mozilla::MozPromise<bool, nsresult, false>, mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:664 \tinlined\n2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::ThenValue<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:923 \tcfi\n3 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::ThenValueBase::DoResolveOrReject(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:621 \tinlined\n3 \tlibxul.so \tmozilla::MozPromise<bool, mozilla::ipc::ResponseRejectReason, true>::ThenValueBase::ResolveOrRejectRunnable::Run() \txpcom/threads/MozPromise.h:488 \tcfi\n4 \tlibxul.so \tnsThread::ProcessNextEvent(bool, bool*) \txpcom/threads/nsThread.cpp:1153 \tinlined\n4 \tlibxul.so \tNS_ProcessNextEvent(nsIThread*, bool) \txpcom/threads/nsThreadUtils.cpp:480 \tcfi\n5 \tlibxul.so \tmozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) \tipc/glue/MessagePump.cpp:329 \tcfi\n6 \tlibxul.so \tMessageLoop::RunInternal() \tipc/chromium/src/base/message_loop.cc:369 \tinlined\n6 \tlibxul.so \tMessageLoop::RunHandler() \tipc/chromium/src/base/message_loop.cc:362 \tinlined\n6 \tlibxul.so \tMessageLoop::Run() \tipc/chromium/src/base/message_loop.cc:344 \tinlined\n6 \tlibxul.so \tnsThread::ThreadFunc(void*) \txpcom/threads/nsThread.cpp:366 \tcfi\n7 \tlibnspr4.so \t_pt_root \tnsprpub/pr/src/pthreads/ptthread.c:191 \tcfi\n8 \tfirefox-bin \tset_alt_signal_stack_and_start(PthreadCreateParams*) \tmozglue/interposers/pthread_create_interposer.cpp:81 \tcfi\n9 \tlibc.so.6 \tstart_thread \t/usr/src/debug/glibc/glibc/nptl/pthread_create.c:448 \tcfi\n10 \tlibc.so.6 \t__GI___clone3 \t/usr/src/debug/glibc/glibc/sysdeps/unix/sysv/linux/x86_64/clone3.S:78 \tcfi",
      "matched_patterns": [
        "mozilla::\\S+::\\S+\\s*\\(",
        "ns[A-Z]\\w+::\\w+",
        "(?i)crashing\\s+thread"
      ],
      "parsed_frames": [
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "MOZ_CrashSequence(void*, long) \tmfbt/Assertions.h:248",
          "file": "",
          "line": null,
          "raw": "0 \tlibxul.so \tMOZ_CrashSequence(void*, long) \tmfbt/Assertions.h:248 \tinlined"
        },
        {
          "frame_index": 0,
          "module": "libxul.so",
          "function": "mozilla::dom::quota::QuotaManager::GetOriginStateMetadata(mozilla::dom::quota::OriginMetadata const&) \tdom/quota/ActorsParent.cpp:7249",
          "file": "",
          "line": null,
          "raw": "0 \tlibxul.so \tmozilla::dom::quota::QuotaManager::GetOriginStateMetadata(mozilla::dom::quota::OriginMetadata const&) \tdom/quota/ActorsParent.cpp:7249 \tcontext"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "mozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&)::$_1::operator()() const \tdom/quota/OriginOperations.cpp:3576",
          "file": "",
          "line": null,
          "raw": "1 \tlibxul.so \tmozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&)::$_1::operator()() const \tdom/quota/OriginOperations.cpp:3576 \tinlined"
        },
        {
          "frame_index": 1,
          "module": "libxul.so",
          "function": "mozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&) \tdom/quota/OriginOperations.cpp:3576",
          "file": "",
          "line": null,
          "raw": "1 \tlibxul.so \tmozilla::dom::quota::PersistOp::DoDirectoryWork(mozilla::dom::quota::QuotaManager&) \tdom/quota/OriginOperations.cpp:3576 \tcfi"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::operator()(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const \tdom/quota/OriginOperationBase.cpp:98",
          "file": "",
          "line": null,
          "raw": "2 \tlibxul.so \tmozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::operator()(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const \tdom/quota/OriginOperationBase.cpp:98 \tinlined"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::MozPromise<bool, nsresult, false>::InvokeMethod<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:652",
          "file": "",
          "line": null,
          "raw": "2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::InvokeMethod<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:652 \tinlined"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::MozPromise<bool, nsresult, false>::InvokeCallbackMethod<true, mozilla::MozPromise<bool, nsresult, false>, mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:664",
          "file": "",
          "line": null,
          "raw": "2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::InvokeCallbackMethod<true, mozilla::MozPromise<bool, nsresult, false>, mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&>(mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0*, RefPtr<mozilla::MozPromise<bool, nsresult, false> > (mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0::*)(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) const, mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue const&) \txpcom/threads/MozPromise.h:664 \tinlined"
        },
        {
          "frame_index": 2,
          "module": "libxul.so",
          "function": "mozilla::MozPromise<bool, nsresult, false>::ThenValue<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:923",
          "file": "",
          "line": null,
          "raw": "2 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::ThenValue<mozilla::dom::quota::OriginOperationBase::RunImmediately()::$_0>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:923 \tcfi"
        },
        {
          "frame_index": 3,
          "module": "libxul.so",
          "function": "mozilla::MozPromise<bool, nsresult, false>::ThenValueBase::DoResolveOrReject(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:621",
          "file": "",
          "line": null,
          "raw": "3 \tlibxul.so \tmozilla::MozPromise<bool, nsresult, false>::ThenValueBase::DoResolveOrReject(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) \txpcom/threads/MozPromise.h:621 \tinlined"
        },
        {
          "frame_index": 3,
          "module": "libxul.so",
          "function": "mozilla::MozPromise<bool, mozilla::ipc::ResponseRejectReason, true>::ThenValueBase::ResolveOrRejectRunnable::Run() \txpcom/threads/MozPromise.h:488",
          "file": "",
          "line": null,
          "raw": "3 \tlibxul.so \tmozilla::MozPromise<bool, mozilla::ipc::ResponseRejectReason, true>::ThenValueBase::ResolveOrRejectRunnable::Run() \txpcom/threads/MozPromise.h:488 \tcfi"
        },
        {
          "frame_index": 4,
          "module": "libxul.so",
          "function": "nsThread::ProcessNextEvent(bool, bool*) \txpcom/threads/nsThread.cpp:1153",
          "file": "",
          "line": null,
          "raw": "4 \tlibxul.so \tnsThread::ProcessNextEvent(bool, bool*) \txpcom/threads/nsThread.cpp:1153 \tinlined"
        },
        {
          "frame_index": 4,
          "module": "libxul.so",
          "function": "NS_ProcessNextEvent(nsIThread*, bool) \txpcom/threads/nsThreadUtils.cpp:480",
          "file": "",
          "line": null,
          "raw": "4 \tlibxul.so \tNS_ProcessNextEvent(nsIThread*, bool) \txpcom/threads/nsThreadUtils.cpp:480 \tcfi"
        },
        {
          "frame_index": 5,
          "module": "libxul.so",
          "function": "mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) \tipc/glue/MessagePump.cpp:329",
          "file": "",
          "line": null,
          "raw": "5 \tlibxul.so \tmozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) \tipc/glue/MessagePump.cpp:329 \tcfi"
        },
        {
          "frame_index": 6,
          "module": "libxul.so",
          "function": "MessageLoop::RunInternal() \tipc/chromium/src/base/message_loop.cc:369",
          "file": "",
          "line": null,
          "raw": "6 \tlibxul.so \tMessageLoop::RunInternal() \tipc/chromium/src/base/message_loop.cc:369 \tinlined"
        },
        {
          "frame_index": 6,
          "module": "libxul.so",
          "function": "MessageLoop::RunHandler() \tipc/chromium/src/base/message_loop.cc:362",
          "file": "",
          "line": null,
          "raw": "6 \tlibxul.so \tMessageLoop::RunHandler() \tipc/chromium/src/base/message_loop.cc:362 \tinlined"
        },
        {
          "frame_index": 6,
          "module": "libxul.so",
          "function": "MessageLoop::Run() \tipc/chromium/src/base/message_loop.cc:344",
          "file": "",
          "line": null,
          "raw": "6 \tlibxul.so \tMessageLoop::Run() \tipc/chromium/src/base/message_loop.cc:344 \tinlined"
        },
        {
          "frame_index": 6,
          "module": "libxul.so",
          "function": "nsThread::ThreadFunc(void*) \txpcom/threads/nsThread.cpp:366",
          "file": "",
          "line": null,
          "raw": "6 \tlibxul.so \tnsThread::ThreadFunc(void*) \txpcom/threads/nsThread.cpp:366 \tcfi"
        },
        {
          "frame_index": 7,
          "module": "libnspr4.so",
          "function": "_pt_root \tnsprpub/pr/src/pthreads/ptthread.c:191",
          "file": "",
          "line": null,
          "raw": "7 \tlibnspr4.so \t_pt_root \tnsprpub/pr/src/pthreads/ptthread.c:191 \tcfi"
        }
      ],
      "frame_count": 18
    }
  ],
  "has_stack_traces": true,
  "stack_trace_count": 1,
  "total_parsed_frames": 18,
  "regressor_count": 1,
  "source": "step1",
  "bugzilla_status": "RESOLVED",
  "bugzilla_resolution": "FIXED",
  "bugzilla_lookup_timestamp": "2025-12-15T15:53:28.604679",
  "fixing_commit_count": 1,
  "category": "single_commit",
  "commit_source": "bugbug",
  "fixing_commit": {
    "commit_hash": "f466599094b7e16948794a49b0571e03eb2b4df9",
    "short_hash": "f466599094b7",
    "description": "Revert \"Bug 1962133 - QM: Add accessed flag to FullOriginMetadata and persist it in the origin metadata file; r=dom-storage-reviewers,hsingh\" as requested by dmeehan for causing top crash in Bug 1972221.\n\nThis reverts commit 433768e64dd71c996694e08005854756b7c45fb3.",
    "author": "Serban Stanca <sstanca@mozilla.com>",
    "pushdate": "2025-06-15 13:49:48",
    "files": [
      "dom/indexedDB/ActorsParent.cpp",
      "dom/quota/ActorsParent.cpp",
      "dom/quota/CommonMetadata.h",
      "dom/quota/DirectoryMetadata.cpp",
      "dom/quota/DirectoryMetadata.h",
      "dom/quota/OriginInfo.cpp",
      "dom/quota/OriginInfo.h",
      "dom/quota/OriginOperations.cpp",
      "dom/quota/QuotaManager.h",
      "dom/quota/moz.build",
      "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
      "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
      "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
      "dom/quota/test/gtest/TestQuotaManager.cpp"
    ],
    "file_count": 14,
    "components": [
      "Core::Storage: Quota Manager",
      "Core::Storage: IndexedDB"
    ]
  },
  "regressor_analysis": [
    {
      "regressor_bug_id": "1962133",
      "total_commits": 7,
      "matching_commits_count": 7,
      "matching_commits": [
        {
          "commit_hash": "d586b6b633191a7c6ff251361b0442d98d06c764",
          "short_hash": "d586b6b63319",
          "description": "Bug 1962133 - QM: Add accessed flag to FullOriginMetadata and persist it in the origin metadata file; r=dom-storage-reviewers,hsingh\n\nThis patch introduces a new mAccessed field in OriginStateMetadata, which is\ninherited by FullOriginMetadata. One of the reserved 32-bit fields in the\nmetadata header is now used as a bitfield, with one bit allocated to represent\nthe accessed flag.\n\nThe accessed flag is now reliably persisted for any origin directory that has\nbeen accessed by a quota client. It will later be used to determine whether\ncached quota info can be trusted or if a full directory scan is required.\n\nAll relevant gtests have been updated to verify that the mAccessed field is\ncorrectly stored in memory and on disk.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D247232",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-15 09:03:40",
          "files_modified": [
            "dom/indexedDB/ActorsParent.cpp",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/OriginInfo.h",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/TestQuotaManager.cpp"
          ],
          "file_overlap_count": 14,
          "overlapping_files": [
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/test/gtest/TestQuotaManager.cpp",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/OriginInfo.h",
            "dom/indexedDB/ActorsParent.cpp"
          ],
          "components": [
            "Core::Storage: Quota Manager",
            "Core::Storage: IndexedDB"
          ]
        },
        {
          "commit_hash": "f466599094b7e16948794a49b0571e03eb2b4df9",
          "short_hash": "f466599094b7",
          "description": "Revert \"Bug 1962133 - QM: Add accessed flag to FullOriginMetadata and persist it in the origin metadata file; r=dom-storage-reviewers,hsingh\" as requested by dmeehan for causing top crash in Bug 1972221.\n\nThis reverts commit 433768e64dd71c996694e08005854756b7c45fb3.",
          "author": "Serban Stanca <sstanca@mozilla.com>",
          "pushdate": "2025-06-15 13:49:48",
          "files_modified": [
            "dom/indexedDB/ActorsParent.cpp",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/OriginInfo.h",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/TestQuotaManager.cpp"
          ],
          "file_overlap_count": 14,
          "overlapping_files": [
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/test/gtest/TestQuotaManager.cpp",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/OriginInfo.h",
            "dom/indexedDB/ActorsParent.cpp"
          ],
          "components": [
            "Core::Storage: Quota Manager",
            "Core::Storage: IndexedDB"
          ]
        },
        {
          "commit_hash": "9987ebf11f141d7e31c958972aee01676d717246",
          "short_hash": "9987ebf11f14",
          "description": "Bug 1962133 - QM: Add accessed flag to FullOriginMetadata and persist it in the origin metadata file; r=dom-storage-reviewers,hsingh\n\nThis patch introduces a new mAccessed field in OriginStateMetadata, which is\ninherited by FullOriginMetadata. One of the reserved 32-bit fields in the\nmetadata header is now used as a bitfield, with one bit allocated to represent\nthe accessed flag.\n\nThe accessed flag is now reliably persisted for any origin directory that has\nbeen accessed by a quota client. It will later be used to determine whether\ncached quota info can be trusted or if a full directory scan is required.\n\nAll relevant gtests have been updated to verify that the mAccessed field is\ncorrectly stored in memory and on disk.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D247232",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-16 09:38:11",
          "files_modified": [
            "dom/indexedDB/ActorsParent.cpp",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/OriginInfo.h",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/TestQuotaManager.cpp"
          ],
          "file_overlap_count": 14,
          "overlapping_files": [
            "dom/quota/CommonMetadata.h",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/test/gtest/TestQuotaManager.cpp",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/moz.build",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/OriginInfo.h",
            "dom/indexedDB/ActorsParent.cpp"
          ],
          "components": [
            "Core::Storage: IndexedDB",
            "Core::Storage: Quota Manager"
          ]
        },
        {
          "commit_hash": "27b1f7f62a00d003b61e7d3265ec1c7587f221fa",
          "short_hash": "27b1f7f62a00",
          "description": "Bug 1962133 - QM: Introduce OriginStateMetadata struct for origin metadata header; r=dom-storage-reviewers,hsingh\n\nThis patch introduces a new OriginStateMetadata struct to represent origin\nstate separately from the other OriginMetadata fields. This prepares the origin\nmetadata loading and saving code for adding a new field like the accessed flag.\n\nThis patch also adds a new method QuotaManager::GetOriginStateMetadata which is\ninitially used in basic gtests, but it will become more important in follow-up\nbugs patches.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D247049",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-11 18:38:51",
          "files_modified": [
            "dom/quota/ActorsParent.cpp",
            "dom/quota/CommonMetadata.h",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/OriginInfo.h",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/TestQuotaManager.cpp"
          ],
          "file_overlap_count": 10,
          "overlapping_files": [
            "dom/quota/CommonMetadata.h",
            "dom/quota/test/gtest/TestQuotaManager.cpp",
            "dom/quota/OriginInfo.cpp",
            "dom/quota/QuotaManager.h",
            "dom/quota/test/gtest/QuotaManagerTestHelpers.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/test/gtest/QuotaManagerDependencyFixture.h",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/OriginInfo.h"
          ],
          "components": [
            "Core::Storage: Quota Manager"
          ]
        },
        {
          "commit_hash": "a576f5346c6cfc32a5b147158e48ec1f4fcf2a8f",
          "short_hash": "a576f5346c6c",
          "description": "Bug 1962133 - QM: Prepare metadata header infrastructure for accessed flag addition and reduce duplication; r=dom-storage-reviewers,hsingh\n\nThis patch restructures metadata header reading and writing code to reduce\nduplication and establish clean infrastructure for adding the accessed flag to\nthe metadata file header.\n\nNo functional behavior change is introduced yet. This is a preparation step to\nmake the upcoming changes simpler and safer to review.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D247055",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-12 16:31:09",
          "files_modified": [
            "dom/quota/ActorsParent.cpp",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/moz.build"
          ],
          "file_overlap_count": 5,
          "overlapping_files": [
            "dom/quota/DirectoryMetadata.h",
            "dom/quota/DirectoryMetadata.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/moz.build",
            "dom/quota/ActorsParent.cpp"
          ],
          "components": [
            "Core::Storage: Quota Manager"
          ]
        },
        {
          "commit_hash": "7422fd99c7b16e84aad554bad938366876b30713",
          "short_hash": "7422fd99c7b1",
          "description": "Bug 1962133 - QM: Rationalize QuotaManager::CreateDirectoryMetadata2 arguments; r=dom-storage-reviewers,hsingh\n\nRefactors CreateDirectoryMetadata2 to take a FullOriginMetadata object as a\nsingle argument instead of passing timestamp, persisted and OriginMetadata\nseparately. This simplifies usage, especially in the context of upcoming\nmetadata format expansion.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D246717",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-13 03:47:27",
          "files_modified": [
            "dom/quota/ActorsParent.cpp",
            "dom/quota/OriginOperations.cpp",
            "dom/quota/QuotaManager.h"
          ],
          "file_overlap_count": 3,
          "overlapping_files": [
            "dom/quota/OriginOperations.cpp",
            "dom/quota/ActorsParent.cpp",
            "dom/quota/QuotaManager.h"
          ],
          "components": [
            "Core::Storage: Quota Manager"
          ]
        },
        {
          "commit_hash": "26405156644df297d909840c938b81cb2f9ee812",
          "short_hash": "26405156644d",
          "description": "Bug 1962133 - QM: Rationalize QuotaManager::InitializeOrigin arguments; r=dom-storage-reviewers,hsingh\n\nRefactors InitializeOrigin to take FullOriginMetadata as a single argument\ninstead of passing the persistence type, origin metadata, accessed time, and\npersisted flag separately. This reduces redundancy, simplifies usage, and helps\nprevent mismatches between parameters.\n\nThis is a continuation of bug 1697115 which also focused on simplifying some\nQuotaManager methods by consolidating arguments.\n\nDifferential Revision: https://phabricator.services.mozilla.com/D247066",
          "author": "Jan Varga <jvarga@mozilla.com>",
          "pushdate": "2025-06-13 03:47:27",
          "files_modified": [
            "dom/quota/ActorsParent.cpp",
            "dom/quota/QuotaManager.h"
          ],
          "file_overlap_count": 2,
          "overlapping_files": [
            "dom/quota/QuotaManager.h",
            "dom/quota/ActorsParent.cpp"
          ],
          "components": [
            "Core::Storage: Quota Manager"
          ]
        }
      ],
      "commit_source": "bugbug"
    }
  ],
  "total_matching_regressor_commits": 7
}