# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/media/mp4/MP4Demuxer.cpp
# Commit: 1d5a44ae7207
# Full Hash: 1d5a44ae72071f079dcb00b62419c2ddd3c9f12c
# Author: Norisz Fay <nfay@mozilla.com>
# Date: 2023-01-27 21:11 +0200
# Regressor Bug: 1788119
# File Overlap Count: 1
# Overlapping Files: Cargo.lock
# Description:
#   Backed out 5 changesets (bug 1788119) for causing build bustages on DecoderData.cpp CLOSED TREE
# ==============================================================================

diff -r 83609f9575ac -r 1d5a44ae7207 dom/media/mp4/MP4Demuxer.cpp
--- a/dom/media/mp4/MP4Demuxer.cpp	Fri Jan 27 19:06:16 2023 +0000
+++ b/dom/media/mp4/MP4Demuxer.cpp	Fri Jan 27 21:11:42 2023 +0200
@@ -13,6 +13,7 @@
 #include "AnnexB.h"
 #include "BufferStream.h"
 #include "H264.h"
+#include "Index.h"
 #include "MP4Decoder.h"
 #include "MP4Metadata.h"
 #include "MoofParser.h"
@@ -22,7 +23,6 @@
 #include "mozilla/StaticPrefs_media.h"
 #include "mozilla/Telemetry.h"
 #include "nsPrintfCString.h"
-#include "SampleIterator.h"
 
 extern mozilla::LazyLogModule gMediaDemuxerLog;
 mozilla::LogModule* GetDemuxerLog() { return gMediaDemuxerLog; }
@@ -66,7 +66,7 @@
   RefPtr<MediaResource> mResource;
   RefPtr<ResourceStream> mStream;
   UniquePtr<TrackInfo> mInfo;
-  RefPtr<MP4SampleIndex> mIndex;
+  RefPtr<Index> mIndex;
   UniquePtr<SampleIterator> mIterator;
   Maybe<media::TimeUnit> mNextKeyframeTime;
   // Queued samples extracted by the demuxer, but not yet returned.
@@ -309,8 +309,7 @@
     : mResource(aResource),
       mStream(new ResourceStream(aResource)),
       mInfo(std::move(aInfo)),
-      mIndex(new MP4SampleIndex(aIndices, mStream, mInfo->mTrackId,
-                                mInfo->IsAudio())),
+      mIndex(new Index(aIndices, mStream, mInfo->mTrackId, mInfo->IsAudio())),
       mIterator(MakeUnique<SampleIterator>(mIndex)),
       mNeedReIndex(true) {
   EnsureUpToDateIndex();  // Force update of index