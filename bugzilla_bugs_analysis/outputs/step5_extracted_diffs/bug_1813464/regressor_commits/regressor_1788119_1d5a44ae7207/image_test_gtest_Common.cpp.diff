# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: image/test/gtest/Common.cpp
# Commit: 1d5a44ae7207
# Full Hash: 1d5a44ae72071f079dcb00b62419c2ddd3c9f12c
# Author: Norisz Fay <nfay@mozilla.com>
# Date: 2023-01-27 21:11 +0200
# Regressor Bug: 1788119
# File Overlap Count: 1
# Overlapping Files: Cargo.lock
# Description:
#   Backed out 5 changesets (bug 1788119) for causing build bustages on DecoderData.cpp CLOSED TREE
# ==============================================================================

diff -r 83609f9575ac -r 1d5a44ae7207 image/test/gtest/Common.cpp
--- a/image/test/gtest/Common.cpp	Fri Jan 27 19:06:16 2023 +0000
+++ b/image/test/gtest/Common.cpp	Fri Jan 27 21:11:42 2023 +0200
@@ -46,8 +46,6 @@
   // Ensure AVIF is enabled to run decoder tests.
   rv = Preferences::SetBool("image.avif.enabled", true);
   EXPECT_TRUE(rv == NS_OK);
-  rv = Preferences::SetBool("image.avif.sequence.enabled", true);
-  EXPECT_TRUE(rv == NS_OK);
 
 #ifdef MOZ_JXL
   // Ensure JXL is enabled to run decoder tests.
@@ -218,18 +216,11 @@
             abs(pmColor.mGreen - gotColor.mGreen) > aFuzz ||
             abs(pmColor.mRed - gotColor.mRed) > aFuzz ||
             abs(pmColor.mAlpha - gotColor.mAlpha) > aFuzz) {
-          EXPECT_EQ(expectedPixel, gotPixel)
-              << "Color mismatch for rectangle from " << aRect.TopLeft()
-              << " to " << aRect.BottomRight() << ": "
-              << "got rgba(" << static_cast<int>(gotColor.mRed) << ", "
-              << static_cast<int>(gotColor.mGreen) << ", "
-              << static_cast<int>(gotColor.mBlue) << ", "
-              << static_cast<int>(gotColor.mAlpha) << "), "
-              << "expected rgba(" << static_cast<int>(pmColor.mRed) << ", "
-              << static_cast<int>(pmColor.mGreen) << ", "
-              << static_cast<int>(pmColor.mBlue) << ", "
-              << static_cast<int>(pmColor.mAlpha) << ")";
-          return false;
+          EXPECT_EQ(pmColor.mBlue, gotColor.mBlue);
+          EXPECT_EQ(pmColor.mGreen, gotColor.mGreen);
+          EXPECT_EQ(pmColor.mRed, gotColor.mRed);
+          EXPECT_EQ(pmColor.mAlpha, gotColor.mAlpha);
+          ASSERT_EQ_OR_RETURN(expectedPixel, gotPixel, false);
         }
       }
     }
@@ -756,11 +747,6 @@
                        IntSize(100, 100), TEST_CASE_IS_ANIMATED);
 }
 
-ImageTestCase GreenFirstFrameAnimatedAVIFTestCase() {
-  return ImageTestCase("first-frame-green.avif", "image/avif",
-                       IntSize(100, 100), TEST_CASE_IS_ANIMATED);
-}
-
 ImageTestCase BlendAnimatedGIFTestCase() {
   return ImageTestCase("blend.gif", "image/gif", IntSize(100, 100),
                        TEST_CASE_IS_ANIMATED);
@@ -776,11 +762,6 @@
                        TEST_CASE_IS_TRANSPARENT | TEST_CASE_IS_ANIMATED);
 }
 
-ImageTestCase BlendAnimatedAVIFTestCase() {
-  return ImageTestCase("blend.avif", "image/avif", IntSize(100, 100),
-                       TEST_CASE_IS_TRANSPARENT | TEST_CASE_IS_ANIMATED);
-}
-
 ImageTestCase CorruptTestCase() {
   return ImageTestCase("corrupt.jpg", "image/jpeg", IntSize(100, 100),
                        TEST_CASE_HAS_ERROR);