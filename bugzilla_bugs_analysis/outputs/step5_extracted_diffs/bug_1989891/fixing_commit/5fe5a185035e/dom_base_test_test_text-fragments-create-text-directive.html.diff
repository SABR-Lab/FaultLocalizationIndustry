# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: dom/base/test/test_text-fragments-create-text-directive.html
# Commit: 5fe5a185035e
# Full Hash: 5fe5a185035e90b142f267c768f8b019256f25d9
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-09-23 17:35 +0000
# Description:
#   Bug 1989891 - Text Fragments: Ensure context terms don't start/end with whitespace when reaching maximum length. r=smaug
# ==============================================================================

diff -r c84a239b905e -r 5fe5a185035e dom/base/test/test_text-fragments-create-text-directive.html
--- a/dom/base/test/test_text-fragments-create-text-directive.html	Tue Sep 23 17:01:42 2025 +0000
+++ b/dom/base/test/test_text-fragments-create-text-directive.html	Tue Sep 23 17:35:19 2025 +0000
@@ -78,6 +78,31 @@
   <!-- note that "text" must already exist in the page to trigger this. -->
   <p id="rangeBasedWithPunctuationAfterFirstWordStart">Text: the colon</p>
   <p id="rangeBasedWithPunctuationAfterFirstWordEnd">is important here</p>
+  <!-- (crash)Test case for bug 1989891 -->
+  <p>1 1111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+<span id="prefixAndSuffixHitMaxLength">test</span>
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
+1111111111111 1
+</p>
   <script>
     document.addEventListener("DOMContentLoaded", () => {
       const empty = document.createTextNode("");
@@ -463,7 +488,16 @@
           endOffset: rangeBasedWithPunctuationAfterFirstWordEnd.firstChild.length,
           content: "Text: the colon\n  is important here",
           textDirective: "text=Text%3A%20the,here",
-        }
+        },
+        {
+          name: "Prefix and suffix hit max length at whitespace",
+          startContainer: prefixAndSuffixHitMaxLength.firstChild,
+          startOffset: 0,
+          endContainer: prefixAndSuffixHitMaxLength.firstChild,
+          endOffset: prefixAndSuffixHitMaxLength.firstChild.length,
+          content: "test",
+          textDirective: "text=test,-1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
+        },
       ]) {
         const range = document.createRange();
         range.setStart(testCase.startContainer, testCase.startOffset);
