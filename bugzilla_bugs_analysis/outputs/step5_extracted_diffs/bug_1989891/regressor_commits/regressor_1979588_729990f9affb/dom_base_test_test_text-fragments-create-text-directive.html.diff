# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/test/test_text-fragments-create-text-directive.html
# Commit: 729990f9affb
# Full Hash: 729990f9affbcbc05925bf1cbc5749016664bc3f
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-09-09 20:57:47
# Regressor Bug: 1979588
# File Overlap Count: 2
# Overlapping Files: dom/base/test/test_text-fragments-create-text-directive.html, dom/base/TextDirectiveCreator.cpp
# Description:
#   Bug 1979588 - Text Fragments: Correctly deal with long words at end of range for range-based matching. r=dom-core,smaug
#   
#   The range-based approach for creating a text directive uses the word breaker algorithm
#   to identify where to split between `start` and `end` term. If the range ends with a word
#   which is over 50% of the length content, the algorithm would return wordEnd=length,
# ==============================================================================

diff -r 12d0bf6a782e -r 729990f9affb dom/base/test/test_text-fragments-create-text-directive.html
--- a/dom/base/test/test_text-fragments-create-text-directive.html	Tue Sep 09 14:32:24 2025 +0000
+++ b/dom/base/test/test_text-fragments-create-text-directive.html	Tue Sep 09 14:35:37 2025 +0000
@@ -43,6 +43,8 @@
   <div>HereEndsATableAndThisIsHereToMakeSureTheTestResultsAreIndependentOfSurroundingContent</div>
 
   <span id="longWord">1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</span>
+  <!-- Test case for Bug 1979588: Long URL with unbreakable segment at the end -->
+  <div id="longUrlForBug1979588">https://example.com/test?foo=bar#verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation</div>
   <p id="loremIpsum">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
   <p>
     <span id="beforeEmptyTextNode">before empty text node</span>
@@ -429,6 +431,15 @@
           textDirective: "text=%7D",
           dontCompareRangeBoundaries: true,
         },
+        {
+          name: "Test for Bug 1979588: Long URL with unbreakable segment should not crash",
+          startContainer: longUrlForBug1979588.firstChild,
+          startOffset: 0,
+          endContainer: longUrlForBug1979588.firstChild,
+          endOffset: longUrlForBug1979588.firstChild.length,
+          content: "https://example.com/test?foo=bar#verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation",
+          textDirective: "text=https,verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation",
+        },
       ]) {
         const range = document.createRange();
         range.setStart(testCase.startContainer, testCase.startOffset);
