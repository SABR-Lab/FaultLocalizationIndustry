# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: dom/base/test/test_text-fragments-create-text-directive.html
# Commit: a9560be525c8
# Full Hash: a9560be525c8880189debb175e8ad3fa9e56ba49
# Author: Jan-Niklas Jaeschke <jjaschke@mozilla.com>
# Date: 2025-09-10 21:28:29
# Regressor Bug: 1979588
# File Overlap Count: 2
# Overlapping Files: dom/base/test/test_text-fragments-create-text-directive.html, dom/base/TextDirectiveCreator.cpp
# Description:
#   Bug 1979588 - Text Fragments: Correctly deal with long words at end of range for range-based matching. r=dom-core,smaug
#   
#   The range-based approach for creating a text directive uses the word breaker algorithm
#   to identify where to split between `start` and `end` term. If the range ends with a word
#   which is over 50% of the length content, the algorithm would return wordEnd=length,
# ==============================================================================

diff -r b6966486a1dd -r a9560be525c8 dom/base/test/test_text-fragments-create-text-directive.html
--- a/dom/base/test/test_text-fragments-create-text-directive.html	Wed Sep 10 12:06:33 2025 +0000
+++ b/dom/base/test/test_text-fragments-create-text-directive.html	Wed Sep 10 12:33:30 2025 +0000
@@ -43,6 +43,8 @@
   <div>HereEndsATableAndThisIsHereToMakeSureTheTestResultsAreIndependentOfSurroundingContent</div>
 
   <span id="longWord">1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</span>
+  <!-- Test case for Bug 1979588: Long URL with unbreakable segment at the end -->
+  <div id="longUrlForBug1979588">https://example.com/test?foo=bar#verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation</div>
   <p id="loremIpsum">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
   <p>
     <span id="beforeEmptyTextNode">before empty text node</span>
@@ -70,6 +72,10 @@
       <td>foo</td>
     </tr>
   </table>
+  <!-- (crash)Test case for Bug 1987845; example paragraph found on https://en.wikipedia.org/wiki/Nuclear_weapon-->
+  <p>Nuclear<!-- This is needed so that there is an additional match to consider --></p>
+  <p id="rangeBasedWihSpaceInTheMiddle">Nuclear weapons have only twice been used in warfare, both times by the United States against Japan at the end of World War II. On August 6, 1945, the United States Army Air Forces (USAAF) detonated a uranium gun-type fission bomb nicknamed "Little Boy" over the Japanese city of Hiroshima; three days later, on August 9, the USAAF[4] detonated a plutonium implosion-type fission bomb nicknamed "Fat Man" over the Japanese city of Nagasaki. These bombings caused injuries that resulted in the deaths of approximately 200,000 civilians and military personnel.[5] The ethics of these bombings and their role in Japan's surrender are to this day, still subjects of debate</p>
+
   <script>
     document.addEventListener("DOMContentLoaded", () => {
       const empty = document.createTextNode("");
@@ -429,6 +435,24 @@
           textDirective: "text=%7D",
           dontCompareRangeBoundaries: true,
         },
+        {
+          name: "Test for Bug 1979588: Long URL with unbreakable segment should not crash",
+          startContainer: longUrlForBug1979588.firstChild,
+          startOffset: 0,
+          endContainer: longUrlForBug1979588.firstChild,
+          endOffset: longUrlForBug1979588.firstChild.length,
+          content: "https://example.com/test?foo=bar#verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation",
+          textDirective: "text=https,verylongnonbreakableurlsegmentthatcannotbebrokenintowordsbecauseiturlsegmentsdonotcontainspacesorothertraditionwordbreakingcharacterswhichcausesproblemsintextdirectivecreation",
+        },
+        {
+          name: "Test for Bug 1987845: Long text with spaces in the middle",
+          startContainer: rangeBasedWihSpaceInTheMiddle.firstChild,
+          startOffset: 0,
+          endContainer: rangeBasedWihSpaceInTheMiddle.firstChild,
+          endOffset: rangeBasedWihSpaceInTheMiddle.firstChild.length,
+          content: "Nuclear weapons have only twice been used in warfare, both times by the United States against Japan at the end of World War II. On August 6, 1945, the United States Army Air Forces (USAAF) detonated a uranium gun-type fission bomb nicknamed \"Little Boy\" over the Japanese city of Hiroshima; three days later, on August 9, the USAAF[4] detonated a plutonium implosion-type fission bomb nicknamed \"Fat Man\" over the Japanese city of Nagasaki. These bombings caused injuries that resulted in the deaths of approximately 200,000 civilians and military personnel.[5] The ethics of these bombings and their role in Japan's surrender are to this day, still subjects of debate",
+          textDirective: "text=Nuclear%20weapons,debate",
+        }
       ]) {
         const range = document.createRange();
         range.setStart(testCase.startContainer, testCase.startOffset);
