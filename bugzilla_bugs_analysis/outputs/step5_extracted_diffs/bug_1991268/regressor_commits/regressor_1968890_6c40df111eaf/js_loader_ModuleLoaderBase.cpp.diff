# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: js/loader/ModuleLoaderBase.cpp
# Commit: 6c40df111eaf
# Full Hash: 6c40df111eafd06f61381f8e6caa822d6180636f
# Author: Yoshi Cheng-Hao Huang <allstars.chh@gmail.com>
# Date: 2025-10-03 20:53 +0000
# Regressor Bug: 1968890
# File Overlap Count: 1
# Overlapping Files: js/loader/ModuleLoaderBase.cpp
# Description:
#   Bug 1968890 - Part 10: Check if the request has been canceled in reject handler. r=jonco
# ==============================================================================

diff -r b83b3c1baa19 -r 6c40df111eaf js/loader/ModuleLoaderBase.cpp
--- a/js/loader/ModuleLoaderBase.cpp	Fri Oct 03 20:53:30 2025 +0000
+++ b/js/loader/ModuleLoaderBase.cpp	Fri Oct 03 20:53:30 2025 +0000
@@ -1337,6 +1337,11 @@
     JSContext* aCx, ModuleLoadRequest* aRequest, Handle<Value> error) {
   ModuleScript* moduleScript = aRequest->mModuleScript;
 
+  if (aRequest->IsCanceled()) {
+    aRequest->Release();
+    return true;
+  }
+
   // TODO, Bug 1990416: Align the loading descendants behavior of dynamic import
   if (aRequest->IsDynamicImport()) {
     LOG(
