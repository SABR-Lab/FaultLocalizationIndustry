# ==============================================================================
# FIXING COMMIT DIFF
# ==============================================================================
# File: netwerk/cookie/CookieValidation.cpp
# Commit: fe6e63a2f914
# Full Hash: fe6e63a2f9141d9eeec41bfde52cc34b33c170fe
# Author: Andrea Marchesini <amarchesini@mozilla.com>
# Date: 2025-10-09 14:54 +0000
# Description:
#   Bug 1992536 - Use cookie creation time instead or PR_Now() to validate the expiration time, r=valentin,cookie-reviewers
# ==============================================================================

diff -r 0147060f88c2 -r fe6e63a2f914 netwerk/cookie/CookieValidation.cpp
--- a/netwerk/cookie/CookieValidation.cpp	Thu Oct 09 14:36:53 2025 +0000
+++ b/netwerk/cookie/CookieValidation.cpp	Thu Oct 09 14:54:32 2025 +0000
@@ -115,7 +115,7 @@
   // This part checks if the caleers have set the expiry value to max 400 days.
   if (!mCookieData.isSession()) {
     int64_t maxageCap = StaticPrefs::network_cookie_maxageCap();
-    int64_t currentTimeInMSec = PR_Now() / PR_USEC_PER_MSEC;
+    int64_t currentTimeInMSec = mCookieData.creationTime() / PR_USEC_PER_MSEC;
     int64_t expiry = mCookieData.expiry();
     if (maxageCap && expiry > currentTimeInMSec + maxageCap * 1000) {
       mResult = eRejectedAttributeExpiryOversize;
