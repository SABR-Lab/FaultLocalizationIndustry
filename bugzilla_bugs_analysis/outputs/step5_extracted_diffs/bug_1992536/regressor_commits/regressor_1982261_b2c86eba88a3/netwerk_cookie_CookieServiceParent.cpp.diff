# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: netwerk/cookie/CookieServiceParent.cpp
# Commit: b2c86eba88a3
# Full Hash: b2c86eba88a348fb99ed75b0c1aed59848c0d451
# Author: Andrea Marchesini <amarchesini@mozilla.com>
# Date: 2025-09-17 17:41 +0000
# Regressor Bug: 1982261
# File Overlap Count: 1
# Overlapping Files: netwerk/cookie/CookieService.cpp
# Description:
#   Bug 1982261 - CookieServiceParent logs about invalid cookies instead of crashing,  a=dmeehan DONTBUILD
# ==============================================================================

diff -r b889a3daa95f -r b2c86eba88a3 netwerk/cookie/CookieServiceParent.cpp
--- a/netwerk/cookie/CookieServiceParent.cpp	Wed Sep 17 13:33:37 2025 +0000
+++ b/netwerk/cookie/CookieServiceParent.cpp	Wed Sep 17 17:41:13 2025 +0000
@@ -338,10 +338,18 @@
   // update, to make sure we don't send it back to the same content process.
   CookieProcessingGuard guard(this);
 
-  bool ok = mCookieService->SetCookiesFromIPC(aBaseDomain, aOriginAttributes,
-                                              aHost, aFromHttp, aIsThirdParty,
-                                              aCookies, aBrowsingContext);
-  return ok ? IPC_OK() : IPC_FAIL(this, "Invalid cookie received.");
+  nsICookieValidation::ValidationError error =
+      mCookieService->SetCookiesFromIPC(aBaseDomain, aOriginAttributes, aHost,
+                                        aFromHttp, aIsThirdParty, aCookies,
+                                        aBrowsingContext);
+  MOZ_DIAGNOSTIC_ASSERT(error == nsICookieValidation::eOK);
+
+  if (error != nsICookieValidation::eOK) {
+    MOZ_LOG(gCookieLog, LogLevel::Warning,
+            ("Invalid cookie submission from the content process: %d", error));
+  }
+
+  return IPC_OK();
 }
 
 }  // namespace net
