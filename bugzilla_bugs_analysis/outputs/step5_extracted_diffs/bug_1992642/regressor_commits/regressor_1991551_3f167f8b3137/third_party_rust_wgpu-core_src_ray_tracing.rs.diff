# ==============================================================================
# REGRESSOR COMMIT DIFF
# ==============================================================================
# File: third_party/rust/wgpu-core/src/ray_tracing.rs
# Commit: 3f167f8b3137
# Full Hash: 3f167f8b313749f50f135e189e5854bef7ac0c73
# Author: Erich Gubler <erichdongubler@gmail.com>
# Date: 2025-10-03 18:08 +0000
# Regressor Bug: 1991551
# File Overlap Count: 23
# Overlapping Files: third_party/rust/wgpu-hal/Cargo.toml, supply-chain/audits.toml, third_party/rust/naga/src/back/spv/writer.rs, third_party/rust/naga/src/back/msl/writer.rs, third_party/rust/wgpu-types/src/lib.rs
# Description:
#   Bug 1991551 - build(webgpu): update WGPU to 8c4aebc0c1b75e3f7412dfc180745a0717fc30ec r=webgpu-reviewers,supply-chain-reviewers,nical
# ==============================================================================

diff -r 823439f307a0 -r 3f167f8b3137 third_party/rust/wgpu-core/src/ray_tracing.rs
--- a/third_party/rust/wgpu-core/src/ray_tracing.rs	Fri Oct 03 18:01:30 2025 +0000
+++ b/third_party/rust/wgpu-core/src/ray_tracing.rs	Fri Oct 03 18:08:29 2025 +0000
@@ -21,7 +21,7 @@
     device::{DeviceError, MissingFeatures},
     id::{BlasId, BufferId, TlasId},
     resource::{
-        Blas, BlasCompactCallback, BlasPrepareCompactResult, DestroyedResourceError,
+        Blas, BlasCompactCallback, BlasPrepareCompactResult, Buffer, DestroyedResourceError,
         InvalidResourceError, MissingBufferUsageError, ResourceErrorIdent, Tlas,
     },
 };
@@ -304,6 +304,7 @@
     UseTlas(Arc<Tlas>),
 }
 
+/// Like [`BlasTriangleGeometry`], but with owned data.
 #[derive(Debug, Clone)]
 #[cfg_attr(feature = "serde", derive(serde::Serialize, serde::Deserialize))]
 pub struct TraceBlasTriangleGeometry {
@@ -347,6 +348,55 @@
     pub lowest_unmodified: u32,
 }
 
+/// Like [`BlasTriangleGeometry`], but with `Arc`s.
+#[derive(Debug, Clone)]
+pub struct ArcBlasTriangleGeometry {
+    pub size: wgt::BlasTriangleGeometrySizeDescriptor,
+    pub vertex_buffer: Arc<Buffer>,
+    pub index_buffer: Option<Arc<Buffer>>,
+    pub transform_buffer: Option<Arc<Buffer>>,
+    pub first_vertex: u32,
+    pub vertex_stride: BufferAddress,
+    pub first_index: Option<u32>,
+    pub transform_buffer_offset: Option<BufferAddress>,
+}
+
+/// [`BlasTriangleGeometry`], without the resources.
+#[derive(Debug, Clone)]
+pub struct BlasTriangleGeometryInfo {
+    pub size: wgt::BlasTriangleGeometrySizeDescriptor,
+    pub first_vertex: u32,
+    pub vertex_stride: BufferAddress,
+    pub first_index: Option<u32>,
+    pub transform_buffer_offset: Option<BufferAddress>,
+}
+
+#[derive(Debug, Clone)]
+pub enum ArcBlasGeometries {
+    TriangleGeometries(Vec<ArcBlasTriangleGeometry>),
+}
+
+#[derive(Debug, Clone)]
+pub struct ArcBlasBuildEntry {
+    pub blas: Arc<Blas>,
+    pub geometries: ArcBlasGeometries,
+}
+
+#[derive(Debug, Clone)]
+pub struct ArcTlasInstance {
+    pub blas: Arc<Blas>,
+    pub transform: [f32; 12],
+    pub custom_data: u32,
+    pub mask: u8,
+}
+
+#[derive(Debug, Clone)]
+pub struct ArcTlasPackage {
+    pub tlas: Arc<Tlas>,
+    pub instances: Vec<Option<ArcTlasInstance>>,
+    pub lowest_unmodified: u32,
+}
+
 #[derive(Clone, Debug, Error)]
 pub enum BlasPrepareCompactError {
     #[error(transparent)]